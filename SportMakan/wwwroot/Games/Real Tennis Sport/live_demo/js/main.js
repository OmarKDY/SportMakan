!function(l){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=l();else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self);b.CANNON=l()}}(function(){return function a(b,g,m){function e(f,p){if(!g[f]){if(!b[f]){var q="function"==typeof require&&require;if(!p&&q)return q(f,!0);if(d)return d(f,!0);throw Error("Cannot find module '"+f+"'");}q=g[f]={exports:{}};b[f][0].call(q.exports,function(a){var d=b[f][1][a];return e(d?
d:a)},q,q.exports,a,b,g,m)}return g[f].exports}for(var d="function"==typeof require&&require,q=0;q<m.length;q++)e(m[q]);return e}({1:[function(b,g,m){g.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},
bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(b,g,m){g.exports={version:b("../package.json").version,AABB:b("./collision/AABB"),ArrayCollisionMatrix:b("./collision/ArrayCollisionMatrix"),
Body:b("./objects/Body"),Box:b("./shapes/Box"),Broadphase:b("./collision/Broadphase"),Constraint:b("./constraints/Constraint"),ContactEquation:b("./equations/ContactEquation"),Narrowphase:b("./world/Narrowphase"),ConeTwistConstraint:b("./constraints/ConeTwistConstraint"),ContactMaterial:b("./material/ContactMaterial"),ConvexPolyhedron:b("./shapes/ConvexPolyhedron"),Cylinder:b("./shapes/Cylinder"),DistanceConstraint:b("./constraints/DistanceConstraint"),Equation:b("./equations/Equation"),EventTarget:b("./utils/EventTarget"),
FrictionEquation:b("./equations/FrictionEquation"),GSSolver:b("./solver/GSSolver"),GridBroadphase:b("./collision/GridBroadphase"),Heightfield:b("./shapes/Heightfield"),HingeConstraint:b("./constraints/HingeConstraint"),LockConstraint:b("./constraints/LockConstraint"),Mat3:b("./math/Mat3"),Material:b("./material/Material"),NaiveBroadphase:b("./collision/NaiveBroadphase"),ObjectCollisionMatrix:b("./collision/ObjectCollisionMatrix"),Pool:b("./utils/Pool"),Particle:b("./shapes/Particle"),Plane:b("./shapes/Plane"),
PointToPointConstraint:b("./constraints/PointToPointConstraint"),Quaternion:b("./math/Quaternion"),Ray:b("./collision/Ray"),RaycastVehicle:b("./objects/RaycastVehicle"),RaycastResult:b("./collision/RaycastResult"),RigidVehicle:b("./objects/RigidVehicle"),RotationalEquation:b("./equations/RotationalEquation"),RotationalMotorEquation:b("./equations/RotationalMotorEquation"),SAPBroadphase:b("./collision/SAPBroadphase"),SPHSystem:b("./objects/SPHSystem"),Shape:b("./shapes/Shape"),Solver:b("./solver/Solver"),
Sphere:b("./shapes/Sphere"),SplitSolver:b("./solver/SplitSolver"),Spring:b("./objects/Spring"),Trimesh:b("./shapes/Trimesh"),Vec3:b("./math/Vec3"),Vec3Pool:b("./utils/Vec3Pool"),World:b("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,
"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,
"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(b,g,m){function a(a){a=a||{};
this.lowerBound=new e;a.lowerBound&&this.lowerBound.copy(a.lowerBound);this.upperBound=new e;a.upperBound&&this.upperBound.copy(a.upperBound)}var e=b("../math/Vec3");b("../utils/Utils");g.exports=a;var d=new e;a.prototype.setFromPoints=function(a,p,e,b){var k=this.lowerBound,f=this.upperBound;k.copy(a[0]);e&&e.vmult(k,k);f.copy(k);for(var n=1;n<a.length;n++){var q=a[n];e&&(e.vmult(q,d),q=d);q.x>f.x&&(f.x=q.x);q.x<k.x&&(k.x=q.x);q.y>f.y&&(f.y=q.y);q.y<k.y&&(k.y=q.y);q.z>f.z&&(f.z=q.z);q.z<k.z&&(k.z=
q.z)}p&&(p.vadd(k,k),p.vadd(f,f));b&&(k.x-=b,k.y-=b,k.z-=b,f.x+=b,f.y+=b,f.z+=b);return this};a.prototype.copy=function(a){this.lowerBound.copy(a.lowerBound);this.upperBound.copy(a.upperBound);return this};a.prototype.clone=function(){return(new a).copy(this)};a.prototype.extend=function(a){var d=a.lowerBound.x;this.lowerBound.x>d&&(this.lowerBound.x=d);d=a.upperBound.x;this.upperBound.x<d&&(this.upperBound.x=d);d=a.lowerBound.y;this.lowerBound.y>d&&(this.lowerBound.y=d);d=a.upperBound.y;this.upperBound.y<
d&&(this.upperBound.y=d);d=a.lowerBound.z;this.lowerBound.z>d&&(this.lowerBound.z=d);d=a.upperBound.z;this.upperBound.z<d&&(this.upperBound.z=d)};a.prototype.overlaps=function(a){var d=this.lowerBound,f=this.upperBound,e=a.lowerBound;a=a.upperBound;return(e.x<=f.x&&f.x<=a.x||d.x<=a.x&&a.x<=f.x)&&(e.y<=f.y&&f.y<=a.y||d.y<=a.y&&a.y<=f.y)&&(e.z<=f.z&&f.z<=a.z||d.z<=a.z&&a.z<=f.z)};a.prototype.contains=function(a){var d=this.lowerBound,f=this.upperBound,e=a.lowerBound;a=a.upperBound;return d.x<=e.x&&
f.x>=a.x&&d.y<=e.y&&f.y>=a.y&&d.z<=e.z&&f.z>=a.z};a.prototype.getCorners=function(a,d,e,b,k,r,n,q){var f=this.lowerBound,p=this.upperBound;a.copy(f);d.set(p.x,f.y,f.z);e.set(p.x,p.y,f.z);b.set(f.x,p.y,p.z);k.set(p.x,f.y,f.z);r.set(f.x,p.y,f.z);n.set(f.x,f.y,p.z);q.copy(p)};var q=[new e,new e,new e,new e,new e,new e,new e,new e];a.prototype.toLocalFrame=function(a,d){this.getCorners(q[0],q[1],q[2],q[3],q[4],q[5],q[6],q[7]);for(var f=0;8!==f;f++){var e=q[f];a.pointToLocal(e,e)}return d.setFromPoints(q)};
a.prototype.toWorldFrame=function(a,d){this.getCorners(q[0],q[1],q[2],q[3],q[4],q[5],q[6],q[7]);for(var f=0;8!==f;f++){var e=q[f];a.pointToWorld(e,e)}return d.setFromPoints(q)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(b,g,m){function a(){this.matrix=[]}g.exports=a;a.prototype.get=function(a,d){a=a.index;d=d.index;if(d>a){var e=d;d=a;a=e}return this.matrix[(a*(a+1)>>1)+d-1]};a.prototype.set=function(a,d,b){a=a.index;d=d.index;if(d>a){var f=d;d=a;a=f}this.matrix[(a*(a+1)>>1)+d-1]=b?1:0};
a.prototype.reset=function(){for(var a=0,d=this.matrix.length;a!==d;a++)this.matrix[a]=0};a.prototype.setNumObjects=function(a){this.matrix.length=a*(a-1)>>1}},{}],5:[function(b,g,m){function a(){this.world=null;this.useBoundingBoxes=!1;this.dirty=!0}var e=b("../objects/Body");m=b("../math/Vec3");var d=b("../math/Quaternion");b("../shapes/Shape");b("../shapes/Plane");g.exports=a;a.prototype.collisionPairs=function(a,d,k){throw Error("collisionPairs not implemented for this BroadPhase class!");};var q=
e.STATIC|e.KINEMATIC;a.prototype.needBroadphaseCollision=function(a,d){return 0!==(a.collisionFilterGroup&d.collisionFilterMask)&&0!==(d.collisionFilterGroup&a.collisionFilterMask)&&(0===(a.type&q)&&a.sleepState!==e.SLEEPING||0===(d.type&q)&&d.sleepState!==e.SLEEPING)?!0:!1};a.prototype.intersectionTest=function(a,d,k,f){this.useBoundingBoxes?this.doBoundingBoxBroadphase(a,d,k,f):this.doBoundingSphereBroadphase(a,d,k,f)};var f=new m;new m;new d;new m;a.prototype.doBoundingSphereBroadphase=function(a,
d,k,e){d.position.vsub(a.position,f);var r=Math.pow(a.boundingRadius+d.boundingRadius,2);f.norm2()<r&&(k.push(a),e.push(d))};a.prototype.doBoundingBoxBroadphase=function(a,d,k,f){a.aabbNeedsUpdate&&a.computeAABB();d.aabbNeedsUpdate&&d.computeAABB();a.aabb.overlaps(d.aabb)&&(k.push(a),f.push(d))};var p={keys:[]},w=[],u=[];a.prototype.makePairsUnique=function(a,d){for(var k=a.length,f=0;f!==k;f++)w[f]=a[f],u[f]=d[f];a.length=0;for(f=d.length=0;f!==k;f++){var r=w[f].id,n=u[f].id;r=r<n?r+","+n:n+","+
r;p[r]=f;p.keys.push(r)}for(f=0;f!==p.keys.length;f++)r=p.keys.pop(),k=p[r],a.push(w[k]),d.push(u[k]),delete p[r]};a.prototype.setWorld=function(a){};var k=new m;a.boundingSphereCheck=function(a,d){a.position.vsub(d.position,k);return Math.pow(a.shape.boundingSphereRadius+d.shape.boundingSphereRadius,2)>k.norm2()};a.prototype.aabbQuery=function(a,d,k){console.warn(".aabbQuery is not implemented in this Broadphase subclass.");return[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,
"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(b,g,m){function a(a,f,b,k,r){e.apply(this);this.nx=b||10;this.ny=k||10;this.nz=r||10;this.aabbMin=a||new d(100,100,100);this.aabbMax=f||new d(-100,-100,-100);a=this.nx*this.ny*this.nz;if(0>=a)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[];this.binLengths=[];this.bins.length=a;this.binLengths.length=a;for(f=0;f<a;f++)this.bins[f]=[],this.binLengths[f]=0}g.exports=a;var e=b("./Broadphase"),d=b("../math/Vec3"),q=b("../shapes/Shape");
a.prototype=new e;a.prototype.constructor=a;var f=new d;new d;a.prototype.collisionPairs=function(a,d,e){function k(a,d,k,f,r,n,b){a=(a-I)*O|0;d=(d-B)*L|0;k=(k-Q)*H|0;f=S((f-I)*O);r=S((r-B)*L);n=S((n-Q)*H);0>a?a=0:a>=p&&(a=p-1);0>d?d=0:d>=g&&(d=g-1);0>k?k=0:k>=u&&(k=u-1);0>f?f=0:f>=p&&(f=p-1);0>r?r=0:r>=g&&(r=g-1);0>n?n=0:n>=u&&(n=u-1);a*=w;d*=m;k*=1;f*=w;r*=m;for(n*=1;a<=f;a+=w)for(var e=d;e<=r;e+=m)for(var q=k;q<=n;q+=1){var v=a+e+q;J[v][T[v]++]=b}}var r=a.numObjects();a=a.bodies;var n=this.aabbMax,
b=this.aabbMin,p=this.nx,g=this.ny,u=this.nz,w=g*u,m=u,F=n.x,G=n.y,K=n.z,I=b.x,B=b.y,Q=b.z,O=p/(F-I),L=g/(G-B),H=u/(K-Q);F=(F-I)/p;var W=(G-B)/g;K=(K-Q)/u;var ba=.5*Math.sqrt(F*F+W*W+K*K);G=q.types;var X=G.SPHERE,R=G.PLANE,J=this.bins,T=this.binLengths;G=this.bins.length;for(b=0;b!==G;b++)T[b]=0;var S=Math.ceil;b=Math.min;n=Math.max;for(b=0;b!==r;b++){n=a[b];var ea=n.shape;switch(ea.type){case X:var U=n.position.x,qa=n.position.y,ha=n.position.z;ea=ea.radius;k(U-ea,qa-ea,ha-ea,U+ea,qa+ea,ha+ea,n);
break;case R:ea.worldNormalNeedsUpdate&&ea.computeWorldNormal(n.quaternion);ha=ea.worldNormal;ea=B+.5*W-n.position.y;var ja=Q+.5*K-n.position.z,V=f;V.set(I+.5*F-n.position.x,ea,ja);for(var Ia=U=0;U!==p;U++,Ia+=w,V.y=ea,V.x+=F)for(var na=qa=0;qa!==g;qa++,na+=m,V.z=ja,V.y+=W)for(var wa=0,Z=0;wa!==u;wa++,Z+=1,V.z+=K)if(V.dot(ha)<ba){var Aa=Ia+na+Z;J[Aa][T[Aa]++]=n}break;default:n.aabbNeedsUpdate&&n.computeAABB(),k(n.aabb.lowerBound.x,n.aabb.lowerBound.y,n.aabb.lowerBound.z,n.aabb.upperBound.x,n.aabb.upperBound.y,
n.aabb.upperBound.z,n)}}for(b=0;b!==G;b++)if(r=T[b],1<r)for(a=J[b],U=0;U!==r;U++)for(n=a[U],qa=0;qa!==U;qa++)F=a[qa],this.needBroadphaseCollision(n,F)&&this.intersectionTest(n,F,d,e);this.makePairsUnique(d,e)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(b,g,m){function a(){e.apply(this)}g.exports=a;var e=b("./Broadphase");b=b("./AABB");a.prototype=new e;a.prototype.constructor=a;a.prototype.collisionPairs=function(a,b,f){a=a.bodies;var d=a.length,e,q;for(e=0;e!==d;e++)for(q=
0;q!==e;q++){var k=a[e];var r=a[q];this.needBroadphaseCollision(k,r)&&this.intersectionTest(k,r,b,f)}};new b;a.prototype.aabbQuery=function(a,b,f){f=f||[];for(var d=0;d<a.bodies.length;d++){var e=a.bodies[d];e.aabbNeedsUpdate&&e.computeAABB();e.aabb.overlaps(b)&&f.push(e)}return f}},{"./AABB":3,"./Broadphase":5}],8:[function(b,g,m){function a(){this.matrix={}}g.exports=a;a.prototype.get=function(a,d){a=a.id;d=d.id;if(d>a){var b=d;d=a;a=b}return a+"-"+d in this.matrix};a.prototype.set=function(a,d,
b){a=a.id;d=d.id;if(d>a){var f=d;d=a;a=f}b?this.matrix[a+"-"+d]=!0:delete this.matrix[a+"-"+d]};a.prototype.reset=function(){this.matrix={}};a.prototype.setNumObjects=function(a){}},{}],9:[function(b,g,m){function a(k,r){this.from=k?k.clone():new d;this.to=r?r.clone():new d;this._direction=new d;this.precision=1E-4;this.checkCollisionResponse=!0;this.skipBackfaces=!1;this.collisionFilterGroup=this.collisionFilterMask=-1;this.mode=a.ANY;this.result=new f;this.hasHit=!1;this.callback=function(a){}}
function e(a,d,f,r){r.vsub(d,X);f.vsub(d,u);a.vsub(d,k);a=X.dot(X);d=X.dot(u);f=X.dot(k);r=u.dot(u);var n=u.dot(k),b,e;return 0<=(b=r*f-d*n)&&0<=(e=a*n-d*f)&&b+e<a*r-d*d}g.exports=a;var d=b("../math/Vec3");g=b("../math/Quaternion");var q=b("../math/Transform");b("../shapes/ConvexPolyhedron");b("../shapes/Box");var f=b("../collision/RaycastResult");m=b("../shapes/Shape");b=b("../collision/AABB");a.prototype.constructor=a;a.CLOSEST=1;a.ANY=2;a.ALL=4;var p=new b,w=[];a.prototype.intersectWorld=function(d,
k){this.mode=k.mode||a.ANY;this.result=k.result||new f;this.skipBackfaces=!!k.skipBackfaces;this.collisionFilterMask="undefined"!==typeof k.collisionFilterMask?k.collisionFilterMask:-1;this.collisionFilterGroup="undefined"!==typeof k.collisionFilterGroup?k.collisionFilterGroup:-1;k.from&&this.from.copy(k.from);k.to&&this.to.copy(k.to);this.callback=k.callback||function(){};this.hasHit=!1;this.result.reset();this._updateDirection();this.getAABB(p);w.length=0;d.broadphase.aabbQuery(d,p,w);this.intersectBodies(w);
return this.hasHit};var u=new d,k=new d;a.pointInTriangle=e;var r=new d,n=new g;a.prototype.intersectBody=function(a,d){d&&(this.result=d,this._updateDirection());var k=this.checkCollisionResponse;if((!k||a.collisionResponse)&&0!==(this.collisionFilterGroup&a.collisionFilterMask)&&0!==(a.collisionFilterGroup&this.collisionFilterMask))for(var f=0,b=a.shapes.length;f<b;f++){var e=a.shapes[f];if(!k||e.collisionResponse)if(a.quaternion.mult(a.shapeOrientations[f],n),a.quaternion.vmult(a.shapeOffsets[f],
r),r.vadd(a.position,r),this.intersectShape(e,n,r,a),this.result._shouldStop)break}};a.prototype.intersectBodies=function(a,d){d&&(this.result=d,this._updateDirection());for(var k=0,f=a.length;!this.result._shouldStop&&k<f;k++)this.intersectBody(a[k])};a.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction);this._direction.normalize()};a.prototype.intersectShape=function(a,d,k,f){var r=this.from,n=this._direction;k.vsub(r,X);var b=X.dot(n);n.mult(b,R);R.vadd(r,R);k.distanceTo(R)>
a.boundingSphereRadius||(r=this[a.type])&&r.call(this,a,d,k,f)};new d;new d;var v=new d,x=new d,z=new d,A=new d;new d;new f;a.prototype.intersectBox=function(a,d,k,f){return this.intersectConvex(a.convexPolyhedronRepresentation,d,k,f)};a.prototype[m.types.BOX]=a.prototype.intersectBox;a.prototype.intersectPlane=function(a,k,f,r){var n=this.from,b=this.to,e=this._direction,p=new d(0,0,1);k.vmult(p,p);var q=new d;n.vsub(f,q);k=q.dot(p);b.vsub(f,q);q=q.dot(p);if(!(0<k*q||n.distanceTo(b)<k||(q=p.dot(e),
Math.abs(q)<this.precision))){var g=new d;b=new d;k=new d;n.vsub(f,g);f=-p.dot(g)/q;e.scale(f,b);n.vadd(b,k);this.reportIntersection(p,k,a,r,-1)}};a.prototype[m.types.PLANE]=a.prototype.intersectPlane;a.prototype.getAABB=function(a){var d=this.to,k=this.from;a.lowerBound.x=Math.min(d.x,k.x);a.lowerBound.y=Math.min(d.y,k.y);a.lowerBound.z=Math.min(d.z,k.z);a.upperBound.x=Math.max(d.x,k.x);a.upperBound.y=Math.max(d.y,k.y);a.upperBound.z=Math.max(d.z,k.z)};var D={faceList:[0]};a.prototype.intersectHeightfield=
function(k,f,r,n){var b=new d,e=new a(this.from,this.to);q.pointToLocalFrame(r,f,e.from,e.from);q.pointToLocalFrame(r,f,e.to,e.to);var p=[],g=null,u=null,v=null,w=null,m=k.getIndexOfPosition(e.from.x,e.from.y,p,!1);m&&(g=p[0],u=p[1],v=p[0],w=p[1]);if(m=k.getIndexOfPosition(e.to.x,e.to.y,p,!1)){if(null===g||p[0]<g)g=p[0];if(null===v||p[0]>v)v=p[0];if(null===u||p[1]<u)u=p[1];if(null===w||p[1]>w)w=p[1]}if(null!==g)for(k.getRectMinMax(g,u,v,w,[]),e=g;e<=v;e++)for(p=u;p<=w;p++){if(this.result._shouldStop)return;
k.getConvexTrianglePillar(e,p,!1);q.pointToWorldFrame(r,f,k.pillarOffset,b);this.intersectConvex(k.pillarConvex,f,b,n,D);if(this.result._shouldStop)return;k.getConvexTrianglePillar(e,p,!0);q.pointToWorldFrame(r,f,k.pillarOffset,b);this.intersectConvex(k.pillarConvex,f,b,n,D)}};a.prototype[m.types.HEIGHTFIELD]=a.prototype.intersectHeightfield;var E=new d,F=new d;a.prototype.intersectSphere=function(a,d,k,f){d=this.from;var r=this.to,n=Math.pow(r.x-d.x,2)+Math.pow(r.y-d.y,2)+Math.pow(r.z-d.z,2),b=2*
((r.x-d.x)*(d.x-k.x)+(r.y-d.y)*(d.y-k.y)+(r.z-d.z)*(d.z-k.z)),e=Math.pow(b,2)-4*n*(Math.pow(d.x-k.x,2)+Math.pow(d.y-k.y,2)+Math.pow(d.z-k.z,2)-Math.pow(a.radius,2));if(!(0>e))if(0===e)d.lerp(r,e,E),E.vsub(k,F),F.normalize(),this.reportIntersection(F,E,a,f,-1);else{var p=(-b-Math.sqrt(e))/(2*n);n=(-b+Math.sqrt(e))/(2*n);0<=p&&1>=p&&(d.lerp(r,p,E),E.vsub(k,F),F.normalize(),this.reportIntersection(F,E,a,f,-1));!this.result._shouldStop&&0<=n&&1>=n&&(d.lerp(r,n,E),E.vsub(k,F),F.normalize(),this.reportIntersection(F,
E,a,f,-1))}};a.prototype[m.types.SPHERE]=a.prototype.intersectSphere;var G=new d;new d;new d;var K=new d;a.prototype.intersectConvex=function(a,d,k,f,r){r=r&&r.faceList||null;for(var n=a.faces,b=a.vertices,p=a.faceNormals,q=this._direction,g=this.from,u=g.distanceTo(this.to),w=r?r.length:n.length,m=this.result,B=0;!m._shouldStop&&B<w;B++){var ea=r?r[B]:B,R=n[ea],D=p[ea],L=d,S=k;K.copy(b[R[0]]);L.vmult(K,K);K.vadd(S,K);K.vsub(g,K);L.vmult(D,G);D=q.dot(G);if(!(Math.abs(D)<this.precision||(D=G.dot(K)/
D,0>D)))for(q.mult(D,v),v.vadd(g,v),x.copy(b[R[0]]),L.vmult(x,x),S.vadd(x,x),D=1;!m._shouldStop&&D<R.length-1;D++){z.copy(b[R[D]]);A.copy(b[R[D+1]]);L.vmult(z,z);L.vmult(A,A);S.vadd(z,z);S.vadd(A,A);var Q=v.distanceTo(g);!e(v,x,z,A)&&!e(v,z,x,A)||Q>u||this.reportIntersection(G,v,a,f,ea)}}};a.prototype[m.types.CONVEXPOLYHEDRON]=a.prototype.intersectConvex;var I=new d,B=new d,Q=new d,O=new d,L=new d,H=new d;new b;var W=[],ba=new q;a.prototype.intersectTrimesh=function(a,d,k,f,r){r=a.indices;var n=this.from,
b=this.to,p=this._direction;ba.position.copy(k);ba.quaternion.copy(d);q.vectorToLocalFrame(k,d,p,B);q.pointToLocalFrame(k,d,n,Q);q.pointToLocalFrame(k,d,b,O);n=Q.distanceSquared(O);a.tree.rayQuery(this,ba,W);b=0;for(p=W.length;!this.result._shouldStop&&b!==p;b++){var g=W[b];a.getNormal(g,I);a.getVertex(r[3*g],x);x.vsub(Q,K);var u=B.dot(I);u=I.dot(K)/u;0>u||(B.scale(u,v),v.vadd(Q,v),a.getVertex(r[3*g+1],z),a.getVertex(r[3*g+2],A),u=v.distanceSquared(Q),!e(v,z,x,A)&&!e(v,x,z,A)||u>n||(q.vectorToWorldFrame(d,
I,L),q.pointToWorldFrame(k,d,v,H),this.reportIntersection(L,H,a,f,g)))}W.length=0};a.prototype[m.types.TRIMESH]=a.prototype.intersectTrimesh;a.prototype.reportIntersection=function(d,k,f,r,n){var b=this.from,e=this.to,p=b.distanceTo(k),q=this.result;if(!(this.skipBackfaces&&0<d.dot(this._direction)))switch(q.hitFaceIndex="undefined"!==typeof n?n:-1,this.mode){case a.ALL:this.hasHit=!0;q.set(b,e,d,k,f,r,p);q.hasHit=!0;this.callback(q);break;case a.CLOSEST:if(p<q.distance||!q.hasHit)this.hasHit=!0,
q.hasHit=!0,q.set(b,e,d,k,f,r,p);break;case a.ANY:this.hasHit=!0,q.hasHit=!0,q.set(b,e,d,k,f,r,p),q._shouldStop=!0}};var X=new d,R=new d},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(b,g,m){function a(){this.rayFromWorld=new e;this.rayToWorld=new e;this.hitNormalWorld=new e;this.hitPointWorld=new e;this.hasHit=!1;this.body=this.shape=null;
this.distance=this.hitFaceIndex=-1;this._shouldStop=!1}var e=b("../math/Vec3");g.exports=a;a.prototype.reset=function(){this.rayFromWorld.setZero();this.rayToWorld.setZero();this.hitNormalWorld.setZero();this.hitPointWorld.setZero();this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1};a.prototype.abort=function(){this._shouldStop=!0};a.prototype.set=function(a,b,f,e,g,u,k){this.rayFromWorld.copy(a);this.rayToWorld.copy(b);this.hitNormalWorld.copy(f);this.hitPointWorld.copy(e);
this.shape=g;this.body=u;this.distance=k}},{"../math/Vec3":30}],11:[function(b,g,m){function a(a){e.apply(this);this.axisList=[];this.world=null;this.axisIndex=0;var d=this.axisList;this._addBodyHandler=function(a){d.push(a.body)};this._removeBodyHandler=function(a){a=d.indexOf(a.body);-1!==a&&d.splice(a,1)};a&&this.setWorld(a)}b("../shapes/Shape");var e=b("../collision/Broadphase");g.exports=a;a.prototype=new e;a.prototype.setWorld=function(a){for(var d=this.axisList.length=0;d<a.bodies.length;d++)this.axisList.push(a.bodies[d]);
a.removeEventListener("addBody",this._addBodyHandler);a.removeEventListener("removeBody",this._removeBodyHandler);a.addEventListener("addBody",this._addBodyHandler);a.addEventListener("removeBody",this._removeBodyHandler);this.world=a;this.dirty=!0};a.insertionSortX=function(a){for(var d=1,f=a.length;d<f;d++){for(var b=a[d],e=d-1;0<=e&&!(a[e].aabb.lowerBound.x<=b.aabb.lowerBound.x);e--)a[e+1]=a[e];a[e+1]=b}return a};a.insertionSortY=function(a){for(var d=1,f=a.length;d<f;d++){for(var b=a[d],e=d-1;0<=
e&&!(a[e].aabb.lowerBound.y<=b.aabb.lowerBound.y);e--)a[e+1]=a[e];a[e+1]=b}return a};a.insertionSortZ=function(a){for(var d=1,f=a.length;d<f;d++){for(var b=a[d],e=d-1;0<=e&&!(a[e].aabb.lowerBound.z<=b.aabb.lowerBound.z);e--)a[e+1]=a[e];a[e+1]=b}return a};a.prototype.collisionPairs=function(d,b,f){d=this.axisList;var e=d.length,q=this.axisIndex,g,k;this.dirty&&(this.sortList(),this.dirty=!1);for(g=0;g!==e;g++){var r=d[g];for(k=g+1;k<e;k++){var n=d[k];if(this.needBroadphaseCollision(r,n)){if(!a.checkBounds(r,
n,q))break;this.intersectionTest(r,n,b,f)}}}};a.prototype.sortList=function(){for(var d=this.axisList,b=this.axisIndex,f=d.length,e=0;e!==f;e++){var g=d[e];g.aabbNeedsUpdate&&g.computeAABB()}0===b?a.insertionSortX(d):1===b?a.insertionSortY(d):2===b&&a.insertionSortZ(d)};a.checkBounds=function(a,b,f){if(0===f){var d=a.position.x;var e=b.position.x}else 1===f?(d=a.position.y,e=b.position.y):2===f&&(d=a.position.z,e=b.position.z);return e-b.boundingRadius<d+a.boundingRadius};a.prototype.autoDetectAxis=
function(){for(var a=0,b=0,f=0,e=0,g=0,u=0,k=this.axisList,r=k.length,n=1/r,v=0;v!==r;v++){var m=k[v],z=m.position.x;a+=z;b+=z*z;z=m.position.y;f+=z;e+=z*z;m=m.position.z;g+=m;u+=m*m}a=b-a*a*n;f=e-f*f*n;g=u-g*g*n;this.axisIndex=a>f?a>g?0:2:f>g?1:2};a.prototype.aabbQuery=function(a,b,f){f=f||[];this.dirty&&(this.sortList(),this.dirty=!1);a=this.axisList;for(var d=0;d<a.length;d++){var e=a[d];e.aabbNeedsUpdate&&e.computeAABB();e.aabb.overlaps(b)&&f.push(e)}return f}},{"../collision/Broadphase":5,"../shapes/Shape":43}],
12:[function(b,g,m){function a(a,b,g){g=g||{};var k="undefined"!==typeof g.maxForce?g.maxForce:1E6,r=g.pivotA?g.pivotA.clone():new f,n=g.pivotB?g.pivotB.clone():new f;this.axisA=g.axisA?g.axisA.clone():new f;this.axisB=g.axisB?g.axisB.clone():new f;e.call(this,a,r,b,n,k);this.collideConnected=!!g.collideConnected;this.angle="undefined"!==typeof g.angle?g.angle:0;r=this.coneEquation=new d(a,b,g);a=this.twistEquation=new q(a,b,g);this.twistAngle="undefined"!==typeof g.twistAngle?g.twistAngle:0;r.maxForce=
0;r.minForce=-k;a.maxForce=0;a.minForce=-k;this.equations.push(r,a)}g.exports=a;b("./Constraint");var e=b("./PointToPointConstraint"),d=b("../equations/ConeEquation"),q=b("../equations/RotationalEquation");b("../equations/ContactEquation");var f=b("../math/Vec3");a.prototype=new e;a.constructor=a;new f;new f;a.prototype.update=function(){var a=this.bodyA,d=this.bodyB,f=this.coneEquation,k=this.twistEquation;e.prototype.update.call(this);a.vectorToWorldFrame(this.axisA,f.axisA);d.vectorToWorldFrame(this.axisB,
f.axisB);this.axisA.tangents(k.axisA,k.axisA);a.vectorToWorldFrame(k.axisA,k.axisA);this.axisB.tangents(k.axisB,k.axisB);d.vectorToWorldFrame(k.axisB,k.axisB);f.angle=this.angle;k.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(b,g,m){function a(d,b,f){f=e.defaults(f,{collideConnected:!0,wakeUpBodies:!0});this.equations=[];this.bodyA=d;
this.bodyB=b;this.id=a.idCounter++;this.collideConnected=f.collideConnected;f.wakeUpBodies&&(d&&d.wakeUp(),b&&b.wakeUp())}g.exports=a;var e=b("../utils/Utils");a.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!");};a.prototype.enable=function(){for(var a=this.equations,b=0;b<a.length;b++)a[b].enabled=!0};a.prototype.disable=function(){for(var a=this.equations,b=0;b<a.length;b++)a[b].enabled=!1};a.idCounter=0},{"../utils/Utils":53}],14:[function(b,
g,m){function a(a,f,b,g){e.call(this,a,f);"undefined"===typeof b&&(b=a.position.distanceTo(f.position));"undefined"===typeof g&&(g=1E6);this.distance=b;a=this.distanceEquation=new d(a,f);this.equations.push(a);a.minForce=-g;a.maxForce=g}g.exports=a;var e=b("./Constraint"),d=b("../equations/ContactEquation");a.prototype=new e;a.prototype.update=function(){var a=this.distanceEquation,d=.5*this.distance,b=a.ni;this.bodyB.position.vsub(this.bodyA.position,b);b.normalize();b.mult(d,a.ri);b.mult(-d,a.rj)}},
{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(b,g,m){function a(a,k,b){b=b||{};var r="undefined"!==typeof b.maxForce?b.maxForce:1E6,p=b.pivotA?b.pivotA.clone():new f,g=b.pivotB?b.pivotB.clone():new f;e.call(this,a,p,k,g,r);(this.axisA=b.axisA?b.axisA.clone():new f(1,0,0)).normalize();(this.axisB=b.axisB?b.axisB.clone():new f(1,0,0)).normalize();p=this.rotationalEquation1=new d(a,k,b);b=this.rotationalEquation2=new d(a,k,b);a=this.motorEquation=new q(a,k,r);a.enabled=!1;this.equations.push(p,
b,a)}g.exports=a;b("./Constraint");var e=b("./PointToPointConstraint"),d=b("../equations/RotationalEquation"),q=b("../equations/RotationalMotorEquation");b("../equations/ContactEquation");var f=b("../math/Vec3");a.prototype=new e;a.constructor=a;a.prototype.enableMotor=function(){this.motorEquation.enabled=!0};a.prototype.disableMotor=function(){this.motorEquation.enabled=!1};a.prototype.setMotorSpeed=function(a){this.motorEquation.targetVelocity=a};a.prototype.setMotorMaxForce=function(a){this.motorEquation.maxForce=
a;this.motorEquation.minForce=-a};var p=new f,w=new f;a.prototype.update=function(){var a=this.bodyA,d=this.bodyB,f=this.motorEquation,b=this.rotationalEquation1,g=this.rotationalEquation2,q=this.axisA,m=this.axisB;e.prototype.update.call(this);a.quaternion.vmult(q,p);d.quaternion.vmult(m,w);p.tangents(b.axisA,g.axisA);b.axisB.copy(w);g.axisB.copy(w);this.motorEquation.enabled&&(a.quaternion.vmult(this.axisA,f.axisA),d.quaternion.vmult(this.axisB,f.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,
"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(b,g,m){function a(a,b,g){g=g||{};var f="undefined"!==typeof g.maxForce?g.maxForce:1E6,k=new q,r=new q,n=new q;a.position.vadd(b.position,n);n.scale(.5,n);b.pointToLocalFrame(n,r);a.pointToLocalFrame(n,k);e.call(this,a,k,b,r,f);f=this.rotationalEquation1=new d(a,b,g);k=this.rotationalEquation2=new d(a,b,g);a=this.rotationalEquation3=new d(a,b,g);this.equations.push(f,k,a)}g.exports=
a;b("./Constraint");var e=b("./PointToPointConstraint"),d=b("../equations/RotationalEquation");b("../equations/RotationalMotorEquation");b("../equations/ContactEquation");var q=b("../math/Vec3");a.prototype=new e;a.constructor=a;new q;new q;a.prototype.update=function(){var a=this.bodyA,d=this.bodyB,b=this.rotationalEquation1,g=this.rotationalEquation2,k=this.rotationalEquation3;e.prototype.update.call(this);a.vectorToWorldFrame(q.UNIT_X,b.axisA);d.vectorToWorldFrame(q.UNIT_Y,b.axisB);a.vectorToWorldFrame(q.UNIT_Y,
g.axisA);d.vectorToWorldFrame(q.UNIT_Z,g.axisB);a.vectorToWorldFrame(q.UNIT_Z,k.axisA);d.vectorToWorldFrame(q.UNIT_X,k.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(b,g,m){function a(a,b,g,u,k){e.call(this,a,g);k="undefined"!==typeof k?k:1E6;this.pivotA=b?b.clone():new q;this.pivotB=u?u.clone():new q;b=this.equationX=new d(a,g);u=this.equationY=
new d(a,g);a=this.equationZ=new d(a,g);this.equations.push(b,u,a);b.minForce=u.minForce=a.minForce=-k;b.maxForce=u.maxForce=a.maxForce=k;b.ni.set(1,0,0);u.ni.set(0,1,0);a.ni.set(0,0,1)}g.exports=a;var e=b("./Constraint"),d=b("../equations/ContactEquation"),q=b("../math/Vec3");a.prototype=new e;a.prototype.update=function(){var a=this.bodyB,d=this.equationX,b=this.equationY,e=this.equationZ;this.bodyA.quaternion.vmult(this.pivotA,d.ri);a.quaternion.vmult(this.pivotB,d.rj);b.ri.copy(d.ri);b.rj.copy(d.rj);
e.ri.copy(d.ri);e.rj.copy(d.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(b,g,m){function a(a,f,b){b=b||{};var k="undefined"!==typeof b.maxForce?b.maxForce:1E6;d.call(this,a,f,-k,k);this.axisA=b.axisA?b.axisA.clone():new e(1,0,0);this.axisB=b.axisB?b.axisB.clone():new e(0,1,0);this.angle="undefined"!==typeof b.angle?b.angle:0}g.exports=a;var e=b("../math/Vec3");b("../math/Mat3");var d=b("./Equation");a.prototype=new d;a.prototype.constructor=a;var q=new e,
f=new e;a.prototype.computeB=function(a){var d=this.a,b=this.b,k=this.axisA,r=this.axisB,e=this.jacobianElementA,g=this.jacobianElementB;k.cross(r,q);r.cross(k,f);e.rotational.copy(f);g.rotational.copy(q);k=Math.cos(this.angle)-k.dot(r);r=this.computeGW();e=this.computeGiMf();return-k*d-r*b-a*e}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(b,g,m){function a(a,k,f){e.call(this,a,k,0,"undefined"!==typeof f?f:1E6);this.restitution=0;this.ri=new d;this.rj=new d;this.ni=new d}g.exports=
a;var e=b("./Equation"),d=b("../math/Vec3");b("../math/Mat3");a.prototype=new e;a.prototype.constructor=a;var q=new d,f=new d,p=new d;a.prototype.computeB=function(a){var d=this.a,k=this.b,b=this.bi,e=this.bj,r=this.ri,n=this.rj,g=b.velocity,v=b.angularVelocity,u=e.velocity,m=e.angularVelocity,w=this.jacobianElementA,O=this.jacobianElementB,L=this.ni;r.cross(L,q);n.cross(L,f);L.negate(w.spatial);q.negate(w.rotational);O.spatial.copy(L);O.rotational.copy(f);p.copy(e.position);p.vadd(n,p);p.vsub(b.position,
p);p.vsub(r,p);b=L.dot(p);e=this.restitution+1;g=e*u.dot(L)-e*g.dot(L)+m.dot(f)-v.dot(q);v=this.computeGiMf();return-b*d-g*k-a*v};var w=new d,u=new d,k=new d,r=new d,n=new d;a.prototype.getImpactVelocityAlongNormal=function(){this.bi.position.vadd(this.ri,k);this.bj.position.vadd(this.rj,r);this.bi.getVelocityAtWorldPoint(k,w);this.bj.getVelocityAtWorldPoint(r,u);w.vsub(u,n);return this.ni.dot(n)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(b,g,m){function a(d,k,f,b){this.id=
a.id++;this.minForce="undefined"===typeof f?-1E6:f;this.maxForce="undefined"===typeof b?1E6:b;this.bi=d;this.bj=k;this.eps=this.b=this.a=0;this.jacobianElementA=new e;this.jacobianElementB=new e;this.enabled=!0;this.setSpookParams(1E7,4,1/60)}g.exports=a;var e=b("../math/JacobianElement");b=b("../math/Vec3");a.prototype.constructor=a;a.id=0;a.prototype.setSpookParams=function(a,d,k){this.a=4/(k*(1+4*d));this.b=4*d/(1+4*d);this.eps=4/(k*k*a*(1+4*d))};a.prototype.computeB=function(a,d,k){var f=this.computeGW(),
b=this.computeGq(),e=this.computeGiMf();return-b*a-f*d-e*k};a.prototype.computeGq=function(){var a=this.jacobianElementB,d=this.bj.position;return this.jacobianElementA.spatial.dot(this.bi.position)+a.spatial.dot(d)};var d=new b;a.prototype.computeGW=function(){var a=this.jacobianElementB,k=this.bi,f=this.bj,b=f.velocity;f=f.angularVelocity||d;return this.jacobianElementA.multiplyVectors(k.velocity,k.angularVelocity||d)+a.multiplyVectors(b,f)};a.prototype.computeGWlambda=function(){var a=this.jacobianElementB,
k=this.bi,f=this.bj,b=f.vlambda;f=f.wlambda||d;return this.jacobianElementA.multiplyVectors(k.vlambda,k.wlambda||d)+a.multiplyVectors(b,f)};var q=new b,f=new b,p=new b,w=new b;a.prototype.computeGiMf=function(){var a=this.jacobianElementA,d=this.jacobianElementB,k=this.bi,b=this.bj,e=k.force,g=k.torque,u=b.force,m=b.torque,F=k.invMassSolve,G=b.invMassSolve;k.invInertiaWorldSolve?k.invInertiaWorldSolve.vmult(g,p):p.set(0,0,0);b.invInertiaWorldSolve?b.invInertiaWorldSolve.vmult(m,w):w.set(0,0,0);e.mult(F,
q);u.mult(G,f);return a.multiplyVectors(q,p)+d.multiplyVectors(f,w)};var u=new b;a.prototype.computeGiMGt=function(){var a=this.jacobianElementA,d=this.jacobianElementB,k=this.bi,f=this.bj,b=k.invInertiaWorldSolve,e=f.invInertiaWorldSolve;k=k.invMassSolve+f.invMassSolve;b&&(b.vmult(a.rotational,u),k+=u.dot(a.rotational));e&&(e.vmult(d.rotational,u),k+=u.dot(d.rotational));return k};var k=new b;new b;new b;new b;new b;new b;a.prototype.addToWlambda=function(a){var d=this.jacobianElementA,f=this.jacobianElementB,
b=this.bi,e=this.bj;d.spatial.mult(b.invMassSolve*a,k);b.vlambda.vadd(k,b.vlambda);f.spatial.mult(e.invMassSolve*a,k);e.vlambda.vadd(k,e.vlambda);b.invInertiaWorldSolve&&(b.invInertiaWorldSolve.vmult(d.rotational,k),k.mult(a,k),b.wlambda.vadd(k,b.wlambda));e.invInertiaWorldSolve&&(e.invInertiaWorldSolve.vmult(f.rotational,k),k.mult(a,k),e.wlambda.vadd(k,e.wlambda))};a.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(b,
g,m){function a(a,f,b){e.call(this,a,f,-b,b);this.ri=new d;this.rj=new d;this.t=new d}g.exports=a;var e=b("./Equation"),d=b("../math/Vec3");b("../math/Mat3");a.prototype=new e;a.prototype.constructor=a;var q=new d,f=new d;a.prototype.computeB=function(a){var d=this.b,b=this.rj,k=this.t;this.ri.cross(k,q);b.cross(k,f);b=this.jacobianElementA;var e=this.jacobianElementB;k.negate(b.spatial);q.negate(b.rotational);e.spatial.copy(k);e.rotational.copy(f);k=this.computeGW();b=this.computeGiMf();return-k*
d-a*b}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(b,g,m){function a(a,f,b){b=b||{};var k="undefined"!==typeof b.maxForce?b.maxForce:1E6;d.call(this,a,f,-k,k);this.axisA=b.axisA?b.axisA.clone():new e(1,0,0);this.axisB=b.axisB?b.axisB.clone():new e(0,1,0);this.maxAngle=Math.PI/2}g.exports=a;var e=b("../math/Vec3");b("../math/Mat3");var d=b("./Equation");a.prototype=new d;a.prototype.constructor=a;var q=new e,f=new e;a.prototype.computeB=function(a){var d=this.a,b=this.b,k=
this.axisA,e=this.axisB,n=this.jacobianElementA,g=this.jacobianElementB;k.cross(e,q);e.cross(k,f);n.rotational.copy(f);g.rotational.copy(q);k=Math.cos(this.maxAngle)-k.dot(e);e=this.computeGW();n=this.computeGiMf();return-k*d-e*b-a*n}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(b,g,m){function a(a,f,b){b="undefined"!==typeof b?b:1E6;d.call(this,a,f,-b,b);this.axisA=new e;this.axisB=new e;this.targetVelocity=0}g.exports=a;var e=b("../math/Vec3");b("../math/Mat3");var d=b("./Equation");
a.prototype=new d;a.prototype.constructor=a;a.prototype.computeB=function(a){var d=this.b,b=this.axisB,e=this.jacobianElementB;this.jacobianElementA.rotational.copy(this.axisA);b.negate(e.rotational);b=this.computeGW()-this.targetVelocity;e=this.computeGiMf();return-b*d-a*e}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(b,g,m){function a(d,b,f){f=e.defaults(f,{friction:.3,restitution:.3,contactEquationStiffness:1E7,contactEquationRelaxation:3,frictionEquationStiffness:1E7,frictionEquationRelaxation:3});
this.id=a.idCounter++;this.materials=[d,b];this.friction=f.friction;this.restitution=f.restitution;this.contactEquationStiffness=f.contactEquationStiffness;this.contactEquationRelaxation=f.contactEquationRelaxation;this.frictionEquationStiffness=f.frictionEquationStiffness;this.frictionEquationRelaxation=f.frictionEquationRelaxation}var e=b("../utils/Utils");g.exports=a;a.idCounter=0},{"../utils/Utils":53}],25:[function(b,g,m){function a(b){var d="";b=b||{};"string"===typeof b?(d=b,b={}):"object"===
typeof b&&(d="");this.name=d;this.id=a.idCounter++;this.friction="undefined"!==typeof b.friction?b.friction:-1;this.restitution="undefined"!==typeof b.restitution?b.restitution:-1}g.exports=a;a.idCounter=0},{}],26:[function(b,g,m){function a(){this.spatial=new e;this.rotational=new e}g.exports=a;var e=b("./Vec3");a.prototype.multiplyElement=function(a){return a.spatial.dot(this.spatial)+a.rotational.dot(this.rotational)};a.prototype.multiplyVectors=function(a,b){return a.dot(this.spatial)+b.dot(this.rotational)}},
{"./Vec3":30}],27:[function(b,g,m){function a(a){this.elements=a?a:[0,0,0,0,0,0,0,0,0]}g.exports=a;var e=b("./Vec3");a.prototype.identity=function(){var a=this.elements;a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1};a.prototype.setZero=function(){var a=this.elements;a[0]=0;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=0;a[6]=0;a[7]=0;a[8]=0};a.prototype.setTrace=function(a){var d=this.elements;d[0]=a.x;d[4]=a.y;d[8]=a.z};a.prototype.getTrace=function(a){a=a||new e;var d=this.elements;a.x=d[0];
a.y=d[4];a.z=d[8]};a.prototype.vmult=function(a,b){b=b||new e;var d=this.elements,g=a.x,q=a.y,u=a.z;b.x=d[0]*g+d[1]*q+d[2]*u;b.y=d[3]*g+d[4]*q+d[5]*u;b.z=d[6]*g+d[7]*q+d[8]*u;return b};a.prototype.smult=function(a){for(var d=0;d<this.elements.length;d++)this.elements[d]*=a};a.prototype.mmult=function(d,b){for(var f=b||new a,e=0;3>e;e++)for(var g=0;3>g;g++){for(var q=0,k=0;3>k;k++)q+=d.elements[e+3*k]*this.elements[k+3*g];f.elements[e+3*g]=q}return f};a.prototype.scale=function(d,b){b=b||new a;for(var f=
this.elements,e=b.elements,g=0;3!==g;g++)e[3*g+0]=d.x*f[3*g+0],e[3*g+1]=d.y*f[3*g+1],e[3*g+2]=d.z*f[3*g+2];return b};a.prototype.solve=function(a,b){b=b||new e;for(var d=[],g=0;12>g;g++)d.push(0);var q;for(g=0;3>g;g++)for(q=0;3>q;q++)d[g+4*q]=this.elements[g+3*q];d[3]=a.x;d[7]=a.y;d[11]=a.z;var u=3,k=u;do{g=k-u;if(0===d[g+4*g])for(q=g+1;q<k;q++)if(0!==d[g+4*q]){var r=4;do{var n=4-r;d[n+4*g]+=d[n+4*q]}while(--r);break}if(0!==d[g+4*g])for(q=g+1;q<k;q++){var v=d[g+4*q]/d[g+4*g];r=4;do n=4-r,d[n+4*q]=
n<=g?0:d[n+4*q]-d[n+4*g]*v;while(--r)}}while(--u);b.z=d[11]/d[10];b.y=(d[7]-d[6]*b.z)/d[5];b.x=(d[3]-d[2]*b.z-d[1]*b.y)/d[0];if(isNaN(b.x)||isNaN(b.y)||isNaN(b.z)||Infinity===b.x||Infinity===b.y||Infinity===b.z)throw"Could not solve equation! Got x=["+b.toString()+"], b=["+a.toString()+"], A=["+this.toString()+"]";return b};a.prototype.e=function(a,b,f){if(void 0===f)return this.elements[b+3*a];this.elements[b+3*a]=f};a.prototype.copy=function(a){for(var d=0;d<a.elements.length;d++)this.elements[d]=
a.elements[d];return this};a.prototype.toString=function(){for(var a="",b=0;9>b;b++)a+=this.elements[b]+",";return a};a.prototype.reverse=function(d){d=d||new a;for(var b=[],f=0;18>f;f++)b.push(0);var e;for(f=0;3>f;f++)for(e=0;3>e;e++)b[f+6*e]=this.elements[f+3*e];b[3]=1;b[9]=0;b[15]=0;b[4]=0;b[10]=1;b[16]=0;b[5]=0;b[11]=0;b[17]=1;var g=3,u=g;do{f=u-g;if(0===b[f+6*f])for(e=f+1;e<u;e++)if(0!==b[f+6*e]){var k=6;do{var r=6-k;b[r+6*f]+=b[r+6*e]}while(--k);break}if(0!==b[f+6*f])for(e=f+1;e<u;e++){var n=
b[f+6*e]/b[f+6*f];k=6;do r=6-k,b[r+6*e]=r<=f?0:b[r+6*e]-b[r+6*f]*n;while(--k)}}while(--g);f=2;do{e=f-1;do{n=b[f+6*e]/b[f+6*f];k=6;do r=6-k,b[r+6*e]-=b[r+6*f]*n;while(--k)}while(e--)}while(--f);f=2;do{n=1/b[f+6*f];k=6;do r=6-k,b[r+6*f]*=n;while(--k)}while(f--);f=2;do{e=2;do{r=b[3+e+6*f];if(isNaN(r)||Infinity===r)throw"Could not reverse! A=["+this.toString()+"]";d.e(f,e,r)}while(e--)}while(f--);return d};a.prototype.setRotationFromQuaternion=function(a){var d=a.x,b=a.y,e=a.z,g=a.w,u=d+d,k=b+b,r=e+e;
a=d*u;var n=d*k;d*=r;var v=b*k;b*=r;e*=r;u*=g;k*=g;g*=r;r=this.elements;r[0]=1-(v+e);r[1]=n-g;r[2]=d+k;r[3]=n+g;r[4]=1-(a+e);r[5]=b-u;r[6]=d-k;r[7]=b+u;r[8]=1-(a+v);return this};a.prototype.transpose=function(d){d=d||new a;for(var b=d.elements,f=this.elements,e=0;3!==e;e++)for(var g=0;3!==g;g++)b[3*e+g]=f[3*g+e];return d}},{"./Vec3":30}],28:[function(b,g,m){function a(a,d,b,f){this.x=void 0!==a?a:0;this.y=void 0!==d?d:0;this.z=void 0!==b?b:0;this.w=void 0!==f?f:1}g.exports=a;var e=b("./Vec3");a.prototype.set=
function(a,d,b,f){this.x=a;this.y=d;this.z=b;this.w=f};a.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w};a.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]};a.prototype.setFromAxisAngle=function(a,d){var b=Math.sin(.5*d);this.x=a.x*b;this.y=a.y*b;this.z=a.z*b;this.w=Math.cos(.5*d)};a.prototype.toAxisAngle=function(a){a=a||new e;this.normalize();var d=2*Math.acos(this.w),b=Math.sqrt(1-this.w*this.w);.001>b?(a.x=this.x,a.y=this.y,a.z=this.z):(a.x=this.x/
b,a.y=this.y/b,a.z=this.z/b);return[a,d]};var d=new e,q=new e;a.prototype.setFromVectors=function(a,b){if(a.isAntiparallelTo(b))a.tangents(d,q),this.setFromAxisAngle(d,Math.PI);else{var k=a.cross(b);this.x=k.x;this.y=k.y;this.z=k.z;this.w=Math.sqrt(Math.pow(a.norm(),2)*Math.pow(b.norm(),2))+a.dot(b);this.normalize()}};var f=new e,p=new e,w=new e;a.prototype.mult=function(d,b){b=b||new a;var k=this.w;f.set(this.x,this.y,this.z);p.set(d.x,d.y,d.z);b.w=k*d.w-f.dot(p);f.cross(p,w);b.x=k*p.x+d.w*f.x+w.x;
b.y=k*p.y+d.w*f.y+w.y;b.z=k*p.z+d.w*f.z+w.z;return b};a.prototype.inverse=function(d){var b=this.x,f=this.y,e=this.z,g=this.w;d=d||new a;this.conjugate(d);b=1/(b*b+f*f+e*e+g*g);d.x*=b;d.y*=b;d.z*=b;d.w*=b;return d};a.prototype.conjugate=function(d){d=d||new a;d.x=-this.x;d.y=-this.y;d.z=-this.z;d.w=this.w;return d};a.prototype.normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===a?this.w=this.z=this.y=this.x=0:(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=
a)};a.prototype.normalizeFast=function(){var a=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===a?this.w=this.z=this.y=this.x=0:(this.x*=a,this.y*=a,this.z*=a,this.w*=a)};a.prototype.vmult=function(a,d){d=d||new e;var b=a.x,k=a.y,f=a.z,g=this.x,p=this.y,q=this.z,m=this.w,u=m*b+p*f-q*k,w=m*k+q*b-g*f,G=m*f+g*k-p*b;b=-g*b-p*k-q*f;d.x=u*m+b*-g+w*-q-G*-p;d.y=w*m+b*-p+G*-g-u*-q;d.z=G*m+b*-q+u*-p-w*-g;return d};a.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this};
a.prototype.toEuler=function(a,d){d=d||"YZX";var b=this.x,k=this.y,f=this.z,e=this.w;switch(d){case "YZX":var g=b*k+f*e;if(.499<g){var p=2*Math.atan2(b,e);var q=Math.PI/2;var m=0}-.499>g&&(p=-2*Math.atan2(b,e),q=-Math.PI/2,m=0);isNaN(p)&&(m=f*f,p=Math.atan2(2*k*e-2*b*f,1-2*k*k-2*m),q=Math.asin(2*g),m=Math.atan2(2*b*e-2*k*f,1-2*b*b-2*m));break;default:throw Error("Euler order "+d+" not supported yet.");}a.y=p;a.z=q;a.x=m};a.prototype.setFromEuler=function(a,d,b,f){f=f||"XYZ";var k=Math.cos(a/2),e=
Math.cos(d/2),g=Math.cos(b/2);a=Math.sin(a/2);d=Math.sin(d/2);b=Math.sin(b/2);"XYZ"===f?(this.x=a*e*g+k*d*b,this.y=k*d*g-a*e*b,this.z=k*e*b+a*d*g,this.w=k*e*g-a*d*b):"YXZ"===f?(this.x=a*e*g+k*d*b,this.y=k*d*g-a*e*b,this.z=k*e*b-a*d*g,this.w=k*e*g+a*d*b):"ZXY"===f?(this.x=a*e*g-k*d*b,this.y=k*d*g+a*e*b,this.z=k*e*b+a*d*g,this.w=k*e*g-a*d*b):"ZYX"===f?(this.x=a*e*g-k*d*b,this.y=k*d*g+a*e*b,this.z=k*e*b-a*d*g,this.w=k*e*g+a*d*b):"YZX"===f?(this.x=a*e*g+k*d*b,this.y=k*d*g+a*e*b,this.z=k*e*b-a*d*g,this.w=
k*e*g-a*d*b):"XZY"===f&&(this.x=a*e*g-k*d*b,this.y=k*d*g-a*e*b,this.z=k*e*b+a*d*g,this.w=k*e*g+a*d*b);return this};a.prototype.clone=function(){return new a(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(b,g,m){function a(a){a=a||{};this.position=new e;a.position&&this.position.copy(a.position);this.quaternion=new d;a.quaternion&&this.quaternion.copy(a.quaternion)}var e=b("./Vec3"),d=b("./Quaternion");g.exports=a;var q=new d;a.pointToLocalFrame=function(a,d,b,g){g=g||new e;b.vsub(a,g);
d.conjugate(q);q.vmult(g,g);return g};a.prototype.pointToLocal=function(d,b){return a.pointToLocalFrame(this.position,this.quaternion,d,b)};a.pointToWorldFrame=function(a,d,b,g){g=g||new e;d.vmult(b,g);g.vadd(a,g);return g};a.prototype.pointToWorld=function(d,b){return a.pointToWorldFrame(this.position,this.quaternion,d,b)};a.prototype.vectorToWorldFrame=function(a,d){d=d||new e;this.quaternion.vmult(a,d);return d};a.vectorToWorldFrame=function(a,d,b){a.vmult(d,b);return b};a.vectorToLocalFrame=function(a,
d,b,g){g=g||new e;d.w*=-1;d.vmult(b,g);d.w*=-1;return g}},{"./Quaternion":28,"./Vec3":30}],30:[function(b,g,m){function a(a,d,b){this.x=a||0;this.y=d||0;this.z=b||0}g.exports=a;var e=b("./Mat3");a.ZERO=new a(0,0,0);a.UNIT_X=new a(1,0,0);a.UNIT_Y=new a(0,1,0);a.UNIT_Z=new a(0,0,1);a.prototype.cross=function(d,b){var f=d.x,k=d.y,e=d.z,g=this.x,p=this.y,q=this.z;b=b||new a;b.x=p*e-q*k;b.y=q*f-g*e;b.z=g*k-p*f;return b};a.prototype.set=function(a,d,b){this.x=a;this.y=d;this.z=b;return this};a.prototype.setZero=
function(){this.x=this.y=this.z=0};a.prototype.vadd=function(d,b){if(b)b.x=d.x+this.x,b.y=d.y+this.y,b.z=d.z+this.z;else return new a(this.x+d.x,this.y+d.y,this.z+d.z)};a.prototype.vsub=function(d,b){if(b)b.x=this.x-d.x,b.y=this.y-d.y,b.z=this.z-d.z;else return new a(this.x-d.x,this.y-d.y,this.z-d.z)};a.prototype.crossmat=function(){return new e([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])};a.prototype.normalize=function(){var a=this.x,d=this.y,b=this.z;a=Math.sqrt(a*a+d*d+b*b);0<a?(d=1/
a,this.x*=d,this.y*=d,this.z*=d):this.z=this.y=this.x=0;return a};a.prototype.unit=function(d){d=d||new a;var b=this.x,f=this.y,k=this.z,e=Math.sqrt(b*b+f*f+k*k);0<e?(e=1/e,d.x=b*e,d.y=f*e,d.z=k*e):(d.x=1,d.y=0,d.z=0);return d};a.prototype.norm=function(){var a=this.x,d=this.y,b=this.z;return Math.sqrt(a*a+d*d+b*b)};a.prototype.length=a.prototype.norm;a.prototype.norm2=function(){return this.dot(this)};a.prototype.lengthSquared=a.prototype.norm2;a.prototype.distanceTo=function(a){var d=this.x,b=this.y,
k=this.z,f=a.x,e=a.y;a=a.z;return Math.sqrt((f-d)*(f-d)+(e-b)*(e-b)+(a-k)*(a-k))};a.prototype.distanceSquared=function(a){var d=this.x,b=this.y,k=this.z,f=a.x,e=a.y;a=a.z;return(f-d)*(f-d)+(e-b)*(e-b)+(a-k)*(a-k)};a.prototype.mult=function(d,b){b=b||new a;var f=this.y,k=this.z;b.x=d*this.x;b.y=d*f;b.z=d*k;return b};a.prototype.scale=a.prototype.mult;a.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};a.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z};a.prototype.negate=
function(d){d=d||new a;d.x=-this.x;d.y=-this.y;d.z=-this.z;return d};var d=new a,q=new a;a.prototype.tangents=function(a,b){var f=this.norm();0<f?(f=1/f,d.set(this.x*f,this.y*f,this.z*f),.9>Math.abs(d.x)?q.set(1,0,0):q.set(0,1,0),d.cross(q,a),d.cross(a,b)):(a.set(1,0,0),b.set(0,1,0))};a.prototype.toString=function(){return this.x+","+this.y+","+this.z};a.prototype.toArray=function(){return[this.x,this.y,this.z]};a.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};a.prototype.lerp=
function(a,d,b){var k=this.x,f=this.y,e=this.z;b.x=k+(a.x-k)*d;b.y=f+(a.y-f)*d;b.z=e+(a.z-e)*d};a.prototype.almostEquals=function(a,d){void 0===d&&(d=1E-6);return Math.abs(this.x-a.x)>d||Math.abs(this.y-a.y)>d||Math.abs(this.z-a.z)>d?!1:!0};a.prototype.almostZero=function(a){void 0===a&&(a=1E-6);return Math.abs(this.x)>a||Math.abs(this.y)>a||Math.abs(this.z)>a?!1:!0};var f=new a;a.prototype.isAntiparallelTo=function(a,d){this.negate(f);return f.almostEquals(a,d)};a.prototype.clone=function(){return new a(this.x,
this.y,this.z)}},{"./Mat3":27}],31:[function(b,g,m){function a(b){b=b||{};e.apply(this);this.id=a.idCounter++;this.postStep=this.preStep=this.world=null;this.vlambda=new d;this.collisionFilterGroup="number"===typeof b.collisionFilterGroup?b.collisionFilterGroup:1;this.collisionFilterMask="number"===typeof b.collisionFilterMask?b.collisionFilterMask:1;this.collisionResponse=!0;this.position=new d;b.position&&this.position.copy(b.position);this.previousPosition=new d;this.initPosition=new d;this.velocity=
new d;b.velocity&&this.velocity.copy(b.velocity);this.initVelocity=new d;this.force=new d;var k="number"===typeof b.mass?b.mass:0;this.mass=k;this.invMass=0<k?1/k:0;this.material=b.material||null;this.linearDamping="number"===typeof b.linearDamping?b.linearDamping:.01;this.type=0>=k?a.STATIC:a.DYNAMIC;typeof b.type===typeof a.STATIC&&(this.type=b.type);this.allowSleep="undefined"!==typeof b.allowSleep?b.allowSleep:!0;this.sleepState=0;this.sleepSpeedLimit="undefined"!==typeof b.sleepSpeedLimit?b.sleepSpeedLimit:
.1;this.sleepTimeLimit="undefined"!==typeof b.sleepTimeLimit?b.sleepTimeLimit:1;this.timeLastSleepy=0;this._wakeUpAfterNarrowphase=!1;this.torque=new d;this.quaternion=new f;b.quaternion&&this.quaternion.copy(b.quaternion);this.initQuaternion=new f;this.angularVelocity=new d;b.angularVelocity&&this.angularVelocity.copy(b.angularVelocity);this.initAngularVelocity=new d;this.interpolatedPosition=new d;this.interpolatedQuaternion=new f;this.shapes=[];this.shapeOffsets=[];this.shapeOrientations=[];this.inertia=
new d;this.invInertia=new d;this.invInertiaWorld=new q;this.invMassSolve=0;this.invInertiaSolve=new d;this.invInertiaWorldSolve=new q;this.fixedRotation="undefined"!==typeof b.fixedRotation?b.fixedRotation:!1;this.angularDamping="undefined"!==typeof b.angularDamping?b.angularDamping:.01;this.aabb=new p;this.aabbNeedsUpdate=!0;this.wlambda=new d;b.shape&&this.addShape(b.shape);this.updateMassProperties()}g.exports=a;var e=b("../utils/EventTarget");b("../shapes/Shape");var d=b("../math/Vec3"),q=b("../math/Mat3"),
f=b("../math/Quaternion");b("../material/Material");var p=b("../collision/AABB"),w=b("../shapes/Box");a.prototype=new e;a.prototype.constructor=a;a.DYNAMIC=1;a.STATIC=2;a.KINEMATIC=4;a.AWAKE=0;a.SLEEPY=1;a.SLEEPING=2;a.idCounter=0;a.prototype.wakeUp=function(){var d=this.sleepState;this.sleepState=0;d===a.SLEEPING&&this.dispatchEvent({type:"wakeup"})};a.prototype.sleep=function(){this.sleepState=a.SLEEPING;this.velocity.set(0,0,0);this.angularVelocity.set(0,0,0)};a.sleepyEvent={type:"sleepy"};a.sleepEvent=
{type:"sleep"};a.prototype.sleepTick=function(d){if(this.allowSleep){var b=this.sleepState,k=this.velocity.norm2()+this.angularVelocity.norm2(),f=Math.pow(this.sleepSpeedLimit,2);b===a.AWAKE&&k<f?(this.sleepState=a.SLEEPY,this.timeLastSleepy=d,this.dispatchEvent(a.sleepyEvent)):b===a.SLEEPY&&k>f?this.wakeUp():b===a.SLEEPY&&d-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(a.sleepEvent))}};a.prototype.updateSolveMassProperties=function(){this.sleepState===a.SLEEPING||this.type===
a.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))};a.prototype.pointToLocalFrame=function(a,b){b=b||new d;a.vsub(this.position,b);this.quaternion.conjugate().vmult(b,b);return b};a.prototype.vectorToLocalFrame=function(a,b){b=b||new d;this.quaternion.conjugate().vmult(a,b);return b};a.prototype.pointToWorldFrame=function(a,
b){b=b||new d;this.quaternion.vmult(a,b);b.vadd(this.position,b);return b};a.prototype.vectorToWorldFrame=function(a,b){b=b||new d;this.quaternion.vmult(a,b);return b};var u=new d,k=new f;a.prototype.addShape=function(a,b,k){var e=new d,g=new f;b&&e.copy(b);k&&g.copy(k);this.shapes.push(a);this.shapeOffsets.push(e);this.shapeOrientations.push(g);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=!0;return this};a.prototype.updateBoundingRadius=function(){for(var a=this.shapes,
d=this.shapeOffsets,b=a.length,k=0,f=0;f!==b;f++){var e=a[f];e.updateBoundingSphereRadius();var g=d[f].norm();e=e.boundingSphereRadius;g+e>k&&(k=g+e)}this.boundingRadius=k};var r=new p;a.prototype.computeAABB=function(){for(var a=this.shapes,d=this.shapeOffsets,b=this.shapeOrientations,f=a.length,e=this.quaternion,g=this.aabb,n=0;n!==f;n++){var q=a[n];b[n].mult(e,k);k.vmult(d[n],u);u.vadd(this.position,u);q.calculateWorldAABB(u,k,r.lowerBound,r.upperBound);0===n?g.copy(r):g.extend(r)}this.aabbNeedsUpdate=
!1};var n=new q,v=new q;new q;a.prototype.updateInertiaWorld=function(a){var d=this.invInertia;if(d.x!==d.y||d.y!==d.z||a)n.setRotationFromQuaternion(this.quaternion),n.transpose(v),n.scale(d,n),n.mmult(v,this.invInertiaWorld)};var x=new d,z=new d;a.prototype.applyForce=function(d,b){this.type===a.DYNAMIC&&(b.vsub(this.position,x),x.cross(d,z),this.force.vadd(d,this.force),this.torque.vadd(z,this.torque))};var A=new d,D=new d;a.prototype.applyLocalForce=function(d,b){this.type===a.DYNAMIC&&(this.vectorToWorldFrame(d,
A),this.pointToWorldFrame(b,D),this.applyForce(A,D))};var E=new d,F=new d,G=new d;a.prototype.applyImpulse=function(d,b){this.type===a.DYNAMIC&&(b.vsub(this.position,E),F.copy(d),F.mult(this.invMass,F),this.velocity.vadd(F,this.velocity),E.cross(d,G),this.invInertiaWorld.vmult(G,G),this.angularVelocity.vadd(G,this.angularVelocity))};var K=new d,I=new d;a.prototype.applyLocalImpulse=function(d,b){this.type===a.DYNAMIC&&(this.vectorToWorldFrame(d,K),this.pointToWorldFrame(b,I),this.applyImpulse(K,I))};
var B=new d;a.prototype.updateMassProperties=function(){this.invMass=0<this.mass?1/this.mass:0;var a=this.inertia,d=this.fixedRotation;this.computeAABB();B.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2);w.calculateInertia(B,this.mass,a);this.invInertia.set(0<a.x&&!d?1/a.x:0,0<a.y&&!d?1/a.y:0,0<a.z&&!d?1/a.z:0);this.updateInertiaWorld(!0)};a.prototype.getVelocityAtWorldPoint=function(a,b){var k=
new d;a.vsub(this.position,k);this.angularVelocity.cross(k,b);this.velocity.vadd(b,b);return b}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(b,g,m){function a(a){this.chassisBody=a.chassisBody;this.wheelInfos=[];this.sliding=!1;this.world=null;this.indexRightAxis="undefined"!==typeof a.indexRightAxis?a.indexRightAxis:1;this.indexForwardAxis="undefined"!==
typeof a.indexForwardAxis?a.indexForwardAxis:0;this.indexUpAxis="undefined"!==typeof a.indexUpAxis?a.indexUpAxis:2}function e(a,d,b){var k=F,f=G,e=K,g=I;d.vsub(a.position,k);k.cross(b,f);a.invInertiaWorld.vmult(f,g);g.cross(k,e);return a.invMass+b.dot(e)}b("./Body");var d=b("../math/Vec3"),q=b("../math/Quaternion");b("../collision/RaycastResult");m=b("../collision/Ray");var f=b("../objects/WheelInfo");g.exports=a;new d;new d;new d;var p=new d,w=new d,u=new d;new m;a.prototype.addWheel=function(a){a=
a||{};a=new f(a);var d=this.wheelInfos.length;this.wheelInfos.push(a);return d};a.prototype.setSteeringValue=function(a,d){this.wheelInfos[d].steering=a};new d;a.prototype.applyEngineForce=function(a,d){this.wheelInfos[d].engineForce=a};a.prototype.setBrake=function(a,d){this.wheelInfos[d].brake=a};a.prototype.addToWorld=function(a){a.add(this.chassisBody);var d=this;this.preStepCallback=function(){d.updateVehicle(a.dt)};a.addEventListener("preStep",this.preStepCallback);this.world=a};a.prototype.getVehicleAxisWorld=
function(a,d){d.set(0===a?1:0,1===a?1:0,2===a?1:0);this.chassisBody.vectorToWorldFrame(d,d)};a.prototype.updateVehicle=function(a){for(var b=this.wheelInfos,k=b.length,f=this.chassisBody,e=0;e<k;e++)this.updateWheelTransform(e);this.currentVehicleSpeedKmHour=3.6*f.velocity.norm();e=new d;this.getVehicleAxisWorld(this.indexForwardAxis,e);0>e.dot(f.velocity)&&(this.currentVehicleSpeedKmHour*=-1);for(e=0;e<k;e++)this.castRay(b[e]);this.updateSuspension(a);var g=new d,n=new d;for(e=0;e<k;e++){var r=b[e],
q=r.suspensionForce;q>r.maxSuspensionForce&&(q=r.maxSuspensionForce);r.raycastResult.hitNormalWorld.scale(q*a,g);r.raycastResult.hitPointWorld.vsub(f.position,n);f.applyImpulse(g,r.raycastResult.hitPointWorld)}this.updateFriction(a);g=new d;n=new d;q=new d;for(e=0;e<k;e++){r=b[e];f.getVelocityAtWorldPoint(r.chassisConnectionPointWorld,q);var m=1;switch(this.indexUpAxis){case 1:m=-1}if(r.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,n);var p=n.dot(r.raycastResult.hitNormalWorld);r.raycastResult.hitNormalWorld.scale(p,
g);n.vsub(g,n);p=n.dot(q);r.deltaRotation=m*p*a/r.radius}!r.sliding&&r.isInContact||0===r.engineForce||!r.useCustomSlidingRotationalSpeed||(r.deltaRotation=(0<r.engineForce?1:-1)*r.customSlidingRotationalSpeed*a);Math.abs(r.brake)>Math.abs(r.engineForce)&&(r.deltaRotation=0);r.rotation+=r.deltaRotation;r.deltaRotation*=.99}};a.prototype.updateSuspension=function(a){a=this.chassisBody.mass;for(var d=this.wheelInfos,b=d.length,k=0;k<b;k++){var e=d[k];if(e.isInContact){var f=e.suspensionStiffness*(e.suspensionRestLength-
e.suspensionLength)*e.clippedInvContactDotSuspension;var g=e.suspensionRelativeVelocity;f-=(0>g?e.dampingCompression:e.dampingRelaxation)*g;e.suspensionForce=f*a;0>e.suspensionForce&&(e.suspensionForce=0)}else e.suspensionForce=0}};a.prototype.removeFromWorld=function(a){a.remove(this.chassisBody);a.removeEventListener("preStep",this.preStepCallback);this.world=null};var k=new d,r=new d;a.prototype.castRay=function(a){this.updateWheelTransformWorld(a);var b=this.chassisBody,e=-1;a.directionWorld.scale(a.suspensionRestLength+
a.radius,k);var f=a.chassisConnectionPointWorld;f.vadd(k,r);var g=a.raycastResult;g.reset();var n=b.collisionResponse;b.collisionResponse=!1;this.world.rayTest(f,r,g);b.collisionResponse=n;f=g.body;a.raycastResult.groundObject=0;f?(e=g.distance,a.raycastResult.hitNormalWorld=g.hitNormalWorld,a.isInContact=!0,a.suspensionLength=g.distance-a.radius,g=a.suspensionRestLength-a.maxSuspensionTravel,f=a.suspensionRestLength+a.maxSuspensionTravel,a.suspensionLength<g&&(a.suspensionLength=g),a.suspensionLength>
f&&(a.suspensionLength=f,a.raycastResult.reset()),g=a.raycastResult.hitNormalWorld.dot(a.directionWorld),f=new d,b.getVelocityAtWorldPoint(a.raycastResult.hitPointWorld,f),b=a.raycastResult.hitNormalWorld.dot(f),-.1<=g?(a.suspensionRelativeVelocity=0,a.clippedInvContactDotSuspension=10):(g=-1/g,a.suspensionRelativeVelocity=b*g,a.clippedInvContactDotSuspension=g)):(a.suspensionLength=a.suspensionRestLength+0*a.maxSuspensionTravel,a.suspensionRelativeVelocity=0,a.directionWorld.scale(-1,a.raycastResult.hitNormalWorld),
a.clippedInvContactDotSuspension=1);return e};a.prototype.updateWheelTransformWorld=function(a){a.isInContact=!1;var d=this.chassisBody;d.pointToWorldFrame(a.chassisConnectionPointLocal,a.chassisConnectionPointWorld);d.vectorToWorldFrame(a.directionLocal,a.directionWorld);d.vectorToWorldFrame(a.axleLocal,a.axleWorld)};a.prototype.updateWheelTransform=function(a){a=this.wheelInfos[a];this.updateWheelTransformWorld(a);a.directionLocal.scale(-1,p);w.copy(a.axleLocal);p.cross(w,u);u.normalize();w.normalize();
var d=a.steering,b=new q;b.setFromAxisAngle(p,d);d=new q;d.setFromAxisAngle(w,a.rotation);var k=a.worldTransform.quaternion;this.chassisBody.quaternion.mult(b,k);k.mult(d,k);k.normalize();b=a.worldTransform.position;b.copy(a.directionWorld);b.scale(a.suspensionLength,b);b.vadd(a.chassisConnectionPointWorld,b)};var n=[new d(1,0,0),new d(0,1,0),new d(0,0,1)];a.prototype.getWheelTransformWorld=function(a){return this.wheelInfos[a].worldTransform};var v=new d,x=[],z=[];a.prototype.updateFriction=function(a){for(var b=
this.wheelInfos,k=b.length,f=this.chassisBody,g=0,r=0;r<k;r++){var q=b[r],m=q.raycastResult.body;m&&g++;q.sideImpulse=0;q.forwardImpulse=0;z[r]||(z[r]=new d);x[r]||(x[r]=new d)}for(r=0;r<k;r++)if(q=b[r],m=q.raycastResult.body){var p=x[r];this.getWheelTransformWorld(r).vectorToWorldFrame(n[this.indexRightAxis],p);g=q.raycastResult.hitNormalWorld;var u=p.dot(g);g.scale(u,v);p.vsub(v,p);p.normalize();g.cross(p,z[r]);z[r].normalize();g=q;u=f;var w=q.raycastResult.hitPointWorld,F=q.raycastResult.hitPointWorld;
if(1.1<p.norm2())m=0;else{var K=B,G=Q,I=O;u.getVelocityAtWorldPoint(w,K);m.getVelocityAtWorldPoint(F,G);K.vsub(G,I);m=-.2*p.dot(I)*(1/(u.invMass+m.invMass))}g.sideImpulse=m;q.sideImpulse*=1}this.sliding=!1;for(r=0;r<k;r++){q=b[r];m=q.raycastResult.body;u=0;q.slipInfo=1;if(m){g=q.brake?q.brake:0;K=f;w=m;F=q.raycastResult.hitPointWorld;p=z[r];u=g;G=F;I=A;var L=D,na=E;K.getVelocityAtWorldPoint(G,I);w.getVelocityAtWorldPoint(G,L);I.vsub(L,na);G=p.dot(na);K=e(K,F,p);w=e(w,F,p);w=1/(K+w)*-G;u<w&&(w=u);
w<-u&&(w=-u);u=w;u+=q.engineForce*a;g/=u;q.slipInfo*=g}q.forwardImpulse=0;q.skidInfo=1;m&&(q.skidInfo=1,m=q.suspensionForce*a*q.frictionSlip,g=m*m,q.forwardImpulse=u,u=.5*q.forwardImpulse,w=1*q.sideImpulse,u=u*u+w*w,q.sliding=!1,u>g&&(this.sliding=!0,q.sliding=!0,g=m/Math.sqrt(u),q.skidInfo*=g))}if(this.sliding)for(r=0;r<k;r++)q=b[r],0!==q.sideImpulse&&1>q.skidInfo&&(q.forwardImpulse*=q.skidInfo,q.sideImpulse*=q.skidInfo);for(r=0;r<k;r++)q=b[r],a=new d,a.copy(q.raycastResult.hitPointWorld),0!==q.forwardImpulse&&
(m=new d,z[r].scale(q.forwardImpulse,m),f.applyImpulse(m,a)),0!==q.sideImpulse&&(m=q.raycastResult.body,g=new d,g.copy(q.raycastResult.hitPointWorld),u=new d,x[r].scale(q.sideImpulse,u),f.pointToLocalFrame(a,a),a["xyz"[this.indexUpAxis]]*=q.rollInfluence,f.pointToWorldFrame(a,a),f.applyImpulse(u,a),u.scale(-1,u),m.applyImpulse(u,g))};var A=new d,D=new d,E=new d,F=new d,G=new d,K=new d,I=new d,B=new d,Q=new d,O=new d},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,
"../objects/WheelInfo":36,"./Body":31}],33:[function(b,g,m){function a(a){this.wheelBodies=[];this.coordinateSystem="undefined"===typeof a.coordinateSystem?new f(1,2,3):a.coordinateSystem.clone();this.chassisBody=a.chassisBody;this.chassisBody||(a=new q(new f(5,2,.5)),this.chassisBody=new e(1,a));this.constraints=[];this.wheelAxes=[];this.wheelForces=[]}var e=b("./Body"),d=b("../shapes/Sphere"),q=b("../shapes/Box"),f=b("../math/Vec3"),p=b("../constraints/HingeConstraint");g.exports=a;a.prototype.addWheel=
function(a){a=a||{};var b=a.body;b||(b=new e(1,new d(1.2)));this.wheelBodies.push(b);this.wheelForces.push(0);new f;var k="undefined"!==typeof a.position?a.position.clone():new f,g=new f;this.chassisBody.pointToWorldFrame(k,g);b.position.set(g.x,g.y,g.z);a="undefined"!==typeof a.axis?a.axis.clone():new f(0,1,0);this.wheelAxes.push(a);b=new p(this.chassisBody,b,{pivotA:k,axisA:a,pivotB:f.ZERO,axisB:a,collideConnected:!1});this.constraints.push(b);return this.wheelBodies.length-1};a.prototype.setSteeringValue=
function(a,d){var b=this.wheelAxes[d],k=Math.cos(a),f=Math.sin(a),e=b.x;b=b.y;this.constraints[d].axisA.set(k*e-f*b,f*e+k*b,0)};a.prototype.setMotorSpeed=function(a,d){var b=this.constraints[d];b.enableMotor();b.motorTargetVelocity=a};a.prototype.disableMotor=function(a){this.constraints[a].disableMotor()};var w=new f;a.prototype.setWheelForce=function(a,d){this.wheelForces[d]=a};a.prototype.applyWheelForce=function(a,d){var b=this.wheelBodies[d],k=b.torque;this.wheelAxes[d].scale(a,w);b.vectorToWorldFrame(w,
w);k.vadd(w,k)};a.prototype.addToWorld=function(a){for(var d=this.constraints,b=this.wheelBodies.concat([this.chassisBody]),k=0;k<b.length;k++)a.add(b[k]);for(k=0;k<d.length;k++)a.addConstraint(d[k]);a.addEventListener("preStep",this._update.bind(this))};a.prototype._update=function(){for(var a=this.wheelForces,d=0;d<a.length;d++)this.applyWheelForce(a[d],d)};a.prototype.removeFromWorld=function(a){for(var d=this.constraints,b=this.wheelBodies.concat([this.chassisBody]),k=0;k<b.length;k++)a.remove(b[k]);
for(k=0;k<d.length;k++)a.removeConstraint(d[k])};var u=new f;a.prototype.getWheelSpeed=function(a){var d=this.wheelBodies[a].angularVelocity;this.chassisBody.vectorToWorldFrame(this.wheelAxes[a],u);return d.dot(u)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(b,g,m){function a(){this.particles=[];this.speedOfSound=this.smoothingRadius=this.density=1;this.viscosity=.01;this.eps=1E-6;this.pressures=[];this.densities=[];this.neighbors=
[]}g.exports=a;b("../shapes/Shape");g=b("../math/Vec3");b("../math/Quaternion");b("../shapes/Particle");b("../objects/Body");b("../material/Material");a.prototype.add=function(a){this.particles.push(a);this.neighbors.length<this.particles.length&&this.neighbors.push([])};a.prototype.remove=function(a){a=this.particles.indexOf(a);-1!==a&&(this.particles.splice(a,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var e=new g;a.prototype.getNeighbors=function(a,d){for(var b=this.particles.length,
k=a.id,f=this.smoothingRadius*this.smoothingRadius,g=0;g!==b;g++){var r=this.particles[g];r.position.vsub(a.position,e);k!==r.id&&e.norm2()<f&&d.push(r)}};var d=new g,q=new g,f=new g,p=new g,w=new g,u=new g;a.prototype.update=function(){for(var a=this.particles.length,b=this.speedOfSound,e=this.eps,g=0;g!==a;g++){var m=this.particles[g],z=this.neighbors[g];z.length=0;this.getNeighbors(m,z);z.push(this.particles[g]);for(var A=z.length,D=0,E=0;E!==A;E++){m.position.vsub(z[E].position,d);var F=d.norm();
F=this.w(F);D+=z[E].mass*F}this.densities[g]=D;this.pressures[g]=b*b*(this.densities[g]-this.density)}for(g=0;g!==a;g++){b=this.particles[g];q.set(0,0,0);f.set(0,0,0);z=this.neighbors[g];A=z.length;for(E=0;E!==A;E++)D=z[E],b.position.vsub(D.position,w),F=w.norm(),m=-D.mass*(this.pressures[g]/(this.densities[g]*this.densities[g]+e)+this.pressures[E]/(this.densities[E]*this.densities[E]+e)),this.gradw(w,p),p.mult(m,p),q.vadd(p,q),D.velocity.vsub(b.velocity,u),u.mult(1/(1E-4+this.densities[g]*this.densities[E])*
this.viscosity*D.mass,u),m=this.nablaw(F),u.mult(m,u),f.vadd(u,f);f.mult(b.mass,f);q.mult(b.mass,q);b.force.vadd(f,b.force);b.force.vadd(q,b.force)}};a.prototype.w=function(a){var d=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(d,9))*Math.pow(d*d-a*a,3)};a.prototype.gradw=function(a,d){var b=a.norm(),k=this.smoothingRadius;a.mult(945/(32*Math.PI*Math.pow(k,9))*Math.pow(k*k-b*b,2),d)};a.prototype.nablaw=function(a){var d=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(d,9))*(d*d-a*a)*(7*
a*a-3*d*d)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(b,g,m){function a(a,d,b){b=b||{};this.restLength="number"===typeof b.restLength?b.restLength:1;this.stiffness=b.stiffness||100;this.damping=b.damping||1;this.bodyA=a;this.bodyB=d;this.localAnchorA=new e;this.localAnchorB=new e;b.localAnchorA&&this.localAnchorA.copy(b.localAnchorA);b.localAnchorB&&this.localAnchorB.copy(b.localAnchorB);b.worldAnchorA&&
this.setWorldAnchorA(b.worldAnchorA);b.worldAnchorB&&this.setWorldAnchorB(b.worldAnchorB)}var e=b("../math/Vec3");g.exports=a;a.prototype.setWorldAnchorA=function(a){this.bodyA.pointToLocalFrame(a,this.localAnchorA)};a.prototype.setWorldAnchorB=function(a){this.bodyB.pointToLocalFrame(a,this.localAnchorB)};a.prototype.getWorldAnchorA=function(a){this.bodyA.pointToWorldFrame(this.localAnchorA,a)};a.prototype.getWorldAnchorB=function(a){this.bodyB.pointToWorldFrame(this.localAnchorB,a)};var d=new e,
q=new e,f=new e,p=new e,w=new e,u=new e,k=new e,r=new e,n=new e,v=new e,x=new e;a.prototype.applyForce=function(){var a=this.stiffness,b=this.damping,e=this.restLength,g=this.bodyA,m=this.bodyB;this.getWorldAnchorA(w);this.getWorldAnchorB(u);w.vsub(g.position,k);u.vsub(m.position,r);u.vsub(w,d);var G=d.norm();q.copy(d);q.normalize();m.velocity.vsub(g.velocity,f);m.angularVelocity.cross(r,x);f.vadd(x,f);g.angularVelocity.cross(k,x);f.vsub(x,f);q.mult(-a*(G-e)-b*f.dot(q),p);g.force.vsub(p,g.force);
m.force.vadd(p,m.force);k.cross(p,n);r.cross(p,v);g.torque.vsub(n,g.torque);m.torque.vadd(v,m.torque)}},{"../math/Vec3":30}],36:[function(b,g,m){function a(a){a=f.defaults(a,{chassisConnectionPointLocal:new e,chassisConnectionPointWorld:new e,directionLocal:new e,directionWorld:new e,axleLocal:new e,axleWorld:new e,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1E4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,
maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1});this.maxSuspensionTravel=a.maxSuspensionTravel;this.customSlidingRotationalSpeed=a.customSlidingRotationalSpeed;this.useCustomSlidingRotationalSpeed=a.useCustomSlidingRotationalSpeed;this.sliding=!1;this.chassisConnectionPointLocal=a.chassisConnectionPointLocal.clone();
this.chassisConnectionPointWorld=a.chassisConnectionPointWorld.clone();this.directionLocal=a.directionLocal.clone();this.directionWorld=a.directionWorld.clone();this.axleLocal=a.axleLocal.clone();this.axleWorld=a.axleWorld.clone();this.suspensionRestLength=a.suspensionRestLength;this.suspensionMaxLength=a.suspensionMaxLength;this.radius=a.radius;this.suspensionStiffness=a.suspensionStiffness;this.dampingCompression=a.dampingCompression;this.dampingRelaxation=a.dampingRelaxation;this.frictionSlip=
a.frictionSlip;this.deltaRotation=this.rotation=this.steering=0;this.rollInfluence=a.rollInfluence;this.maxSuspensionForce=a.maxSuspensionForce;this.brake=this.engineForce=0;this.isFrontWheel=a.isFrontWheel;this.clippedInvContactDotSuspension=1;this.forwardImpulse=this.sideImpulse=this.suspensionLength=this.skidInfo=this.suspensionForce=this.suspensionRelativeVelocity=0;this.raycastResult=new q;this.worldTransform=new d;this.isInContact=!1}var e=b("../math/Vec3"),d=b("../math/Transform"),q=b("../collision/RaycastResult"),
f=b("../utils/Utils");g.exports=a;var p=new e,w=new e;p=new e;a.prototype.updateWheel=function(a){var d=this.raycastResult;if(this.isInContact){var b=d.hitNormalWorld.dot(d.directionWorld);d.hitPointWorld.vsub(a.position,w);a.getVelocityAtWorldPoint(w,p);a=d.hitNormalWorld.dot(p);-.1<=b?(this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10):(b=-1/b,this.suspensionRelativeVelocity=a*b,this.clippedInvContactDotSuspension=b)}else d.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=
0,d.directionWorld.scale(-1,d.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(b,g,m){function a(a){e.call(this);this.type=e.types.BOX;this.halfExtents=a;this.convexPolyhedronRepresentation=null;this.updateConvexPolyhedronRepresentation();this.updateBoundingSphereRadius()}g.exports=a;var e=b("./Shape"),d=b("../math/Vec3"),q=b("./ConvexPolyhedron");a.prototype=new e;a.prototype.constructor=
a;a.prototype.updateConvexPolyhedronRepresentation=function(){var a=this.halfExtents.x,b=this.halfExtents.y,k=this.halfExtents.z;a=[new d(-a,-b,-k),new d(a,-b,-k),new d(a,b,-k),new d(-a,b,-k),new d(-a,-b,k),new d(a,-b,k),new d(a,b,k),new d(-a,b,k)];new d(0,0,1);new d(0,1,0);new d(1,0,0);this.convexPolyhedronRepresentation=a=new q(a,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]);a.material=this.material};a.prototype.calculateLocalInertia=function(b,f){f=f||new d;a.calculateInertia(this.halfExtents,
b,f);return f};a.calculateInertia=function(a,d,b){b.x=1/12*d*(4*a.y*a.y+4*a.z*a.z);b.y=1/12*d*(4*a.x*a.x+4*a.z*a.z);b.z=1/12*d*(4*a.y*a.y+4*a.x*a.x)};a.prototype.getSideNormals=function(a,d){var b=this.halfExtents;a[0].set(b.x,0,0);a[1].set(0,b.y,0);a[2].set(0,0,b.z);a[3].set(-b.x,0,0);a[4].set(0,-b.y,0);a[5].set(0,0,-b.z);if(void 0!==d)for(b=0;b!==a.length;b++)d.vmult(a[b],a[b]);return a};a.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z};a.prototype.updateBoundingSphereRadius=
function(){this.boundingSphereRadius=this.halfExtents.norm()};var f=new d;new d;a.prototype.forEachWorldCorner=function(a,d,b){var e=this.halfExtents;e=[[e.x,e.y,e.z],[-e.x,e.y,e.z],[-e.x,-e.y,e.z],[-e.x,-e.y,-e.z],[e.x,-e.y,-e.z],[e.x,e.y,-e.z],[-e.x,e.y,-e.z],[e.x,-e.y,e.z]];for(var k=0;k<e.length;k++)f.set(e[k][0],e[k][1],e[k][2]),d.vmult(f,f),a.vadd(f,f),b(f.x,f.y,f.z)};var p=[new d,new d,new d,new d,new d,new d,new d,new d];a.prototype.calculateWorldAABB=function(a,d,b,e){var f=this.halfExtents;
p[0].set(f.x,f.y,f.z);p[1].set(-f.x,f.y,f.z);p[2].set(-f.x,-f.y,f.z);p[3].set(-f.x,-f.y,-f.z);p[4].set(f.x,-f.y,-f.z);p[5].set(f.x,f.y,-f.z);p[6].set(-f.x,f.y,-f.z);p[7].set(f.x,-f.y,f.z);var k=p[0];d.vmult(k,k);a.vadd(k,k);e.copy(k);b.copy(k);for(f=1;8>f;f++){k=p[f];d.vmult(k,k);a.vadd(k,k);var g=k.x,r=k.y;k=k.z;g>e.x&&(e.x=g);r>e.y&&(e.y=r);k>e.z&&(e.z=k);g<b.x&&(b.x=g);r<b.y&&(b.y=r);k<b.z&&(b.z=k)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(b,g,m){function a(a,d,
b){e.call(this);this.type=e.types.CONVEXPOLYHEDRON;this.vertices=a||[];this.worldVertices=[];this.worldVerticesNeedsUpdate=!0;this.faces=d||[];this.faceNormals=[];this.computeNormals();this.worldFaceNormalsNeedsUpdate=!0;this.worldFaceNormals=[];this.uniqueEdges=[];this.uniqueAxes=b?b.slice():null;this.computeEdges();this.updateBoundingSphereRadius()}g.exports=a;var e=b("./Shape"),d=b("../math/Vec3");b("../math/Quaternion");var q=b("../math/Transform");a.prototype=new e;a.prototype.constructor=a;
var f=new d;a.prototype.computeEdges=function(){for(var a=this.faces,d=this.vertices,b=this.uniqueEdges,e=b.length=0;e!==a.length;e++)for(var k=a[e],g=k.length,n=0;n!==g;n++){d[k[n]].vsub(d[k[(n+1)%g]],f);f.normalize();for(var r=!1,q=0;q!==b.length;q++)if(b[q].almostEquals(f)||b[q].almostEquals(f)){r=!0;break}r||b.push(f.clone())}};a.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var a=0;a<this.faces.length;a++){for(var b=0;b<this.faces[a].length;b++)if(!this.vertices[this.faces[a][b]])throw Error("Vertex "+
this.faces[a][b]+" not found!");b=this.faceNormals[a]||new d;this.getFaceNormal(a,b);b.negate(b);this.faceNormals[a]=b;if(0>b.dot(this.vertices[this.faces[a][0]]))for(console.error(".faceNormals["+a+"] = Vec3("+b.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),b=0;b<this.faces[a].length;b++)console.warn(".vertices["+this.faces[a][b]+"] = Vec3("+this.vertices[this.faces[a][b]].toString()+")")}};var p=
new d,w=new d;a.computeNormal=function(a,d,b,e){d.vsub(a,w);b.vsub(d,p);p.cross(w,e);e.isZero()||e.normalize()};a.prototype.getFaceNormal=function(d,b){var e=this.faces[d];return a.computeNormal(this.vertices[e[0]],this.vertices[e[1]],this.vertices[e[2]],b)};var u=new d;a.prototype.clipAgainstHull=function(a,b,e,f,k,g,n,r,q){for(var m=-1,p=-Number.MAX_VALUE,v=0;v<e.faces.length;v++){u.copy(e.faceNormals[v]);k.vmult(u,u);var w=u.dot(g);w>p&&(p=w,m=v)}p=[];v=e.faces[m];w=v.length;for(var x=0;x<w;x++){var B=
e.vertices[v[x]],z=new d;z.copy(B);k.vmult(z,z);f.vadd(z,z);p.push(z)}0<=m&&this.clipFaceAgainstHull(g,a,b,p,n,r,q)};var k=new d,r=new d,n=new d,v=new d,x=new d,z=new d;a.prototype.findSeparatingAxis=function(a,d,b,e,f,g,q,m){var p=Number.MAX_VALUE,u=0;if(this.uniqueAxes)for(B=0;B!==this.uniqueAxes.length;B++){b.vmult(this.uniqueAxes[B],k);A=this.testSepAxis(k,a,d,b,e,f);if(!1===A)return!1;A<p&&(p=A,g.copy(k))}else for(var w=q?q.length:this.faces.length,B=0;B<w;B++){A=q?q[B]:B;k.copy(this.faceNormals[A]);
b.vmult(k,k);var A=this.testSepAxis(k,a,d,b,e,f);if(!1===A)return!1;A<p&&(p=A,g.copy(k))}if(a.uniqueAxes)for(B=0;B!==a.uniqueAxes.length;B++){f.vmult(a.uniqueAxes[B],r);u++;A=this.testSepAxis(r,a,d,b,e,f);if(!1===A)return!1;A<p&&(p=A,g.copy(r))}else for(q=m?m.length:a.faces.length,B=0;B<q;B++){A=m?m[B]:B;r.copy(a.faceNormals[A]);f.vmult(r,r);u++;A=this.testSepAxis(r,a,d,b,e,f);if(!1===A)return!1;A<p&&(p=A,g.copy(r))}for(m=0;m!==this.uniqueEdges.length;m++)for(b.vmult(this.uniqueEdges[m],v),u=0;u!==
a.uniqueEdges.length;u++)if(f.vmult(a.uniqueEdges[u],x),v.cross(x,z),!z.almostZero()){z.normalize();B=this.testSepAxis(z,a,d,b,e,f);if(!1===B)return!1;B<p&&(p=B,g.copy(z))}e.vsub(d,n);0<n.dot(g)&&g.negate(g);return!0};var A=[],D=[];a.prototype.testSepAxis=function(d,b,e,f,k,g){a.project(this,d,e,f,A);a.project(b,d,k,g,D);e=A[0];d=A[1];b=D[0];f=D[1];if(e<f||b<d)return!1;e-=f;d=b-d;return e<d?e:d};var E=new d,F=new d;a.prototype.calculateLocalInertia=function(a,d){this.computeLocalAABB(E,F);var b=F.x-
E.x,e=F.y-E.y,f=F.z-E.z;d.x=1/12*a*(4*e*e+4*f*f);d.y=1/12*a*(4*b*b+4*f*f);d.z=1/12*a*(4*e*e+4*b*b)};a.prototype.getPlaneConstantOfFace=function(a){return-this.faceNormals[a].dot(this.vertices[this.faces[a][0]])};var G=new d,K=new d,I=new d,B=new d,Q=new d,O=new d,L=new d,H=new d;a.prototype.clipFaceAgainstHull=function(a,d,b,e,f,k,g){for(var n=[],r=-1,q=Number.MAX_VALUE,m=0;m<this.faces.length;m++){G.copy(this.faceNormals[m]);b.vmult(G,G);var p=G.dot(a);p<q&&(q=p,r=m)}if(!(0>r)){a=this.faces[r];a.connectedFaces=
[];for(q=0;q<this.faces.length;q++)for(m=0;m<this.faces[q].length;m++)-1!==a.indexOf(this.faces[q][m])&&q!==r&&-1===a.connectedFaces.indexOf(q)&&a.connectedFaces.push(q);q=a.length;for(m=0;m<q;m++){p=this.vertices[a[m]];p.vsub(this.vertices[a[(m+1)%q]],K);I.copy(K);b.vmult(I,I);d.vadd(I,I);B.copy(this.faceNormals[r]);b.vmult(B,B);d.vadd(B,B);I.cross(B,Q);Q.negate(Q);O.copy(p);b.vmult(O,O);d.vadd(O,O);O.dot(Q);p=a.connectedFaces[m];L.copy(this.faceNormals[p]);p=this.getPlaneConstantOfFace(p);H.copy(L);
b.vmult(H,H);p-=H.dot(d);for(this.clipFaceAgainstPlane(e,n,H,p);e.length;)e.shift();for(;n.length;)e.push(n.shift())}L.copy(this.faceNormals[r]);p=this.getPlaneConstantOfFace(r);H.copy(L);b.vmult(H,H);p-=H.dot(d);for(q=0;q<e.length;q++)d=H.dot(e[q])+p,d<=f&&(console.log("clamped: depth="+d+" to minDist="+(f+"")),d=f),d<=k&&(b=e[q],0>=d&&g.push({point:b,normal:H,depth:d}))}};a.prototype.clipFaceAgainstPlane=function(a,b,e,f){var k=a.length;if(2>k)return b;var g=a[a.length-1];var n=e.dot(g)+f;for(var r=
0;r<k;r++){var q=a[r];var m=e.dot(q)+f;if(0>n){if(0>m){var p=new d;p.copy(q)}else p=new d,g.lerp(q,n/(n-m),p);b.push(p)}else 0>m&&(p=new d,g.lerp(q,n/(n-m),p),b.push(p),b.push(q));g=q;n=m}return b};a.prototype.computeWorldVertices=function(a,b){for(var e=this.vertices.length;this.worldVertices.length<e;)this.worldVertices.push(new d);for(var f=this.vertices,k=this.worldVertices,g=0;g!==e;g++)b.vmult(f[g],k[g]),a.vadd(k[g],k[g]);this.worldVerticesNeedsUpdate=!1};new d;a.prototype.computeLocalAABB=
function(a,d){var b=this.vertices.length,e=this.vertices;a.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);d.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var f=0;f<b;f++){var k=e[f];k.x<a.x?a.x=k.x:k.x>d.x&&(d.x=k.x);k.y<a.y?a.y=k.y:k.y>d.y&&(d.y=k.y);k.z<a.z?a.z=k.z:k.z>d.z&&(d.z=k.z)}};a.prototype.computeWorldFaceNormals=function(a){for(var b=this.faceNormals.length;this.worldFaceNormals.length<b;)this.worldFaceNormals.push(new d);for(var e=this.faceNormals,f=this.worldFaceNormals,
k=0;k!==b;k++)a.vmult(e[k],f[k]);this.worldFaceNormalsNeedsUpdate=!1};a.prototype.updateBoundingSphereRadius=function(){for(var a=0,d=this.vertices,b=0,e=d.length;b!==e;b++){var f=d[b].norm2();f>a&&(a=f)}this.boundingSphereRadius=Math.sqrt(a)};var W=new d;a.prototype.calculateWorldAABB=function(a,d,b,e){for(var f=this.vertices.length,k=this.vertices,g,n,r,q,m,p,v=0;v<f;v++){W.copy(k[v]);d.vmult(W,W);a.vadd(W,W);var u=W;if(u.x<g||void 0===g)g=u.x;else if(u.x>q||void 0===q)q=u.x;if(u.y<n||void 0===
n)n=u.y;else if(u.y>m||void 0===m)m=u.y;if(u.z<r||void 0===r)r=u.z;else if(u.z>p||void 0===p)p=u.z}b.set(g,n,r);e.set(q,m,p)};a.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};a.prototype.getAveragePointLocal=function(a){a=a||new d;for(var b=this.vertices.length,e=this.vertices,f=0;f<b;f++)a.vadd(e[f],a);a.mult(1/b,a);return a};a.prototype.transformAllPoints=function(a,d){var b=this.vertices.length,e=this.vertices;if(d){for(var f=0;f<b;f++){var k=e[f];d.vmult(k,k)}for(f=
0;f<this.faceNormals.length;f++)k=this.faceNormals[f],d.vmult(k,k)}if(a)for(f=0;f<b;f++)k=e[f],k.vadd(a,k)};var ba=new d,X=new d,R=new d;a.prototype.pointIsInside=function(a){var d=this.vertices,b=this.faces,e=this.faceNormals,f=this.faces.length;this.getAveragePointLocal(ba);for(var k=0;k<f;k++){var g=e[k];var n=d[b[k][0]],r=X;a.vsub(n,r);r=g.dot(r);var q=R;ba.vsub(n,q);g=g.dot(q);if(0>r&&0<g||0<r&&0>g)return!1}return-1};new d;var J=new d,T=new d;a.project=function(a,d,b,e,f){var k=a.vertices.length;
a=a.vertices;T.setZero();q.vectorToLocalFrame(b,e,d,J);q.pointToLocalFrame(b,e,T,T);e=T.dot(J);b=d=a[0].dot(J);for(var g=1;g<k;g++){var n=a[g].dot(J);n>d&&(d=n);n<b&&(b=n)}b-=e;d-=e;b>d&&(k=b,b=d,d=k);f[0]=d;f[1]=b}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(b,g,m){function a(a,b,g,m){var f=[],r=[],n=[],p=[],u=[],w=Math.cos,A=Math.sin;f.push(new d(b*w(0),b*A(0),.5*-g));p.push(0);f.push(new d(a*w(0),a*A(0),.5*g));u.push(1);for(var D=0;D<m;D++){var E=
2*Math.PI/m*(D+1),F=2*Math.PI/m*(D+.5);D<m-1?(f.push(new d(b*w(E),b*A(E),.5*-g)),p.push(2*D+2),f.push(new d(a*w(E),a*A(E),.5*g)),u.push(2*D+3),n.push([2*D+2,2*D+3,2*D+1,2*D])):n.push([0,1,2*D+1,2*D]);(1===m%2||D<m/2)&&r.push(new d(w(F),A(F),0))}n.push(u);r.push(new d(0,0,1));a=[];for(D=0;D<p.length;D++)a.push(p[p.length-D-1]);n.push(a);this.type=e.types.CONVEXPOLYHEDRON;q.call(this,f,n,r)}g.exports=a;var e=b("./Shape"),d=b("../math/Vec3");b("../math/Quaternion");var q=b("./ConvexPolyhedron");a.prototype=
new q},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(b,g,m){function a(a,b){b=f.defaults(b,{maxValue:null,minValue:null,elementSize:1});this.data=a;this.maxValue=b.maxValue;this.minValue=b.minValue;this.elementSize=b.elementSize;null===b.minValue&&this.updateMinValue();null===b.maxValue&&this.updateMaxValue();this.cacheEnabled=!0;e.call(this);this.pillarConvex=new d;this.pillarOffset=new q;this.type=e.types.HEIGHTFIELD;this.updateBoundingSphereRadius();
this._cachedPillars={}}var e=b("./Shape"),d=b("./ConvexPolyhedron"),q=b("../math/Vec3"),f=b("../utils/Utils");g.exports=a;a.prototype=new e;a.prototype.update=function(){this._cachedPillars={}};a.prototype.updateMinValue=function(){for(var a=this.data,b=a[0][0],d=0;d!==a.length;d++)for(var e=0;e!==a[d].length;e++){var f=a[d][e];f<b&&(b=f)}this.minValue=b};a.prototype.updateMaxValue=function(){for(var a=this.data,b=a[0][0],d=0;d!==a.length;d++)for(var e=0;e!==a[d].length;e++){var f=a[d][e];f>b&&(b=
f)}this.maxValue=b};a.prototype.setHeightValueAtIndex=function(a,b,d){this.data[a][b]=d;this.clearCachedConvexTrianglePillar(a,b,!1);0<a&&(this.clearCachedConvexTrianglePillar(a-1,b,!0),this.clearCachedConvexTrianglePillar(a-1,b,!1));0<b&&(this.clearCachedConvexTrianglePillar(a,b-1,!0),this.clearCachedConvexTrianglePillar(a,b-1,!1));0<b&&0<a&&this.clearCachedConvexTrianglePillar(a-1,b-1,!0)};a.prototype.getRectMinMax=function(a,b,d,e,f){f=f||[];for(var k=this.data,g=this.minValue;a<=d;a++)for(var r=
b;r<=e;r++){var q=k[a][r];q>g&&(g=q)}f[0]=this.minValue;f[1]=g};a.prototype.getIndexOfPosition=function(a,b,d,e){var f=this.elementSize,k=this.data;a=Math.floor(a/f);b=Math.floor(b/f);d[0]=a;d[1]=b;e&&(0>a&&(a=0),0>b&&(b=0),a>=k.length-1&&(a=k.length-1),b>=k[0].length-1&&(b=k[0].length-1));return 0>a||0>b||a>=k.length-1||b>=k[0].length-1?!1:!0};a.prototype.getHeightAt=function(a,b,d){var e=[];this.getIndexOfPosition(a,b,e,d);a=[];this.getRectMinMax(e[0],e[1]+1,e[0],e[1]+1,a);return(a[0]+a[1])/2};
a.prototype.getCacheConvexTrianglePillarKey=function(a,b,d){return a+"_"+b+"_"+(d?1:0)};a.prototype.getCachedConvexTrianglePillar=function(a,b,d){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(a,b,d)]};a.prototype.setCachedConvexTrianglePillar=function(a,b,d,e,f){this._cachedPillars[this.getCacheConvexTrianglePillarKey(a,b,d)]={convex:e,offset:f}};a.prototype.clearCachedConvexTrianglePillar=function(a,b,d){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(a,b,d)]};a.prototype.getConvexTrianglePillar=
function(a,b,e){var f=this.pillarConvex,g=this.pillarOffset;if(this.cacheEnabled){var n=this.getCachedConvexTrianglePillar(a,b,e);if(n){this.pillarConvex=n.convex;this.pillarOffset=n.offset;return}f=new d;g=new q;this.pillarConvex=f;this.pillarOffset=g}n=this.data;var m=this.elementSize,p=f.faces;f.vertices.length=6;for(var u=0;6>u;u++)f.vertices[u]||(f.vertices[u]=new q);p.length=5;for(u=0;5>u;u++)p[u]||(p[u]=[]);u=f.vertices;var w=(Math.min(n[a][b],n[a+1][b],n[a][b+1],n[a+1][b+1])-this.minValue)/
2+this.minValue;e?(g.set((a+.75)*m,(b+.75)*m,w),u[0].set(.25*m,.25*m,n[a+1][b+1]-w),u[1].set(-.75*m,.25*m,n[a][b+1]-w),u[2].set(.25*m,-.75*m,n[a+1][b]-w),u[3].set(.25*m,.25*m,-w-1),u[4].set(-.75*m,.25*m,-w-1),u[5].set(.25*m,-.75*m,-w-1),p[0][0]=0,p[0][1]=1,p[0][2]=2,p[1][0]=5,p[1][1]=4,p[1][2]=3,p[2][0]=2,p[2][1]=5,p[2][2]=3,p[2][3]=0,p[3][0]=3,p[3][1]=4,p[3][2]=1,p[3][3]=0,p[4][0]=1,p[4][1]=4,p[4][2]=5,p[4][3]=2):(g.set((a+.25)*m,(b+.25)*m,w),u[0].set(-.25*m,-.25*m,n[a][b]-w),u[1].set(.75*m,-.25*
m,n[a+1][b]-w),u[2].set(-.25*m,.75*m,n[a][b+1]-w),u[3].set(-.25*m,-.25*m,-w-1),u[4].set(.75*m,-.25*m,-w-1),u[5].set(-.25*m,.75*m,-w-1),p[0][0]=0,p[0][1]=1,p[0][2]=2,p[1][0]=5,p[1][1]=4,p[1][2]=3,p[2][0]=0,p[2][1]=2,p[2][2]=5,p[2][3]=3,p[3][0]=1,p[3][1]=0,p[3][2]=3,p[3][3]=4,p[4][0]=4,p[4][1]=5,p[4][2]=2,p[4][3]=1);f.computeNormals();f.computeEdges();f.updateBoundingSphereRadius();this.setCachedConvexTrianglePillar(a,b,e,f,g)};a.prototype.calculateLocalInertia=function(a,b){b=b||new q;b.set(0,0,0);
return b};a.prototype.volume=function(){return Number.MAX_VALUE};a.prototype.calculateWorldAABB=function(a,b,d,e){d.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};a.prototype.updateBoundingSphereRadius=function(){var a=this.data,b=this.elementSize;this.boundingSphereRadius=(new q(a.length*b,a[0].length*b,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue)))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,
"./Shape":43}],41:[function(b,g,m){function a(){e.call(this);this.type=e.types.PARTICLE}g.exports=a;var e=b("./Shape"),d=b("../math/Vec3");a.prototype=new e;a.prototype.constructor=a;a.prototype.calculateLocalInertia=function(a,b){b=b||new d;b.set(0,0,0);return b};a.prototype.volume=function(){return 0};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0};a.prototype.calculateWorldAABB=function(a,b,d,e){d.copy(a);e.copy(a)}},{"../math/Vec3":30,"./Shape":43}],42:[function(b,
g,m){function a(){e.call(this);this.type=e.types.PLANE;this.worldNormal=new d;this.worldNormalNeedsUpdate=!0;this.boundingSphereRadius=Number.MAX_VALUE}g.exports=a;var e=b("./Shape"),d=b("../math/Vec3");a.prototype=new e;a.prototype.constructor=a;a.prototype.computeWorldNormal=function(a){var b=this.worldNormal;b.set(0,0,1);a.vmult(b,b);this.worldNormalNeedsUpdate=!1};a.prototype.calculateLocalInertia=function(a,b){return b=b||new d};a.prototype.volume=function(){return Number.MAX_VALUE};var q=new d;
a.prototype.calculateWorldAABB=function(a,b,d,e){q.set(0,0,1);b.vmult(q,q);b=Number.MAX_VALUE;d.set(-b,-b,-b);e.set(b,b,b);1===q.x&&(e.x=a.x);1===q.y&&(e.y=a.y);1===q.z&&(e.z=a.z);-1===q.x&&(d.x=a.x);-1===q.y&&(d.y=a.y);-1===q.z&&(d.z=a.z)};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(b,g,m){function a(){this.id=a.idCounter++;this.boundingSphereRadius=this.type=0;this.collisionResponse=!0;this.material=
null}g.exports=a;a=b("./Shape");b("../math/Vec3");b("../math/Quaternion");b("../material/Material");a.prototype.constructor=a;a.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type;};a.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type;};a.prototype.calculateLocalInertia=function(a,b){throw"calculateLocalInertia() not implemented for shape type "+this.type;};a.idCounter=0;a.types={SPHERE:1,
PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(b,g,m){function a(a){e.call(this);this.radius=void 0!==a?Number(a):1;this.type=e.types.SPHERE;if(0>this.radius)throw Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}g.exports=a;var e=b("./Shape"),d=b("../math/Vec3");a.prototype=new e;a.prototype.constructor=a;a.prototype.calculateLocalInertia=
function(a,b){b=b||new d;var e=2*a*this.radius*this.radius/5;b.x=e;b.y=e;b.z=e;return b};a.prototype.volume=function(){return 4*Math.PI*this.radius/3};a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius};a.prototype.calculateWorldAABB=function(a,b,d,e){b=this.radius;for(var f=["x","y","z"],k=0;k<f.length;k++){var g=f[k];d[g]=a[g]-b;e[g]=a[g]+b}}},{"../math/Vec3":30,"./Shape":43}],45:[function(b,g,m){function a(a,b){e.call(this);this.type=e.types.TRIMESH;this.vertices=
new Float32Array(a);this.indices=new Int16Array(b);this.normals=new Float32Array(b.length);this.aabb=new f;this.edges=null;this.scale=new d(1,1,1);this.tree=new p;this.updateEdges();this.updateNormals();this.updateAABB();this.updateBoundingSphereRadius();this.updateTree()}g.exports=a;var e=b("./Shape"),d=b("../math/Vec3");b("../math/Quaternion");var q=b("../math/Transform"),f=b("../collision/AABB"),p=b("../utils/Octree");a.prototype=new e;a.prototype.constructor=a;var w=new d;a.prototype.updateTree=
function(){var a=this.tree;a.reset();a.aabb.copy(this.aabb);var b=this.scale;a.aabb.lowerBound.x*=1/b.x;a.aabb.lowerBound.y*=1/b.y;a.aabb.lowerBound.z*=1/b.z;a.aabb.upperBound.x*=1/b.x;a.aabb.upperBound.y*=1/b.y;a.aabb.upperBound.z*=1/b.z;b=new f;for(var e=new d,k=new d,g=new d,n=[e,k,g],r=0;r<this.indices.length/3;r++){var q=3*r;this._getUnscaledVertex(this.indices[q],e);this._getUnscaledVertex(this.indices[q+1],k);this._getUnscaledVertex(this.indices[q+2],g);b.setFromPoints(n);a.insert(b,r)}a.removeEmptyNodes()};
var u=new f;a.prototype.getTrianglesInAABB=function(a,b){u.copy(a);var d=this.scale,e=d.x,f=d.y;d=d.z;var k=u.lowerBound,g=u.upperBound;k.x/=e;k.y/=f;k.z/=d;g.x/=e;g.y/=f;g.z/=d;return this.tree.aabbQuery(u,b)};a.prototype.setScale=function(a){var b=a.x===a.y===a.z;this.scale.x===this.scale.y===this.scale.z&&b||this.updateNormals();this.scale.copy(a);this.updateAABB();this.updateBoundingSphereRadius()};a.prototype.updateNormals=function(){for(var b=this.normals,d=0;d<this.indices.length/3;d++){var e=
3*d,f=this.indices[e+1],k=this.indices[e+2];this.getVertex(this.indices[e],x);this.getVertex(f,z);this.getVertex(k,A);a.computeNormal(z,x,A,w);b[e]=w.x;b[e+1]=w.y;b[e+2]=w.z}};a.prototype.updateEdges=function(){for(var a={},b=function(b,d){a[f<k?f+"_"+k:k+"_"+f]=!0},d=0;d<this.indices.length/3;d++){var e=3*d,f=this.indices[e],k=this.indices[e+1];e=this.indices[e+2];b(f,k);b(k,e);b(e,f)}b=Object.keys(a);this.edges=new Int16Array(2*b.length);for(d=0;d<b.length;d++)e=b[d].split("_"),this.edges[2*d]=
parseInt(e[0],10),this.edges[2*d+1]=parseInt(e[1],10)};a.prototype.getEdgeVertex=function(a,b,d){this.getVertex(this.edges[2*a+(b?1:0)],d)};var k=new d,r=new d;a.prototype.getEdgeVector=function(a,b){this.getEdgeVertex(a,0,k);this.getEdgeVertex(a,1,r);r.vsub(k,b)};var n=new d,v=new d;a.computeNormal=function(a,b,d,e){b.vsub(a,v);d.vsub(b,n);n.cross(v,e);e.isZero()||e.normalize()};var x=new d,z=new d,A=new d;a.prototype.getVertex=function(a,b){var d=this.scale;this._getUnscaledVertex(a,b);b.x*=d.x;
b.y*=d.y;b.z*=d.z;return b};a.prototype._getUnscaledVertex=function(a,b){var d=3*a,e=this.vertices;return b.set(e[d],e[d+1],e[d+2])};a.prototype.getWorldVertex=function(a,b,d,e){this.getVertex(a,e);q.pointToWorldFrame(b,d,e,e);return e};a.prototype.getTriangleVertices=function(a,b,d,e){a*=3;this.getVertex(this.indices[a],b);this.getVertex(this.indices[a+1],d);this.getVertex(this.indices[a+2],e)};a.prototype.getNormal=function(a,b){var d=3*a;return b.set(this.normals[d],this.normals[d+1],this.normals[d+
2])};var D=new f;a.prototype.calculateLocalInertia=function(a,b){this.computeLocalAABB(D);var d=D.upperBound.x-D.lowerBound.x,e=D.upperBound.y-D.lowerBound.y,f=D.upperBound.z-D.lowerBound.z;return b.set(1/12*a*(4*e*e+4*f*f),1/12*a*(4*d*d+4*f*f),1/12*a*(4*e*e+4*d*d))};var E=new d;a.prototype.computeLocalAABB=function(a){var b=a.lowerBound;a=a.upperBound;var d=this.vertices.length;this.getVertex(0,E);b.copy(E);a.copy(E);for(var e=0;e!==d;e++)this.getVertex(e,E),E.x<b.x?b.x=E.x:E.x>a.x&&(a.x=E.x),E.y<
b.y?b.y=E.y:E.y>a.y&&(a.y=E.y),E.z<b.z?b.z=E.z:E.z>a.z&&(a.z=E.z)};a.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)};a.prototype.updateBoundingSphereRadius=function(){var a=0,b=this.vertices,e=new d,f=0;for(b=b.length/3;f!==b;f++){this.getVertex(f,e);var k=e.norm2();k>a&&(a=k)}this.boundingSphereRadius=Math.sqrt(a)};new d;var F=new q,G=new f;a.prototype.calculateWorldAABB=function(a,b,d,e){F.position=a;F.quaternion=b;this.aabb.toWorldFrame(F,G);d.copy(G.lowerBound);e.copy(G.upperBound)};
a.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};a.createTorus=function(b,d,e,f,k){b=b||1;d=d||.5;e=e||8;f=f||6;k=k||2*Math.PI;for(var g=[],n=[],r=0;r<=e;r++)for(var q=0;q<=f;q++){var m=q/f*k,p=r/e*Math.PI*2;g.push((b+d*Math.cos(p))*Math.cos(m),(b+d*Math.cos(p))*Math.sin(m),d*Math.sin(p))}for(r=1;r<=e;r++)for(q=1;q<=f;q++)b=(f+1)*(r-1)+q-1,d=(f+1)*(r-1)+q,k=(f+1)*r+q,n.push((f+1)*r+q-1,b,k),n.push(b,d,k);return new a(g,n)}},{"../collision/AABB":3,"../math/Quaternion":28,
"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(b,g,m){function a(){e.call(this);this.iterations=10;this.tolerance=1E-7}g.exports=a;b("../math/Vec3");b("../math/Quaternion");var e=b("./Solver");a.prototype=new e;var d=[],q=[],f=[];a.prototype.solve=function(a,b){var e=0,k=this.iterations,g=this.tolerance*this.tolerance,n=this.equations,m=n.length,p=b.bodies,w=p.length,A;if(0!==m)for(A=0;A!==w;A++)p[A].updateSolveMassProperties();q.length=m;f.length=m;d.length=
m;for(A=0;A!==m;A++){var D=n[A];d[A]=0;f[A]=D.computeB(a);q[A]=1/D.computeC()}if(0!==m){for(A=0;A!==w;A++)D=p[A],e=D.wlambda,D.vlambda.set(0,0,0),e&&e.set(0,0,0);for(e=0;e!==k;e++){for(var E=A=0;E!==m;E++){D=n[E];var F=f[E];var G=q[E];var K=d[E];var I=D.computeGWlambda();F=G*(F-I-D.eps*K);K+F<D.minForce?F=D.minForce-K:K+F>D.maxForce&&(F=D.maxForce-K);d[E]+=F;A+=0<F?F:-F;D.addToWlambda(F)}if(A*A<g)break}for(A=0;A!==w;A++)D=p[A],k=D.velocity,g=D.angularVelocity,k.vadd(D.vlambda,k),g&&g.vadd(D.wlambda,
g)}return e}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(b,g,m){function a(){this.equations=[]}g.exports=a;a.prototype.solve=function(a,b){return 0};a.prototype.addEquation=function(a){a.enabled&&this.equations.push(a)};a.prototype.removeEquation=function(a){var b=this.equations;a=b.indexOf(a);-1!==a&&b.splice(a,1)};a.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(b,g,m){function a(a){f.call(this);this.iterations=10;this.tolerance=1E-7;
this.subsolver=a;this.nodes=[];for(this.nodePool=[];128>this.nodePool.length;)this.nodePool.push(this.createNode())}function e(a){for(var b=a.length,d=0;d!==b;d++){var e=a[d];if(!(e.visited||e.body.type&k))return e}return!1}function d(a,b,d){b.push(a.body);b=a.eqs.length;for(var e=0;e!==b;e++){var f=a.eqs[e];-1===d.indexOf(f)&&d.push(f)}}function q(a,b){return b.id-a.id}g.exports=a;b("../math/Vec3");b("../math/Quaternion");var f=b("./Solver");b=b("../objects/Body");a.prototype=new f;var p=[],w=[],
u={bodies:[]},k=b.STATIC,r=[];a.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}};a.prototype.solve=function(a,b){for(var f=this.nodePool,k=b.bodies,g=this.equations,n=g.length,m=k.length,v=this.subsolver;f.length<m;)f.push(this.createNode());p.length=m;for(var G=0;G<m;G++)p[G]=f[G];for(G=0;G!==m;G++)f=p[G],f.body=k[G],f.children.length=0,f.eqs.length=0,f.visited=!1;for(m=0;m!==n;m++){f=g[m];G=k.indexOf(f.bi);var K=k.indexOf(f.bj);G=p[G];K=p[K];G.children.push(K);G.eqs.push(f);
K.children.push(G);K.eqs.push(f)}k=0;g=w;v.tolerance=this.tolerance;for(v.iterations=this.iterations;G=e(p);){g.length=0;u.bodies.length=0;f=G;G=d;n=u.bodies;m=g;r.push(f);f.visited=!0;for(G(f,n,m);r.length;)for(f=r.pop();K=e(f.children);)K.visited=!0,G(K,n,m),r.push(K);n=g.length;g=g.sort(q);for(G=0;G!==n;G++)v.addEquation(g[G]);v.solve(a,u);v.removeAllEquations();k++}return k}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(b,g,m){b=function(){};g.exports=
b;b.prototype={constructor:b,addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var d=this._listeners;void 0===d[a]&&(d[a]=[]);-1===d[a].indexOf(b)&&d[a].push(b);return this},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var d=this._listeners;return void 0!==d[a]&&-1!==d[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){if(void 0===this._listeners)return this;var d=this._listeners;if(void 0===d[a])return this;var e=d[a].indexOf(b);-1!==e&&d[a].splice(e,
1);return this},dispatchEvent:function(a){if(void 0===this._listeners)return this;var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var d=0,g=b.length;d<g;d++)b[d].call(this,a)}return this}}},{}],50:[function(b,g,m){function a(a){a=a||{};this.root=a.root||null;this.aabb=a.aabb?a.aabb.clone():new d;this.data=[];this.children=[]}function e(b,d){d=d||{};d.root=null;d.aabb=b;a.call(this,d);this.maxDepth="undefined"!==typeof d.maxDepth?d.maxDepth:8}var d=b("../collision/AABB"),q=b("../math/Vec3");
g.exports=e;e.prototype=new a;a.prototype.reset=function(a,b){this.children.length=this.data.length=0};a.prototype.insert=function(a,b,d){var e=this.data;d=d||0;if(!this.aabb.contains(a))return!1;var f=this.children;if(d<(this.maxDepth||this.root.maxDepth)){var k=!1;f.length||(this.subdivide(),k=!0);for(var g=0;8!==g;g++)if(f[g].insert(a,b,d+1))return!0;k&&(f.length=0)}e.push(b);return!0};var f=new q;a.prototype.subdivide=function(){var b=this.aabb,e=b.lowerBound,k=b.upperBound;b=this.children;b.push(new a({aabb:new d({lowerBound:new q(0,
0,0)})}),new a({aabb:new d({lowerBound:new q(1,0,0)})}),new a({aabb:new d({lowerBound:new q(1,1,0)})}),new a({aabb:new d({lowerBound:new q(1,1,1)})}),new a({aabb:new d({lowerBound:new q(0,1,1)})}),new a({aabb:new d({lowerBound:new q(0,0,1)})}),new a({aabb:new d({lowerBound:new q(1,0,1)})}),new a({aabb:new d({lowerBound:new q(0,1,0)})}));k.vsub(e,f);f.scale(.5,f);k=this.root||this;for(var g=0;8!==g;g++){var n=b[g];n.root=k;var m=n.aabb.lowerBound;m.x*=f.x;m.y*=f.y;m.z*=f.z;m.vadd(e,m);m.vadd(f,n.aabb.upperBound)}};
a.prototype.aabbQuery=function(a,b){for(var d=[this];d.length;){var e=d.pop();e.aabb.overlaps(a)&&Array.prototype.push.apply(b,e.data);Array.prototype.push.apply(d,e.children)}return b};var p=new d;a.prototype.rayQuery=function(a,b,d){a.getAABB(p);p.toLocalFrame(b,p);this.aabbQuery(p,d);return d};a.prototype.removeEmptyNodes=function(){for(var a=[this];a.length;){for(var b=a.pop(),d=b.children.length-1;0<=d;d--)b.children[d].data.length||b.children.splice(d,1);Array.prototype.push.apply(a,b.children)}}},
{"../collision/AABB":3,"../math/Vec3":30}],51:[function(b,g,m){function a(){this.objects=[];this.type=Object}g.exports=a;a.prototype.release=function(){for(var a=arguments.length,b=0;b!==a;b++)this.objects.push(arguments[b])};a.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()};a.prototype.constructObject=function(){throw Error("constructObject() not implemented in this Pool subclass yet!");}},{}],52:[function(b,g,m){function a(){this.data={keys:[]}}
g.exports=a;a.prototype.get=function(a,b){if(a>b){var d=b;b=a;a=d}return this.data[a+"-"+b]};a.prototype.set=function(a,b,g){if(a>b){var d=b;b=a;a=d}d=a+"-"+b;this.get(a,b)||this.data.keys.push(d);this.data[d]=g};a.prototype.reset=function(){for(var a=this.data,b=a.keys;0<b.length;){var g=b.pop();delete a[g]}}},{}],53:[function(b,g,m){function a(){}g.exports=a;a.defaults=function(a,b){a=a||{};for(var d in b)d in a||(a[d]=b[d]);return a}},{}],54:[function(b,g,m){function a(){d.call(this);this.type=
e}g.exports=a;var e=b("../math/Vec3"),d=b("./Pool");a.prototype=new d;a.prototype.constructObject=function(){return new e}},{"../math/Vec3":30,"./Pool":51}],55:[function(b,g,m){function a(a){this.contactPointPool=[];this.frictionEquationPool=[];this.result=[];this.frictionResult=[];this.v3pool=new p;this.world=a;this.currentContactMaterial=null;this.enableFrictionReduction=!1}g.exports=a;g=b("../collision/AABB");m=b("../shapes/Shape");var e=b("../collision/Ray"),d=b("../math/Vec3"),q=b("../math/Transform");
b("../shapes/ConvexPolyhedron");var f=b("../math/Quaternion");b("../solver/Solver");var p=b("../utils/Vec3Pool"),w=b("../equations/ContactEquation"),u=b("../equations/FrictionEquation");a.prototype.createContactEquation=function(a,b,d,e,f,k){if(this.contactPointPool.length){var g=this.contactPointPool.pop();g.bi=a;g.bj=b}else g=new w(a,b);g.enabled=a.collisionResponse&&b.collisionResponse&&d.collisionResponse&&e.collisionResponse;var n=this.currentContactMaterial;g.restitution=n.restitution;g.setSpookParams(n.contactEquationStiffness,
n.contactEquationRelaxation,this.world.dt);a=d.material||a.material;b=e.material||b.material;a&&b&&0<=a.restitution&&0<=b.restitution&&(g.restitution=a.restitution*b.restitution);g.si=f||d;g.sj=k||e;return g};a.prototype.createFrictionEquationsFromContact=function(a,b){var d=a.bi,e=a.bj,f=this.world,k=this.currentContactMaterial,g=k.friction,n=a.si.material||d.material,r=a.sj.material||e.material;n&&r&&0<=n.friction&&0<=r.friction&&(g=n.friction*r.friction);if(0<g){g*=f.gravity.length();n=d.invMass+
e.invMass;0<n&&(n=1/n);var m=this.frictionEquationPool;r=m.length?m.pop():new u(d,e,g*n);m=m.length?m.pop():new u(d,e,g*n);r.bi=m.bi=d;r.bj=m.bj=e;r.minForce=m.minForce=-g*n;r.maxForce=m.maxForce=g*n;r.ri.copy(a.ri);r.rj.copy(a.rj);m.ri.copy(a.ri);m.rj.copy(a.rj);a.ni.tangents(r.t,m.t);r.setSpookParams(k.frictionEquationStiffness,k.frictionEquationRelaxation,f.dt);m.setSpookParams(k.frictionEquationStiffness,k.frictionEquationRelaxation,f.dt);r.enabled=m.enabled=a.enabled;b.push(r,m);return!0}return!1};
var k=new d,r=new d,n=new d;a.prototype.createFrictionFromAverage=function(a){var b=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(b,this.frictionResult)&&1!==a){var d=this.frictionResult[this.frictionResult.length-2],e=this.frictionResult[this.frictionResult.length-1];k.setZero();r.setZero();n.setZero();for(var f=b.bi,g=0;g!==a;g++)b=this.result[this.result.length-1-g],b.bodyA!==f?(k.vadd(b.ni,k),r.vadd(b.ri,r),n.vadd(b.rj,n)):(k.vsub(b.ni,k),r.vadd(b.rj,r),n.vadd(b.ri,
n));a=1/a;r.scale(a,d.ri);n.scale(a,d.rj);e.ri.copy(d.ri);e.rj.copy(d.rj);k.normalize();k.tangents(d.t,e.t)}};var v=new d,x=new d,z=new f,A=new f;a.prototype.getContacts=function(a,b,d,e,f,k,g){this.contactPointPool=f;this.frictionEquationPool=g;this.result=e;this.frictionResult=k;e=0;for(f=a.length;e!==f;e++){k=a[e];g=b[e];var n=null;k.material&&g.material&&(n=d.getContactMaterial(k.material,g.material)||null);for(var r=0;r<k.shapes.length;r++){k.quaternion.mult(k.shapeOrientations[r],z);k.quaternion.vmult(k.shapeOffsets[r],
v);v.vadd(k.position,v);for(var m=k.shapes[r],q=0;q<g.shapes.length;q++){g.quaternion.mult(g.shapeOrientations[q],A);g.quaternion.vmult(g.shapeOffsets[q],x);x.vadd(g.position,x);var p=g.shapes[q];if(!(v.distanceTo(x)>m.boundingSphereRadius+p.boundingSphereRadius)){var u=null;m.material&&p.material&&(u=d.getContactMaterial(m.material,p.material)||null);this.currentContactMaterial=u||n||d.defaultContactMaterial;(u=this[m.type|p.type])&&(m.type<p.type?u.call(this,m,p,v,x,z,A,k,g,m,p):u.call(this,p,m,
x,v,A,z,g,k,m,p))}}}}};a.prototype[m.types.BOX|m.types.BOX]=a.prototype.boxBox=function(a,b,d,e,f,k,g,n){a.convexPolyhedronRepresentation.material=a.material;b.convexPolyhedronRepresentation.material=b.material;a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse;b.convexPolyhedronRepresentation.collisionResponse=b.collisionResponse;this.convexConvex(a.convexPolyhedronRepresentation,b.convexPolyhedronRepresentation,d,e,f,k,g,n,a,b)};a.prototype[m.types.BOX|m.types.CONVEXPOLYHEDRON]=
a.prototype.boxConvex=function(a,b,d,e,f,k,g,n){a.convexPolyhedronRepresentation.material=a.material;a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse;this.convexConvex(a.convexPolyhedronRepresentation,b,d,e,f,k,g,n,a,b)};a.prototype[m.types.BOX|m.types.PARTICLE]=a.prototype.boxParticle=function(a,b,d,e,f,k,g,n){a.convexPolyhedronRepresentation.material=a.material;a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse;this.convexParticle(a.convexPolyhedronRepresentation,
b,d,e,f,k,g,n,a,b)};a.prototype[m.types.SPHERE]=a.prototype.sphereSphere=function(a,b,d,e,f,k,g,n){f=this.createContactEquation(g,n,a,b);e.vsub(d,f.ni);f.ni.normalize();f.ri.copy(f.ni);f.rj.copy(f.ni);f.ri.mult(a.radius,f.ri);f.rj.mult(-b.radius,f.rj);f.ri.vadd(d,f.ri);f.ri.vsub(g.position,f.ri);f.rj.vadd(e,f.rj);f.rj.vsub(n.position,f.rj);this.result.push(f);this.createFrictionEquationsFromContact(f,this.frictionResult)};var D=new d,E=new d,F=new d;a.prototype[m.types.PLANE|m.types.TRIMESH]=a.prototype.planeTrimesh=
function(a,b,e,f,k,g,n,r){var m=new d;D.set(0,0,1);k.vmult(D,D);for(k=0;k<b.vertices.length/3;k++){b.getVertex(k,m);var p=new d;p.copy(m);q.pointToWorldFrame(f,g,p,m);p=E;m.vsub(e,p);if(0>=D.dot(p)){var v=this.createContactEquation(n,r,a,b);v.ni.copy(D);var u=F;D.scale(p.dot(D),u);m.vsub(u,u);v.ri.copy(u);v.ri.vsub(n.position,v.ri);v.rj.copy(m);v.rj.vsub(r.position,v.rj);this.result.push(v);this.createFrictionEquationsFromContact(v,this.frictionResult)}}};var G=new d,K=new d;new d;var I=new d,B=new d,
Q=new d,O=new d,L=new d,H=new d,W=new d,ba=new d,X=new d,R=new d,J=new d,T=new g,S=[];a.prototype[m.types.SPHERE|m.types.TRIMESH]=a.prototype.sphereTrimesh=function(a,b,d,f,k,g,n,m){q.pointToLocalFrame(f,g,d,W);k=a.radius;T.lowerBound.set(W.x-k,W.y-k,W.z-k);T.upperBound.set(W.x+k,W.y+k,W.z+k);b.getTrianglesInAABB(T,S);var r=a.radius*a.radius;for(k=0;k<S.length;k++)for(var p=0;3>p;p++)if(b.getVertex(b.indices[3*S[k]+p],I),I.vsub(W,K),K.norm2()<=r){B.copy(I);q.pointToWorldFrame(f,g,B,I);I.vsub(d,K);
var v=this.createContactEquation(n,m,a,b);v.ni.copy(K);v.ni.normalize();v.ri.copy(v.ni);v.ri.scale(a.radius,v.ri);v.ri.vadd(d,v.ri);v.ri.vsub(n.position,v.ri);v.rj.copy(I);v.rj.vsub(m.position,v.rj);this.result.push(v);this.createFrictionEquationsFromContact(v,this.frictionResult)}for(k=0;k<S.length;k++)for(p=0;3>p;p++)b.getVertex(b.indices[3*S[k]+p],Q),b.getVertex(b.indices[3*S[k]+(p+1)%3],O),O.vsub(Q,L),W.vsub(O,ba),d=ba.dot(L),W.vsub(Q,ba),v=ba.dot(L),0<v&&0>d&&(W.vsub(Q,ba),H.copy(L),H.normalize(),
v=ba.dot(H),H.scale(v,ba),ba.vadd(Q,ba),d=ba.distanceTo(W),d<a.radius&&(v=this.createContactEquation(n,m,a,b),ba.vsub(W,v.ni),v.ni.normalize(),v.ni.scale(a.radius,v.ri),q.pointToWorldFrame(f,g,ba,ba),ba.vsub(m.position,v.rj),q.vectorToWorldFrame(g,v.ni,v.ni),q.vectorToWorldFrame(g,v.ri,v.ri),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)));k=0;for(p=S.length;k!==p;k++)b.getTriangleVertices(S[k],X,R,J),b.getNormal(S[k],G),W.vsub(X,ba),d=ba.dot(G),G.scale(d,ba),W.vsub(ba,
ba),d=ba.distanceTo(W),e.pointInTriangle(ba,X,R,J)&&d<a.radius&&(v=this.createContactEquation(n,m,a,b),ba.vsub(W,v.ni),v.ni.normalize(),v.ni.scale(a.radius,v.ri),q.pointToWorldFrame(f,g,ba,ba),ba.vsub(m.position,v.rj),q.vectorToWorldFrame(g,v.ni,v.ni),q.vectorToWorldFrame(g,v.ri,v.ri),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult));S.length=0};var ea=new d,U=new d;a.prototype[m.types.SPHERE|m.types.PLANE]=a.prototype.spherePlane=function(a,b,d,e,f,k,g,n){b=this.createContactEquation(g,
n,a,b);b.ni.set(0,0,1);k.vmult(b.ni,b.ni);b.ni.negate(b.ni);b.ni.normalize();b.ni.mult(a.radius,b.ri);d.vsub(e,ea);b.ni.mult(b.ni.dot(ea),U);ea.vsub(U,b.rj);-ea.dot(b.ni)<=a.radius&&(a=b.ri,k=b.rj,a.vadd(d,a),a.vsub(g.position,a),k.vadd(e,k),k.vsub(n.position,k),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult))};var qa=new d,ha=new d,ja=new d,V=new d,Ia=new d,na=new d,wa=new d,Z=[new d,new d,new d,new d,new d,new d],Aa=new d,Da=new d,sa=new d,za=new d;a.prototype[m.types.SPHERE|
m.types.BOX]=a.prototype.sphereBox=function(a,b,d,e,f,k,g,n){f=this.v3pool;d.vsub(e,V);b.getSideNormals(Z,k);k=a.radius;for(var m=!1,r=null,q=0,p=0,v=0,u=null,w=0,x=Z.length;w!==x&&!1===m;w++){var A=Ia;A.copy(Z[w]);var B=A.norm();A.normalize();var z=V.dot(A);if(z<B+k&&0<z){var D=na,R=wa;D.copy(Z[(w+1)%3]);R.copy(Z[(w+2)%3]);var F=D.norm(),E=R.norm();D.normalize();R.normalize();var G=V.dot(D),T=V.dot(R);G<F&&G>-F&&T<E&&T>-E&&(z=Math.abs(z-B-k),null===u||z<u)&&(u=z,p=G,v=T,r=B,Da.copy(A),sa.copy(D),
za.copy(R),q++)}}q&&(m=!0,q=this.createContactEquation(g,n,a,b),Da.mult(-k,q.ri),q.ni.copy(Da),q.ni.negate(q.ni),Da.mult(r,Da),sa.mult(p,sa),Da.vadd(sa,Da),za.mult(v,za),Da.vadd(za,q.rj),q.ri.vadd(d,q.ri),q.ri.vsub(g.position,q.ri),q.rj.vadd(e,q.rj),q.rj.vsub(n.position,q.rj),this.result.push(q),this.createFrictionEquationsFromContact(q,this.frictionResult));z=f.get();for(r=0;2!==r&&!m;r++)for(p=0;2!==p&&!m;p++)for(v=0;2!==v&&!m;v++)z.set(0,0,0),r?z.vadd(Z[0],z):z.vsub(Z[0],z),p?z.vadd(Z[1],z):z.vsub(Z[1],
z),v?z.vadd(Z[2],z):z.vsub(Z[2],z),e.vadd(z,Aa),Aa.vsub(d,Aa),Aa.norm2()<k*k&&(m=!0,q=this.createContactEquation(g,n,a,b),q.ri.copy(Aa),q.ri.normalize(),q.ni.copy(q.ri),q.ri.mult(k,q.ri),q.rj.copy(z),q.ri.vadd(d,q.ri),q.ri.vsub(g.position,q.ri),q.rj.vadd(e,q.rj),q.rj.vsub(n.position,q.rj),this.result.push(q),this.createFrictionEquationsFromContact(q,this.frictionResult));f.release(z);u=f.get();w=f.get();q=f.get();x=f.get();z=f.get();A=Z.length;for(r=0;r!==A&&!m;r++)for(p=0;p!==A&&!m;p++)if(r%3!==
p%3){Z[p].cross(Z[r],u);u.normalize();Z[r].vadd(Z[p],w);q.copy(d);q.vsub(w,q);q.vsub(e,q);B=q.dot(u);u.mult(B,x);for(v=0;v===r%3||v===p%3;)v++;z.copy(d);z.vsub(x,z);z.vsub(w,z);z.vsub(e,z);B=Math.abs(B);D=z.norm();B<Z[v].norm()&&D<k&&(m=!0,v=this.createContactEquation(g,n,a,b),w.vadd(x,v.rj),v.rj.copy(v.rj),z.negate(v.ni),v.ni.normalize(),v.ri.copy(v.rj),v.ri.vadd(e,v.ri),v.ri.vsub(d,v.ri),v.ri.normalize(),v.ri.mult(k,v.ri),v.ri.vadd(d,v.ri),v.ri.vsub(g.position,v.ri),v.rj.vadd(e,v.rj),v.rj.vsub(n.position,
v.rj),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult))}f.release(u,w,q,x,z)};var va=new d,ya=new d,La=new d,Va=new d,ra=new d,fa=new d,Ga=new d,ca=new d,Wa=new d,Ha=new d;a.prototype[m.types.SPHERE|m.types.CONVEXPOLYHEDRON]=a.prototype.sphereConvex=function(a,b,d,e,f,k,g,n){f=this.v3pool;d.vsub(e,va);for(var m=b.faceNormals,q=b.faces,r=b.vertices,p=a.radius,v=0;v!==r.length;v++){var u=ra;k.vmult(r[v],u);e.vadd(u,u);var w=Va;u.vsub(d,w);if(w.norm2()<p*p){a=this.createContactEquation(g,
n,a,b);a.ri.copy(w);a.ri.normalize();a.ni.copy(a.ri);a.ri.mult(p,a.ri);u.vsub(e,a.rj);a.ri.vadd(d,a.ri);a.ri.vsub(g.position,a.ri);a.rj.vadd(e,a.rj);a.rj.vsub(n.position,a.rj);this.result.push(a);this.createFrictionEquationsFromContact(a,this.frictionResult);return}}v=0;for(u=q.length;v!==u;v++){w=q[v];var x=fa;k.vmult(m[v],x);var A=Ga;k.vmult(r[w[0]],A);A.vadd(e,A);var z=ca;x.mult(-p,z);d.vadd(z,z);var B=Wa;z.vsub(A,B);z=B.dot(x);B=Ha;d.vsub(A,B);if(0>z&&0<B.dot(x)){A=[];B=0;for(var D=w.length;B!==
D;B++){var R=f.get();k.vmult(r[w[B]],R);e.vadd(R,R);A.push(R)}a:{B=A;D=x;R=d;for(var F=null,E=B.length,G=0;G!==E;G++){var T=B[G],ea=qa;B[(G+1)%E].vsub(T,ea);var sa=ha;ea.cross(D,sa);ea=ja;R.vsub(T,ea);T=sa.dot(ea);if(null===F||0<T&&!0===F||0>=T&&!1===F)null===F&&(F=0<T);else{B=!1;break a}}B=!0}if(B){a=this.createContactEquation(g,n,a,b);x.mult(-p,a.ri);x.negate(a.ni);b=f.get();x.mult(-z,b);k=f.get();x.mult(-p,k);d.vsub(e,a.rj);a.rj.vadd(k,a.rj);a.rj.vadd(b,a.rj);a.rj.vadd(e,a.rj);a.rj.vsub(n.position,
a.rj);a.ri.vadd(d,a.ri);a.ri.vsub(g.position,a.ri);f.release(b);f.release(k);this.result.push(a);this.createFrictionEquationsFromContact(a,this.frictionResult);B=0;for(w=A.length;B!==w;B++)f.release(A[B]);break}else for(B=0;B!==w.length;B++){x=f.get();z=f.get();k.vmult(r[w[(B+1)%w.length]],x);k.vmult(r[w[(B+2)%w.length]],z);e.vadd(x,x);e.vadd(z,z);E=ya;z.vsub(x,E);F=La;E.unit(F);D=f.get();R=f.get();d.vsub(x,R);G=R.dot(F);F.mult(G,D);D.vadd(x,D);F=f.get();D.vsub(d,F);if(0<G&&G*G<E.norm2()&&F.norm2()<
p*p){a=this.createContactEquation(g,n,a,b);D.vsub(e,a.rj);D.vsub(d,a.ni);a.ni.normalize();a.ni.mult(p,a.ri);a.rj.vadd(e,a.rj);a.rj.vsub(n.position,a.rj);a.ri.vadd(d,a.ri);a.ri.vsub(g.position,a.ri);this.result.push(a);this.createFrictionEquationsFromContact(a,this.frictionResult);B=0;for(w=A.length;B!==w;B++)f.release(A[B]);f.release(x);f.release(z);f.release(D);f.release(F);f.release(R);return}f.release(x);f.release(z);f.release(D);f.release(F);f.release(R)}B=0;for(w=A.length;B!==w;B++)f.release(A[B])}}};
new d;new d;a.prototype[m.types.PLANE|m.types.BOX]=a.prototype.planeBox=function(a,b,d,e,f,k,g,n){b.convexPolyhedronRepresentation.material=b.material;b.convexPolyhedronRepresentation.collisionResponse=b.collisionResponse;this.planeConvex(a,b.convexPolyhedronRepresentation,d,e,f,k,g,n)};var ta=new d,oa=new d,P=new d,pa=new d;a.prototype[m.types.PLANE|m.types.CONVEXPOLYHEDRON]=a.prototype.planeConvex=function(a,b,d,e,f,k,g,n){oa.set(0,0,1);f.vmult(oa,oa);for(var r=f=0;r!==b.vertices.length;r++)if(ta.copy(b.vertices[r]),
k.vmult(ta,ta),e.vadd(ta,ta),ta.vsub(d,P),0>=oa.dot(P)){var m=this.createContactEquation(g,n,a,b),q=pa;oa.mult(oa.dot(P),q);ta.vsub(q,q);q.vsub(d,m.ri);m.ni.copy(oa);ta.vsub(e,m.rj);m.ri.vadd(d,m.ri);m.ri.vsub(g.position,m.ri);m.rj.vadd(e,m.rj);m.rj.vsub(n.position,m.rj);this.result.push(m);f++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(m,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)};var Lb=new d,Oa=new d;a.prototype[m.types.CONVEXPOLYHEDRON]=
a.prototype.convexConvex=function(a,b,d,e,f,k,g,n,m,q,r,p){if(!(d.distanceTo(e)>a.boundingSphereRadius+b.boundingSphereRadius)&&a.findSeparatingAxis(b,d,f,e,k,Lb,r,p)){r=[];a.clipAgainstHull(d,f,b,e,k,Lb,-100,100,r);for(k=f=0;k!==r.length;k++){p=this.createContactEquation(g,n,a,b,m,q);var v=p.ri,u=p.rj;Lb.negate(p.ni);r[k].normal.negate(Oa);Oa.mult(r[k].depth,Oa);r[k].point.vadd(Oa,v);u.copy(r[k].point);v.vsub(d,v);u.vsub(e,u);v.vadd(d,v);v.vsub(g.position,v);u.vadd(e,u);u.vsub(n.position,u);this.result.push(p);
f++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(p,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}};var ma=new d,sb=new d,ia=new d;a.prototype[m.types.PLANE|m.types.PARTICLE]=a.prototype.planeParticle=function(a,b,d,e,f,k,g,n){ma.set(0,0,1);g.quaternion.vmult(ma,ma);e.vsub(g.position,sb);0>=ma.dot(sb)&&(a=this.createContactEquation(n,g,b,a),a.ni.copy(ma),a.ni.negate(a.ni),a.ri.set(0,0,0),ma.mult(ma.dot(e),ia),e.vsub(ia,ia),a.rj.copy(ia),
this.result.push(a),this.createFrictionEquationsFromContact(a,this.frictionResult))};var Ca=new d;a.prototype[m.types.PARTICLE|m.types.SPHERE]=a.prototype.sphereParticle=function(a,b,d,e,f,k,g,n){Ca.set(0,0,1);e.vsub(d,Ca);Ca.norm2()<=a.radius*a.radius&&(b=this.createContactEquation(n,g,b,a),Ca.normalize(),b.rj.copy(Ca),b.rj.mult(a.radius,b.rj),b.ni.copy(Ca),b.ni.negate(b.ni),b.ri.set(0,0,0),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult))};var tb=new f,eb=new d;
new d;var Ea=new d,cb=new d,Gb=new d;a.prototype[m.types.PARTICLE|m.types.CONVEXPOLYHEDRON]=a.prototype.convexParticle=function(a,b,d,e,f,k,g,n){var m=-1;k=null;var r=0;eb.copy(e);eb.vsub(d,eb);f.conjugate(tb);tb.vmult(eb,eb);if(a.pointIsInside(eb)){a.worldVerticesNeedsUpdate&&a.computeWorldVertices(d,f);a.worldFaceNormalsNeedsUpdate&&a.computeWorldFaceNormals(f);f=0;for(var q=a.faces.length;f!==q;f++){var p=a.worldFaceNormals[f];e.vsub(a.worldVertices[a.faces[f][0]],cb);var v=-p.dot(cb);if(null===
k||Math.abs(v)<Math.abs(k))k=v,m=f,Ea.copy(p),r++}-1!==m?(a=this.createContactEquation(n,g,b,a),Ea.mult(k,Gb),Gb.vadd(e,Gb),Gb.vsub(d,Gb),a.rj.copy(Gb),Ea.negate(a.ni),a.ri.set(0,0,0),b=a.ri,k=a.rj,b.vadd(e,b),b.vsub(n.position,b),k.vadd(d,k),k.vsub(g.position,k),this.result.push(a),this.createFrictionEquationsFromContact(a,this.frictionResult)):console.warn("Point found inside convex, but did not find penetrating face!")}};a.prototype[m.types.BOX|m.types.HEIGHTFIELD]=a.prototype.boxHeightfield=function(a,
b,d,e,f,k,g,n){a.convexPolyhedronRepresentation.material=a.material;a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse;this.convexHeightfield(a.convexPolyhedronRepresentation,b,d,e,f,k,g,n)};var xc=new d,ub=new d,yc=[0];a.prototype[m.types.CONVEXPOLYHEDRON|m.types.HEIGHTFIELD]=a.prototype.convexHeightfield=function(a,b,d,e,f,k,g,n){var m=b.data,r=b.elementSize,p=a.boundingSphereRadius;q.pointToLocalFrame(e,k,d,xc);var v=Math.floor((xc.x-p)/r)-1,u=Math.ceil((xc.x+p)/r)+1,w=Math.floor((xc.y-
p)/r)-1;r=Math.ceil((xc.y+p)/r)+1;if(!(0>u||0>r||v>m.length||w>m[0].length)){0>v&&(v=0);0>u&&(u=0);0>w&&(w=0);0>r&&(r=0);v>=m.length&&(v=m.length-1);u>=m.length&&(u=m.length-1);r>=m[0].length&&(r=m[0].length-1);w>=m[0].length&&(w=m[0].length-1);m=[];b.getRectMinMax(v,w,u,r,m);var x=m[0];if(!(xc.z-p>m[1]||xc.z+p<x))for(p=v;p<u;p++)for(v=w;v<r;v++)b.getConvexTrianglePillar(p,v,!1),q.pointToWorldFrame(e,k,b.pillarOffset,ub),d.distanceTo(ub)<b.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&
this.convexConvex(a,b.pillarConvex,d,ub,f,k,g,n,null,null,yc,null),b.getConvexTrianglePillar(p,v,!0),q.pointToWorldFrame(e,k,b.pillarOffset,ub),d.distanceTo(ub)<b.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.convexConvex(a,b.pillarConvex,d,ub,f,k,g,n,null,null,yc,null)}};var bb=new d,Ya=new d;a.prototype[m.types.SPHERE|m.types.HEIGHTFIELD]=a.prototype.sphereHeightfield=function(a,b,d,e,f,k,g,n){var m=b.data,r=a.radius,p=b.elementSize;q.pointToLocalFrame(e,k,d,bb);var v=Math.floor((bb.x-
r)/p)-1,u=Math.ceil((bb.x+r)/p)+1,w=Math.floor((bb.y-r)/p)-1;p=Math.ceil((bb.y+r)/p)+1;if(!(0>u||0>p||v>m.length||p>m[0].length)){0>v&&(v=0);0>u&&(u=0);0>w&&(w=0);0>p&&(p=0);v>=m.length&&(v=m.length-1);u>=m.length&&(u=m.length-1);p>=m[0].length&&(p=m[0].length-1);w>=m[0].length&&(w=m[0].length-1);m=[];b.getRectMinMax(v,w,u,p,m);var x=m[0];if(!(bb.z-r>m[1]||bb.z+r<x))for(r=this.result;v<u;v++)for(m=w;m<p;m++)if(x=r.length,b.getConvexTrianglePillar(v,m,!1),q.pointToWorldFrame(e,k,b.pillarOffset,Ya),
d.distanceTo(Ya)<b.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.sphereConvex(a,b.pillarConvex,d,Ya,f,k,g,n),b.getConvexTrianglePillar(v,m,!0),q.pointToWorldFrame(e,k,b.pillarOffset,Ya),d.distanceTo(Ya)<b.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.sphereConvex(a,b.pillarConvex,d,Ya,f,k,g,n),2<r.length-x)return}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,
"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(b,g,m){function a(){f.apply(this);this.dt=-1;this.allowSleep=!1;this.contacts=[];this.frictionEquations=[];this.quatNormalizeSkip=0;this.quatNormalizeFast=!1;this.stepnumber=this.time=0;this.default_dt=1/60;this.nextId=0;this.gravity=new e;this.broadphase=new x;this.bodies=[];this.solver=new d;this.constraints=[];this.narrowphase=new q(this);this.collisionMatrix=new p;
this.collisionMatrixPrevious=new p;this.materials=[];this.contactmaterials=[];this.contactMaterialTable=new r;this.defaultMaterial=new w("default");this.defaultContactMaterial=new u(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0});this.doProfiling=!1;this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0};this.subsystems=[];this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null}}g.exports=a;b("../shapes/Shape");
var e=b("../math/Vec3");g=b("../math/Quaternion");var d=b("../solver/GSSolver");b("../utils/Vec3Pool");b("../equations/ContactEquation");b("../equations/FrictionEquation");var q=b("./Narrowphase"),f=b("../utils/EventTarget"),p=b("../collision/ArrayCollisionMatrix"),w=b("../material/Material"),u=b("../material/ContactMaterial"),k=b("../objects/Body"),r=b("../utils/TupleDictionary"),n=b("../collision/RaycastResult");m=b("../collision/AABB");var v=b("../collision/Ray"),x=b("../collision/NaiveBroadphase");
a.prototype=new f;new m;var z=new v;a.prototype.getContactMaterial=function(a,b){return this.contactMaterialTable.get(a.id,b.id)};a.prototype.numObjects=function(){return this.bodies.length};a.prototype.collisionMatrixTick=function(){var a=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix;this.collisionMatrix=a;this.collisionMatrix.reset()};a.prototype.add=a.prototype.addBody=function(a){-1===this.bodies.indexOf(a)&&(a.index=this.bodies.length,this.bodies.push(a),a.world=
this,a.initPosition.copy(a.position),a.initVelocity.copy(a.velocity),a.timeLastSleepy=this.time,a instanceof k&&(a.initAngularVelocity.copy(a.angularVelocity),a.initQuaternion.copy(a.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=a,this.dispatchEvent(this.addBodyEvent))};a.prototype.addConstraint=function(a){this.constraints.push(a)};a.prototype.removeConstraint=function(a){a=this.constraints.indexOf(a);-1!==a&&this.constraints.splice(a,1)};a.prototype.rayTest=
function(a,b,d){d instanceof n?this.raycastClosest(a,b,{skipBackfaces:!0},d):this.raycastAll(a,b,{skipBackfaces:!0},d)};a.prototype.raycastAll=function(a,b,d,e){d.mode=v.ALL;d.from=a;d.to=b;d.callback=e;return z.intersectWorld(this,d)};a.prototype.raycastAny=function(a,b,d,e){d.mode=v.ANY;d.from=a;d.to=b;d.result=e;return z.intersectWorld(this,d)};a.prototype.raycastClosest=function(a,b,d,e){d.mode=v.CLOSEST;d.from=a;d.to=b;d.result=e;return z.intersectWorld(this,d)};a.prototype.remove=function(a){a.world=
null;var b=this.bodies.length-1,d=this.bodies,e=d.indexOf(a);if(-1!==e){d.splice(e,1);for(e=0;e!==d.length;e++)d[e].index=e;this.collisionMatrix.setNumObjects(b);this.removeBodyEvent.body=a;this.dispatchEvent(this.removeBodyEvent)}};a.prototype.removeBody=a.prototype.remove;a.prototype.addMaterial=function(a){this.materials.push(a)};a.prototype.addContactMaterial=function(a){this.contactmaterials.push(a);this.contactMaterialTable.set(a.materials[0].id,a.materials[1].id,a)};"undefined"===typeof performance&&
(performance={});if(!performance.now){var A=Date.now();performance.timing&&performance.timing.navigationStart&&(A=performance.timing.navigationStart);performance.now=function(){return Date.now()-A}}var D=new e;a.prototype.step=function(a,b,d){d=d||10;b=b||0;if(0===b)this.internalStep(a),this.time+=a;else{var e=Math.floor((this.time+b)/a)-Math.floor(this.time/a);e=Math.min(e,d);d=performance.now();for(var f=0;f!==e&&!(this.internalStep(a),performance.now()-d>1E3*a);f++);this.time+=b;a=this.time%a/
a;b=this.bodies;for(e=0;e!==b.length;e++)d=b[e],d.type!==k.STATIC&&d.sleepState!==k.SLEEPING?(d.position.vsub(d.previousPosition,D),D.scale(a,D),d.position.vadd(D,d.interpolatedPosition)):(d.interpolatedPosition.copy(d.position),d.interpolatedQuaternion.copy(d.quaternion))}};var E={type:"postStep"},F={type:"preStep"},G={type:"collide",body:null,contact:null},K=[],I=[],B=[],Q=[];new e;new e;new e;new e;new e;new e;new e;new e;new e;new g;var O=new g,L=new g,H=new e;a.prototype.internalStep=function(a){this.dt=
a;var b=this.contacts,d=this.numObjects(),e=this.bodies,f=this.solver,g=this.gravity,n=this.doProfiling,m=this.profile,r=k.DYNAMIC,q,p=this.constraints;g.norm();var v=g.x,u=g.y,w=g.z;n&&(q=performance.now());for(g=0;g!==d;g++){var x=e[g];if(x.type&r){var A=x.force;x=x.mass;A.x+=x*v;A.y+=x*u;A.z+=x*w}}g=0;for(x=this.subsystems.length;g!==x;g++)this.subsystems[g].update();n&&(q=performance.now());B.length=0;Q.length=0;this.broadphase.collisionPairs(this,B,Q);n&&(m.broadphase=performance.now()-q);x=
p.length;for(g=0;g!==x;g++)if(v=p[g],!v.collideConnected)for(u=B.length-1;0<=u;--u)if(v.bodyA===B[u]&&v.bodyB===Q[u]||v.bodyB===B[u]&&v.bodyA===Q[u])B.splice(u,1),Q.splice(u,1);this.collisionMatrixTick();n&&(q=performance.now());x=b.length;for(g=0;g!==x;g++)K.push(b[g]);b.length=0;x=this.frictionEquations.length;for(g=0;g!==x;g++)I.push(this.frictionEquations[g]);this.frictionEquations.length=0;this.narrowphase.getContacts(B,Q,this,b,K,this.frictionEquations,I);n&&(m.narrowphase=performance.now()-
q);n&&(q=performance.now());for(g=0;g<this.frictionEquations.length;g++)f.addEquation(this.frictionEquations[g]);g=b.length;for(u=0;u!==g;u++)v=b[u],x=v.bi,w=v.bj,x.material&&w.material&&this.getContactMaterial(x.material,w.material),x.material&&w.material&&0<=x.material.restitution&&0<=w.material.restitution&&(v.restitution=x.material.restitution*w.material.restitution),f.addEquation(v),x.allowSleep&&x.type===k.DYNAMIC&&x.sleepState===k.SLEEPING&&w.sleepState===k.AWAKE&&w.type!==k.STATIC&&w.velocity.norm2()+
w.angularVelocity.norm2()>=2*Math.pow(w.sleepSpeedLimit,2)&&(x._wakeUpAfterNarrowphase=!0),w.allowSleep&&w.type===k.DYNAMIC&&w.sleepState===k.SLEEPING&&x.sleepState===k.AWAKE&&x.type!==k.STATIC&&x.velocity.norm2()+x.angularVelocity.norm2()>=2*Math.pow(x.sleepSpeedLimit,2)&&(w._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(x,w,!0),this.collisionMatrixPrevious.get(x,w)||(G.body=w,G.contact=v,x.dispatchEvent(G),G.body=x,w.dispatchEvent(G));n&&(m.makeContactConstraints=performance.now()-q,q=performance.now());
for(g=0;g!==d;g++)x=e[g],x._wakeUpAfterNarrowphase&&(x.wakeUp(),x._wakeUpAfterNarrowphase=!1);x=p.length;for(g=0;g!==x;g++)for(v=p[g],v.update(),u=0,b=v.equations.length;u!==b;u++)f.addEquation(v.equations[u]);f.solve(a,this);n&&(m.solve=performance.now()-q);f.removeAllEquations();f=Math.pow;for(g=0;g!==d;g++)if(x=e[g],x.type&r&&(p=f(1-x.linearDamping,a),b=x.velocity,b.mult(p,b),p=x.angularVelocity))b=f(1-x.angularDamping,a),p.mult(b,p);this.dispatchEvent(F);for(g=0;g!==d;g++)x=e[g],x.preStep&&x.preStep.call(x);
n&&(q=performance.now());r=k.DYNAMIC|k.KINEMATIC;f=0===this.stepnumber%(this.quatNormalizeSkip+1);p=this.quatNormalizeFast;b=.5*a;for(g=0;g!==d;g++)if(x=e[g],v=x.force,u=x.torque,x.type&r&&x.sleepState!==k.SLEEPING){w=x.velocity;A=x.angularVelocity;var z=x.position,D=x.quaternion,W=x.invMass,sa=x.invInertiaWorld;w.x+=v.x*W*a;w.y+=v.y*W*a;w.z+=v.z*W*a;x.angularVelocity&&(sa.vmult(u,H),H.mult(a,H),H.vadd(A,A));z.x+=w.x*a;z.y+=w.y*a;z.z+=w.z*a;x.angularVelocity&&(O.set(A.x,A.y,A.z,0),O.mult(D,L),D.x+=
b*L.x,D.y+=b*L.y,D.z+=b*L.z,D.w+=b*L.w,f&&(p?D.normalizeFast():D.normalize()));x.aabb&&(x.aabbNeedsUpdate=!0);x.updateInertiaWorld&&x.updateInertiaWorld()}this.clearForces();this.broadphase.dirty=!0;n&&(m.integrate=performance.now()-q);this.time+=a;this.stepnumber+=1;this.dispatchEvent(E);for(g=0;g!==d;g++)x=e[g],(a=x.postStep)&&a.call(x);if(this.allowSleep)for(g=0;g!==d;g++)e[g].sleepTick(this.time)};a.prototype.clearForces=function(){for(var a=this.bodies,b=a.length,d=0;d!==b;d++){var e=a[d];e.force.set(0,
0,0);e.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},
{},[2])(2)});CANNON=CANNON||{};var camera,scene,s_oRayCasterMesh;
CANNON.Demo=function(l){function b(){if(D){for(var a in D.__controllers)D.__controllers[a].updateDisplay();for(var b in D.__folders)for(a in D.__folders[b].__controllers)D.__folders[b].__controllers[a].updateDisplay()}}function g(a){function b(a,d){a.material&&(a.material=d);for(var e=0;e<a.children.length;e++)b(a.children[e],d)}if(-1===ea.indexOf(a))throw Error("Render mode "+a+" not found!");switch(a){case "solid":k.currentMaterial=I;U.intensity=1;qa.color.setHex(2236962);break;case "wireframe":k.currentMaterial=
B,U.intensity=0,qa.color.setHex(16777215)}for(var d=0;d<z.length;d++)b(z[d],k.currentMaterial);n.rendermode=a}function m(){for(var a=x.length,b=0;b<a;b++){var d=x[b];d.position.copy(d.initPosition);d.velocity.copy(d.initVelocity);d.initAngularVelocity&&(d.angularVelocity.copy(d.initAngularVelocity),d.quaternion.copy(d.initQuaternion))}}function a(a){0===a.x&&(a.x=1E-6);0===a.y&&(a.y=1E-6);0===a.z&&(a.z=1E-6)}function e(){for(var b=x.length,d=0;d<b;d++){var e=x[d],f=z[d];f.position.copy(e.position);
e.quaternion&&f.quaternion.copy(e.quaternion)}O.restart();if(n.contacts)for(d=0;d<S.contacts.length;d++)for(b=0;2>b;b++){f=O.request();var g=S.contacts[d];e=0===b?g.bi:g.bj;var k=0===b?g.ri:g.rj;f.position.set(e.position.x+k.x,e.position.y+k.y,e.position.z+k.z)}O.hideCached();L.restart();if(n.cm2contact)for(d=0;d<S.contacts.length;d++)for(b=0;2>b;b++)f=L.request(),g=S.contacts[d],e=0===b?g.bi:g.bj,k=0===b?g.ri:g.rj,f.scale.set(k.x,k.y,k.z),a(f.scale),f.position.copy(e.position);L.hideCached();X.restart();
R.restart();if(n.constraints){for(d=0;d<S.constraints.length;d++)g=S.constraints[d],g instanceof CANNON.DistanceConstraint&&(e=g.equations.normal,b=e.bi,e=e.bj,f=X.request(),e=e.position?e.position:e,f.scale.set(e.x-b.position.x,e.y-b.position.y,e.z-b.position.z),a(f.scale),f.position.copy(b.position));for(d=0;d<S.constraints.length;d++)if(g=S.constraints[d],g instanceof CANNON.PointToPointConstraint){k=g.equations.normal;b=k.bi;e=k.bj;f=R.request();g=R.request();var l=R.request();f.scale.set(k.ri.x,
k.ri.y,k.ri.z);g.scale.set(k.rj.x,k.rj.y,k.rj.z);l.scale.set(-k.penetrationVec.x,-k.penetrationVec.y,-k.penetrationVec.z);a(f.scale);a(g.scale);a(l.scale);f.position.copy(b.position);g.position.copy(e.position);k.bj.position.vadd(k.rj,l.position)}}R.hideCached();X.hideCached();J.restart();if(n.normals)for(d=0;d<S.contacts.length;d++)g=S.contacts[d],b=g.bi,f=J.request(),k=g.ni,e=b,f.scale.set(k.x,k.y,k.z),a(f.scale),f.position.copy(e.position),g.ri.vadd(f.position,f.position);J.hideCached();T.restart();
if(n.axes)for(b=0;b<x.length;b++)e=x[b],f=T.request(),f.position.copy(e.position),e.quaternion&&f.quaternion.copy(e.quaternion);T.hideCached();ba.restart();if(n.aabbs)for(d=0;d<x.length;d++)e=x[d],e.computeAABB&&(e.aabbNeedsUpdate&&e.computeAABB(),isFinite(e.aabb.lowerBound.x)&&isFinite(e.aabb.lowerBound.y)&&isFinite(e.aabb.lowerBound.z)&&isFinite(e.aabb.upperBound.x)&&isFinite(e.aabb.upperBound.y)&&isFinite(e.aabb.upperBound.z)&&0!=e.aabb.lowerBound.x-e.aabb.upperBound.x&&0!=e.aabb.lowerBound.y-
e.aabb.upperBound.y&&0!=e.aabb.lowerBound.z-e.aabb.upperBound.z&&(f=ba.request(),f.scale.set(e.aabb.lowerBound.x-e.aabb.upperBound.x,e.aabb.lowerBound.y-e.aabb.upperBound.y,e.aabb.lowerBound.z-e.aabb.upperBound.z),f.position.set(.5*(e.aabb.lowerBound.x+e.aabb.upperBound.x),.5*(e.aabb.lowerBound.y+e.aabb.upperBound.y),.5*(e.aabb.lowerBound.z+e.aabb.upperBound.z))));ba.hideCached()}function d(){requestAnimationFrame(d);n.paused||e();CAMERA_TEST&&na.update();wa.clear();wa.render(k.scene,camera);ha.update()}
function q(a){mouseX=a.clientX-Aa;mouseY=a.clientY-Da}function f(a){V=s_iCanvasResizeWidth+2*s_iCanvasOffsetWidth;Ia=s_iCanvasResizeHeight+2*s_iCanvasOffsetHeight;CAMERA_TEST&&(na.screen.width=V,na.screen.height=Ia)}function p(a){k.dispatchEvent({type:"destroy"});n.paused=!1;b();w(a)}function w(a){for(var d=z.length,e=0;e<d;e++){S.remove(x.pop());var f=z.pop();k.scene.remove(f)}for(;S.constraints.length;)S.removeConstraint(S.constraints[0]);A[a]();n.iterations=S.solver.iterations;n.gx=S.gravity.x+
0;n.gy=S.gravity.y+0;n.gz=S.gravity.z+0;n.quatNormalizeSkip=S.quatNormalizeSkip;n.quatNormalizeFast=S.quatNormalizeFast;b();O.restart();O.hideCached();L.restart();L.hideCached();X.restart();X.hideCached();J.restart();J.hideCached()}function u(a){var b=[],d=[];this.request=function(){geo=b.length?b.pop():a();scene.add(geo);d.push(geo);return geo};this.restart=function(){for(;d.length;)b.push(d.pop())};this.hideCached=function(){for(var a=0;a<b.length;a++)scene.remove(b[a])}}var k=this;this.addScene=
function(a,b){if("string"!==typeof a)throw Error("1st argument of Demo.addScene(title,initfunc) must be a string!");if("function"!==typeof b)throw Error("2nd argument of Demo.addScene(title,initfunc) must be a function!");A.push(b);var d=A.length-1;G[a]=function(){p(d)};r.add(G,a)};this.restartCurrentScene=m;this.changeScene=p;this.start=function(){w(0)};var r,n=this.settings={stepFrequency:60,quatNormalizeSkip:2,quatNormalizeFast:!0,gx:0,gy:0,gz:0,iterations:3,tolerance:1E-4,k:1E6,d:3,scene:0,paused:!1,
rendermode:"solid",constraints:!1,contacts:!1,cm2contact:!1,normals:!1,axes:!1,particleSize:.1,shadows:!1,aabbs:!1,profiling:!1,maxSubSteps:3};l=l||{};for(var v in l)v in n&&(n[v]=l[v]);if(0!==n.stepFrequency%60)throw Error("stepFrequency must be a multiple of 60.");var x=this.bodies=[],z=this.visuals=[],A=[],D=null,E=null,F=null,G={},K=new THREE.SphereGeometry(.1,6,6);this.particleGeo=new THREE.SphereGeometry(1,16,8);var I=new THREE.MeshPhongMaterial({color:11184810,specular:1118481,shininess:100}),
B=new THREE.MeshLambertMaterial({color:16777215,wireframe:!0});this.currentMaterial=I;var Q=new THREE.MeshPhongMaterial({color:16711680});this.particleMaterial=new THREE.MeshLambertMaterial({color:16711680});var O=new u(function(){return new THREE.Mesh(K,Q)}),L=new u(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:16711680}))}),H=new THREE.BoxGeometry(1,1,1),W=new THREE.MeshBasicMaterial({color:11184810,
wireframe:!0}),ba=new u(function(){return new THREE.Mesh(H,W)}),X=new u(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:16711680}))}),R=new u(function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:16711680}))}),J=new u(function(){var a=new THREE.Geometry;
a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(1,1,1));return new THREE.Line(a,new THREE.LineBasicMaterial({color:65280}))}),T=new u(function(){var a=new THREE.Object3D,b=new THREE.Vector3(0,0,0),d=new THREE.Geometry,e=new THREE.Geometry,f=new THREE.Geometry;d.vertices.push(b);e.vertices.push(b);f.vertices.push(b);d.vertices.push(new THREE.Vector3(1,0,0));e.vertices.push(new THREE.Vector3(0,1,0));f.vertices.push(new THREE.Vector3(0,0,1));b=new THREE.Line(d,new THREE.LineBasicMaterial({color:16711680}));
e=new THREE.Line(e,new THREE.LineBasicMaterial({color:65280}));f=new THREE.Line(f,new THREE.LineBasicMaterial({color:255}));a.add(b);a.add(e);a.add(f);return a}),S=this.world=new CANNON.World;S.broadphase=new CANNON.NaiveBroadphase;var ea=["solid","wireframe"],U,qa,ha,ja;Detector.webgl||Detector.addGetWebGLMessage();var V=s_iCanvasResizeWidth+2*s_iCanvasOffsetWidth,Ia=s_iCanvasResizeHeight+2*s_iCanvasOffsetHeight,na,wa,Z,Aa=V/2,Da=Ia/2;(function(){Z=document.createElement("div");document.body.appendChild(Z);
CAMERA_TEST?(NEAR=1,camera=new THREE.PerspectiveCamera(45,V/Ia,NEAR,FAR),camera.lookAt(new THREE.Vector3(CAMERA_TEST_LOOK_AT.x,CAMERA_TEST_LOOK_AT.y,CAMERA_TEST_LOOK_AT.z)),camera.position.set(0,500,500),camera.up.set(0,0,1)):camera=createCamera();scene=k.scene=new THREE.Scene;scene.fog=new THREE.Fog(2236962,1E3,1E4);qa=new THREE.AmbientLight(4473924);scene.add(qa);U=new THREE.DirectionalLight(16777164,1);U.position.set(200,160,200);U.target.position.set(0,0,0);U.castShadow=!0;U.shadow.camera.near=
10;U.shadow.camera.far=100;U.shadow.camera.fov=30;U.shadowMapBias=.0139;U.shadowMapDarkness=.1;U.shadow.mapSize.width=1024;U.shadow.mapSize.height=1024;scene.add(U);scene.add(camera);var a=new THREE.PlaneBufferGeometry(500,500,50,50);s_oRayCasterMesh=new THREE.Mesh(a,new THREE.MeshLambertMaterial({color:16777215*Math.random()}));wa=SHOW_3D_RENDER?new THREE.WebGLRenderer({clearColor:0,clearAlpha:.5,antialias:!1,alpha:!0}):new THREE.CanvasRenderer({clearColor:0,clearAlpha:.5,antialias:!1,alpha:!0});
wa.setSize(V,Ia);wa.domElement.style.position="relative";wa.domElement.style.top="0px";wa.domElement.style.opacity=CANVAS_3D_OPACITY;Z.appendChild(wa.domElement);ja=document.createElement("div");ja.style.position="absolute";ja.style.top="10px";ja.style.width="100%";ja.style.textAlign="center";ja.innerHTML='<a href="http://github.com/schteppe/cannon.js">cannon.js</a> - javascript 3d physics';Z.appendChild(ja);document.addEventListener("mousemove",q);window.addEventListener("resize",f);wa.setClearColor(scene.fog.color,
1);wa.autoClear=!1;F=document.createElement("canvas");F.width=V;F.height=Ia;F.style.opacity=.5;F.style.position="absolute";F.style.top="0px";F.style.zIndex=90;Z.appendChild(F);E=new SmoothieChart({labelOffsetY:50,maxDataSetLength:100,millisPerPixel:2,grid:{strokeStyle:"none",fillStyle:"none",lineWidth:1,millisPerLine:250,verticalSections:6},labels:{fillStyle:"rgb(180, 180, 180)"}});E.streamTo(F);var b={};a=[[255,0,0],[0,255,0],[0,0,255],[255,255,0],[255,0,255],[0,255,255]];var d=0;for(l in S.profile){var e=
a[d%a.length];b[l]=new TimeSeries({label:l,fillStyle:"rgb("+e[0]+","+e[1]+","+e[2]+")",maxDataLength:500});d++}S.addEventListener("postStep",function(a){for(var d in S.profile)b[d].append(1E3*S.time,S.profile[d])});d=0;for(l in S.profile)e=a[d%a.length],E.addTimeSeries(b[l],{strokeStyle:"rgb("+e[0]+","+e[1]+","+e[2]+")",lineWidth:2}),d++;S.doProfiling=!1;E.stop();F.style.display="none";ha=new Stats;ha.domElement.style.position="absolute";ha.domElement.style.top="0px";ha.domElement.style.zIndex=100;
Z.appendChild(ha.domElement);if(void 0!=window.dat){D=new dat.GUI;D.domElement.parentNode.style.zIndex=120;var l=D.addFolder("Rendering");l.add(n,"rendermode",{Solid:"solid",Wireframe:"wireframe"}).onChange(function(a){g(a)});l.add(n,"contacts");l.add(n,"cm2contact");l.add(n,"normals");l.add(n,"constraints");l.add(n,"axes");l.add(n,"particleSize").min(0).max(1).onChange(function(a){for(var b=0;b<z.length;b++)x[b]instanceof CANNON.Particle&&z[b].scale.set(a,a,a)});l.add(n,"shadows").onChange(function(a){a?
wa.shadowMapAutoUpdate=!0:(wa.shadowMapAutoUpdate=!1,wa.clearTarget(U.shadowMap))});l.add(n,"aabbs");l.add(n,"profiling").onChange(function(a){a?(S.doProfiling=!0,E.start(),F.style.display="block"):(S.doProfiling=!1,E.stop(),F.style.display="none")});l=D.addFolder("World");l.add(n,"paused").onChange(function(a){});l.add(n,"stepFrequency",FPS,10*FPS).step(FPS);l.add(n,"gx",-100,100).onChange(function(a){isNaN(a)||S.gravity.set(a,n.gy,n.gz)});l.add(n,"gy",-100,100).onChange(function(a){isNaN(a)||S.gravity.set(n.gx,
a,n.gz)});l.add(n,"gz",-100,100).onChange(function(a){isNaN(a)||S.gravity.set(n.gx,n.gy,a)});l.add(n,"quatNormalizeSkip",0,50).step(1).onChange(function(a){isNaN(a)||(S.quatNormalizeSkip=a)});l.add(n,"quatNormalizeFast").onChange(function(a){S.quatNormalizeFast=!!a});l=D.addFolder("Solver");l.add(n,"iterations",1,50).step(1).onChange(function(a){S.solver.iterations=a});l.add(n,"k",10,1E7).onChange(function(a){k.setGlobalSpookParams(n.k,n.d,1/n.stepFrequency)});l.add(n,"d",0,20).step(.1).onChange(function(a){k.setGlobalSpookParams(n.k,
n.d,1/n.stepFrequency)});l.add(n,"tolerance",0,10).step(.01).onChange(function(a){S.solver.tolerance=a});r=D.addFolder("Scenes");r.open()}CAMERA_TEST&&(na=new THREE.TrackballControls(camera,wa.domElement),na.rotateSpeed=1,na.zoomSpeed=1.2,na.panSpeed=.2,na.noZoom=!1,na.noPan=!1,na.staticMoving=!1,na.dynamicDampingFactor=.3,na.minDistance=0,na.maxDistance=1E5,na.keys=[65,83,68],na.screen.width=V,na.screen.height=Ia)})();d();document.addEventListener("keypress",function(a){if(a.keyCode)switch(a.keyCode){case 32:m();
break;case 104:"none"==ha.domElement.style.display?(ha.domElement.style.display="block",ja.style.display="block"):(ha.domElement.style.display="none",ja.style.display="none");break;case 97:n.aabbs=!n.aabbs;b();break;case 99:n.constraints=!n.constraints;b();break;case 112:n.paused=!n.paused;b();break;case 115:S.step(1/n.stepFrequency);e();break;case 109:a=ea.indexOf(n.rendermode);a++;a%=ea.length;g(ea[a]);b();break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:A.length>a.keyCode-
49&&!document.activeElement.localName.match(/input/)&&p(a.keyCode-49)}})};CANNON.Demo.prototype=new CANNON.EventTarget;CANNON.Demo.constructor=CANNON.Demo;
CANNON.Demo.prototype.setGlobalSpookParams=function(l,b,g){for(var m=this.world,a=0;a<m.constraints.length;a++)for(var e=m.constraints[a],d=0;d<e.equations.length;d++)e.equations[d].setSpookParams(l,b,g);for(a=0;a<m.contactmaterials.length;a++)g=m.contactmaterials[a],g.contactEquationStiffness=l,g.frictionEquationStiffness=l,g.contactEquationRelaxation=b,g.frictionEquationRelaxation=b;m.defaultContactMaterial.contactEquationStiffness=l;m.defaultContactMaterial.frictionEquationStiffness=l;m.defaultContactMaterial.contactEquationRelaxation=
b;m.defaultContactMaterial.frictionEquationRelaxation=b};CANNON.Demo.prototype.getWorld=function(){return this.world};CANNON.Demo.prototype.addVisual=function(l,b){var g;l instanceof CANNON.Body&&(g=this.shape2mesh(l,b));g&&(this.bodies.push(l),this.visuals.push(g),l.visualref=g,l.visualref.visualId=this.bodies.length-1,this.scene.add(g));return g};CANNON.Demo.prototype.addVisuals=function(l){for(var b=0;b<l.length;b++)this.addVisual(l[b])};
CANNON.Demo.prototype.removeVisual=function(l){if(l.visualref){for(var b=this.bodies,g=this.visuals,m=[],a=[],e=b.length,d=0;d<e;d++)m.unshift(b.pop()),a.unshift(g.pop());e=l.visualref.visualId;for(var q=0;q<m.length;q++)q!==e&&(d=q>e?q-1:q,b[d]=m[q],g[d]=a[q],b[d].visualref=m[q].visualref,b[d].visualref.visualId=d);l.visualref.visualId=null;this.scene.remove(l.visualref);l.visualref=null}};CANNON.Demo.prototype.removeAllVisuals=function(){for(;this.bodies.length;)this.removeVisual(this.bodies[0])};
CANNON.Demo.prototype.shape2mesh=function(l,b){for(var g=new THREE.Object3D,m=0;m<l.shapes.length;m++){var a=l.shapes[m];switch(a.type){case CANNON.Shape.types.SPHERE:var e=new THREE.SphereGeometry(a.radius,8,8);a=void 0===b?new THREE.Mesh(e,this.currentMaterial):new THREE.Mesh(e,b);a.castShadow=!0;break;case CANNON.Shape.types.PARTICLE:a=new THREE.Mesh(this.particleGeo,this.particleMaterial);e=this.settings;a.scale.set(e.particleSize,e.particleSize,e.particleSize);break;case CANNON.Shape.types.PLANE:var d=
new THREE.PlaneGeometry(10,10,4,4);a=new THREE.Object3D;e=new THREE.Object3D;d=void 0===b?new THREE.Mesh(d,this.currentMaterial):new THREE.Mesh(d,b);d.scale.set(100,100,100);e.add(d);d.castShadow=!1;d.receiveShadow=!0;a.add(e);break;case CANNON.Shape.types.BOX:e=new THREE.BoxGeometry(2*a.halfExtents.x,2*a.halfExtents.y,2*a.halfExtents.z);a=void 0===b?new THREE.Mesh(e,this.currentMaterial):new THREE.Mesh(e,b);break;case CANNON.Shape.types.CONVEXPOLYHEDRON:d=new THREE.Geometry;for(e=0;e<a.vertices.length;e++){var q=
a.vertices[e];d.vertices.push(new THREE.Vector3(q.x,q.y,q.z))}for(e=0;e<a.faces.length;e++){var f=a.faces[e],p=f[0];for(q=1;q<f.length-1;q++)d.faces.push(new THREE.Face3(p,f[q],f[q+1]))}d.computeBoundingSphere();d.computeFaceNormals();a=void 0===b?new THREE.Mesh(d,this.currentMaterial):new THREE.Mesh(d,b);break;case CANNON.Shape.types.HEIGHTFIELD:d=new THREE.Geometry;f=new CANNON.Vec3;p=new CANNON.Vec3;var w=new CANNON.Vec3;for(q=0;q<a.data.length-1;q++)for(var u=0;u<a.data[q].length-1;u++)for(var k=
0;2>k;k++)a.getConvexTrianglePillar(q,u,0===k),f.copy(a.pillarConvex.vertices[0]),p.copy(a.pillarConvex.vertices[1]),w.copy(a.pillarConvex.vertices[2]),f.vadd(a.pillarOffset,f),p.vadd(a.pillarOffset,p),w.vadd(a.pillarOffset,w),d.vertices.push(new THREE.Vector3(f.x,f.y,f.z),new THREE.Vector3(p.x,p.y,p.z),new THREE.Vector3(w.x,w.y,w.z)),e=d.vertices.length-3,d.faces.push(new THREE.Face3(e,e+1,e+2));d.computeBoundingSphere();d.computeFaceNormals();a=void 0===b?new THREE.Mesh(d,this.currentMaterial):
new THREE.Mesh(d,b);break;case CANNON.Shape.types.TRIMESH:d=new THREE.Geometry;f=new CANNON.Vec3;p=new CANNON.Vec3;w=new CANNON.Vec3;for(e=0;e<a.indices.length/3;e++)a.getTriangleVertices(e,f,p,w),d.vertices.push(new THREE.Vector3(f.x,f.y,f.z),new THREE.Vector3(p.x,p.y,p.z),new THREE.Vector3(w.x,w.y,w.z)),q=d.vertices.length-3,d.faces.push(new THREE.Face3(q,q+1,q+2));d.computeBoundingSphere();d.computeFaceNormals();a=void 0===b?new THREE.Mesh(d,this.currentMaterial):new THREE.Mesh(d,b);break;default:throw"Visual type not recognized: "+
a.type;}a.receiveShadow=!0;a.castShadow=!0;if(a.children)for(e=0;e<a.children.length;e++)if(a.children[e].castShadow=!0,a.children[e].receiveShadow=!0,a.children[e])for(q=0;q<a.children[e].length;q++)a.children[e].children[q].castShadow=!0,a.children[e].children[q].receiveShadow=!0;e=l.shapeOffsets[m];d=l.shapeOrientations[m];a.position.set(e.x,e.y,e.z);a.quaternion.set(d.x,d.y,d.z,d.w);g.add(a)}this.camera=function(){return camera};this.getScene=function(){return scene};return g};
(function(l,b){"object"===typeof exports&&"undefined"!==typeof module?b(exports):"function"===typeof define&&define.amd?define(["exports"],b):b(l.THREE=l.THREE||{})})(this,function(l){function b(){}function g(c,h){this.x=c||0;this.y=h||0}function m(c,h,a,y,b,d,e,f,k,n){Object.defineProperty(this,"id",{value:ne++});this.uuid=l.Math.generateUUID();this.sourceFile=this.name="";this.image=void 0!==c?c:m.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==h?h:m.DEFAULT_MAPPING;this.wrapS=void 0!==a?a:
1001;this.wrapT=void 0!==y?y:1001;this.magFilter=void 0!==b?b:1006;this.minFilter=void 0!==d?d:1008;this.anisotropy=void 0!==k?k:1;this.format=void 0!==e?e:1023;this.type=void 0!==f?f:1009;this.offset=new g(0,0);this.repeat=new g(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==n?n:3E3;this.version=0;this.onUpdate=null}function a(c,h,a,y){this.x=c||0;this.y=h||0;this.z=a||0;this.w=void 0!==y?y:1}function e(c,h,t){this.uuid=l.Math.generateUUID();
this.width=c;this.height=h;this.scissor=new a(0,0,c,h);this.scissorTest=!1;this.viewport=new a(0,0,c,h);t=t||{};void 0===t.minFilter&&(t.minFilter=1006);this.texture=new m(void 0,void 0,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding);this.depthBuffer=void 0!==t.depthBuffer?t.depthBuffer:!0;this.stencilBuffer=void 0!==t.stencilBuffer?t.stencilBuffer:!0;this.depthTexture=void 0!==t.depthTexture?t.depthTexture:null}function d(c,h,a){e.call(this,c,h,a);this.activeMipMapLevel=
this.activeCubeFace=0}function q(c,h,a,y){this._x=c||0;this._y=h||0;this._z=a||0;this._w=void 0!==y?y:1}function f(c,h,a){this.x=c||0;this.y=h||0;this.z=a||0}function p(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function w(c,h,a,y,b,d,e,f,g,k){c=void 0!==c?c:[];m.call(this,c,void 0!==h?h:301,a,y,b,d,e,f,g,k);this.flipY=!1}function u(c,h,a){var t=c[0];if(0>=t||
0<t)return c;var b=h*a,d=oe[b];void 0===d&&(d=new Float32Array(b),oe[b]=d);if(0!==h)for(t.toArray(d,0),t=1,b=0;t!==h;++t)b+=a,c[t].toArray(d,b);return d}function k(c,h){var a=pe[h];void 0===a&&(a=new Int32Array(h),pe[h]=a);for(var b=0;b!==h;++b)a[b]=c.allocTextureUnit();return a}function r(c,h){c.uniform1f(this.addr,h)}function n(c,h){c.uniform1i(this.addr,h)}function v(c,h){void 0===h.x?c.uniform2fv(this.addr,h):c.uniform2f(this.addr,h.x,h.y)}function x(c,h){void 0!==h.x?c.uniform3f(this.addr,h.x,
h.y,h.z):void 0!==h.r?c.uniform3f(this.addr,h.r,h.g,h.b):c.uniform3fv(this.addr,h)}function z(c,h){void 0===h.x?c.uniform4fv(this.addr,h):c.uniform4f(this.addr,h.x,h.y,h.z,h.w)}function A(c,h){c.uniformMatrix2fv(this.addr,!1,h.elements||h)}function D(c,h){c.uniformMatrix3fv(this.addr,!1,h.elements||h)}function E(c,h){c.uniformMatrix4fv(this.addr,!1,h.elements||h)}function F(c,h,a){var t=a.allocTextureUnit();c.uniform1i(this.addr,t);a.setTexture2D(h||qe,t)}function G(c,h,a){var t=a.allocTextureUnit();
c.uniform1i(this.addr,t);a.setTextureCube(h||re,t)}function K(c,h){c.uniform2iv(this.addr,h)}function I(c,h){c.uniform3iv(this.addr,h)}function B(c,h){c.uniform4iv(this.addr,h)}function Q(c){switch(c){case 5126:return r;case 35664:return v;case 35665:return x;case 35666:return z;case 35674:return A;case 35675:return D;case 35676:return E;case 35678:return F;case 35680:return G;case 5124:case 35670:return n;case 35667:case 35671:return K;case 35668:case 35672:return I;case 35669:case 35673:return B}}
function O(c,h){c.uniform1fv(this.addr,h)}function L(c,h){c.uniform1iv(this.addr,h)}function H(c,h){c.uniform2fv(this.addr,u(h,this.size,2))}function W(c,h){c.uniform3fv(this.addr,u(h,this.size,3))}function ba(c,h){c.uniform4fv(this.addr,u(h,this.size,4))}function X(c,h){c.uniformMatrix2fv(this.addr,!1,u(h,this.size,4))}function R(c,h){c.uniformMatrix3fv(this.addr,!1,u(h,this.size,9))}function J(c,h){c.uniformMatrix4fv(this.addr,!1,u(h,this.size,16))}function T(c,h,a){var t=h.length,b=k(a,t);c.uniform1iv(this.addr,
b);for(c=0;c!==t;++c)a.setTexture2D(h[c]||qe,b[c])}function S(c,h,a){var t=h.length,b=k(a,t);c.uniform1iv(this.addr,b);for(c=0;c!==t;++c)a.setTextureCube(h[c]||re,b[c])}function ea(c){switch(c){case 5126:return O;case 35664:return H;case 35665:return W;case 35666:return ba;case 35674:return X;case 35675:return R;case 35676:return J;case 35678:return T;case 35680:return S;case 5124:case 35670:return L;case 35667:case 35671:return K;case 35668:case 35672:return I;case 35669:case 35673:return B}}function U(c,
h,a){this.id=c;this.addr=a;this.setValue=Q(h.type)}function qa(c,h,a){this.id=c;this.addr=a;this.size=h.size;this.setValue=ea(h.type)}function ha(c){this.id=c;this.seq=[];this.map={}}function ja(c,h,a){this.seq=[];this.map={};this.renderer=a;a=c.getProgramParameter(h,c.ACTIVE_UNIFORMS);for(var t=0;t!==a;++t){var b=c.getActiveUniform(h,t),d=c.getUniformLocation(h,b.name),e=this,f=b.name,g=f.length;for(Od.lastIndex=0;;){var k=Od.exec(f),l=Od.lastIndex,n=k[1],m=k[3];"]"===k[2]&&(n|=0);if(void 0===m||
"["===m&&l+2===g){f=e;b=void 0===m?new U(n,b,d):new qa(n,b,d);f.seq.push(b);f.map[b.id]=b;break}else m=e.map[n],void 0===m&&(m=new ha(n),n=e,e=m,n.seq.push(e),n.map[e.id]=e),e=m}}}function V(c,h,a){return void 0===h&&void 0===a?this.set(c):this.setRGB(c,h,a)}function Ia(c,h){this.min=void 0!==c?c:new g(Infinity,Infinity);this.max=void 0!==h?h:new g(-Infinity,-Infinity)}function na(c,h){var a,b,d,e,k,l,n,m,r,q,p=c.context,v=c.state,u,w,x,A,Sa;this.render=function(t,y,C){if(0!==h.length){t=new f;var M=
C.w/C.z,aa=.5*C.z,Y=.5*C.w,ka=16/C.w,Ba=new g(ka*M,ka),la=new f(1,1,0),fb=new g(1,1),Mc=new Ia;Mc.min.set(0,0);Mc.max.set(C.z-16,C.w-16);if(void 0===x){ka=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]);var Ra=new Uint16Array([0,1,2,0,2,3]);u=p.createBuffer();w=p.createBuffer();p.bindBuffer(p.ARRAY_BUFFER,u);p.bufferData(p.ARRAY_BUFFER,ka,p.STATIC_DRAW);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,w);p.bufferData(p.ELEMENT_ARRAY_BUFFER,Ra,p.STATIC_DRAW);A=p.createTexture();Sa=p.createTexture();v.bindTexture(p.TEXTURE_2D,
A);p.texImage2D(p.TEXTURE_2D,0,p.RGB,16,16,0,p.RGB,p.UNSIGNED_BYTE,null);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST);v.bindTexture(p.TEXTURE_2D,Sa);p.texImage2D(p.TEXTURE_2D,0,p.RGBA,16,16,0,p.RGBA,p.UNSIGNED_BYTE,null);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,
p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST);ka={vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"};Ra=p.createProgram();var ld=p.createShader(p.FRAGMENT_SHADER),
B=p.createShader(p.VERTEX_SHADER),z="precision "+c.getPrecision()+" float;\n";p.shaderSource(ld,z+ka.fragmentShader);p.shaderSource(B,z+ka.vertexShader);p.compileShader(ld);p.compileShader(B);p.attachShader(Ra,ld);p.attachShader(Ra,B);p.linkProgram(Ra);x=Ra;r=p.getAttribLocation(x,"position");q=p.getAttribLocation(x,"uv");a=p.getUniformLocation(x,"renderType");b=p.getUniformLocation(x,"map");d=p.getUniformLocation(x,"occlusionMap");e=p.getUniformLocation(x,"opacity");k=p.getUniformLocation(x,"color");
l=p.getUniformLocation(x,"scale");n=p.getUniformLocation(x,"rotation");m=p.getUniformLocation(x,"screenPosition")}p.useProgram(x);v.initAttributes();v.enableAttribute(r);v.enableAttribute(q);v.disableUnusedAttributes();p.uniform1i(d,0);p.uniform1i(b,1);p.bindBuffer(p.ARRAY_BUFFER,u);p.vertexAttribPointer(r,2,p.FLOAT,!1,16,0);p.vertexAttribPointer(q,2,p.FLOAT,!1,16,8);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,w);v.disable(p.CULL_FACE);v.setDepthWrite(!1);Ra=0;for(ld=h.length;Ra<ld;Ra++)if(ka=16/C.w,Ba.set(ka*
M,ka),B=h[Ra],t.set(B.matrixWorld.elements[12],B.matrixWorld.elements[13],B.matrixWorld.elements[14]),t.applyMatrix4(y.matrixWorldInverse),t.applyProjection(y.projectionMatrix),la.copy(t),fb.x=C.x+la.x*aa+aa-8,fb.y=C.y+la.y*Y+Y-8,!0===Mc.containsPoint(fb)){v.activeTexture(p.TEXTURE0);v.bindTexture(p.TEXTURE_2D,null);v.activeTexture(p.TEXTURE1);v.bindTexture(p.TEXTURE_2D,A);p.copyTexImage2D(p.TEXTURE_2D,0,p.RGB,fb.x,fb.y,16,16,0);p.uniform1i(a,0);p.uniform2f(l,Ba.x,Ba.y);p.uniform3f(m,la.x,la.y,la.z);
v.disable(p.BLEND);v.enable(p.DEPTH_TEST);p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0);v.activeTexture(p.TEXTURE0);v.bindTexture(p.TEXTURE_2D,Sa);p.copyTexImage2D(p.TEXTURE_2D,0,p.RGBA,fb.x,fb.y,16,16,0);p.uniform1i(a,1);v.disable(p.DEPTH_TEST);v.activeTexture(p.TEXTURE1);v.bindTexture(p.TEXTURE_2D,A);p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0);B.positionScreen.copy(la);B.customUpdateCallback?B.customUpdateCallback(B):B.updateLensFlares();p.uniform1i(a,2);v.enable(p.BLEND);z=0;for(var D=
B.lensFlares.length;z<D;z++){var da=B.lensFlares[z];.001<da.opacity&&.001<da.scale&&(la.x=da.x,la.y=da.y,la.z=da.z,ka=da.size*da.scale/C.w,Ba.x=ka*M,Ba.y=ka,p.uniform3f(m,la.x,la.y,la.z),p.uniform2f(l,Ba.x,Ba.y),p.uniform1f(n,da.rotation),p.uniform1f(e,da.opacity),p.uniform3f(k,da.color.r,da.color.g,da.color.b),v.setBlending(da.blending,da.blendEquation,da.blendSrc,da.blendDst),c.setTexture2D(da.texture,1),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0))}}v.enable(p.CULL_FACE);v.enable(p.DEPTH_TEST);
v.setDepthWrite(!0);c.resetGLState()}}}function wa(c,h){function a(c,h){return c.renderOrder!==h.renderOrder?c.renderOrder-h.renderOrder:c.z!==h.z?h.z-c.z:h.id-c.id}var b,d,e,g,k,l,n,r,p,v,u,w,x,B,A,Sa,z,da=c.context,D=c.state,F,R,E,G,ea=new f,K=new q,H=new f;this.render=function(t,y){if(0!==h.length){if(void 0===E){var C=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),f=new Uint16Array([0,1,2,0,2,3]);F=da.createBuffer();R=da.createBuffer();da.bindBuffer(da.ARRAY_BUFFER,F);da.bufferData(da.ARRAY_BUFFER,
C,da.STATIC_DRAW);da.bindBuffer(da.ELEMENT_ARRAY_BUFFER,R);da.bufferData(da.ELEMENT_ARRAY_BUFFER,f,da.STATIC_DRAW);C=da.createProgram();f=da.createShader(da.VERTEX_SHADER);var M=da.createShader(da.FRAGMENT_SHADER);da.shaderSource(f,["precision "+c.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
da.shaderSource(M,["precision "+c.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
da.compileShader(f);da.compileShader(M);da.attachShader(C,f);da.attachShader(C,M);da.linkProgram(C);E=C;Sa=da.getAttribLocation(E,"position");z=da.getAttribLocation(E,"uv");b=da.getUniformLocation(E,"uvOffset");d=da.getUniformLocation(E,"uvScale");e=da.getUniformLocation(E,"rotation");g=da.getUniformLocation(E,"scale");k=da.getUniformLocation(E,"color");l=da.getUniformLocation(E,"map");n=da.getUniformLocation(E,"opacity");r=da.getUniformLocation(E,"modelViewMatrix");p=da.getUniformLocation(E,"projectionMatrix");
v=da.getUniformLocation(E,"fogType");u=da.getUniformLocation(E,"fogDensity");w=da.getUniformLocation(E,"fogNear");x=da.getUniformLocation(E,"fogFar");B=da.getUniformLocation(E,"fogColor");A=da.getUniformLocation(E,"alphaTest");C=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");C.width=8;C.height=8;f=C.getContext("2d");f.fillStyle="white";f.fillRect(0,0,8,8);G=new m(C);G.needsUpdate=!0}da.useProgram(E);D.initAttributes();D.enableAttribute(Sa);D.enableAttribute(z);D.disableUnusedAttributes();
D.disable(da.CULL_FACE);D.enable(da.BLEND);da.bindBuffer(da.ARRAY_BUFFER,F);da.vertexAttribPointer(Sa,2,da.FLOAT,!1,16,0);da.vertexAttribPointer(z,2,da.FLOAT,!1,16,8);da.bindBuffer(da.ELEMENT_ARRAY_BUFFER,R);da.uniformMatrix4fv(p,!1,y.projectionMatrix.elements);D.activeTexture(da.TEXTURE0);da.uniform1i(l,0);f=C=0;(M=t.fog)?(da.uniform3f(B,M.color.r,M.color.g,M.color.b),M&&M.isFog?(da.uniform1f(w,M.near),da.uniform1f(x,M.far),da.uniform1i(v,1),f=C=1):M&&M.isFogExp2&&(da.uniform1f(u,M.density),da.uniform1i(v,
2),f=C=2)):(da.uniform1i(v,0),f=C=0);M=0;for(var aa=h.length;M<aa;M++){var Y=h[M];Y.modelViewMatrix.multiplyMatrices(y.matrixWorldInverse,Y.matrixWorld);Y.z=-Y.modelViewMatrix.elements[14]}h.sort(a);var q=[];M=0;for(aa=h.length;M<aa;M++){Y=h[M];var ka=Y.material;!1!==ka.visible&&(da.uniform1f(A,ka.alphaTest),da.uniformMatrix4fv(r,!1,Y.modelViewMatrix.elements),Y.matrixWorld.decompose(ea,K,H),q[0]=H.x,q[1]=H.y,Y=0,t.fog&&ka.fog&&(Y=f),C!==Y&&(da.uniform1i(v,Y),C=Y),null!==ka.map?(da.uniform2f(b,ka.map.offset.x,
ka.map.offset.y),da.uniform2f(d,ka.map.repeat.x,ka.map.repeat.y)):(da.uniform2f(b,0,0),da.uniform2f(d,1,1)),da.uniform1f(n,ka.opacity),da.uniform3f(k,ka.color.r,ka.color.g,ka.color.b),da.uniform1f(e,ka.rotation),da.uniform2fv(g,q),D.setBlending(ka.blending,ka.blendEquation,ka.blendSrc,ka.blendDst),D.setDepthTest(ka.depthTest),D.setDepthWrite(ka.depthWrite),ka.map?c.setTexture2D(ka.map,0):c.setTexture2D(G,0),da.drawElements(da.TRIANGLES,6,da.UNSIGNED_SHORT,0))}D.enable(da.CULL_FACE);c.resetGLState()}}}
function Z(){Object.defineProperty(this,"id",{value:se++});this.uuid=l.Math.generateUUID();this.name="";this.type="Material";this.lights=this.fog=!0;this.blending=1;this.side=0;this.shading=2;this.vertexColors=0;this.opacity=1;this.transparent=!1;this.blendSrc=204;this.blendDst=205;this.blendEquation=100;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=3;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=!1;this.colorWrite=!0;this.precision=
null;this.polygonOffset=!1;this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0}function Aa(c){Z.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=
1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==c&&(void 0!==c.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(c))}function Da(c){Z.call(this);this.type="MeshDepthMaterial";this.depthPacking=
3200;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(c)}function sa(c,h){this.min=void 0!==c?c:new f(Infinity,Infinity,Infinity);this.max=void 0!==h?h:new f(-Infinity,-Infinity,-Infinity)}function za(c,h){this.center=void 0!==c?c:new f;this.radius=void 0!==h?h:0}function va(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&
console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function ya(c,h){this.normal=void 0!==c?c:new f(1,0,0);this.constant=void 0!==h?h:0}function La(c,h,a,b,d,e){this.planes=[void 0!==c?c:new ya,void 0!==h?h:new ya,void 0!==a?a:new ya,void 0!==b?b:new ya,void 0!==d?d:new ya,void 0!==e?e:new ya]}function Va(c,h,t,b){function y(h,a,t,b){var y=h.geometry;var d=A;var C=h.customDepthMaterial;t&&(d=z,C=h.customDistanceMaterial);C?d=C:(C=!1,a.morphTargets&&(y&&y.isBufferGeometry?
C=y.morphAttributes&&y.morphAttributes.position&&0<y.morphAttributes.position.length:y&&y.isGeometry&&(C=y.morphTargets&&0<y.morphTargets.length)),h=h.isSkinnedMesh&&a.skinning,y=0,C&&(y|=1),h&&(y|=2),d=d[y]);c.localClippingEnabled&&!0===a.clipShadows&&0!==a.clippingPlanes.length&&(y=d.uuid,C=a.uuid,h=Sa[y],void 0===h&&(h={},Sa[y]=h),y=h[C],void 0===y&&(y=d.clone(),h[C]=y),d=y);d.visible=a.visible;d.wireframe=a.wireframe;C=a.side;H.renderSingleSided&&2==C&&(C=0);H.renderReverseSided&&(0===C?C=1:1===
C&&(C=0));d.side=C;d.clipShadows=a.clipShadows;d.clippingPlanes=a.clippingPlanes;d.wireframeLinewidth=a.wireframeLinewidth;d.linewidth=a.linewidth;t&&void 0!==d.uniforms.lightPos&&d.uniforms.lightPos.value.copy(b);return d}function d(c,h,a){if(!1!==c.visible){0!==(c.layers.mask&h.layers.mask)&&(c.isMesh||c.isLine||c.isPoints)&&c.castShadow&&(!1===c.frustumCulled||!0===m.intersectsObject(c))&&!0===c.material.visible&&(c.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,c.matrixWorld),B.push(c));
c=c.children;for(var t=0,b=c.length;t<b;t++)d(c[t],h,a)}}var k=c.context,n=c.state,m=new La,r=new p,q=h.shadows,v=new g,u=new g(b.maxTextureSize,b.maxTextureSize),w=new f,x=new f,B=[],A=Array(4),z=Array(4),Sa={},D=[new f(1,0,0),new f(-1,0,0),new f(0,0,1),new f(0,0,-1),new f(0,1,0),new f(0,-1,0)],da=[new f(0,1,0),new f(0,1,0),new f(0,1,0),new f(0,1,0),new f(0,0,1),new f(0,0,-1)],F=[new a,new a,new a,new a,new a,new a];h=new Da;h.depthPacking=3201;h.clipping=!0;b=Xc.distanceRGBA;for(var R=l.UniformsUtils.clone(b.uniforms),
E=0;4!==E;++E){var G=0!==(E&1),ea=0!==(E&2),K=h.clone();K.morphTargets=G;K.skinning=ea;A[E]=K;G=new Aa({defines:{USE_SHADOWMAP:""},uniforms:R,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader,morphTargets:G,skinning:ea,clipping:!0});z[E]=G}var H=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=1;this.renderSingleSided=this.renderReverseSided=!0;this.render=function(h,a){if(!1!==H.enabled&&(!1!==H.autoUpdate||!1!==H.needsUpdate)&&0!==q.length){n.clearColor(1,1,1,1);n.disable(k.BLEND);
n.setDepthTest(!0);n.setScissorTest(!1);for(var b,C,f=0,g=q.length;f<g;f++){var M=q[f],aa=M.shadow;if(void 0===aa)console.warn("THREE.WebGLShadowMap:",M,"has no shadow.");else{var l=aa.camera;v.copy(aa.mapSize);v.min(u);if(M&&M.isPointLight){b=6;C=!0;var Y=v.x,p=v.y;F[0].set(2*Y,p,Y,p);F[1].set(0,p,Y,p);F[2].set(3*Y,p,Y,p);F[3].set(Y,p,Y,p);F[4].set(3*Y,0,Y,p);F[5].set(Y,0,Y,p);v.x*=4;v.y*=2}else b=1,C=!1;null===aa.map&&(aa.map=new e(v.x,v.y,{minFilter:1003,magFilter:1003,format:1023}),l.updateProjectionMatrix());
aa&&aa.isSpotLightShadow&&aa.update(M);Y=aa.map;aa=aa.matrix;x.setFromMatrixPosition(M.matrixWorld);l.position.copy(x);c.setRenderTarget(Y);c.clear();for(Y=0;Y<b;Y++){C?(w.copy(l.position),w.add(D[Y]),l.up.copy(da[Y]),l.lookAt(w),n.viewport(F[Y])):(w.setFromMatrixPosition(M.target.matrixWorld),l.lookAt(w));l.updateMatrixWorld();l.matrixWorldInverse.getInverse(l.matrixWorld);aa.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);aa.multiply(l.projectionMatrix);aa.multiply(l.matrixWorldInverse);r.multiplyMatrices(l.projectionMatrix,
l.matrixWorldInverse);m.setFromMatrix(r);B.length=0;d(h,a,l);p=0;for(var ka=B.length;p<ka;p++){var Ba=B[p],la=t.update(Ba),fb=Ba.material;if(fb&&fb.isMultiMaterial){var Sa=la.groups;fb=fb.materials;for(var Ra=0,Mc=Sa.length;Ra<Mc;Ra++){var A=Sa[Ra],z=fb[A.materialIndex];!0===z.visible&&(z=y(Ba,z,C,x),c.renderBufferDirect(l,null,la,z,Ba,A))}}else z=y(Ba,fb,C,x),c.renderBufferDirect(l,null,la,z,Ba,null)}}}}b=c.getClearColor();C=c.getClearAlpha();c.setClearColor(b,C);H.needsUpdate=!1}}}function ra(c,
h){this.origin=void 0!==c?c:new f;this.direction=void 0!==h?h:new f}function fa(c,h,a,b){this._x=c||0;this._y=h||0;this._z=a||0;this._order=b||fa.DefaultOrder}function Ga(){this.mask=1}function ca(){Object.defineProperty(this,"id",{value:te++});this.uuid=l.Math.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=ca.DefaultUp.clone();var c=new f,h=new fa,a=new q,b=new f(1,1,1);h.onChange(function(){a.setFromEuler(h,!1)});a.onChange(function(){h.setFromQuaternion(a,
void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:c},rotation:{enumerable:!0,value:h},quaternion:{enumerable:!0,value:a},scale:{enumerable:!0,value:b},modelViewMatrix:{value:new p},normalMatrix:{value:new va}});this.matrix=new p;this.matrixWorld=new p;this.matrixAutoUpdate=ca.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new Ga;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={};this.onBeforeRender=
null}function Wa(c,h){this.start=void 0!==c?c:new f;this.end=void 0!==h?h:new f}function Ha(c,h,a){this.a=void 0!==c?c:new f;this.b=void 0!==h?h:new f;this.c=void 0!==a?a:new f}function ta(c,h,a,b,d,e){this.a=c;this.b=h;this.c=a;this.normal=b&&b.isVector3?b:new f;this.vertexNormals=Array.isArray(b)?b:[];this.color=d&&d.isColor?d:new V;this.vertexColors=Array.isArray(d)?d:[];this.materialIndex=void 0!==e?e:0}function oa(c){Z.call(this);this.type="MeshBasicMaterial";this.color=new V(16777215);this.aoMap=
this.map=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.lights=this.morphTargets=this.skinning=!1;this.setValues(c)}function P(c,h,a){if(Array.isArray(c))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=l.Math.generateUUID();this.array=c;this.itemSize=h;this.count=void 0!==
c?c.length/h:0;this.normalized=!0===a;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0}function pa(c,h){return new P(new Uint16Array(c),h)}function Lb(c,h){return new P(new Uint32Array(c),h)}function Oa(c,h){return new P(new Float32Array(c),h)}function ma(){Object.defineProperty(this,"id",{value:xd++});this.uuid=l.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];
this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function sb(){Object.defineProperty(this,"id",{value:xd++});this.uuid=l.Math.generateUUID();this.name="";this.type="DirectGeometry";this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=
[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function ia(){Object.defineProperty(this,"id",{value:xd++});this.uuid=l.Math.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}}
function Ca(c,h){ca.call(this);this.type="Mesh";this.geometry=void 0!==c?c:new ia;this.material=void 0!==h?h:new oa({color:16777215*Math.random()});this.drawMode=0;this.updateMorphTargets()}function tb(c,h,a,b,d,e){function t(c,h,a,t,b,d,C,e,g,aa,Y){var ka=d/g,Ba=C/aa,u=d/2,la=C/2,w=e/2;C=g+1;for(var x=aa+1,fb=d=0,Sa=new f,Ra=0;Ra<x;Ra++)for(var Mc=Ra*Ba-la,B=0;B<C;B++)Sa[c]=(B*ka-u)*t,Sa[h]=Mc*b,Sa[a]=w,M[m]=Sa.x,M[m+1]=Sa.y,M[m+2]=Sa.z,Sa[c]=0,Sa[h]=0,Sa[a]=0<e?1:-1,l[m]=Sa.x,l[m+1]=Sa.y,l[m+2]=
Sa.z,n[r]=B/g,n[r+1]=1-Ra/aa,m+=3,r+=2,d+=1;for(Ra=0;Ra<aa;Ra++)for(B=0;B<g;B++)c=q+B+C*(Ra+1),h=q+(B+1)+C*(Ra+1),a=q+(B+1)+C*Ra,k[p]=q+B+C*Ra,k[p+1]=c,k[p+2]=a,k[p+3]=c,k[p+4]=h,k[p+5]=a,p+=6,fb+=6;y.addGroup(v,fb,Y);v+=fb;q+=d}ia.call(this);this.type="BoxBufferGeometry";this.parameters={width:c,height:h,depth:a,widthSegments:b,heightSegments:d,depthSegments:e};var y=this;b=Math.floor(b)||1;d=Math.floor(d)||1;e=Math.floor(e)||1;var C=0+(b+1)*(d+1)*2+(b+1)*(e+1)*2+(e+1)*(d+1)*2,g=6*(0+b*d*2+b*e*2+
e*d*2),k=new (65535<g?Uint32Array:Uint16Array)(g),M=new Float32Array(3*C),l=new Float32Array(3*C),n=new Float32Array(2*C),m=0,r=0,p=0,q=0,v=0;t("z","y","x",-1,-1,a,h,c,e,d,0);t("z","y","x",1,-1,a,h,-c,e,d,1);t("x","z","y",1,1,c,a,h,b,e,2);t("x","z","y",1,-1,c,a,-h,b,e,3);t("x","y","z",1,-1,c,h,a,b,d,4);t("x","y","z",-1,-1,c,h,-a,b,d,5);this.setIndex(new P(k,1));this.addAttribute("position",new P(M,3));this.addAttribute("normal",new P(l,3));this.addAttribute("uv",new P(n,2))}function eb(c,h,a,b){ia.call(this);
this.type="PlaneBufferGeometry";this.parameters={width:c,height:h,widthSegments:a,heightSegments:b};var t=c/2,y=h/2;a=Math.floor(a)||1;b=Math.floor(b)||1;var d=a+1,e=b+1,f=c/a,g=h/b;h=new Float32Array(d*e*3);c=new Float32Array(d*e*3);for(var k=new Float32Array(d*e*2),l=0,n=0,m=0;m<e;m++)for(var r=m*g-y,p=0;p<d;p++)h[l]=p*f-t,h[l+1]=-r,c[l+2]=1,k[n]=p/a,k[n+1]=1-m/b,l+=3,n+=2;l=0;t=new (65535<h.length/3?Uint32Array:Uint16Array)(a*b*6);for(m=0;m<b;m++)for(p=0;p<a;p++)y=p+d*(m+1),e=p+1+d*(m+1),f=p+1+
d*m,t[l]=p+d*m,t[l+1]=y,t[l+2]=f,t[l+3]=y,t[l+4]=e,t[l+5]=f,l+=6;this.setIndex(new P(t,1));this.addAttribute("position",new P(h,3));this.addAttribute("normal",new P(c,3));this.addAttribute("uv",new P(k,2))}function Ea(){ca.call(this);this.type="Camera";this.matrixWorldInverse=new p;this.projectionMatrix=new p}function cb(c,h,a,b){Ea.call(this);this.type="PerspectiveCamera";this.fov=void 0!==c?c:50;this.zoom=1;this.near=void 0!==a?a:.1;this.far=void 0!==b?b:2E3;this.focus=10;this.aspect=void 0!==h?
h:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}function Gb(c,h,a,b,d,e){Ea.call(this);this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=c;this.right=h;this.top=a;this.bottom=b;this.near=void 0!==d?d:.1;this.far=void 0!==e?e:2E3;this.updateProjectionMatrix()}function xc(c,h,a){var t,b,d;return{setMode:function(c){t=c},setIndex:function(a){a.array instanceof Uint32Array&&h.get("OES_element_index_uint")?(b=c.UNSIGNED_INT,d=4):(b=c.UNSIGNED_SHORT,
d=2)},render:function(h,y){c.drawElements(t,y,b,h*d);a.calls++;a.vertices+=y;t===c.TRIANGLES&&(a.faces+=y/3)},renderInstances:function(y,C,e){var f=h.get("ANGLE_instanced_arrays");null===f?console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(f.drawElementsInstancedANGLE(t,e,b,C*d,y.maxInstancedCount),a.calls++,a.vertices+=e*y.maxInstancedCount,t===c.TRIANGLES&&(a.faces+=y.maxInstancedCount*e/3))}}}function ub(c,
h,a){var t;return{setMode:function(c){t=c},render:function(h,b){c.drawArrays(t,h,b);a.calls++;a.vertices+=b;t===c.TRIANGLES&&(a.faces+=b/3)},renderInstances:function(b){var y=h.get("ANGLE_instanced_arrays");if(null===y)console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{var d=b.attributes.position;d=d&&d.isInterleavedBufferAttribute?d.data.count:d.count;y.drawArraysInstancedANGLE(t,0,d,b.maxInstancedCount);
a.calls++;a.vertices+=d*b.maxInstancedCount;t===c.TRIANGLES&&(a.faces+=b.maxInstancedCount*d/3)}}}}function yc(){var c={};return{get:function(h){if(void 0!==c[h.id])return c[h.id];switch(h.type){case "DirectionalLight":var a={direction:new f,color:new V,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new g};break;case "SpotLight":a={position:new f,direction:new f,color:new V,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new g};break;case "PointLight":a=
{position:new f,color:new V,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new g};break;case "HemisphereLight":a={direction:new f,skyColor:new V,groundColor:new V}}return c[h.id]=a}}}function bb(c){c=c.split("\n");for(var h=0;h<c.length;h++)c[h]=h+1+": "+c[h];return c.join("\n")}function Ya(c,h,a){var t=c.createShader(h);c.shaderSource(t,a);c.compileShader(t);!1===c.getShaderParameter(t,c.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==c.getShaderInfoLog(t)&&
console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",h===c.VERTEX_SHADER?"vertex":"fragment",c.getShaderInfoLog(t),bb(a));return t}function Fb(c){switch(c){case 3E3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+
c);}}function Ja(c,h){var a=Fb(h);return"vec4 "+c+"( vec4 value ) { return "+a[0]+"ToLinear"+a[1]+"; }"}function Xa(c,h){var a=Fb(h);return"vec4 "+c+"( vec4 value ) { return LinearTo"+a[0]+a[1]+"; }"}function Kb(c,h){switch(h){case 1:var a="Linear";break;case 2:a="Reinhard";break;case 3:a="Uncharted2";break;case 4:a="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+h);}return"vec3 "+c+"( vec3 color ) { return "+a+"ToneMapping( color ); }"}function De(c,h,a){c=c||{};return[c.derivatives||
h.envMapCubeUV||h.bumpMap||h.normalMap||h.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(c.fragDepth||h.logarithmicDepthBuffer)&&a.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",c.drawBuffers&&a.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(c.shaderTextureLOD||h.envMap)&&a.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Wc).join("\n")}function Hd(c){var h=[],a;for(a in c){var b=c[a];!1!==b&&h.push("#define "+
a+" "+b)}return h.join("\n")}function Wc(c){return""!==c}function le(c,h){return c.replace(/NUM_DIR_LIGHTS/g,h.numDirLights).replace(/NUM_SPOT_LIGHTS/g,h.numSpotLights).replace(/NUM_POINT_LIGHTS/g,h.numPointLights).replace(/NUM_HEMI_LIGHTS/g,h.numHemiLights)}function Id(c){return c.replace(/#include +<([\w\d.]+)>/g,function(c,a){var h=Fa[a];if(void 0===h)throw Error("Can not resolve #include <"+a+">");return Id(h)})}function me(c){return c.replace(/for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,
function(c,a,b,d){c="";for(a=parseInt(a);a<parseInt(b);a++)c+=d.replace(/\[ i \]/g,"[ "+a+" ]");return c})}function Ee(c,h,a,b){var t=c.context,d=a.extensions,y=a.defines,e=a.__webglShader.vertexShader,f=a.__webglShader.fragmentShader,k="SHADOWMAP_TYPE_BASIC";1===b.shadowMapType?k="SHADOWMAP_TYPE_PCF":2===b.shadowMapType&&(k="SHADOWMAP_TYPE_PCF_SOFT");var g="ENVMAP_TYPE_CUBE",l="ENVMAP_MODE_REFLECTION",n="ENVMAP_BLENDING_MULTIPLY";if(b.envMap){switch(a.envMap.mapping){case 301:case 302:g="ENVMAP_TYPE_CUBE";
break;case 306:case 307:g="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:g="ENVMAP_TYPE_EQUIREC";break;case 305:g="ENVMAP_TYPE_SPHERE"}switch(a.envMap.mapping){case 302:case 304:l="ENVMAP_MODE_REFRACTION"}switch(a.combine){case 0:n="ENVMAP_BLENDING_MULTIPLY";break;case 1:n="ENVMAP_BLENDING_MIX";break;case 2:n="ENVMAP_BLENDING_ADD"}}var m=0<c.gammaFactor?c.gammaFactor:1;d=De(d,b,c.extensions);var p=Hd(y),r=t.createProgram();a.isRawShaderMaterial?(y=[p,"\n"].filter(Wc).join("\n"),k=[d,p,"\n"].filter(Wc).join("\n")):
(y=["precision "+b.precision+" float;","precision "+b.precision+" int;","#define SHADER_NAME "+a.__webglShader.name,p,b.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+b.maxBones,b.map?"#define USE_MAP":"",b.envMap?"#define USE_ENVMAP":"",b.envMap?"#define "+l:"",b.lightMap?"#define USE_LIGHTMAP":"",b.aoMap?"#define USE_AOMAP":"",b.emissiveMap?"#define USE_EMISSIVEMAP":"",b.bumpMap?"#define USE_BUMPMAP":"",b.normalMap?"#define USE_NORMALMAP":"",b.displacementMap&&
b.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",b.specularMap?"#define USE_SPECULARMAP":"",b.roughnessMap?"#define USE_ROUGHNESSMAP":"",b.metalnessMap?"#define USE_METALNESSMAP":"",b.alphaMap?"#define USE_ALPHAMAP":"",b.vertexColors?"#define USE_COLOR":"",b.flatShading?"#define FLAT_SHADED":"",b.skinning?"#define USE_SKINNING":"",b.useVertexTexture?"#define BONE_TEXTURE":"",b.morphTargets?"#define USE_MORPHTARGETS":"",b.morphNormals&&!1===b.flatShading?"#define USE_MORPHNORMALS":"",b.doubleSided?
"#define DOUBLE_SIDED":"",b.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+b.numClippingPlanes,b.shadowMapEnabled?"#define USE_SHADOWMAP":"",b.shadowMapEnabled?"#define "+k:"",b.sizeAttenuation?"#define USE_SIZEATTENUATION":"",b.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",b.logarithmicDepthBuffer&&c.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;",
"uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;",
"\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Wc).join("\n"),k=[d,"precision "+b.precision+" float;","precision "+b.precision+" int;","#define SHADER_NAME "+a.__webglShader.name,p,b.alphaTest?"#define ALPHATEST "+b.alphaTest:"","#define GAMMA_FACTOR "+m,b.useFog&&b.fog?"#define USE_FOG":
"",b.useFog&&b.fogExp?"#define FOG_EXP2":"",b.map?"#define USE_MAP":"",b.envMap?"#define USE_ENVMAP":"",b.envMap?"#define "+g:"",b.envMap?"#define "+l:"",b.envMap?"#define "+n:"",b.lightMap?"#define USE_LIGHTMAP":"",b.aoMap?"#define USE_AOMAP":"",b.emissiveMap?"#define USE_EMISSIVEMAP":"",b.bumpMap?"#define USE_BUMPMAP":"",b.normalMap?"#define USE_NORMALMAP":"",b.specularMap?"#define USE_SPECULARMAP":"",b.roughnessMap?"#define USE_ROUGHNESSMAP":"",b.metalnessMap?"#define USE_METALNESSMAP":"",b.alphaMap?
"#define USE_ALPHAMAP":"",b.vertexColors?"#define USE_COLOR":"",b.flatShading?"#define FLAT_SHADED":"",b.doubleSided?"#define DOUBLE_SIDED":"",b.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+b.numClippingPlanes,b.shadowMapEnabled?"#define USE_SHADOWMAP":"",b.shadowMapEnabled?"#define "+k:"",b.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",b.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",b.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",b.logarithmicDepthBuffer&&
c.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",b.envMap&&c.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==b.toneMapping?"#define TONE_MAPPING":"",0!==b.toneMapping?Fa.tonemapping_pars_fragment:"",0!==b.toneMapping?Kb("toneMapping",b.toneMapping):"",b.outputEncoding||b.mapEncoding||b.envMapEncoding||b.emissiveMapEncoding?Fa.encodings_pars_fragment:"",b.mapEncoding?Ja("mapTexelToLinear",b.mapEncoding):
"",b.envMapEncoding?Ja("envMapTexelToLinear",b.envMapEncoding):"",b.emissiveMapEncoding?Ja("emissiveMapTexelToLinear",b.emissiveMapEncoding):"",b.outputEncoding?Xa("linearToOutputTexel",b.outputEncoding):"",b.depthPacking?"#define DEPTH_PACKING "+a.depthPacking:"","\n"].filter(Wc).join("\n"));e=Id(e,b);e=le(e,b);f=Id(f,b);f=le(f,b);a.isShaderMaterial||(e=me(e),f=me(f));f=k+f;e=Ya(t,t.VERTEX_SHADER,y+e);f=Ya(t,t.FRAGMENT_SHADER,f);t.attachShader(r,e);t.attachShader(r,f);void 0!==a.index0AttributeName?
t.bindAttribLocation(r,0,a.index0AttributeName):!0===b.morphTargets&&t.bindAttribLocation(r,0,"position");t.linkProgram(r);b=t.getProgramInfoLog(r);g=t.getShaderInfoLog(e);l=t.getShaderInfoLog(f);m=n=!0;if(!1===t.getProgramParameter(r,t.LINK_STATUS))n=!1,console.error("THREE.WebGLProgram: shader error: ",t.getError(),"gl.VALIDATE_STATUS",t.getProgramParameter(r,t.VALIDATE_STATUS),"gl.getProgramInfoLog",b,g,l);else if(""!==b)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",b);else if(""===
g||""===l)m=!1;m&&(this.diagnostics={runnable:n,material:a,programLog:b,vertexShader:{log:g,prefix:y},fragmentShader:{log:l,prefix:k}});t.deleteShader(e);t.deleteShader(f);var q;this.getUniforms=function(){void 0===q&&(q=new ja(t,r,c));return q};var v;this.getAttributes=function(){if(void 0===v){for(var c={},h=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES),a=0;a<h;a++){var b=t.getActiveAttrib(r,a).name;c[b]=t.getAttribLocation(r,b)}v=c}return v};this.destroy=function(){t.deleteProgram(r);this.program=
void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=He++;this.code=h;this.usedTimes=1;this.program=r;this.vertexShader=e;this.fragmentShader=f;return this}function Fe(c,h){function a(c,h){var a;c?c&&c.isTexture?a=c.encoding:c&&c.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),
a=c.texture.encoding):a=3E3;3E3===a&&h&&(a=3007);return a}var b=[],d={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},e="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes depthPacking".split(" ");
this.getParameters=function(t,b,y,e,C){var f=d[t.type],k;h.floatVertexTextures&&C&&C.skeleton&&C.skeleton.useVertexTexture?k=1024:(k=Math.floor((h.maxVertexUniforms-20)/4),void 0!==C&&C&&C.isSkinnedMesh&&(k=Math.min(C.skeleton.bones.length,k),k<C.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+C.skeleton.bones.length+", this GPU supports just "+k+" (try OpenGL instead of ANGLE)")));var g=c.getPrecision();null!==t.precision&&(g=h.getMaxPrecision(t.precision),g!==t.precision&&
console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",g,"instead."));var M=c.getCurrentRenderTarget();return{shaderID:f,precision:g,supportsVertexTextures:h.vertexTextures,outputEncoding:a(M?M.texture:null,c.gammaOutput),map:!!t.map,mapEncoding:a(t.map,c.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:a(t.envMap,c.gammaInput),envMapCubeUV:!!t.envMap&&(306===t.envMap.mapping||307===t.envMap.mapping),lightMap:!!t.lightMap,aoMap:!!t.aoMap,
emissiveMap:!!t.emissiveMap,emissiveMapEncoding:a(t.emissiveMap,c.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!y,useFog:t.fog,fogExp:y&&y.isFogExp2,flatShading:1===t.shading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:h.logarithmicDepthBuffer,skinning:t.skinning,maxBones:k,useVertexTexture:h.floatVertexTextures&&
C&&C.skeleton&&C.skeleton.useVertexTexture,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:c.maxMorphTargets,maxMorphNormals:c.maxMorphNormals,numDirLights:b.directional.length,numPointLights:b.point.length,numSpotLights:b.spot.length,numHemiLights:b.hemi.length,numClippingPlanes:e,shadowMapEnabled:c.shadowMap.enabled&&C.receiveShadow&&0<b.shadows.length,shadowMapType:c.shadowMap.type,toneMapping:c.toneMapping,physicallyCorrectLights:c.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,
alphaTest:t.alphaTest,doubleSided:2===t.side,flipSided:1===t.side,depthPacking:void 0!==t.depthPacking?t.depthPacking:!1}};this.getProgramCode=function(c,h){var a=[];h.shaderID?a.push(h.shaderID):(a.push(c.fragmentShader),a.push(c.vertexShader));if(void 0!==c.defines)for(var t in c.defines)a.push(t),a.push(c.defines[t]);for(t=0;t<e.length;t++)a.push(h[e[t]]);return a.join()};this.acquireProgram=function(h,a,t){for(var d,y=0,e=b.length;y<e;y++){var C=b[y];if(C.code===t){d=C;++d.usedTimes;break}}void 0===
d&&(d=new Ee(c,t,h,a),b.push(d));return d};this.releaseProgram=function(c){if(0===--c.usedTimes){var h=b.indexOf(c);b[h]=b[b.length-1];b.pop();c.destroy()}};this.programs=b}function Ge(c,h,a){function t(c){var y=c.target;c=d[y.id];null!==c.index&&b(c.index);var e=c.attributes;for(C in e)b(e[C]);y.removeEventListener("dispose",t);delete d[y.id];var C=h.get(y);C.wireframe&&b(C.wireframe);h["delete"](y);y=h.get(c);y.wireframe&&b(y.wireframe);h["delete"](c);a.memory.geometries--}function b(a){var t=a.isInterleavedBufferAttribute?
h.get(a.data).__webglBuffer:h.get(a).__webglBuffer;void 0!==t&&(c.deleteBuffer(t),a.isInterleavedBufferAttribute?h["delete"](a.data):h["delete"](a))}var d={};return{get:function(c){var h=c.geometry;if(void 0!==d[h.id])return d[h.id];h.addEventListener("dispose",t);var b;h.isBufferGeometry?b=h:h.isGeometry&&(void 0===h._bufferGeometry&&(h._bufferGeometry=(new ia).setFromObject(c)),b=h._bufferGeometry);d[h.id]=b;a.memory.geometries++;return b}}}function Jd(c,h,a){function t(a,t){var b=a.isInterleavedBufferAttribute?
a.data:a,d=h.get(b);void 0===d.__webglBuffer?(d.__webglBuffer=c.createBuffer(),c.bindBuffer(t,d.__webglBuffer),c.bufferData(t,b.array,b.dynamic?c.DYNAMIC_DRAW:c.STATIC_DRAW),d.version=b.version):d.version!==b.version&&(c.bindBuffer(t,d.__webglBuffer),!1===b.dynamic||-1===b.updateRange.count?c.bufferSubData(t,0,b.array):0===b.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):
(c.bufferSubData(t,b.updateRange.offset*b.array.BYTES_PER_ELEMENT,b.array.subarray(b.updateRange.offset,b.updateRange.offset+b.updateRange.count)),b.updateRange.count=0),d.version=b.version)}var b=new Ge(c,h,a);return{getAttributeBuffer:function(c){return c.isInterleavedBufferAttribute?h.get(c.data).__webglBuffer:h.get(c).__webglBuffer},getWireframeAttribute:function(a){var b=h.get(a);if(void 0!==b.wireframe)return b.wireframe;var d=[],y=a.index,e=a.attributes;a=e.position;if(null!==y){y=y.array;
e=0;for(var C=y.length;e<C;e+=3){var f=y[e+0],k=y[e+1],g=y[e+2];d.push(f,k,k,g,g,f)}}else for(y=e.position.array,e=0,C=y.length/3-1;e<C;e+=3)f=e+0,k=e+1,g=e+2,d.push(f,k,k,g,g,f);d=new P(new (65535<a.count?Uint32Array:Uint16Array)(d),1);t(d,c.ELEMENT_ARRAY_BUFFER);return b.wireframe=d},update:function(h){var a=b.get(h);h.geometry.isGeometry&&a.updateFromObject(h);h=a.index;var d=a.attributes;null!==h&&t(h,c.ELEMENT_ARRAY_BUFFER);for(var y in d)t(d[y],c.ARRAY_BUFFER);h=a.morphAttributes;for(y in h){d=
h[y];for(var e=0,C=d.length;e<C;e++)t(d[e],c.ARRAY_BUFFER)}return a}}}function Kd(c,h,a,b,d,e,f){function t(c,h){if(c.width>h||c.height>h){var a=h/Math.max(c.width,c.height),t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");t.width=Math.floor(c.width*a);t.height=Math.floor(c.height*a);t.getContext("2d").drawImage(c,0,0,c.width,c.height,0,0,t.width,t.height);console.warn("THREE.WebGLRenderer: image is too big ("+c.width+"x"+c.height+"). Resized to "+t.width+"x"+t.height,c);return t}return c}
function y(c){return l.Math.isPowerOfTwo(c.width)&&l.Math.isPowerOfTwo(c.height)}function C(h){return 1003===h||1004===h||1005===h?c.NEAREST:c.LINEAR}function k(h){h=h.target;h.removeEventListener("dispose",k);a:{var a=b.get(h);if(h.image&&a.__image__webglTextureCube)c.deleteTexture(a.__image__webglTextureCube);else{if(void 0===a.__webglInit)break a;c.deleteTexture(a.__webglTexture)}b["delete"](h)}r.textures--}function g(h){h=h.target;h.removeEventListener("dispose",g);var a=b.get(h),t=b.get(h.texture);
if(h){void 0!==t.__webglTexture&&c.deleteTexture(t.__webglTexture);h.depthTexture&&h.depthTexture.dispose();if(h&&h.isWebGLRenderTargetCube)for(t=0;6>t;t++)c.deleteFramebuffer(a.__webglFramebuffer[t]),a.__webglDepthbuffer&&c.deleteRenderbuffer(a.__webglDepthbuffer[t]);else c.deleteFramebuffer(a.__webglFramebuffer),a.__webglDepthbuffer&&c.deleteRenderbuffer(a.__webglDepthbuffer);b["delete"](h.texture);b["delete"](h)}r.textures--}function M(h,C){var f=b.get(h);if(0<h.version&&f.__version!==h.version){var g=
h.image;if(void 0===g)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",h);else if(!1===g.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",h);else{void 0===f.__webglInit&&(f.__webglInit=!0,h.addEventListener("dispose",k),f.__webglTexture=c.createTexture(),r.textures++);a.activeTexture(c.TEXTURE0+C);a.bindTexture(c.TEXTURE_2D,f.__webglTexture);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,h.flipY);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
h.premultiplyAlpha);c.pixelStorei(c.UNPACK_ALIGNMENT,h.unpackAlignment);var M=t(h.image,d.maxTextureSize);if((1001!==h.wrapS||1001!==h.wrapT||1003!==h.minFilter&&1006!==h.minFilter)&&!1===y(M))if(g=M,g instanceof HTMLImageElement||g instanceof HTMLCanvasElement){var n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=l.Math.nearestPowerOfTwo(g.width);n.height=l.Math.nearestPowerOfTwo(g.height);n.getContext("2d").drawImage(g,0,0,n.width,n.height);console.warn("THREE.WebGLRenderer: image is not power of two ("+
g.width+"x"+g.height+"). Resized to "+n.width+"x"+n.height,g);M=n}else M=g;g=y(M);n=e(h.format);var m=e(h.type);aa(c.TEXTURE_2D,h,g);var q=h.mipmaps;if(h&&h.isDepthTexture){q=c.DEPTH_COMPONENT;if(1015===h.type){if(!p)throw Error("Float Depth Texture only supported in WebGL2.0");q=c.DEPTH_COMPONENT32F}else p&&(q=c.DEPTH_COMPONENT16);1027===h.format&&(q=c.DEPTH_STENCIL);a.texImage2D(c.TEXTURE_2D,0,q,M.width,M.height,0,n,m,null)}else if(h&&h.isDataTexture)if(0<q.length&&g){for(var Y=0,v=q.length;Y<v;Y++)M=
q[Y],a.texImage2D(c.TEXTURE_2D,Y,n,M.width,M.height,0,n,m,M.data);h.generateMipmaps=!1}else a.texImage2D(c.TEXTURE_2D,0,n,M.width,M.height,0,n,m,M.data);else if(h&&h.isCompressedTexture)for(Y=0,v=q.length;Y<v;Y++)M=q[Y],1023!==h.format&&1022!==h.format?-1<a.getCompressedTextureFormats().indexOf(n)?a.compressedTexImage2D(c.TEXTURE_2D,Y,n,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):a.texImage2D(c.TEXTURE_2D,
Y,n,M.width,M.height,0,n,m,M.data);else if(0<q.length&&g){Y=0;for(v=q.length;Y<v;Y++)M=q[Y],a.texImage2D(c.TEXTURE_2D,Y,n,n,m,M);h.generateMipmaps=!1}else a.texImage2D(c.TEXTURE_2D,0,n,n,m,M);h.generateMipmaps&&g&&c.generateMipmap(c.TEXTURE_2D);f.__version=h.version;if(h.onUpdate)h.onUpdate(h);return}}a.activeTexture(c.TEXTURE0+C);a.bindTexture(c.TEXTURE_2D,f.__webglTexture)}function aa(a,t,y){y?(c.texParameteri(a,c.TEXTURE_WRAP_S,e(t.wrapS)),c.texParameteri(a,c.TEXTURE_WRAP_T,e(t.wrapT)),c.texParameteri(a,
c.TEXTURE_MAG_FILTER,e(t.magFilter)),c.texParameteri(a,c.TEXTURE_MIN_FILTER,e(t.minFilter))):(c.texParameteri(a,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(a,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),1001===t.wrapS&&1001===t.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",t),c.texParameteri(a,c.TEXTURE_MAG_FILTER,C(t.magFilter)),c.texParameteri(a,c.TEXTURE_MIN_FILTER,C(t.minFilter)),1003!==t.minFilter&&
1006!==t.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",t));!(y=h.get("EXT_texture_filter_anisotropic"))||1015===t.type&&null===h.get("OES_texture_float_linear")||1016===t.type&&null===h.get("OES_texture_half_float_linear")||!(1<t.anisotropy||b.get(t).__currentAnisotropy)||(c.texParameterf(a,y.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,d.getMaxAnisotropy())),b.get(t).__currentAnisotropy=
t.anisotropy)}function n(h,t,d,y){var C=e(t.texture.format),f=e(t.texture.type);a.texImage2D(y,0,C,t.width,t.height,0,C,f,null);c.bindFramebuffer(c.FRAMEBUFFER,h);c.framebufferTexture2D(c.FRAMEBUFFER,d,y,b.get(t.texture).__webglTexture,0);c.bindFramebuffer(c.FRAMEBUFFER,null)}function m(h,a){c.bindRenderbuffer(c.RENDERBUFFER,h);a.depthBuffer&&!a.stencilBuffer?(c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,a.width,a.height),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,
h)):a.depthBuffer&&a.stencilBuffer?(c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_STENCIL,a.width,a.height),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,h)):c.renderbufferStorage(c.RENDERBUFFER,c.RGBA4,a.width,a.height);c.bindRenderbuffer(c.RENDERBUFFER,null)}var r=f.memory,p="undefined"!==typeof WebGL2RenderingContext&&c instanceof WebGL2RenderingContext;this.setTexture2D=M;this.setTextureCube=function(h,C){var f=b.get(h);if(6===h.image.length)if(0<h.version&&
f.__version!==h.version){f.__image__webglTextureCube||(h.addEventListener("dispose",k),f.__image__webglTextureCube=c.createTexture(),r.textures++);a.activeTexture(c.TEXTURE0+C);a.bindTexture(c.TEXTURE_CUBE_MAP,f.__image__webglTextureCube);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,h.flipY);for(var g=h&&h.isCompressedTexture,M=h.image[0]&&h.image[0].isDataTexture,l=[],n=0;6>n;n++)l[n]=g||M?M?h.image[n].image:h.image[n]:t(h.image[n],d.maxCubemapSize);var m=y(l[0]),p=e(h.format),q=e(h.type);aa(c.TEXTURE_CUBE_MAP,
h,m);for(n=0;6>n;n++)if(g)for(var Y,v=l[n].mipmaps,ka=0,Ba=v.length;ka<Ba;ka++)Y=v[ka],1023!==h.format&&1022!==h.format?-1<a.getCompressedTextureFormats().indexOf(p)?a.compressedTexImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+n,ka,p,Y.width,Y.height,0,Y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):a.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+n,ka,p,Y.width,Y.height,0,p,q,Y.data);else M?a.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,p,
l[n].width,l[n].height,0,p,q,l[n].data):a.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,p,p,q,l[n]);h.generateMipmaps&&m&&c.generateMipmap(c.TEXTURE_CUBE_MAP);f.__version=h.version;if(h.onUpdate)h.onUpdate(h)}else a.activeTexture(c.TEXTURE0+C),a.bindTexture(c.TEXTURE_CUBE_MAP,f.__image__webglTextureCube)};this.setTextureCubeDynamic=function(h,t){a.activeTexture(c.TEXTURE0+t);a.bindTexture(c.TEXTURE_CUBE_MAP,b.get(h).__webglTexture)};this.setupRenderTarget=function(h){var t=b.get(h),d=b.get(h.texture);
h.addEventListener("dispose",g);d.__webglTexture=c.createTexture();r.textures++;var e=h&&h.isWebGLRenderTargetCube,C=y(h);if(e){t.__webglFramebuffer=[];for(var f=0;6>f;f++)t.__webglFramebuffer[f]=c.createFramebuffer()}else t.__webglFramebuffer=c.createFramebuffer();if(e){a.bindTexture(c.TEXTURE_CUBE_MAP,d.__webglTexture);aa(c.TEXTURE_CUBE_MAP,h.texture,C);for(f=0;6>f;f++)n(t.__webglFramebuffer[f],h,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+f);h.texture.generateMipmaps&&C&&c.generateMipmap(c.TEXTURE_CUBE_MAP);
a.bindTexture(c.TEXTURE_CUBE_MAP,null)}else a.bindTexture(c.TEXTURE_2D,d.__webglTexture),aa(c.TEXTURE_2D,h.texture,C),n(t.__webglFramebuffer,h,c.COLOR_ATTACHMENT0,c.TEXTURE_2D),h.texture.generateMipmaps&&C&&c.generateMipmap(c.TEXTURE_2D),a.bindTexture(c.TEXTURE_2D,null);if(h.depthBuffer){t=b.get(h);d=h&&h.isWebGLRenderTargetCube;if(h.depthTexture){if(d)throw Error("target.depthTexture not supported in Cube render targets");if(h&&h.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported!");
c.bindFramebuffer(c.FRAMEBUFFER,t.__webglFramebuffer);if(!h.depthTexture||!h.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");b.get(h.depthTexture).__webglTexture&&h.depthTexture.image.width===h.width&&h.depthTexture.image.height===h.height||(h.depthTexture.image.width=h.width,h.depthTexture.image.height=h.height,h.depthTexture.needsUpdate=!0);M(h.depthTexture,0);t=b.get(h.depthTexture).__webglTexture;if(1026===h.depthTexture.format)c.framebufferTexture2D(c.FRAMEBUFFER,
c.DEPTH_ATTACHMENT,c.TEXTURE_2D,t,0);else if(1027===h.depthTexture.format)c.framebufferTexture2D(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.TEXTURE_2D,t,0);else throw Error("Unknown depthTexture format");}else if(d)for(t.__webglDepthbuffer=[],d=0;6>d;d++)c.bindFramebuffer(c.FRAMEBUFFER,t.__webglFramebuffer[d]),t.__webglDepthbuffer[d]=c.createRenderbuffer(),m(t.__webglDepthbuffer[d],h);else c.bindFramebuffer(c.FRAMEBUFFER,t.__webglFramebuffer),t.__webglDepthbuffer=c.createRenderbuffer(),m(t.__webglDepthbuffer,
h);c.bindFramebuffer(c.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=function(h){var t=h.texture;t.generateMipmaps&&y(h)&&1003!==t.minFilter&&1006!==t.minFilter&&(h=h&&h.isWebGLRenderTargetCube?c.TEXTURE_CUBE_MAP:c.TEXTURE_2D,t=b.get(t).__webglTexture,a.bindTexture(h,t),c.generateMipmap(h),a.bindTexture(h,null))}}function Ld(){var c={};return{get:function(h){h=h.uuid;var a=c[h];void 0===a&&(a={},c[h]=a);return a},"delete":function(h){delete c[h.uuid]},clear:function(){c={}}}}function kd(c,h,t){function b(h,
a,t){var b=new Uint8Array(4),d=c.createTexture();c.bindTexture(h,d);c.texParameteri(h,c.TEXTURE_MIN_FILTER,c.NEAREST);c.texParameteri(h,c.TEXTURE_MAG_FILTER,c.NEAREST);for(h=0;h<t;h++)c.texImage2D(a+h,0,c.RGBA,1,1,0,c.RGBA,c.UNSIGNED_BYTE,b);return d}function d(h){!0!==A[h]&&(c.enable(h),A[h]=!0)}function e(h){!1!==A[h]&&(c.disable(h),A[h]=!1)}function f(h,a,b,y,C,f,g,k){if(0!==h){d(c.BLEND);if(h!==F||k!==T)2===h?k?(c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.ONE,c.ONE,c.ONE,
c.ONE)):(c.blendEquation(c.FUNC_ADD),c.blendFunc(c.SRC_ALPHA,c.ONE)):3===h?k?(c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.ZERO,c.ZERO,c.ONE_MINUS_SRC_COLOR,c.ONE_MINUS_SRC_ALPHA)):(c.blendEquation(c.FUNC_ADD),c.blendFunc(c.ZERO,c.ONE_MINUS_SRC_COLOR)):4===h?k?(c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.ZERO,c.SRC_COLOR,c.ZERO,c.SRC_ALPHA)):(c.blendEquation(c.FUNC_ADD),c.blendFunc(c.ZERO,c.SRC_COLOR)):k?(c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),
c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)):(c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)),F=h,T=k;if(5===h){C=C||a;f=f||b;g=g||y;if(a!==R||C!==ea)c.blendEquationSeparate(t(a),t(C)),R=a,ea=C;if(b!==E||y!==G||f!==K||g!==H)c.blendFuncSeparate(t(b),t(y),t(f),t(g)),E=b,G=y,K=f,H=g}else H=K=ea=G=E=R=null}else e(c.BLEND),F=h}function g(c){v.setFunc(c)}function k(h){L!==h&&(h?c.frontFace(c.CW):
c.frontFace(c.CCW),L=h)}function l(h){0!==h?(d(c.CULL_FACE),h!==P&&(1===h?c.cullFace(c.BACK):2===h?c.cullFace(c.FRONT):c.cullFace(c.FRONT_AND_BACK))):e(c.CULL_FACE);P=h}function n(h){void 0===h&&(h=c.TEXTURE0+O-1);J!==h&&(c.activeTexture(h),J=h)}function m(c,h,a,t){q.setClear(c,h,a,t)}function r(c){v.setClear(c)}function p(c){u.setClear(c)}var q=new function(){var h=!1,t=new a,b=null,d=new a;return{setMask:function(a){b===a||h||(c.colorMask(a,a,a,a),b=a)},setLocked:function(c){h=c},setClear:function(h,
a,b,y){t.set(h,a,b,y);!1===d.equals(t)&&(c.clearColor(h,a,b,y),d.copy(t))},reset:function(){h=!1;b=null;d.set(0,0,0,1)}}},v=new function(){var h=!1,a=null,t=null,b=null;return{setTest:function(h){h?d(c.DEPTH_TEST):e(c.DEPTH_TEST)},setMask:function(t){a===t||h||(c.depthMask(t),a=t)},setFunc:function(h){if(t!==h){if(h)switch(h){case 0:c.depthFunc(c.NEVER);break;case 1:c.depthFunc(c.ALWAYS);break;case 2:c.depthFunc(c.LESS);break;case 3:c.depthFunc(c.LEQUAL);break;case 4:c.depthFunc(c.EQUAL);break;case 5:c.depthFunc(c.GEQUAL);
break;case 6:c.depthFunc(c.GREATER);break;case 7:c.depthFunc(c.NOTEQUAL);break;default:c.depthFunc(c.LEQUAL)}else c.depthFunc(c.LEQUAL);t=h}},setLocked:function(c){h=c},setClear:function(h){b!==h&&(c.clearDepth(h),b=h)},reset:function(){h=!1;b=t=a=null}}},u=new function(){var h=!1,a=null,t=null,b=null,y=null,C=null,f=null,g=null,k=null;return{setTest:function(h){h?d(c.STENCIL_TEST):e(c.STENCIL_TEST)},setMask:function(t){a===t||h||(c.stencilMask(t),a=t)},setFunc:function(h,a,d){if(t!==h||b!==a||y!==
d)c.stencilFunc(h,a,d),t=h,b=a,y=d},setOp:function(h,a,t){if(C!==h||f!==a||g!==t)c.stencilOp(h,a,t),C=h,f=a,g=t},setLocked:function(c){h=c},setClear:function(h){k!==h&&(c.clearStencil(h),k=h)},reset:function(){h=!1;k=g=f=C=y=b=t=a=null}}},w=c.getParameter(c.MAX_VERTEX_ATTRIBS),x=new Uint8Array(w),B=new Uint8Array(w),z=new Uint8Array(w),A={},D=null,F=null,R=null,E=null,G=null,ea=null,K=null,H=null,T=!1,L=null,P=null,Q=null,S=null,ca=null,U=null,O=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS),J=null,I=
{},ha=new a,Z=new a,V={};V[c.TEXTURE_2D]=b(c.TEXTURE_2D,c.TEXTURE_2D,1);V[c.TEXTURE_CUBE_MAP]=b(c.TEXTURE_CUBE_MAP,c.TEXTURE_CUBE_MAP_POSITIVE_X,6);return{buffers:{color:q,depth:v,stencil:u},init:function(){m(0,0,0,1);r(1);p(0);d(c.DEPTH_TEST);g(3);k(!1);l(1);d(c.CULL_FACE);d(c.BLEND);f(1)},initAttributes:function(){for(var c=0,h=x.length;c<h;c++)x[c]=0},enableAttribute:function(a){x[a]=1;0===B[a]&&(c.enableVertexAttribArray(a),B[a]=1);0!==z[a]&&(h.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(a,
0),z[a]=0)},enableAttributeAndDivisor:function(h,a,t){x[h]=1;0===B[h]&&(c.enableVertexAttribArray(h),B[h]=1);z[h]!==a&&(t.vertexAttribDivisorANGLE(h,a),z[h]=a)},disableUnusedAttributes:function(){for(var h=0,a=B.length;h!==a;++h)B[h]!==x[h]&&(c.disableVertexAttribArray(h),B[h]=0)},enable:d,disable:e,getCompressedTextureFormats:function(){if(null===D&&(D=[],h.get("WEBGL_compressed_texture_pvrtc")||h.get("WEBGL_compressed_texture_s3tc")||h.get("WEBGL_compressed_texture_etc1")))for(var a=c.getParameter(c.COMPRESSED_TEXTURE_FORMATS),
t=0;t<a.length;t++)D.push(a[t]);return D},setBlending:f,setColorWrite:function(c){q.setMask(c)},setDepthTest:function(c){v.setTest(c)},setDepthWrite:function(c){v.setMask(c)},setDepthFunc:g,setStencilTest:function(c){u.setTest(c)},setStencilWrite:function(c){u.setMask(c)},setStencilFunc:function(c,h,a){u.setFunc(c,h,a)},setStencilOp:function(c,h,a){u.setOp(c,h,a)},setFlipSided:k,setCullFace:l,setLineWidth:function(h){h!==Q&&(c.lineWidth(h),Q=h)},setPolygonOffset:function(h,a,t){if(h){if(d(c.POLYGON_OFFSET_FILL),
S!==a||ca!==t)c.polygonOffset(a,t),S=a,ca=t}else e(c.POLYGON_OFFSET_FILL)},getScissorTest:function(){return U},setScissorTest:function(h){(U=h)?d(c.SCISSOR_TEST):e(c.SCISSOR_TEST)},activeTexture:n,bindTexture:function(h,a){null===J&&n();var t=I[J];void 0===t&&(t={type:void 0,texture:void 0},I[J]=t);if(t.type!==h||t.texture!==a)c.bindTexture(h,a||V[h]),t.type=h,t.texture=a},compressedTexImage2D:function(){try{c.compressedTexImage2D.apply(c,arguments)}catch(Pd){console.error(Pd)}},texImage2D:function(){try{c.texImage2D.apply(c,
arguments)}catch(Pd){console.error(Pd)}},clearColor:m,clearDepth:r,clearStencil:p,scissor:function(h){!1===ha.equals(h)&&(c.scissor(h.x,h.y,h.z,h.w),ha.copy(h))},viewport:function(h){!1===Z.equals(h)&&(c.viewport(h.x,h.y,h.z,h.w),Z.copy(h))},reset:function(){for(var h=0;h<B.length;h++)1===B[h]&&(c.disableVertexAttribArray(h),B[h]=0);A={};J=D=null;I={};P=L=F=null;q.reset();v.reset();u.reset()}}}function Md(c,h,a){function t(h){if("highp"===h){if(0<c.getShaderPrecisionFormat(c.VERTEX_SHADER,c.HIGH_FLOAT).precision&&
0<c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.HIGH_FLOAT).precision)return"highp";h="mediump"}return"mediump"===h&&0<c.getShaderPrecisionFormat(c.VERTEX_SHADER,c.MEDIUM_FLOAT).precision&&0<c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.MEDIUM_FLOAT).precision?"mediump":"lowp"}var b,d=void 0!==a.precision?a.precision:"highp",e=t(d);e!==d&&(console.warn("THREE.WebGLRenderer:",d,"not supported, using",e,"instead."),d=e);a=!0===a.logarithmicDepthBuffer&&!!h.get("EXT_frag_depth");e=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS);
var f=c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS),g=c.getParameter(c.MAX_TEXTURE_SIZE),k=c.getParameter(c.MAX_CUBE_MAP_TEXTURE_SIZE),l=c.getParameter(c.MAX_VERTEX_ATTRIBS),n=c.getParameter(c.MAX_VERTEX_UNIFORM_VECTORS),m=c.getParameter(c.MAX_VARYING_VECTORS),r=c.getParameter(c.MAX_FRAGMENT_UNIFORM_VECTORS),p=0<f,q=!!h.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==b)return b;var a=h.get("EXT_texture_filter_anisotropic");return b=null!==a?c.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY_EXT):
0},getMaxPrecision:t,precision:d,logarithmicDepthBuffer:a,maxTextures:e,maxVertexTextures:f,maxTextureSize:g,maxCubemapSize:k,maxAttributes:l,maxVertexUniforms:n,maxVaryings:m,maxFragmentUniforms:r,vertexTextures:p,floatFragmentTextures:q,floatVertexTextures:p&&q}}function Nd(c){var h={};return{get:function(a){if(void 0!==h[a])return h[a];switch(a){case "WEBGL_depth_texture":var t=c.getExtension("WEBGL_depth_texture")||c.getExtension("MOZ_WEBGL_depth_texture")||c.getExtension("WEBKIT_WEBGL_depth_texture");
break;case "EXT_texture_filter_anisotropic":t=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":t=c.getExtension("WEBGL_compressed_texture_s3tc")||c.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||c.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":t=c.getExtension("WEBGL_compressed_texture_pvrtc")||
c.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":t=c.getExtension("WEBGL_compressed_texture_etc1");break;default:t=c.getExtension(a)}null===t&&console.warn("THREE.WebGLRenderer: "+a+" extension not supported.");return h[a]=t}}}function qb(){function c(){l.value!==b&&(l.value=b,l.needsUpdate=0<d);a.numPlanes=d}function h(c,h,t,b){var d=null!==c?c.length:0,y=null;if(0!==d){y=l.value;if(!0!==b||null===y){b=t+4*d;h=h.matrixWorldInverse;k.getNormalMatrix(h);
if(null===y||y.length<b)y=new Float32Array(b);for(b=0;b!==d;++b,t+=4)g.copy(c[b]).applyMatrix4(h,k),g.normal.toArray(y,t),y[t+3]=g.constant}l.value=y;l.needsUpdate=!0}a.numPlanes=d;return y}var a=this,b=null,d=0,e=!1,f=!1,g=new ya,k=new va,l={value:null,needsUpdate:!1};this.uniform=l;this.numPlanes=0;this.init=function(c,a,t){var y=0!==c.length||a||0!==d||e;e=a;b=h(c,t,0);d=c.length;return y};this.beginShadows=function(){f=!0;h(null)};this.endShadows=function(){f=!1;c()};this.setState=function(a,
t,y,C,g){if(!e||null===a||0===a.length||f&&!t)f?h(null):c();else{t=f?0:d;var k=4*t,M=C.clippingState||null;l.value=M;M=h(a,y,k,g);for(a=0;a!==k;++a)M[a]=b[a];C.clippingState=M;this.numPlanes+=t}}}function db(c){function h(c,h,a,t){!0===ea&&(c*=t,h*=t,a*=t);xa.clearColor(c,h,a,t)}function t(){xa.init();xa.scissor(W.copy(Ga).multiplyScalar(va));xa.viewport(ba.copy(bb).multiplyScalar(va));h(X.r,X.g,X.b,qa)}function b(){fa=O=null;sa="";Z=-1;xa.reset()}function d(c){c.preventDefault();b();t();ra.clear()}
function e(c){c=c.target;c.removeEventListener("dispose",e);g(c);ra["delete"](c)}function g(c){var h=ra.get(c).program;c.program=void 0;void 0!==h&&Fa.releaseProgram(h)}function k(c,h){return Math.abs(h[0])-Math.abs(c[0])}function n(c,h){return c.object.renderOrder!==h.object.renderOrder?c.object.renderOrder-h.object.renderOrder:c.material.program&&h.material.program&&c.material.program!==h.material.program?c.material.program.id-h.material.program.id:c.material.id!==h.material.id?c.material.id-h.material.id:
c.z!==h.z?c.z-h.z:c.id-h.id}function m(c,h){return c.object.renderOrder!==h.object.renderOrder?c.object.renderOrder-h.object.renderOrder:c.z!==h.z?h.z-c.z:c.id-h.id}function r(c,h,a,t,b){var d;a.transparent?(t=P,d=++Q):(t=T,d=++L);d=t[d];void 0!==d?(d.id=c.id,d.object=c,d.geometry=h,d.material=a,d.z=Xa.z,d.group=b):(d={id:c.id,object:c,geometry:h,material:a,z:Xa.z,group:b},t.push(d))}function q(c){if(!Wa.intersectsSphere(c))return!1;var h=Ea.numPlanes;if(0===h)return!0;var a=U.clippingPlanes,t=c.center;
c=-c.radius;var b=0;do if(a[b].distanceToPoint(t)<c)return!1;while(++b!==h);return!0}function v(c,h){if(!1!==c.visible){if(0!==(c.layers.mask&h.layers.mask))if(c.isLight)H.push(c);else if(c.isSprite){var a;(a=!1===c.frustumCulled)||(Ya.center.set(0,0,0),Ya.radius=.7071067811865476,Ya.applyMatrix4(c.matrixWorld),a=!0===q(Ya));a&&ca.push(c)}else if(c.isLensFlare)J.push(c);else if(c.isImmediateRenderObject)!0===U.sortObjects&&(Xa.setFromMatrixPosition(c.matrixWorld),Xa.applyProjection(Ia)),r(c,null,
c.material,Xa.z,null);else if(c.isMesh||c.isLine||c.isPoints)if(c.isSkinnedMesh&&c.skeleton.update(),(a=!1===c.frustumCulled)||(a=c.geometry,null===a.boundingSphere&&a.computeBoundingSphere(),Ya.copy(a.boundingSphere).applyMatrix4(c.matrixWorld),a=!0===q(Ya)),a){var t=c.material;if(!0===t.visible)if(!0===U.sortObjects&&(Xa.setFromMatrixPosition(c.matrixWorld),Xa.applyProjection(Ia)),a=Kb.update(c),t.isMultiMaterial){var b=a.groups,d=t.materials;t=0;for(var y=b.length;t<y;t++){var e=b[t],C=d[e.materialIndex];
!0===C.visible&&r(c,a,C,Xa.z,e)}}else r(c,a,t,Xa.z,null)}a=c.children;t=0;for(y=a.length;t<y;t++)v(a[t],h)}}function u(c,h,a,t){for(var b=0,d=c.length;b<d;b++){var y=c[b],e=y.object,C=y.geometry,f=void 0===t?y.material:t;y=y.group;e.modelViewMatrix.multiplyMatrices(h.matrixWorldInverse,e.matrixWorld);e.normalMatrix.getNormalMatrix(e.modelViewMatrix);if(e.isImmediateRenderObject){x(f);var g=w(h,a,f,e);sa="";e.render(function(c){U.renderBufferImmediate(c,g,f)})}else{if(null!==e.onBeforeRender)e.onBeforeRender();
U.renderBufferDirect(h,a,C,f,e,y)}}}function x(c){2===c.side?xa.disable(N.CULL_FACE):xa.enable(N.CULL_FACE);xa.setFlipSided(1===c.side);!0===c.transparent?xa.setBlending(c.blending,c.blendEquation,c.blendSrc,c.blendDst,c.blendEquationAlpha,c.blendSrcAlpha,c.blendDstAlpha,c.premultipliedAlpha):xa.setBlending(0);xa.setDepthFunc(c.depthFunc);xa.setDepthTest(c.depthTest);xa.setDepthWrite(c.depthWrite);xa.setColorWrite(c.colorWrite);xa.setPolygonOffset(c.polygonOffset,c.polygonOffsetFactor,c.polygonOffsetUnits)}
function w(c,h,a,t){ma=0;var b=ra.get(a);Oa&&(ya||c!==fa)&&Ea.setState(a.clippingPlanes,a.clipShadows,c,b,c===fa&&a.id===Z);!1===a.needsUpdate&&(void 0===b.program?a.needsUpdate=!0:a.fog&&b.fog!==h?a.needsUpdate=!0:a.lights&&b.lightsHash!==pa.hash?a.needsUpdate=!0:void 0!==b.numClippingPlanes&&b.numClippingPlanes!==Ea.numPlanes&&(a.needsUpdate=!0));if(a.needsUpdate){a:{var d=ra.get(a),y=Fa.getParameters(a,pa,h,Ea.numPlanes,t),C=Fa.getProgramCode(a,y),f=d.program,k=!0;if(void 0===f)a.addEventListener("dispose",
e);else if(f.code!==C)g(a);else if(void 0!==y.shaderID)break a;else k=!1;k&&(y.shaderID?(f=Xc[y.shaderID],d.__webglShader={name:a.type,uniforms:l.UniformsUtils.clone(f.uniforms),vertexShader:f.vertexShader,fragmentShader:f.fragmentShader}):d.__webglShader={name:a.type,uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader},a.__webglShader=d.__webglShader,f=Fa.acquireProgram(a,y,C),d.program=f,a.program=f);y=f.getAttributes();if(a.morphTargets)for(C=a.numSupportedMorphTargets=
0;C<U.maxMorphTargets;C++)0<=y["morphTarget"+C]&&a.numSupportedMorphTargets++;if(a.morphNormals)for(C=a.numSupportedMorphNormals=0;C<U.maxMorphNormals;C++)0<=y["morphNormal"+C]&&a.numSupportedMorphNormals++;y=d.__webglShader.uniforms;if(!a.isShaderMaterial&&!a.isRawShaderMaterial||!0===a.clipping)d.numClippingPlanes=Ea.numPlanes,y.clippingPlanes=Ea.uniform;d.fog=h;d.lightsHash=pa.hash;a.lights&&(y.ambientLightColor.value=pa.ambient,y.directionalLights.value=pa.directional,y.spotLights.value=pa.spot,
y.pointLights.value=pa.point,y.hemisphereLights.value=pa.hemi,y.directionalShadowMap.value=pa.directionalShadowMap,y.directionalShadowMatrix.value=pa.directionalShadowMatrix,y.spotShadowMap.value=pa.spotShadowMap,y.spotShadowMatrix.value=pa.spotShadowMatrix,y.pointShadowMap.value=pa.pointShadowMap,y.pointShadowMatrix.value=pa.pointShadowMatrix);C=d.program.getUniforms();C=ja.seqWithValue(C.seq,y);d.uniformsList=C;d.dynamicUniforms=ja.splitDynamic(C,y)}a.needsUpdate=!1}var M=!1;k=f=!1;d=b.program;
C=d.getUniforms();y=b.__webglShader.uniforms;d.id!==O&&(N.useProgram(d.program),O=d.id,k=f=M=!0);a.id!==Z&&(Z=a.id,f=!0);if(M||c!==fa){C.set(N,c,"projectionMatrix");ua.logarithmicDepthBuffer&&C.setValue(N,"logDepthBufFC",2/(Math.log(c.far+1)/Math.LN2));c!==fa&&(fa=c,k=f=!0);if(a.isShaderMaterial||a.isMeshPhongMaterial||a.isMeshStandardMaterial||a.envMap)M=C.map.cameraPosition,void 0!==M&&M.setValue(N,Xa.setFromMatrixPosition(c.matrixWorld));(a.isMeshPhongMaterial||a.isMeshLambertMaterial||a.isMeshBasicMaterial||
a.isMeshStandardMaterial||a.isShaderMaterial||a.skinning)&&C.setValue(N,"viewMatrix",c.matrixWorldInverse);C.set(N,U,"toneMappingExposure");C.set(N,U,"toneMappingWhitePoint")}a.skinning&&(C.setOptional(N,t,"bindMatrix"),C.setOptional(N,t,"bindMatrixInverse"),M=t.skeleton)&&(ua.floatVertexTextures&&M.useVertexTexture?(C.set(N,M,"boneTexture"),C.set(N,M,"boneTextureWidth"),C.set(N,M,"boneTextureHeight")):C.setOptional(N,M,"boneMatrices"));if(f){a.lights&&(f=k,y.ambientLightColor.needsUpdate=f,y.directionalLights.needsUpdate=
f,y.pointLights.needsUpdate=f,y.spotLights.needsUpdate=f,y.hemisphereLights.needsUpdate=f);h&&a.fog&&(y.fogColor.value=h.color,h.isFog?(y.fogNear.value=h.near,y.fogFar.value=h.far):h.isFogExp2&&(y.fogDensity.value=h.density));if(a.isMeshBasicMaterial||a.isMeshLambertMaterial||a.isMeshPhongMaterial||a.isMeshStandardMaterial||a.isMeshDepthMaterial){y.opacity.value=a.opacity;y.diffuse.value=a.color;a.emissive&&y.emissive.value.copy(a.emissive).multiplyScalar(a.emissiveIntensity);y.map.value=a.map;y.specularMap.value=
a.specularMap;y.alphaMap.value=a.alphaMap;a.aoMap&&(y.aoMap.value=a.aoMap,y.aoMapIntensity.value=a.aoMapIntensity);var aa;a.map?aa=a.map:a.specularMap?aa=a.specularMap:a.displacementMap?aa=a.displacementMap:a.normalMap?aa=a.normalMap:a.bumpMap?aa=a.bumpMap:a.roughnessMap?aa=a.roughnessMap:a.metalnessMap?aa=a.metalnessMap:a.alphaMap?aa=a.alphaMap:a.emissiveMap&&(aa=a.emissiveMap);void 0!==aa&&(aa.isWebGLRenderTarget&&(aa=aa.texture),h=aa.offset,aa=aa.repeat,y.offsetRepeat.value.set(h.x,h.y,aa.x,aa.y));
y.envMap.value=a.envMap;y.flipEnvMap.value=a.envMap&&a.envMap.isCubeTexture?-1:1;y.reflectivity.value=a.reflectivity;y.refractionRatio.value=a.refractionRatio}a.isLineBasicMaterial?(y.diffuse.value=a.color,y.opacity.value=a.opacity):a.isLineDashedMaterial?(y.diffuse.value=a.color,y.opacity.value=a.opacity,y.dashSize.value=a.dashSize,y.totalSize.value=a.dashSize+a.gapSize,y.scale.value=a.scale):a.isPointsMaterial?(y.diffuse.value=a.color,y.opacity.value=a.opacity,y.size.value=a.size*va,y.scale.value=
.5*z.clientHeight,y.map.value=a.map,null!==a.map&&(aa=a.map.offset,h=a.map.repeat,y.offsetRepeat.value.set(aa.x,aa.y,h.x,h.y))):a.isMeshLambertMaterial?(a.lightMap&&(y.lightMap.value=a.lightMap,y.lightMapIntensity.value=a.lightMapIntensity),a.emissiveMap&&(y.emissiveMap.value=a.emissiveMap)):a.isMeshPhongMaterial?(y.specular.value=a.specular,y.shininess.value=Math.max(a.shininess,1E-4),a.lightMap&&(y.lightMap.value=a.lightMap,y.lightMapIntensity.value=a.lightMapIntensity),a.emissiveMap&&(y.emissiveMap.value=
a.emissiveMap),a.bumpMap&&(y.bumpMap.value=a.bumpMap,y.bumpScale.value=a.bumpScale),a.normalMap&&(y.normalMap.value=a.normalMap,y.normalScale.value.copy(a.normalScale)),a.displacementMap&&(y.displacementMap.value=a.displacementMap,y.displacementScale.value=a.displacementScale,y.displacementBias.value=a.displacementBias)):a.isMeshPhysicalMaterial?(y.clearCoat.value=a.clearCoat,y.clearCoatRoughness.value=a.clearCoatRoughness,B(y,a)):a.isMeshStandardMaterial?B(y,a):a.isMeshDepthMaterial?a.displacementMap&&
(y.displacementMap.value=a.displacementMap,y.displacementScale.value=a.displacementScale,y.displacementBias.value=a.displacementBias):a.isMeshNormalMaterial&&(y.opacity.value=a.opacity);ja.upload(N,b.uniformsList,y,U)}C.set(N,t,"modelViewMatrix");C.set(N,t,"normalMatrix");C.setValue(N,"modelMatrix",t.matrixWorld);b=b.dynamicUniforms;null!==b&&(ja.evalDynamic(b,y,t,a,c),ja.upload(N,b,y,U));return d}function B(c,h){c.roughness.value=h.roughness;c.metalness.value=h.metalness;h.roughnessMap&&(c.roughnessMap.value=
h.roughnessMap);h.metalnessMap&&(c.metalnessMap.value=h.metalnessMap);h.lightMap&&(c.lightMap.value=h.lightMap,c.lightMapIntensity.value=h.lightMapIntensity);h.emissiveMap&&(c.emissiveMap.value=h.emissiveMap);h.bumpMap&&(c.bumpMap.value=h.bumpMap,c.bumpScale.value=h.bumpScale);h.normalMap&&(c.normalMap.value=h.normalMap,c.normalScale.value.copy(h.normalScale));h.displacementMap&&(c.displacementMap.value=h.displacementMap,c.displacementScale.value=h.displacementScale,c.displacementBias.value=h.displacementBias);
h.envMap&&(c.envMapIntensity.value=h.envMapIntensity)}function A(c){if(1E3===c)return N.REPEAT;if(1001===c)return N.CLAMP_TO_EDGE;if(1002===c)return N.MIRRORED_REPEAT;if(1003===c)return N.NEAREST;if(1004===c)return N.NEAREST_MIPMAP_NEAREST;if(1005===c)return N.NEAREST_MIPMAP_LINEAR;if(1006===c)return N.LINEAR;if(1007===c)return N.LINEAR_MIPMAP_NEAREST;if(1008===c)return N.LINEAR_MIPMAP_LINEAR;if(1009===c)return N.UNSIGNED_BYTE;if(1017===c)return N.UNSIGNED_SHORT_4_4_4_4;if(1018===c)return N.UNSIGNED_SHORT_5_5_5_1;
if(1019===c)return N.UNSIGNED_SHORT_5_6_5;if(1010===c)return N.BYTE;if(1011===c)return N.SHORT;if(1012===c)return N.UNSIGNED_SHORT;if(1013===c)return N.INT;if(1014===c)return N.UNSIGNED_INT;if(1015===c)return N.FLOAT;var h=Ja.get("OES_texture_half_float");if(null!==h&&1016===c)return h.HALF_FLOAT_OES;if(1021===c)return N.ALPHA;if(1022===c)return N.RGB;if(1023===c)return N.RGBA;if(1024===c)return N.LUMINANCE;if(1025===c)return N.LUMINANCE_ALPHA;if(1026===c)return N.DEPTH_COMPONENT;if(1027===c)return N.DEPTH_STENCIL;
if(100===c)return N.FUNC_ADD;if(101===c)return N.FUNC_SUBTRACT;if(102===c)return N.FUNC_REVERSE_SUBTRACT;if(200===c)return N.ZERO;if(201===c)return N.ONE;if(202===c)return N.SRC_COLOR;if(203===c)return N.ONE_MINUS_SRC_COLOR;if(204===c)return N.SRC_ALPHA;if(205===c)return N.ONE_MINUS_SRC_ALPHA;if(206===c)return N.DST_ALPHA;if(207===c)return N.ONE_MINUS_DST_ALPHA;if(208===c)return N.DST_COLOR;if(209===c)return N.ONE_MINUS_DST_COLOR;if(210===c)return N.SRC_ALPHA_SATURATE;h=Ja.get("WEBGL_compressed_texture_s3tc");
if(null!==h){if(2001===c)return h.COMPRESSED_RGB_S3TC_DXT1_EXT;if(2002===c)return h.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(2003===c)return h.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(2004===c)return h.COMPRESSED_RGBA_S3TC_DXT5_EXT}h=Ja.get("WEBGL_compressed_texture_pvrtc");if(null!==h){if(2100===c)return h.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(2101===c)return h.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(2102===c)return h.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(2103===c)return h.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}h=Ja.get("WEBGL_compressed_texture_etc1");
if(null!==h&&2151===c)return h.COMPRESSED_RGB_ETC1_WEBGL;h=Ja.get("EXT_blend_minmax");if(null!==h){if(103===c)return h.MIN_EXT;if(104===c)return h.MAX_EXT}h=Ja.get("WEBGL_depth_texture");return null!==h&&1020===c?h.UNSIGNED_INT_24_8_WEBGL:0}console.log("THREE.WebGLRenderer","81");c=c||{};var z=void 0!==c.canvas?c.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),D=void 0!==c.context?c.context:null,F=void 0!==c.alpha?c.alpha:!1,R=void 0!==c.depth?c.depth:!0,E=void 0!==c.stencil?
c.stencil:!0,G=void 0!==c.antialias?c.antialias:!1,ea=void 0!==c.premultipliedAlpha?c.premultipliedAlpha:!0,K=void 0!==c.preserveDrawingBuffer?c.preserveDrawingBuffer:!1,H=[],T=[],L=-1,P=[],Q=-1,S=new Float32Array(8),ca=[],J=[];this.domElement=z;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1;this.toneMappingWhitePoint=
this.toneMappingExposure=this.toneMapping=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var U=this,O=null,I=null,ha=null,Z=-1,sa="",fa=null,W=new a,ta=null,ba=new a,ma=0,X=new V(0),qa=0,Ha=z.width,Da=z.height,va=1,Ga=new a(0,0,Ha,Da),Lb=!1,bb=new a(0,0,Ha,Da),Wa=new La,Ea=new qb,Oa=!1,ya=!1,Ya=new za,Ia=new p,Xa=new f,pa={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],
hemi:[],shadows:[]},Fb={calls:0,vertices:0,faces:0,points:0};this.info={render:Fb,memory:{geometries:0,textures:0},programs:null};try{F={alpha:F,depth:R,stencil:E,antialias:G,premultipliedAlpha:ea,preserveDrawingBuffer:K};var N=D||z.getContext("webgl",F)||z.getContext("experimental-webgl",F);if(null===N){if(null!==z.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context.";}void 0===N.getShaderPrecisionFormat&&(N.getShaderPrecisionFormat=
function(){return{rangeMin:1,rangeMax:1,precision:1}});z.addEventListener("webglcontextlost",d,!1)}catch(Ie){console.error("THREE.WebGLRenderer: "+Ie)}var Ja=new Nd(N);Ja.get("WEBGL_depth_texture");Ja.get("OES_texture_float");Ja.get("OES_texture_float_linear");Ja.get("OES_texture_half_float");Ja.get("OES_texture_half_float_linear");Ja.get("OES_standard_derivatives");Ja.get("ANGLE_instanced_arrays");Ja.get("OES_element_index_uint")&&(ia.MaxIndex=4294967296);var ua=new Md(N,Ja,c),xa=new kd(N,Ja,A),
ra=new Ld,sb=new Kd(N,Ja,xa,ra,ua,A,this.info),Kb=new Jd(N,ra,this.info),Fa=new Fe(this,ua),Ka=new yc;this.info.programs=Fa.programs;var Qa=new ub(N,Ja,Fb),Ta=new xc(N,Ja,Fb),Ua=new Gb(-1,1,1,-1,0,1),Ma=new cb,Pa=new Ca(new eb(2,2),new oa({depthTest:!1,depthWrite:!1,fog:!1}));c=Xc.cube;var Na=new Ca(new tb(5,5,5),new Aa({uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}));t();this.context=N;this.capabilities=ua;this.extensions=
Ja;this.properties=ra;this.state=xa;var Za=new Va(this,pa,Kb,ua);this.shadowMap=Za;var $a=new wa(this,ca),ab=new na(this,J);this.getContext=function(){return N};this.getContextAttributes=function(){return N.getContextAttributes()};this.forceContextLoss=function(){Ja.get("WEBGL_lose_context").loseContext()};this.getMaxAnisotropy=function(){return ua.getMaxAnisotropy()};this.getPrecision=function(){return ua.precision};this.getPixelRatio=function(){return va};this.setPixelRatio=function(c){void 0!==
c&&(va=c,this.setSize(bb.z,bb.w,!1))};this.getSize=function(){return{width:Ha,height:Da}};this.setSize=function(c,h,a){Ha=c;Da=h;z.width=c*va;z.height=h*va;!1!==a&&(z.style.width=c+"px",z.style.height=h+"px");this.setViewport(0,0,c,h)};this.setViewport=function(c,h,a,t){xa.viewport(bb.set(c,h,a,t))};this.setScissor=function(c,h,a,t){xa.scissor(Ga.set(c,h,a,t))};this.setScissorTest=function(c){xa.setScissorTest(Lb=c)};this.getClearColor=function(){return X};this.setClearColor=function(c,a){X.set(c);
qa=void 0!==a?a:1;h(X.r,X.g,X.b,qa)};this.getClearAlpha=function(){return qa};this.setClearAlpha=function(c){qa=c;h(X.r,X.g,X.b,qa)};this.clear=function(c,h,a){var t=0;if(void 0===c||c)t|=N.COLOR_BUFFER_BIT;if(void 0===h||h)t|=N.DEPTH_BUFFER_BIT;if(void 0===a||a)t|=N.STENCIL_BUFFER_BIT;N.clear(t)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.clearTarget=function(c,h,a,t){this.setRenderTarget(c);
this.clear(h,a,t)};this.resetGLState=b;this.dispose=function(){P=[];Q=-1;T=[];L=-1;z.removeEventListener("webglcontextlost",d,!1)};this.renderBufferImmediate=function(c,h,a){xa.initAttributes();var t=ra.get(c);c.hasPositions&&!t.position&&(t.position=N.createBuffer());c.hasNormals&&!t.normal&&(t.normal=N.createBuffer());c.hasUvs&&!t.uv&&(t.uv=N.createBuffer());c.hasColors&&!t.color&&(t.color=N.createBuffer());h=h.getAttributes();c.hasPositions&&(N.bindBuffer(N.ARRAY_BUFFER,t.position),N.bufferData(N.ARRAY_BUFFER,
c.positionArray,N.DYNAMIC_DRAW),xa.enableAttribute(h.position),N.vertexAttribPointer(h.position,3,N.FLOAT,!1,0,0));if(c.hasNormals){N.bindBuffer(N.ARRAY_BUFFER,t.normal);if(!a.isMeshPhongMaterial&&!a.isMeshStandardMaterial&&1===a.shading)for(var b=0,d=3*c.count;b<d;b+=9){var y=c.normalArray,e=(y[b+0]+y[b+3]+y[b+6])/3,C=(y[b+1]+y[b+4]+y[b+7])/3,f=(y[b+2]+y[b+5]+y[b+8])/3;y[b+0]=e;y[b+1]=C;y[b+2]=f;y[b+3]=e;y[b+4]=C;y[b+5]=f;y[b+6]=e;y[b+7]=C;y[b+8]=f}N.bufferData(N.ARRAY_BUFFER,c.normalArray,N.DYNAMIC_DRAW);
xa.enableAttribute(h.normal);N.vertexAttribPointer(h.normal,3,N.FLOAT,!1,0,0)}c.hasUvs&&a.map&&(N.bindBuffer(N.ARRAY_BUFFER,t.uv),N.bufferData(N.ARRAY_BUFFER,c.uvArray,N.DYNAMIC_DRAW),xa.enableAttribute(h.uv),N.vertexAttribPointer(h.uv,2,N.FLOAT,!1,0,0));c.hasColors&&0!==a.vertexColors&&(N.bindBuffer(N.ARRAY_BUFFER,t.color),N.bufferData(N.ARRAY_BUFFER,c.colorArray,N.DYNAMIC_DRAW),xa.enableAttribute(h.color),N.vertexAttribPointer(h.color,3,N.FLOAT,!1,0,0));xa.disableUnusedAttributes();N.drawArrays(N.TRIANGLES,
0,c.count);c.count=0};this.renderBufferDirect=function(c,h,a,t,b,d){x(t);var y=w(c,h,t,b),e=!1;c=a.id+"_"+y.id+"_"+t.wireframe;c!==sa&&(sa=c,e=!0);h=b.morphTargetInfluences;if(void 0!==h){var C=[];c=0;for(var f=h.length;c<f;c++)e=h[c],C.push([e,c]);C.sort(k);8<C.length&&(C.length=8);var g=a.morphAttributes;c=0;for(f=C.length;c<f;c++)e=C[c],S[c]=e[0],0!==e[0]?(h=e[1],!0===t.morphTargets&&g.position&&a.addAttribute("morphTarget"+c,g.position[h]),!0===t.morphNormals&&g.normal&&a.addAttribute("morphNormal"+
c,g.normal[h])):(!0===t.morphTargets&&a.removeAttribute("morphTarget"+c),!0===t.morphNormals&&a.removeAttribute("morphNormal"+c));c=C.length;for(h=S.length;c<h;c++)S[c]=0;y.getUniforms().setValue(N,"morphTargetInfluences",S);e=!0}h=a.index;f=a.attributes.position;C=1;!0===t.wireframe&&(h=Kb.getWireframeAttribute(a),C=2);null!==h?(c=Ta,c.setIndex(h)):c=Qa;if(e){e=void 0;var M;if(a&&a.isInstancedBufferGeometry&&(M=Ja.get("ANGLE_instanced_arrays"),null===M))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
else{void 0===e&&(e=0);xa.initAttributes();g=a.attributes;y=y.getAttributes();var aa=t.defaultAttributeValues;for(ka in y){var l=y[ka];if(0<=l){var n=g[ka];if(void 0!==n){var m=N.FLOAT,r=n.array,p=n.normalized;r instanceof Float32Array?m=N.FLOAT:r instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):r instanceof Uint16Array?m=N.UNSIGNED_SHORT:r instanceof Int16Array?m=N.SHORT:r instanceof Uint32Array?m=N.UNSIGNED_INT:r instanceof Int32Array?m=N.INT:r instanceof Int8Array?
m=N.BYTE:r instanceof Uint8Array&&(m=N.UNSIGNED_BYTE);r=n.itemSize;var q=Kb.getAttributeBuffer(n);if(n&&n.isInterleavedBufferAttribute){var Y=n.data,v=Y.stride;n=n.offset;Y&&Y.isInstancedInterleavedBuffer?(xa.enableAttributeAndDivisor(l,Y.meshPerAttribute,M),void 0===a.maxInstancedCount&&(a.maxInstancedCount=Y.meshPerAttribute*Y.count)):xa.enableAttribute(l);N.bindBuffer(N.ARRAY_BUFFER,q);N.vertexAttribPointer(l,r,m,p,v*Y.array.BYTES_PER_ELEMENT,(e*v+n)*Y.array.BYTES_PER_ELEMENT)}else n&&n.isInstancedBufferAttribute?
(xa.enableAttributeAndDivisor(l,n.meshPerAttribute,M),void 0===a.maxInstancedCount&&(a.maxInstancedCount=n.meshPerAttribute*n.count)):xa.enableAttribute(l),N.bindBuffer(N.ARRAY_BUFFER,q),N.vertexAttribPointer(l,r,m,p,0,e*r*n.array.BYTES_PER_ELEMENT)}else if(void 0!==aa&&(m=aa[ka],void 0!==m))switch(m.length){case 2:N.vertexAttrib2fv(l,m);break;case 3:N.vertexAttrib3fv(l,m);break;case 4:N.vertexAttrib4fv(l,m);break;default:N.vertexAttrib1fv(l,m)}}}xa.disableUnusedAttributes()}null!==h&&N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,
Kb.getAttributeBuffer(h))}M=0;null!==h?M=h.count:void 0!==f&&(M=f.count);h=a.drawRange.start*C;f=null!==d?d.start*C:0;var ka=Math.max(h,f);d=Math.max(0,Math.min(M,h+a.drawRange.count*C,f+(null!==d?d.count*C:Infinity))-1-ka+1);if(0!==d){if(b.isMesh)if(!0===t.wireframe)xa.setLineWidth(t.wireframeLinewidth*(null===I?va:1)),c.setMode(N.LINES);else switch(b.drawMode){case 0:c.setMode(N.TRIANGLES);break;case 1:c.setMode(N.TRIANGLE_STRIP);break;case 2:c.setMode(N.TRIANGLE_FAN)}else b.isLine?(t=t.linewidth,
void 0===t&&(t=1),xa.setLineWidth(t*(null===I?va:1)),b.isLineSegments?c.setMode(N.LINES):c.setMode(N.LINE_STRIP)):b.isPoints&&c.setMode(N.POINTS);a&&a.isInstancedBufferGeometry?0<a.maxInstancedCount&&c.renderInstances(a,ka,d):c.render(ka,d)}};this.render=function(c,a,t,b){if(void 0!==a&&!0!==a.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var d=c.fog;sa="";Z=-1;fa=null;!0===c.autoUpdate&&c.updateMatrixWorld();null===a.parent&&a.updateMatrixWorld();
a.matrixWorldInverse.getInverse(a.matrixWorld);Ia.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse);Wa.setFromMatrix(Ia);H.length=0;Q=L=-1;ca.length=0;J.length=0;ya=this.localClippingEnabled;Oa=Ea.init(this.clippingPlanes,ya,a);v(c,a);T.length=L+1;P.length=Q+1;!0===U.sortObjects&&(T.sort(n),P.sort(m));Oa&&Ea.beginShadows();for(var y=H,e=0,C=0,f=y.length;C<f;C++){var g=y[C];g.castShadow&&(pa.shadows[e++]=g)}pa.shadows.length=e;Za.render(c,a);y=H;var k=g=0,M=0,l,aa,r,q,Y=a.matrixWorldInverse,
ka=0,Ba=0,x=0,w=0;e=0;for(C=y.length;e<C;e++)if(f=y[e],l=f.color,aa=f.intensity,r=f.distance,q=f.shadow&&f.shadow.map?f.shadow.map.texture:null,f.isAmbientLight)g+=l.r*aa,k+=l.g*aa,M+=l.b*aa;else if(f.isDirectionalLight){var la=Ka.get(f);la.color.copy(f.color).multiplyScalar(f.intensity);la.direction.setFromMatrixPosition(f.matrixWorld);Xa.setFromMatrixPosition(f.target.matrixWorld);la.direction.sub(Xa);la.direction.transformDirection(Y);if(la.shadow=f.castShadow)la.shadowBias=f.shadow.bias,la.shadowRadius=
f.shadow.radius,la.shadowMapSize=f.shadow.mapSize;pa.directionalShadowMap[ka]=q;pa.directionalShadowMatrix[ka]=f.shadow.matrix;pa.directional[ka++]=la}else if(f.isSpotLight){la=Ka.get(f);la.position.setFromMatrixPosition(f.matrixWorld);la.position.applyMatrix4(Y);la.color.copy(l).multiplyScalar(aa);la.distance=r;la.direction.setFromMatrixPosition(f.matrixWorld);Xa.setFromMatrixPosition(f.target.matrixWorld);la.direction.sub(Xa);la.direction.transformDirection(Y);la.coneCos=Math.cos(f.angle);la.penumbraCos=
Math.cos(f.angle*(1-f.penumbra));la.decay=0===f.distance?0:f.decay;if(la.shadow=f.castShadow)la.shadowBias=f.shadow.bias,la.shadowRadius=f.shadow.radius,la.shadowMapSize=f.shadow.mapSize;pa.spotShadowMap[x]=q;pa.spotShadowMatrix[x]=f.shadow.matrix;pa.spot[x++]=la}else if(f.isPointLight){la=Ka.get(f);la.position.setFromMatrixPosition(f.matrixWorld);la.position.applyMatrix4(Y);la.color.copy(f.color).multiplyScalar(f.intensity);la.distance=f.distance;la.decay=0===f.distance?0:f.decay;if(la.shadow=f.castShadow)la.shadowBias=
f.shadow.bias,la.shadowRadius=f.shadow.radius,la.shadowMapSize=f.shadow.mapSize;pa.pointShadowMap[Ba]=q;void 0===pa.pointShadowMatrix[Ba]&&(pa.pointShadowMatrix[Ba]=new p);Xa.setFromMatrixPosition(f.matrixWorld).negate();pa.pointShadowMatrix[Ba].identity().setPosition(Xa);pa.point[Ba++]=la}else f.isHemisphereLight&&(la=Ka.get(f),la.direction.setFromMatrixPosition(f.matrixWorld),la.direction.transformDirection(Y),la.direction.normalize(),la.skyColor.copy(f.color).multiplyScalar(aa),la.groundColor.copy(f.groundColor).multiplyScalar(aa),
pa.hemi[w++]=la);pa.ambient[0]=g;pa.ambient[1]=k;pa.ambient[2]=M;pa.directional.length=ka;pa.spot.length=x;pa.point.length=Ba;pa.hemi.length=w;pa.hash=ka+","+Ba+","+x+","+w+","+pa.shadows.length;Oa&&Ea.endShadows();Fb.calls=0;Fb.vertices=0;Fb.faces=0;Fb.points=0;void 0===t&&(t=null);this.setRenderTarget(t);y=c.background;null===y?h(X.r,X.g,X.b,qa):y&&y.isColor&&(h(y.r,y.g,y.b,1),b=!0);(this.autoClear||b)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);y&&y.isCubeTexture?
(Ma.projectionMatrix.copy(a.projectionMatrix),Ma.matrixWorld.extractRotation(a.matrixWorld),Ma.matrixWorldInverse.getInverse(Ma.matrixWorld),Na.material.uniforms.tCube.value=y,Na.modelViewMatrix.multiplyMatrices(Ma.matrixWorldInverse,Na.matrixWorld),Kb.update(Na),U.renderBufferDirect(Ma,null,Na.geometry,Na.material,Na,null)):y&&y.isTexture&&(Pa.material.map=y,Kb.update(Pa),U.renderBufferDirect(Ua,null,Pa.geometry,Pa.material,Pa,null));c.overrideMaterial?(b=c.overrideMaterial,u(T,a,d,b),u(P,a,d,b)):
(xa.setBlending(0),u(T,a,d),u(P,a,d));$a.render(c,a);ab.render(c,a,ba);t&&sb.updateRenderTargetMipmap(t);xa.setDepthTest(!0);xa.setDepthWrite(!0);xa.setColorWrite(!0)}};this.setFaceCulling=function(c,h){xa.setCullFace(c);xa.setFlipSided(0===h)};this.allocTextureUnit=function(){var c=ma;c>=ua.maxTextures&&console.warn("WebGLRenderer: trying to use "+c+" texture units while this GPU supports only "+ua.maxTextures);ma+=1;return c};this.setTexture2D=function(){var c=!1;return function(h,a){h&&h.isWebGLRenderTarget&&
(c||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),c=!0),h=h.texture);sb.setTexture2D(h,a)}}();this.setTexture=function(){var c=!1;return function(h,a){c||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),c=!0);sb.setTexture2D(h,a)}}();this.setTextureCube=function(){var c=!1;return function(h,a){h&&h.isWebGLRenderTargetCube&&(c||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),
c=!0),h=h.texture);h&&h.isCubeTexture||Array.isArray(h.image)&&6===h.image.length?sb.setTextureCube(h,a):sb.setTextureCubeDynamic(h,a)}}();this.getCurrentRenderTarget=function(){return I};this.setRenderTarget=function(c){(I=c)&&void 0===ra.get(c).__webglFramebuffer&&sb.setupRenderTarget(c);var h=c&&c.isWebGLRenderTargetCube,a;c?(a=ra.get(c),a=h?a.__webglFramebuffer[c.activeCubeFace]:a.__webglFramebuffer,W.copy(c.scissor),ta=c.scissorTest,ba.copy(c.viewport)):(a=null,W.copy(Ga).multiplyScalar(va),
ta=Lb,ba.copy(bb).multiplyScalar(va));ha!==a&&(N.bindFramebuffer(N.FRAMEBUFFER,a),ha=a);xa.scissor(W);xa.setScissorTest(ta);xa.viewport(ba);h&&(h=ra.get(c.texture),N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_CUBE_MAP_POSITIVE_X+c.activeCubeFace,h.__webglTexture,c.activeMipMapLevel))};this.readRenderTargetPixels=function(c,h,a,t,b,d){if(!1===(c&&c.isWebGLRenderTarget))console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");else{var y=
ra.get(c).__webglFramebuffer;if(y){var e=!1;y!==ha&&(N.bindFramebuffer(N.FRAMEBUFFER,y),e=!0);try{var f=c.texture,C=f.format,g=f.type;1023!==C&&A(C)!==N.getParameter(N.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===g||A(g)===N.getParameter(N.IMPLEMENTATION_COLOR_READ_TYPE)||1015===g&&(Ja.get("OES_texture_float")||Ja.get("WEBGL_color_buffer_float"))||1016===g&&Ja.get("EXT_color_buffer_half_float")?
N.checkFramebufferStatus(N.FRAMEBUFFER)===N.FRAMEBUFFER_COMPLETE?0<=h&&h<=c.width-t&&0<=a&&a<=c.height-b&&N.readPixels(h,a,t,b,A(C),A(g),d):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{e&&N.bindFramebuffer(N.FRAMEBUFFER,ha)}}}}}function rb(c,h){this.name="";this.color=new V(c);this.density=
void 0!==h?h:2.5E-4}function lb(c,h,a){this.name="";this.color=new V(c);this.near=void 0!==h?h:1;this.far=void 0!==a?a:1E3}function Za(){ca.call(this);this.type="Scene";this.overrideMaterial=this.fog=this.background=null;this.autoUpdate=!0}function gb(c,h,a,b,d){ca.call(this);this.lensFlares=[];this.positionScreen=new f;this.customUpdateCallback=void 0;void 0!==c&&this.add(c,h,a,b,d)}function wb(c){Z.call(this);this.type="SpriteMaterial";this.color=new V(16777215);this.map=null;this.rotation=0;this.lights=
this.fog=!1;this.setValues(c)}function wc(c){ca.call(this);this.type="Sprite";this.material=void 0!==c?c:new wb}function ec(){ca.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function fc(c,h,a,b,d,e,f,g,k,l,n,r){m.call(this,null,e,f,g,k,l,b,d,n,r);this.image={data:c,width:h,height:a};this.magFilter=void 0!==k?k:1003;this.minFilter=void 0!==l?l:1003;this.generateMipmaps=this.flipY=!1}function Ma(c,h,a){this.useVertexTexture=void 0!==a?a:!0;this.identityMatrix=
new p;c=c||[];this.bones=c.slice(0);this.useVertexTexture?(c=Math.sqrt(4*this.bones.length),c=l.Math.nextPowerOfTwo(Math.ceil(c)),this.boneTextureHeight=this.boneTextureWidth=Math.max(c,4),this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new fc(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,1023,1015)):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===h)this.calculateInverses();else if(this.bones.length===h.length)this.boneInverses=
h.slice(0);else for(console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[],h=0,c=this.bones.length;h<c;h++)this.boneInverses.push(new p)}function Mb(c){ca.call(this);this.type="Bone";this.skin=c}function Nb(c,h,a){Ca.call(this,c,h);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new p;this.bindMatrixInverse=new p;c=[];if(this.geometry&&void 0!==this.geometry.bones){for(var t,b=0,d=this.geometry.bones.length;b<d;++b)t=this.geometry.bones[b],h=new Mb(this),
c.push(h),h.name=t.name,h.position.fromArray(t.pos),h.quaternion.fromArray(t.rotq),void 0!==t.scl&&h.scale.fromArray(t.scl);b=0;for(d=this.geometry.bones.length;b<d;++b)t=this.geometry.bones[b],-1!==t.parent&&null!==t.parent&&void 0!==c[t.parent]?c[t.parent].add(c[b]):this.add(c[b])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new Ma(c,void 0,a),this.matrixWorld)}function Qa(c){Z.call(this);this.type="LineBasicMaterial";this.color=new V(16777215);this.linewidth=1;this.linejoin=
this.linecap="round";this.lights=!1;this.setValues(c)}function xb(c,h,a){if(1===a)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new Ka(c,h);ca.call(this);this.type="Line";this.geometry=void 0!==c?c:new ia;this.material=void 0!==h?h:new Qa({color:16777215*Math.random()})}function Ka(c,h){xb.call(this,c,h);this.type="LineSegments"}function yb(c){Z.call(this);this.type="PointsMaterial";this.color=new V(16777215);this.map=null;this.size=
1;this.sizeAttenuation=!0;this.lights=!1;this.setValues(c)}function zc(c,h){ca.call(this);this.type="Points";this.geometry=void 0!==c?c:new ia;this.material=void 0!==h?h:new yb({color:16777215*Math.random()})}function zb(){ca.call(this);this.type="Group"}function Ab(c,h,a,b,d,e,f,g,k){function t(){requestAnimationFrame(t);c.readyState>=c.HAVE_CURRENT_DATA&&(y.needsUpdate=!0)}m.call(this,c,h,a,b,d,e,f,g,k);this.generateMipmaps=!1;var y=this;t()}function mb(c,h,a,b,d,e,f,g,k,l,n,r){m.call(this,null,
e,f,g,k,l,b,d,n,r);this.image={width:h,height:a};this.mipmaps=c;this.generateMipmaps=this.flipY=!1}function Yc(c,h,a,b,d,e,f,g,k){m.call(this,c,h,a,b,d,e,f,g,k);this.needsUpdate=!0}function Hc(c,h,a,b,d,e,f,g,k,l){l=void 0!==l?l:1026;if(1026!==l&&1027!==l)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");m.call(this,null,b,d,e,f,g,l,a,k);this.image={width:c,height:h};this.type=void 0!==a?a:1012;this.magFilter=void 0!==f?f:1003;this.minFilter=void 0!==
g?g:1003;this.generateMipmaps=this.flipY=!1}function Ac(c){function h(c,h){return c-h}ia.call(this);var a=[0,0],b={},d=["a","b","c"];if(c&&c.isGeometry){var e=c.vertices,f=c.faces,g=0,k=new Uint32Array(6*f.length);c=0;for(var l=f.length;c<l;c++)for(var n=f[c],m=0;3>m;m++){a[0]=n[d[m]];a[1]=n[d[(m+1)%3]];a.sort(h);var r=a.toString();void 0===b[r]&&(k[2*g]=a[0],k[2*g+1]=a[1],b[r]=!0,g++)}a=new Float32Array(6*g);c=0;for(l=g;c<l;c++)for(m=0;2>m;m++)b=e[k[2*c+m]],g=6*c+3*m,a[g+0]=b.x,a[g+1]=b.y,a[g+2]=
b.z;this.addAttribute("position",new P(a,3))}else if(c&&c.isBufferGeometry){if(null!==c.index){l=c.index.array;e=c.attributes.position;d=c.groups;g=0;0===d.length&&c.addGroup(0,l.length);k=new Uint32Array(2*l.length);f=0;for(n=d.length;f<n;++f){c=d[f];m=c.start;r=c.count;c=m;for(var p=m+r;c<p;c+=3)for(m=0;3>m;m++)a[0]=l[c+m],a[1]=l[c+(m+1)%3],a.sort(h),r=a.toString(),void 0===b[r]&&(k[2*g]=a[0],k[2*g+1]=a[1],b[r]=!0,g++)}a=new Float32Array(6*g);c=0;for(l=g;c<l;c++)for(m=0;2>m;m++)g=6*c+3*m,b=k[2*
c+m],a[g+0]=e.getX(b),a[g+1]=e.getY(b),a[g+2]=e.getZ(b)}else for(e=c.attributes.position.array,g=e.length/3,k=g/3,a=new Float32Array(6*g),c=0,l=k;c<l;c++)for(m=0;3>m;m++)g=18*c+6*m,k=9*c+3*m,a[g+0]=e[k],a[g+1]=e[k+1],a[g+2]=e[k+2],b=9*c+(m+1)%3*3,a[g+3]=e[b],a[g+4]=e[b+1],a[g+5]=e[b+2];this.addAttribute("position",new P(a,3))}}function Vb(c,h,a){ma.call(this);this.type="ParametricGeometry";this.parameters={func:c,slices:h,stacks:a};var t=this.vertices,b=this.faces,d=this.faceVertexUvs[0],e,f,k=h+
1;for(e=0;e<=a;e++){var l=e/a;for(f=0;f<=h;f++){var n=f/h;n=c(n,l);t.push(n)}}for(e=0;e<a;e++)for(f=0;f<h;f++){c=e*k+f;t=e*k+f+1;l=(e+1)*k+f+1;n=(e+1)*k+f;var m=new g(f/h,e/a);var r=new g((f+1)/h,e/a);var p=new g((f+1)/h,(e+1)/a);var q=new g(f/h,(e+1)/a);b.push(new ta(c,t,n));d.push([m,r,q]);b.push(new ta(t,l,n));d.push([r.clone(),p,q.clone()])}this.computeFaceNormals();this.computeVertexNormals()}function $a(c,h,a,b){function t(c){var h=c.normalize().clone();h.index=k.vertices.push(h)-1;h.uv=new g(Math.atan2(c.z,
-c.x)/2/Math.PI+.5,1-(Math.atan2(-c.y,Math.sqrt(c.x*c.x+c.z*c.z))/Math.PI+.5));return h}function d(c,h,a){var t=new ta(c.index,h.index,a.index,[c.clone(),h.clone(),a.clone()]);k.faces.push(t);u.copy(c).add(h).add(a).divideScalar(3);t=Math.atan2(u.z,-u.x);k.faceVertexUvs[0].push([e(c.uv,c,t),e(h.uv,h,t),e(a.uv,a,t)])}function y(c,h){for(var a=Math.pow(2,h),b=t(k.vertices[c.a]),y=t(k.vertices[c.b]),e=t(k.vertices[c.c]),f=[],C=0;C<=a;C++){f[C]=[];for(var g=t(b.clone().lerp(e,C/a)),M=t(y.clone().lerp(e,
C/a)),l=a-C,aa=0;aa<=l;aa++)f[C][aa]=0===aa&&C===a?g:t(g.clone().lerp(M,aa/l))}for(C=0;C<a;C++)for(aa=0;aa<2*(a-C)-1;aa++)b=Math.floor(aa/2),0===aa%2?d(f[C][b+1],f[C+1][b],f[C][b]):d(f[C][b+1],f[C+1][b+1],f[C+1][b])}function e(c,h,a){0>a&&1===c.x&&(c=new g(c.x-1,c.y));0===h.x&&0===h.z&&(c=new g(a/2/Math.PI+.5,c.y));return c.clone()}ma.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:c,indices:h,radius:a,detail:b};a=a||1;b=b||0;for(var k=this,l=0,n=c.length;l<n;l+=3)t(new f(c[l],
c[l+1],c[l+2]));c=this.vertices;var m=[],r=l=0;for(n=h.length;l<n;l+=3,r++){var p=c[h[l]],q=c[h[l+1]],v=c[h[l+2]];m[r]=new ta(p.index,q.index,v.index,[p.clone(),q.clone(),v.clone()])}var u=new f;l=0;for(n=m.length;l<n;l++)y(m[l],b);l=0;for(n=this.faceVertexUvs[0].length;l<n;l++)h=this.faceVertexUvs[0][l],b=h[0].x,c=h[1].x,m=h[2].x,r=Math.min(b,c,m),.9<Math.max(b,c,m)&&.1>r&&(.2>b&&(h[0].x+=1),.2>c&&(h[1].x+=1),.2>m&&(h[2].x+=1));l=0;for(n=this.vertices.length;l<n;l++)this.vertices[l].multiplyScalar(a);
this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new za(new f,a)}function Ic(c,h){$a.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],c,h);this.type="TetrahedronGeometry";this.parameters={radius:c,detail:h}}function Jc(c,h){$a.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],c,h);this.type="OctahedronGeometry";this.parameters={radius:c,detail:h}}function Wb(c,h){var a=(1+Math.sqrt(5))/2;$a.call(this,[-1,a,0,1,
a,0,-1,-a,0,1,-a,0,0,-1,a,0,1,a,0,-1,-a,0,1,-a,a,0,-1,a,0,1,-a,0,-1,-a,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],c,h);this.type="IcosahedronGeometry";this.parameters={radius:c,detail:h}}function Xb(c,h){var a=(1+Math.sqrt(5))/2,b=1/a;$a.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-b,-a,0,-b,a,0,b,-a,0,b,a,-b,-a,0,-b,a,0,b,-a,0,b,a,0,-a,0,-b,a,0,-b,-a,0,b,a,0,b],[3,11,7,3,7,15,
3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],c,h);this.type="DodecahedronGeometry";this.parameters={radius:c,detail:h}}function hb(c,h,a,b,d,e){ma.call(this);this.type="TubeGeometry";this.parameters={path:c,segments:h,radius:a,radialSegments:b,closed:d,taper:e};h=h||64;a=a||1;b=b||8;d=d||!1;e=
e||hb.NoTaper;var t=[],y=h+1,C=new f;var k=new hb.FrenetFrames(c,h,d);var M=k.normals;var l=k.binormals;this.tangents=k.tangents;this.normals=M;this.binormals=l;for(k=0;k<y;k++){t[k]=[];var n=k/(y-1);var m=c.getPointAt(n);var r=M[k];var p=l[k];var q=a*e(n);for(n=0;n<b;n++){var v=n/b*2*Math.PI;var u=-q*Math.cos(v);v=q*Math.sin(v);C.copy(m);C.x+=u*r.x+v*p.x;C.y+=u*r.y+v*p.y;C.z+=u*r.z+v*p.z;t[k][n]=this.vertices.push(new f(C.x,C.y,C.z))-1}}for(k=0;k<h;k++)for(n=0;n<b;n++)e=d?(k+1)%h:k+1,y=(n+1)%b,c=
t[k][n],a=t[e][n],e=t[e][y],y=t[k][y],C=new g(k/h,n/b),M=new g((k+1)/h,n/b),l=new g((k+1)/h,(n+1)/b),r=new g(k/h,(n+1)/b),this.faces.push(new ta(c,a,y)),this.faceVertexUvs[0].push([C,M,r]),this.faces.push(new ta(a,e,y)),this.faceVertexUvs[0].push([M.clone(),l,r.clone()]);this.computeFaceNormals();this.computeVertexNormals()}function Ob(c,h,a,b,d,e){function t(c,h,a,b,t){var d=Math.sin(c);h=a/h*c;a=Math.cos(h);t.x=b*(2+a)*.5*Math.cos(c);t.y=b*(2+a)*d*.5;t.z=b*Math.sin(h)*.5}ia.call(this);this.type=
"TorusKnotBufferGeometry";this.parameters={radius:c,tube:h,tubularSegments:a,radialSegments:b,p:d,q:e};c=c||100;h=h||40;a=Math.floor(a)||64;b=Math.floor(b)||8;d=d||2;e=e||3;var y=(b+1)*(a+1),C=b*a*6;C=new P(new (65535<C?Uint32Array:Uint16Array)(C),1);var k=new P(new Float32Array(3*y),3),M=new P(new Float32Array(3*y),3);y=new P(new Float32Array(2*y),2);var l,n=0,m=0,r=new f,p=new f,q=new g,v=new f,u=new f,x=new f,w=new f,B=new f;for(l=0;l<=a;++l){var z=l/a*d*Math.PI*2;t(z,d,e,c,v);t(z+.01,d,e,c,u);
w.subVectors(u,v);B.addVectors(u,v);x.crossVectors(w,B);B.crossVectors(x,w);x.normalize();B.normalize();for(z=0;z<=b;++z){var A=z/b*Math.PI*2,D=-h*Math.cos(A);A=h*Math.sin(A);r.x=v.x+(D*B.x+A*x.x);r.y=v.y+(D*B.y+A*x.y);r.z=v.z+(D*B.z+A*x.z);k.setXYZ(n,r.x,r.y,r.z);p.subVectors(r,v).normalize();M.setXYZ(n,p.x,p.y,p.z);q.x=l/a;q.y=z/b;y.setXY(n,q.x,q.y);n++}}for(z=1;z<=a;z++)for(l=1;l<=b;l++)c=(b+1)*z+(l-1),h=(b+1)*z+l,d=(b+1)*(z-1)+l,C.setX(m,(b+1)*(z-1)+(l-1)),m++,C.setX(m,c),m++,C.setX(m,d),m++,
C.setX(m,c),m++,C.setX(m,h),m++,C.setX(m,d),m++;this.setIndex(C);this.addAttribute("position",k);this.addAttribute("normal",M);this.addAttribute("uv",y)}function Kc(c,h,a,b,d,e,f){ma.call(this);this.type="TorusKnotGeometry";this.parameters={radius:c,tube:h,tubularSegments:a,radialSegments:b,p:d,q:e};void 0!==f&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");this.fromBufferGeometry(new Ob(c,h,a,b,d,e));this.mergeVertices()}function Bc(c,h,a,
b,d){ia.call(this);this.type="TorusBufferGeometry";this.parameters={radius:c,tube:h,radialSegments:a,tubularSegments:b,arc:d};c=c||100;h=h||40;a=Math.floor(a)||8;b=Math.floor(b)||6;d=d||2*Math.PI;var t=(a+1)*(b+1),y=a*b*6;y=new (65535<y?Uint32Array:Uint16Array)(y);var e=new Float32Array(3*t),C=new Float32Array(3*t);t=new Float32Array(2*t);var g=0,k=0,l=0,n=new f,m=new f,r=new f,p,q;for(p=0;p<=a;p++)for(q=0;q<=b;q++){var v=q/b*d,u=p/a*Math.PI*2;m.x=(c+h*Math.cos(u))*Math.cos(v);m.y=(c+h*Math.cos(u))*
Math.sin(v);m.z=h*Math.sin(u);e[g]=m.x;e[g+1]=m.y;e[g+2]=m.z;n.x=c*Math.cos(v);n.y=c*Math.sin(v);r.subVectors(m,n).normalize();C[g]=r.x;C[g+1]=r.y;C[g+2]=r.z;t[k]=q/b;t[k+1]=p/a;g+=3;k+=2}for(p=1;p<=a;p++)for(q=1;q<=b;q++)c=(b+1)*(p-1)+q-1,h=(b+1)*(p-1)+q,d=(b+1)*p+q,y[l]=(b+1)*p+q-1,y[l+1]=c,y[l+2]=d,y[l+3]=c,y[l+4]=h,y[l+5]=d,l+=6;this.setIndex(new P(y,1));this.addAttribute("position",new P(e,3));this.addAttribute("normal",new P(C,3));this.addAttribute("uv",new P(t,2))}function Yb(c,h,a,b,d){ma.call(this);
this.type="TorusGeometry";this.parameters={radius:c,tube:h,radialSegments:a,tubularSegments:b,arc:d};this.fromBufferGeometry(new Bc(c,h,a,b,d))}function ab(c,h){"undefined"!==typeof c&&(ma.call(this),this.type="ExtrudeGeometry",c=Array.isArray(c)?c:[c],this.addShapeList(c,h),this.computeFaceNormals())}function Zb(c,h){h=h||{};var a=h.font;if(!1===(a&&a.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new ma;a=a.generateShapes(c,h.size,h.curveSegments);
h.amount=void 0!==h.height?h.height:50;void 0===h.bevelThickness&&(h.bevelThickness=10);void 0===h.bevelSize&&(h.bevelSize=8);void 0===h.bevelEnabled&&(h.bevelEnabled=!1);ab.call(this,a,h);this.type="TextGeometry"}function Ta(c,h,a,b,d,e,g){ia.call(this);this.type="SphereBufferGeometry";this.parameters={radius:c,widthSegments:h,heightSegments:a,phiStart:b,phiLength:d,thetaStart:e,thetaLength:g};c=c||50;h=Math.max(3,Math.floor(h)||8);a=Math.max(2,Math.floor(a)||6);b=void 0!==b?b:0;d=void 0!==d?d:2*
Math.PI;e=void 0!==e?e:0;g=void 0!==g?g:Math.PI;var t=e+g,y=(h+1)*(a+1),C=new P(new Float32Array(3*y),3),k=new P(new Float32Array(3*y),3);y=new P(new Float32Array(2*y),2);for(var l=0,M=[],aa=new f,n=0;n<=a;n++){for(var m=[],r=n/a,p=0;p<=h;p++){var q=p/h,v=-c*Math.cos(b+q*d)*Math.sin(e+r*g),u=c*Math.cos(e+r*g),x=c*Math.sin(b+q*d)*Math.sin(e+r*g);aa.set(v,u,x).normalize();C.setXYZ(l,v,u,x);k.setXYZ(l,aa.x,aa.y,aa.z);y.setXY(l,q,1-r);m.push(l);l++}M.push(m)}b=[];for(n=0;n<a;n++)for(p=0;p<h;p++)d=M[n][p+
1],g=M[n][p],l=M[n+1][p],aa=M[n+1][p+1],(0!==n||0<e)&&b.push(d,g,aa),(n!==a-1||t<Math.PI)&&b.push(g,l,aa);this.setIndex(new (65535<C.count?Lb:pa)(b,1));this.addAttribute("position",C);this.addAttribute("normal",k);this.addAttribute("uv",y);this.boundingSphere=new za(new f,c)}function gc(c,h,a,b,d,e,f){ma.call(this);this.type="SphereGeometry";this.parameters={radius:c,widthSegments:h,heightSegments:a,phiStart:b,phiLength:d,thetaStart:e,thetaLength:f};this.fromBufferGeometry(new Ta(c,h,a,b,d,e,f))}
function $b(c,h,a,b,d,e){ia.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:c,outerRadius:h,thetaSegments:a,phiSegments:b,thetaStart:d,thetaLength:e};c=c||20;h=h||50;d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;a=void 0!==a?Math.max(3,a):8;b=void 0!==b?Math.max(1,b):1;var t=(a+1)*(b+1),y=a*b*6;y=new P(new (65535<y?Uint32Array:Uint16Array)(y),1);var C=new P(new Float32Array(3*t),3),k=new P(new Float32Array(3*t),3);t=new P(new Float32Array(2*t),2);var l=0,M=0,n=c,m=(h-c)/b,r=new f,
p=new g,q;for(c=0;c<=b;c++){for(q=0;q<=a;q++){var v=d+q/a*e;r.x=n*Math.cos(v);r.y=n*Math.sin(v);C.setXYZ(l,r.x,r.y,r.z);k.setXYZ(l,0,0,1);p.x=(r.x/h+1)/2;p.y=(r.y/h+1)/2;t.setXY(l,p.x,p.y);l++}n+=m}for(c=0;c<b;c++)for(h=c*(a+1),q=0;q<a;q++)d=v=q+h,e=v+a+1,l=v+a+2,v+=1,y.setX(M,d),M++,y.setX(M,e),M++,y.setX(M,l),M++,y.setX(M,d),M++,y.setX(M,l),M++,y.setX(M,v),M++;this.setIndex(y);this.addAttribute("position",C);this.addAttribute("normal",k);this.addAttribute("uv",t)}function Cc(c,h,a,b,d,e){ma.call(this);
this.type="RingGeometry";this.parameters={innerRadius:c,outerRadius:h,thetaSegments:a,phiSegments:b,thetaStart:d,thetaLength:e};this.fromBufferGeometry(new $b(c,h,a,b,d,e))}function hc(c,h,a,b){ma.call(this);this.type="PlaneGeometry";this.parameters={width:c,height:h,widthSegments:a,heightSegments:b};this.fromBufferGeometry(new eb(c,h,a,b))}function ic(c,h,a,b){ia.call(this);this.type="LatheBufferGeometry";this.parameters={points:c,segments:h,phiStart:a,phiLength:b};h=Math.floor(h)||12;a=a||0;b=b||
2*Math.PI;b=l.Math.clamp(b,0,2*Math.PI);var t=(h+1)*c.length,d=h*c.length*6,y=new P(new (65535<d?Uint32Array:Uint16Array)(d),1),e=new P(new Float32Array(3*t),3),k=new P(new Float32Array(2*t),2),n=0,m=0,r=1/h,p=new f,q=new g;for(t=0;t<=h;t++){d=a+t*r*b;var v=Math.sin(d),u=Math.cos(d);for(d=0;d<=c.length-1;d++)p.x=c[d].x*v,p.y=c[d].y,p.z=c[d].x*u,e.setXYZ(n,p.x,p.y,p.z),q.x=t/h,q.y=d/(c.length-1),k.setXY(n,q.x,q.y),n++}for(t=0;t<h;t++)for(d=0;d<c.length-1;d++)a=d+t*c.length,n=a+c.length,r=a+c.length+
1,p=a+1,y.setX(m,a),m++,y.setX(m,n),m++,y.setX(m,p),m++,y.setX(m,n),m++,y.setX(m,r),m++,y.setX(m,p),m++;this.setIndex(y);this.addAttribute("position",e);this.addAttribute("uv",k);this.computeVertexNormals();if(b===2*Math.PI)for(b=this.attributes.normal.array,y=new f,e=new f,k=new f,a=h*c.length*3,d=t=0;t<c.length;t++,d+=3)y.x=b[d+0],y.y=b[d+1],y.z=b[d+2],e.x=b[a+d+0],e.y=b[a+d+1],e.z=b[a+d+2],k.addVectors(y,e).normalize(),b[d+0]=b[a+d+0]=k.x,b[d+1]=b[a+d+1]=k.y,b[d+2]=b[a+d+2]=k.z}function jc(c,h,
a,b){ma.call(this);this.type="LatheGeometry";this.parameters={points:c,segments:h,phiStart:a,phiLength:b};this.fromBufferGeometry(new ic(c,h,a,b));this.mergeVertices()}function Pb(c,h){ma.call(this);this.type="ShapeGeometry";!1===Array.isArray(c)&&(c=[c]);this.addShapeList(c,h);this.computeFaceNormals()}function kc(c,h){function a(c,h){return c-h}ia.call(this);var b=Math.cos(l.Math.DEG2RAD*(void 0!==h?h:1)),d=[0,0],e={},f=["a","b","c"],g;c&&c.isBufferGeometry?(g=new ma,g.fromBufferGeometry(c)):g=
c.clone();g.mergeVertices();g.computeFaceNormals();var k=g.vertices;g=g.faces;for(var n=0,m=g.length;n<m;n++)for(var r=g[n],p=0;3>p;p++){d[0]=r[f[p]];d[1]=r[f[(p+1)%3]];d.sort(a);var q=d.toString();void 0===e[q]?e[q]={vert1:d[0],vert2:d[1],face1:n,face2:void 0}:e[q].face2=n}d=[];for(q in e)if(f=e[q],void 0===f.face2||g[f.face1].normal.dot(g[f.face2].normal)<=b)n=k[f.vert1],d.push(n.x),d.push(n.y),d.push(n.z),n=k[f.vert2],d.push(n.x),d.push(n.y),d.push(n.z);this.addAttribute("position",new P(new Float32Array(d),
3))}function ac(c,h,a,b,d,e,k,l){function t(a){var t,d=new g,e=new f,C=0,M=!0===a?c:h,n=!0===a?1:-1;var v=q;for(t=1;t<=b;t++)m.setXYZ(q,0,u*n,0),r.setXYZ(q,0,n,0),d.x=.5,d.y=.5,p.setXY(q,d.x,d.y),q++;var ka=q;for(t=0;t<=b;t++){var w=t/b*l+k,Ba=Math.cos(w);w=Math.sin(w);e.x=M*w;e.y=u*n;e.z=M*Ba;m.setXYZ(q,e.x,e.y,e.z);r.setXYZ(q,0,n,0);d.x=.5*Ba+.5;d.y=.5*w*n+.5;p.setXY(q,d.x,d.y);q++}for(t=0;t<b;t++)d=v+t,e=ka+t,!0===a?(aa.setX(Y,e),Y++,aa.setX(Y,e+1)):(aa.setX(Y,e+1),Y++,aa.setX(Y,e)),Y++,aa.setX(Y,
d),Y++,C+=3;y.addGroup(x,C,!0===a?1:2);x+=C}ia.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:c,radiusBottom:h,height:a,radialSegments:b,heightSegments:d,openEnded:e,thetaStart:k,thetaLength:l};var y=this;c=void 0!==c?c:20;h=void 0!==h?h:20;a=void 0!==a?a:100;b=Math.floor(b)||8;d=Math.floor(d)||1;e=void 0!==e?e:!1;k=void 0!==k?k:0;l=void 0!==l?l:2*Math.PI;var C=0;!1===e&&(0<c&&C++,0<h&&C++);var M=function(){var c=(b+1)*(d+1);!1===e&&(c+=(b+1)*C+b*C);return c}(),n=function(){var c=
b*d*6;!1===e&&(c+=b*C*3);return c}(),aa=new P(new (65535<n?Uint32Array:Uint16Array)(n),1),m=new P(new Float32Array(3*M),3),r=new P(new Float32Array(3*M),3),p=new P(new Float32Array(2*M),2),q=0,Y=0,v=[],u=a/2,x=0;(function(){var t,e,C=new f,g=new f,M=0,n=(h-c)/a;for(e=0;e<=d;e++){var ka=[],w=e/d,Ba=w*(h-c)+c;for(t=0;t<=b;t++){var la=t/b,B=la*l+k,z=Math.sin(B);B=Math.cos(B);g.x=Ba*z;g.y=-w*a+u;g.z=Ba*B;m.setXYZ(q,g.x,g.y,g.z);C.set(z,n,B).normalize();r.setXYZ(q,C.x,C.y,C.z);p.setXY(q,la,1-w);ka.push(q);
q++}v.push(ka)}for(t=0;t<b;t++)for(e=0;e<d;e++)C=v[e+1][t],g=v[e+1][t+1],n=v[e][t+1],aa.setX(Y,v[e][t]),Y++,aa.setX(Y,C),Y++,aa.setX(Y,n),Y++,aa.setX(Y,C),Y++,aa.setX(Y,g),Y++,aa.setX(Y,n),Y++,M+=6;y.addGroup(x,M,0);x+=M})();!1===e&&(0<c&&t(!0),0<h&&t(!1));this.setIndex(aa);this.addAttribute("position",m);this.addAttribute("normal",r);this.addAttribute("uv",p)}function nb(c,h,a,b,d,e,f,g){ma.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:c,radiusBottom:h,height:a,radialSegments:b,
heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g};this.fromBufferGeometry(new ac(c,h,a,b,d,e,f,g));this.mergeVertices()}function Bb(c,h,a,b,d,e,f){nb.call(this,0,c,h,a,b,d,e,f);this.type="ConeGeometry";this.parameters={radius:c,height:h,radialSegments:a,heightSegments:b,openEnded:d,thetaStart:e,thetaLength:f}}function Hb(c,h,a,b,d,e,f){ac.call(this,0,c,h,a,b,d,e,f);this.type="ConeBufferGeometry";this.parameters={radius:c,height:h,radialSegments:a,heightSegments:b,thetaStart:e,thetaLength:f}}
function Cb(c,h,a,b){ia.call(this);this.type="CircleBufferGeometry";this.parameters={radius:c,segments:h,thetaStart:a,thetaLength:b};c=c||50;h=void 0!==h?Math.max(3,h):8;a=void 0!==a?a:0;b=void 0!==b?b:2*Math.PI;var t=h+2,d=new Float32Array(3*t),y=new Float32Array(3*t);t=new Float32Array(2*t);y[2]=1;t[0]=.5;t[1]=.5;for(var e=0,g=3,k=2;e<=h;e++,g+=3,k+=2){var l=a+e/h*b;d[g]=c*Math.cos(l);d[g+1]=c*Math.sin(l);y[g+2]=1;t[k]=(d[g]/c+1)/2;t[k+1]=(d[g+1]/c+1)/2}a=[];for(g=1;g<=h;g++)a.push(g,g+1,0);this.setIndex(new P(new Uint16Array(a),
1));this.addAttribute("position",new P(d,3));this.addAttribute("normal",new P(y,3));this.addAttribute("uv",new P(t,2));this.boundingSphere=new za(new f,c)}function ib(c,h,a,b){ma.call(this);this.type="CircleGeometry";this.parameters={radius:c,segments:h,thetaStart:a,thetaLength:b};this.fromBufferGeometry(new Cb(c,h,a,b))}function Ib(c,h,a,b,d,e){ma.call(this);this.type="BoxGeometry";this.parameters={width:c,height:h,depth:a,widthSegments:b,heightSegments:d,depthSegments:e};this.fromBufferGeometry(new tb(c,
h,a,b,d,e));this.mergeVertices()}function Qb(){Aa.call(this,{uniforms:l.UniformsUtils.merge([ua.lights,{opacity:{value:1}}]),vertexShader:Fa.shadow_vert,fragmentShader:Fa.shadow_frag});this.transparent=this.lights=!0;Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(c){this.uniforms.opacity.value=c}}})}function Rb(c){Aa.call(this,c);this.type="RawShaderMaterial"}function lc(c){this.uuid=l.Math.generateUUID();this.type="MultiMaterial";
this.materials=c instanceof Array?c:[];this.visible=!0}function vb(c){Z.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new V(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new V(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new g(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=
0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(c)}function Sb(c){vb.call(this);this.defines={PHYSICAL:""};this.type="MeshPhysicalMaterial";this.reflectivity=.5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(c)}function Db(c){Z.call(this);this.type="MeshPhongMaterial";
this.color=new V(16777215);this.specular=new V(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new V(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new g(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=
!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(c)}function ob(c){Z.call(this,c);this.type="MeshNormalMaterial";this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=this.lights=this.fog=!1;this.setValues(c)}function Tb(c){Z.call(this);this.type="MeshLambertMaterial";this.color=new V(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=
new V(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(c)}function mc(c){Z.call(this);this.type="LineDashedMaterial";this.color=new V(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.lights=!1;this.setValues(c)}
function Zc(c,h,a){var b=this,t=!1,d=0,e=0;this.onStart=void 0;this.onLoad=c;this.onProgress=h;this.onError=a;this.itemStart=function(c){e++;if(!1===t&&void 0!==b.onStart)b.onStart(c,d,e);t=!0};this.itemEnd=function(c){d++;if(void 0!==b.onProgress)b.onProgress(c,d,e);if(d===e&&(t=!1,void 0!==b.onLoad))b.onLoad()};this.itemError=function(c){if(void 0!==b.onError)b.onError(c)}}function jb(c){this.manager=void 0!==c?c:l.DefaultLoadingManager}function md(c){this.manager=void 0!==c?c:l.DefaultLoadingManager;
this._parser=null}function Ub(c){this.manager=void 0!==c?c:l.DefaultLoadingManager;this._parser=null}function bc(c){this.manager=void 0!==c?c:l.DefaultLoadingManager}function Dc(c){this.manager=void 0!==c?c:l.DefaultLoadingManager}function nc(c){this.manager=void 0!==c?c:l.DefaultLoadingManager}function Ua(c,h){ca.call(this);this.type="Light";this.color=new V(c);this.intensity=void 0!==h?h:1;this.receiveShadow=void 0}function oc(c,h,a){Ua.call(this,c,a);this.type="HemisphereLight";this.castShadow=
void 0;this.position.copy(ca.DefaultUp);this.updateMatrix();this.groundColor=new V(h)}function Eb(c){this.camera=c;this.bias=0;this.radius=1;this.mapSize=new g(512,512);this.map=null;this.matrix=new p}function pc(){Eb.call(this,new cb(50,1,.5,500))}function Ec(c,h,a,b,d,e){Ua.call(this,c,h);this.type="SpotLight";this.position.copy(ca.DefaultUp);this.updateMatrix();this.target=new ca;Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(c){this.intensity=c/
Math.PI}});this.distance=void 0!==a?a:0;this.angle=void 0!==b?b:Math.PI/3;this.penumbra=void 0!==d?d:0;this.decay=void 0!==e?e:1;this.shadow=new pc}function Fc(c,h,a,b){Ua.call(this,c,h);this.type="PointLight";Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(c){this.intensity=c/(4*Math.PI)}});this.distance=void 0!==a?a:0;this.decay=void 0!==b?b:1;this.shadow=new Eb(new cb(90,1,.5,500))}function qc(c){Eb.call(this,new Gb(-5,5,5,-5,.5,500))}function rc(c,
h){Ua.call(this,c,h);this.type="DirectionalLight";this.position.copy(ca.DefaultUp);this.updateMatrix();this.target=new ca;this.shadow=new qc}function sc(c,h){Ua.call(this,c,h);this.type="AmbientLight";this.castShadow=void 0}function Na(c,h,a,b){this.parameterPositions=c;this._cachedIndex=0;this.resultBuffer=void 0!==b?b:new h.constructor(a);this.sampleValues=h;this.valueSize=a}function tc(c,h,a,b){Na.call(this,c,h,a,b);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function cc(c,
h,a,b){Na.call(this,c,h,a,b)}function Nc(c,h,a,b){Na.call(this,c,h,a,b)}function uc(c,h,a,b){if(void 0===c)throw Error("track name is undefined");if(void 0===h||0===h.length)throw Error("no keyframes in track named "+c);this.name=c;this.times=l.AnimationUtils.convertArray(h,this.TimeBufferType);this.values=l.AnimationUtils.convertArray(a,this.ValueBufferType);this.setInterpolation(b||this.DefaultInterpolation);this.validate();this.optimize()}function $c(c,h,a,b){uc.call(this,c,h,a,b)}function yd(c,
h,a,b){Na.call(this,c,h,a,b)}function nd(c,h,a,b){uc.call(this,c,h,a,b)}function ad(c,h,a,b){uc.call(this,c,h,a,b)}function zd(c,h,a,b){uc.call(this,c,h,a,b)}function Ad(c,h,a){uc.call(this,c,h,a)}function Bd(c,h,a,b){uc.call(this,c,h,a,b)}function Oc(c,h,a,b){uc.apply(this,arguments)}function Jb(c,h,a){this.name=c;this.tracks=a;this.duration=void 0!==h?h:-1;this.uuid=l.Math.generateUUID();0>this.duration&&this.resetDuration();this.optimize()}function Cd(c){this.manager=void 0!==c?c:l.DefaultLoadingManager;
this.textures={}}function Qd(c){this.manager=void 0!==c?c:l.DefaultLoadingManager}function Pc(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}}function Rd(c){"boolean"===typeof c&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),c=void 0);this.manager=void 0!==c?c:l.DefaultLoadingManager;this.withCredentials=!1}function ue(c){this.manager=void 0!==c?c:l.DefaultLoadingManager;this.texturePath=""}function pb(){}
function vc(c,h){this.v1=c;this.v2=h}function od(){this.curves=[];this.autoClose=!1}function Gc(c,h,a,b,d,e,f,g){this.aX=c;this.aY=h;this.xRadius=a;this.yRadius=b;this.aStartAngle=d;this.aEndAngle=e;this.aClockwise=f;this.aRotation=g||0}function Qc(c){this.points=void 0===c?[]:c}function Rc(c,h,a,b){this.v0=c;this.v1=h;this.v2=a;this.v3=b}function Sc(c,h,a){this.v0=c;this.v1=h;this.v2=a}function Tc(){pd.apply(this,arguments);this.holes=[]}function pd(c){od.call(this);this.currentPoint=new g;c&&this.fromPoints(c)}
function Sd(){this.subPaths=[];this.currentPath=null}function Td(c){this.data=c}function ve(c){this.manager=void 0!==c?c:l.DefaultLoadingManager}function Ud(){void 0===Vd&&(Vd=new (window.AudioContext||window.webkitAudioContext));return Vd}function Wd(c){this.manager=void 0!==c?c:l.DefaultLoadingManager}function we(){this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new cb;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new cb;this.cameraR.layers.enable(2);
this.cameraR.matrixAutoUpdate=!1}function Dd(c,h,a){ca.call(this);this.type="CubeCamera";var b=new cb(90,1,c,h);b.up.set(0,-1,0);b.lookAt(new f(1,0,0));this.add(b);var t=new cb(90,1,c,h);t.up.set(0,-1,0);t.lookAt(new f(-1,0,0));this.add(t);var e=new cb(90,1,c,h);e.up.set(0,0,1);e.lookAt(new f(0,1,0));this.add(e);var g=new cb(90,1,c,h);g.up.set(0,0,-1);g.lookAt(new f(0,-1,0));this.add(g);var k=new cb(90,1,c,h);k.up.set(0,-1,0);k.lookAt(new f(0,0,1));this.add(k);var l=new cb(90,1,c,h);l.up.set(0,-1,
0);l.lookAt(new f(0,0,-1));this.add(l);this.renderTarget=new d(a,a,{format:1022,magFilter:1006,minFilter:1006});this.updateCubeMap=function(c,h){null===this.parent&&this.updateMatrixWorld();var a=this.renderTarget,d=a.texture.generateMipmaps;a.texture.generateMipmaps=!1;a.activeCubeFace=0;c.render(h,b,a);a.activeCubeFace=1;c.render(h,t,a);a.activeCubeFace=2;c.render(h,e,a);a.activeCubeFace=3;c.render(h,g,a);a.activeCubeFace=4;c.render(h,k,a);a.texture.generateMipmaps=d;a.activeCubeFace=5;c.render(h,
l,a);c.setRenderTarget(null)}}function Xd(){ca.call(this);this.type="AudioListener";this.context=Ud();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null}function bd(c){ca.call(this);this.type="Audio";this.context=c.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(c.getInput());this.autoplay=!1;this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=
!0;this.sourceType="empty";this.filters=[]}function Yd(c){bd.call(this,c);this.panner=this.context.createPanner();this.panner.connect(this.gain)}function Zd(c,h){this.analyser=c.context.createAnalyser();this.analyser.fftSize=void 0!==h?h:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);c.getOutput().connect(this.analyser)}function Ed(c,h,a){this.binding=c;this.valueSize=a;c=Float64Array;switch(h){case "quaternion":h=this._slerp;break;case "string":case "bool":c=Array;h=this._select;
break;default:h=this._lerp}this.buffer=new c(4*a);this._mixBufferRegion=h;this.referenceCount=this.useCount=this.cumulativeWeight=0}function Pa(c,h,a){this.path=h;this.parsedPath=a||Pa.parseTrackName(h);this.node=Pa.findNode(c,this.parsedPath.nodeName)||c;this.rootNode=c}function $d(c){this.uuid=l.Math.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var h={};this._indicesByUUID=h;for(var a=0,b=arguments.length;a!==b;++a)h[arguments[a].uuid]=a;this._paths=
[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var d=this;this.stats={objects:{get total(){return d._objects.length},get inUse(){return this.total-d.nCachedObjects_}},get bindingsPerObject(){return d._bindings.length}}}function ae(c,h,a){this._mixer=c;this._clip=h;this._localRoot=a||null;c=h.tracks;h=c.length;a=Array(h);for(var b={endingStart:2400,endingEnd:2400},t=0;t!==h;++t){var d=c[t].createInterpolant(null);a[t]=d;d.settings=b}this._interpolantSettings=b;this._interpolants=
a;this._propertyBindings=Array(h);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=2201;this._loopCount=-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function be(c){this._root=c;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1}function ce(c,
h){"string"===typeof c&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),c=h);this.value=c;this.dynamic=!1}function Uc(){ia.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0}function de(c,h,a,b){this.uuid=l.Math.generateUUID();this.data=c;this.itemSize=h;this.offset=a;this.normalized=!0===b}function cd(c,h){this.uuid=l.Math.generateUUID();this.array=c;this.stride=h;this.count=void 0!==c?c.length/h:0;this.dynamic=!1;this.updateRange={offset:0,count:-1};
this.version=0}function dd(c,h,a){cd.call(this,c,h);this.meshPerAttribute=a||1}function ed(c,h,a){P.call(this,c,h);this.meshPerAttribute=a||1}function ee(c,h,a,b){this.ray=new ra(c,h);this.near=a||0;this.far=b||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})}function xe(c,h){return c.distance-h.distance}
function fe(c,h,a,b){if(!1!==c.visible&&(c.raycast(h,a),!0===b)){c=c.children;b=0;for(var t=c.length;b<t;b++)fe(c[b],h,a,!0)}}function ge(c){this.autoStart=void 0!==c?c:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1}function he(c,h,a){this.radius=void 0!==c?c:1;this.phi=void 0!==h?h:0;this.theta=void 0!==a?a:0;return this}function kb(c,h){Ca.call(this,c,h);this.animationsMap={};this.animationsList=[];var a=this.geometry.morphTargets.length;this.createAnimation("__default",0,a-1,
a/1);this.setAnimationWeight("__default",1)}function qd(c){ca.call(this);this.material=c;this.render=function(c){}}function rd(c,h,a,b){this.object=c;this.size=void 0!==h?h:1;c=void 0!==a?a:16711680;b=void 0!==b?b:1;h=0;(a=this.object.geometry)&&a.isGeometry?h=3*a.faces.length:a&&a.isBufferGeometry&&(h=a.attributes.normal.count);a=new ia;h=new Oa(6*h,3);a.addAttribute("position",h);Ka.call(this,a,new Qa({color:c,linewidth:b}));this.matrixAutoUpdate=!1;this.update()}function fd(c){ca.call(this);this.light=
c;this.light.updateMatrixWorld();this.matrix=c.matrixWorld;this.matrixAutoUpdate=!1;c=new ia;for(var h=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],a=0,b=1;32>a;a++,b++){var d=a/32*Math.PI*2,e=b/32*Math.PI*2;h.push(Math.cos(d),Math.sin(d),1,Math.cos(e),Math.sin(e),1)}c.addAttribute("position",new Oa(h,3));h=new Qa({fog:!1});this.cone=new Ka(c,h);this.add(this.cone);this.update()}function gd(c){this.bones=this.getBoneList(c);for(var h=new ma,a=0;a<this.bones.length;a++){var b=this.bones[a];
b.parent&&b.parent.isBone&&(h.vertices.push(new f),h.vertices.push(new f),h.colors.push(new V(0,0,1)),h.colors.push(new V(0,1,0)))}h.dynamic=!0;a=new Qa({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});Ka.call(this,h,a);this.root=c;this.matrix=c.matrixWorld;this.matrixAutoUpdate=!1;this.update()}function hd(c,h){this.light=c;this.light.updateMatrixWorld();var a=new Ta(h,4,2),b=new oa({wireframe:!0,fog:!1});b.color.copy(this.light.color).multiplyScalar(this.light.intensity);Ca.call(this,
a,b);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1}function id(c,h){ca.call(this);this.light=c;this.light.updateMatrixWorld();this.matrix=c.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new V,new V];var a=new gc(h,4,2);a.rotateX(-Math.PI/2);for(var b=0;8>b;b++)a.faces[b].color=this.colors[4>b?0:1];b=new oa({vertexColors:1,wireframe:!0});this.lightSphere=new Ca(a,b);this.add(this.lightSphere);this.update()}function sd(c,h,a,b){h=h||1;a=new V(void 0!==a?a:4473924);b=new V(void 0!==
b?b:8947848);for(var t=h/2,d=2*c/h,y=[],e=[],f=0,g=0,k=-c;f<=h;f++,k+=d){y.push(-c,0,k,c,0,k);y.push(k,0,-c,k,0,c);var l=f===t?a:b;l.toArray(e,g);g+=3;l.toArray(e,g);g+=3;l.toArray(e,g);g+=3;l.toArray(e,g);g+=3}c=new ia;c.addAttribute("position",new Oa(y,3));c.addAttribute("color",new Oa(e,3));y=new Qa({vertexColors:2});Ka.call(this,c,y)}function td(c,h,a,b){this.object=c;this.size=void 0!==h?h:1;c=void 0!==a?a:16776960;b=void 0!==b?b:1;h=0;(a=this.object.geometry)&&a.isGeometry?h=a.faces.length:
console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");a=new ia;h=new Oa(6*h,3);a.addAttribute("position",h);Ka.call(this,a,new Qa({color:c,linewidth:b}));this.matrixAutoUpdate=!1;this.update()}function jd(c,h){ca.call(this);this.light=c;this.light.updateMatrixWorld();this.matrix=c.matrixWorld;this.matrixAutoUpdate=!1;void 0===h&&(h=1);var a=new ia;a.addAttribute("position",new Oa([-h,h,0,h,h,0,h,-h,0,-h,-h,0,-h,h,0],3));var b=new Qa({fog:!1});
this.add(new xb(a,b));a=new ia;a.addAttribute("position",new Oa([0,0,0,0,0,1],3));this.add(new xb(a,b));this.update()}function ud(c){function h(c,h,b){a(c,b);a(h,b)}function a(c,h){b.vertices.push(new f);b.colors.push(new V(h));void 0===e[c]&&(e[c]=[]);e[c].push(b.vertices.length-1)}var b=new ma,d=new Qa({color:16777215,vertexColors:1}),e={};h("n1","n2",16755200);h("n2","n4",16755200);h("n4","n3",16755200);h("n3","n1",16755200);h("f1","f2",16755200);h("f2","f4",16755200);h("f4","f3",16755200);h("f3",
"f1",16755200);h("n1","f1",16755200);h("n2","f2",16755200);h("n3","f3",16755200);h("n4","f4",16755200);h("p","n1",16711680);h("p","n2",16711680);h("p","n3",16711680);h("p","n4",16711680);h("u1","u2",43775);h("u2","u3",43775);h("u3","u1",43775);h("c","t",16777215);h("p","c",3355443);h("cn1","cn2",3355443);h("cn3","cn4",3355443);h("cf1","cf2",3355443);h("cf3","cf4",3355443);Ka.call(this,b,d);this.camera=c;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=c.matrixWorld;
this.matrixAutoUpdate=!1;this.pointMap=e;this.update()}function vd(c,h){var a=void 0!==h?h:8947848;this.object=c;this.box=new sa;Ca.call(this,new Ib(1,1,1),new oa({color:a,wireframe:!0}))}function wd(c,h){void 0===h&&(h=16776960);var a=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),b=new Float32Array(24),d=new ia;d.setIndex(new P(a,1));d.addAttribute("position",new P(b,3));Ka.call(this,d,new Qa({color:h}));void 0!==c&&this.update(c)}function Vc(c,h,a,b,d,e){ca.call(this);void 0===
b&&(b=16776960);void 0===a&&(a=1);void 0===d&&(d=.2*a);void 0===e&&(e=.2*d);this.position.copy(h);this.line=new xb(ye,new Qa({color:b}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new Ca(ze,new oa({color:b}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(c);this.setLength(a,d,e)}function Fd(c){c=c||1;var h=new Float32Array([0,0,0,c,0,0,0,0,0,0,c,0,0,0,0,0,0,c]),a=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);c=new ia;c.addAttribute("position",new P(h,
3));c.addAttribute("color",new P(a,3));h=new Qa({vertexColors:2});Ka.call(this,c,h)}function Ae(c){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3.");l.CatmullRomCurve3.call(this,c);this.type="catmullrom";this.closed=!0}function Gd(c,h,a,b,d,e){Gc.call(this,c,h,a,a,b,d,e)}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Math.sign&&(Math.sign=function(c){return 0>c?-1:0<c?1:+c});void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,
"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});void 0===Object.assign&&function(){Object.assign=function(c){if(void 0===c||null===c)throw new TypeError("Cannot convert undefined or null to object");for(var h=Object(c),a=1;a<arguments.length;a++){var b=arguments[a];if(void 0!==b&&null!==b)for(var d in b)Object.prototype.hasOwnProperty.call(b,d)&&(h[d]=b[d])}return h}}();Object.assign(b.prototype,{addEventListener:function(c,h){void 0===this._listeners&&(this._listeners=
{});var a=this._listeners;void 0===a[c]&&(a[c]=[]);-1===a[c].indexOf(h)&&a[c].push(h)},hasEventListener:function(c,h){if(void 0===this._listeners)return!1;var a=this._listeners;return void 0!==a[c]&&-1!==a[c].indexOf(h)?!0:!1},removeEventListener:function(c,h){if(void 0!==this._listeners){var a=this._listeners[c];if(void 0!==a){var b=a.indexOf(h);-1!==b&&a.splice(b,1)}}},dispatchEvent:function(c){if(void 0!==this._listeners){var h=this._listeners[c.type];if(void 0!==h){c.target=this;var a=[],b,d=
h.length;for(b=0;b<d;b++)a[b]=h[b];for(b=0;b<d;b++)a[b].call(this,c)}}}});var Be={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},Ce={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},ie={RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},je=
{NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008};l.Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),h=Array(36),a=0,b;return function(){for(var t=0;36>t;t++)8===t||13===t||18===t||23===t?h[t]="-":14===t?h[t]="4":(2>=a&&(a=33554432+16777216*Math.random()|0),b=a&15,a>>=4,h[t]=c[19===t?b&
3|8:b]);return h.join("")}}(),clamp:function(c,h,a){return Math.max(h,Math.min(a,c))},euclideanModulo:function(c,h){return(c%h+h)%h},mapLinear:function(c,h,a,b,d){return b+(c-h)*(d-b)/(a-h)},smoothstep:function(c,h,a){if(c<=h)return 0;if(c>=a)return 1;c=(c-h)/(a-h);return c*c*(3-2*c)},smootherstep:function(c,h,a){if(c<=h)return 0;if(c>=a)return 1;c=(c-h)/(a-h);return c*c*c*(c*(6*c-15)+10)},random16:function(){console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead.");return Math.random()},
randInt:function(c,h){return c+Math.floor(Math.random()*(h-c+1))},randFloat:function(c,h){return c+Math.random()*(h-c)},randFloatSpread:function(c){return c*(.5-Math.random())},degToRad:function(c){return c*l.Math.DEG2RAD},radToDeg:function(c){return c*l.Math.RAD2DEG},isPowerOfTwo:function(c){return 0===(c&c-1)&&0!==c},nearestPowerOfTwo:function(c){return Math.pow(2,Math.round(Math.log(c)/Math.LN2))},nextPowerOfTwo:function(c){c--;c|=c>>1;c|=c>>2;c|=c>>4;c|=c>>8;c|=c>>16;c++;return c}};g.prototype=
{constructor:g,isVector2:!0,get width(){return this.x},set width(c){this.x=c},get height(){return this.y},set height(c){this.y=c},set:function(c,h){this.x=c;this.y=h;return this},setScalar:function(c){this.y=this.x=c;return this},setX:function(c){this.x=c;return this},setY:function(c){this.y=c;return this},setComponent:function(c,h){switch(c){case 0:this.x=h;break;case 1:this.y=h;break;default:throw Error("index is out of range: "+c);}},getComponent:function(c){switch(c){case 0:return this.x;case 1:return this.y;
default:throw Error("index is out of range: "+c);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(c){this.x=c.x;this.y=c.y;return this},add:function(c,h){if(void 0!==h)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(c,h);this.x+=c.x;this.y+=c.y;return this},addScalar:function(c){this.x+=c;this.y+=c;return this},addVectors:function(c,h){this.x=c.x+h.x;this.y=c.y+h.y;return this},addScaledVector:function(c,
h){this.x+=c.x*h;this.y+=c.y*h;return this},sub:function(c,h){if(void 0!==h)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(c,h);this.x-=c.x;this.y-=c.y;return this},subScalar:function(c){this.x-=c;this.y-=c;return this},subVectors:function(c,h){this.x=c.x-h.x;this.y=c.y-h.y;return this},multiply:function(c){this.x*=c.x;this.y*=c.y;return this},multiplyScalar:function(c){isFinite(c)?(this.x*=c,this.y*=c):this.y=this.x=0;
return this},divide:function(c){this.x/=c.x;this.y/=c.y;return this},divideScalar:function(c){return this.multiplyScalar(1/c)},min:function(c){this.x=Math.min(this.x,c.x);this.y=Math.min(this.y,c.y);return this},max:function(c){this.x=Math.max(this.x,c.x);this.y=Math.max(this.y,c.y);return this},clamp:function(c,h){this.x=Math.max(c.x,Math.min(h.x,this.x));this.y=Math.max(c.y,Math.min(h.y,this.y));return this},clampScalar:function(){var c,h;return function(a,b){void 0===c&&(c=new g,h=new g);c.set(a,
a);h.set(b,b);return this.clamp(c,h)}}(),clampLength:function(c,h){var a=this.length();return this.multiplyScalar(Math.max(c,Math.min(h,a))/a)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);
return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(c){return this.x*c.x+this.y*c.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var c=Math.atan2(this.y,this.x);0>c&&(c+=2*Math.PI);return c},distanceTo:function(c){return Math.sqrt(this.distanceToSquared(c))},
distanceToSquared:function(c){var h=this.x-c.x;c=this.y-c.y;return h*h+c*c},distanceToManhattan:function(c){return Math.abs(this.x-c.x)+Math.abs(this.y-c.y)},setLength:function(c){return this.multiplyScalar(c/this.length())},lerp:function(c,h){this.x+=(c.x-this.x)*h;this.y+=(c.y-this.y)*h;return this},lerpVectors:function(c,h,a){return this.subVectors(h,c).multiplyScalar(a).add(c)},equals:function(c){return c.x===this.x&&c.y===this.y},fromArray:function(c,h){void 0===h&&(h=0);this.x=c[h];this.y=c[h+
1];return this},toArray:function(c,h){void 0===c&&(c=[]);void 0===h&&(h=0);c[h]=this.x;c[h+1]=this.y;return c},fromAttribute:function(c,h,a){void 0===a&&(a=0);h=h*c.itemSize+a;this.x=c.array[h];this.y=c.array[h+1];return this},rotateAround:function(c,a){var h=Math.cos(a),b=Math.sin(a),d=this.x-c.x,e=this.y-c.y;this.x=d*h-e*b+c.x;this.y=d*b+e*h+c.y;return this}};m.DEFAULT_IMAGE=void 0;m.DEFAULT_MAPPING=300;m.prototype={constructor:m,isTexture:!0,set needsUpdate(c){!0===c&&this.version++},clone:function(){return(new this.constructor).copy(this)},
copy:function(c){this.image=c.image;this.mipmaps=c.mipmaps.slice(0);this.mapping=c.mapping;this.wrapS=c.wrapS;this.wrapT=c.wrapT;this.magFilter=c.magFilter;this.minFilter=c.minFilter;this.anisotropy=c.anisotropy;this.format=c.format;this.type=c.type;this.offset.copy(c.offset);this.repeat.copy(c.repeat);this.generateMipmaps=c.generateMipmaps;this.premultiplyAlpha=c.premultiplyAlpha;this.flipY=c.flipY;this.unpackAlignment=c.unpackAlignment;this.encoding=c.encoding;return this},toJSON:function(c){if(void 0!==
c.textures[this.uuid])return c.textures[this.uuid];var a={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var b=this.image;void 0===b.uuid&&(b.uuid=l.Math.generateUUID());if(void 0===c.images[b.uuid]){var d=c.images,
e=b.uuid,f=b.uuid,g;void 0!==b.toDataURL?g=b:(g=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),g.width=b.width,g.height=b.height,g.getContext("2d").drawImage(b,0,0,b.width,b.height));g=2048<g.width||2048<g.height?g.toDataURL("image/jpeg",.6):g.toDataURL("image/png");d[e]={uuid:f,url:g}}a.image=b.uuid}return c.textures[this.uuid]=a},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(c){if(300===this.mapping){c.multiply(this.repeat);c.add(this.offset);if(0>
c.x||1<c.x)switch(this.wrapS){case 1E3:c.x-=Math.floor(c.x);break;case 1001:c.x=0>c.x?0:1;break;case 1002:c.x=1===Math.abs(Math.floor(c.x)%2)?Math.ceil(c.x)-c.x:c.x-Math.floor(c.x)}if(0>c.y||1<c.y)switch(this.wrapT){case 1E3:c.y-=Math.floor(c.y);break;case 1001:c.y=0>c.y?0:1;break;case 1002:c.y=1===Math.abs(Math.floor(c.y)%2)?Math.ceil(c.y)-c.y:c.y-Math.floor(c.y)}this.flipY&&(c.y=1-c.y)}}};Object.assign(m.prototype,b.prototype);var ne=0;a.prototype={constructor:a,isVector4:!0,set:function(c,a,b,
d){this.x=c;this.y=a;this.z=b;this.w=d;return this},setScalar:function(c){this.w=this.z=this.y=this.x=c;return this},setX:function(c){this.x=c;return this},setY:function(c){this.y=c;return this},setZ:function(c){this.z=c;return this},setW:function(c){this.w=c;return this},setComponent:function(c,a){switch(c){case 0:this.x=a;break;case 1:this.y=a;break;case 2:this.z=a;break;case 3:this.w=a;break;default:throw Error("index is out of range: "+c);}},getComponent:function(c){switch(c){case 0:return this.x;
case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+c);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(c){this.x=c.x;this.y=c.y;this.z=c.z;this.w=void 0!==c.w?c.w:1;return this},add:function(c,a){if(void 0!==a)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(c,a);this.x+=c.x;this.y+=c.y;this.z+=c.z;this.w+=c.w;return this},
addScalar:function(c){this.x+=c;this.y+=c;this.z+=c;this.w+=c;return this},addVectors:function(c,a){this.x=c.x+a.x;this.y=c.y+a.y;this.z=c.z+a.z;this.w=c.w+a.w;return this},addScaledVector:function(c,a){this.x+=c.x*a;this.y+=c.y*a;this.z+=c.z*a;this.w+=c.w*a;return this},sub:function(c,a){if(void 0!==a)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(c,a);this.x-=c.x;this.y-=c.y;this.z-=c.z;this.w-=c.w;return this},subScalar:function(c){this.x-=
c;this.y-=c;this.z-=c;this.w-=c;return this},subVectors:function(c,a){this.x=c.x-a.x;this.y=c.y-a.y;this.z=c.z-a.z;this.w=c.w-a.w;return this},multiplyScalar:function(c){isFinite(c)?(this.x*=c,this.y*=c,this.z*=c,this.w*=c):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(c){var a=this.x,b=this.y,d=this.z,e=this.w;c=c.elements;this.x=c[0]*a+c[4]*b+c[8]*d+c[12]*e;this.y=c[1]*a+c[5]*b+c[9]*d+c[13]*e;this.z=c[2]*a+c[6]*b+c[10]*d+c[14]*e;this.w=c[3]*a+c[7]*b+c[11]*d+c[15]*e;return this},
divideScalar:function(c){return this.multiplyScalar(1/c)},setAxisAngleFromQuaternion:function(c){this.w=2*Math.acos(c.w);var a=Math.sqrt(1-c.w*c.w);1E-4>a?(this.x=1,this.z=this.y=0):(this.x=c.x/a,this.y=c.y/a,this.z=c.z/a);return this},setAxisAngleFromRotationMatrix:function(c){c=c.elements;var a=c[0];var b=c[4];var d=c[8],e=c[1],f=c[5],g=c[9];var k=c[2];var l=c[6];var n=c[10];if(.01>Math.abs(b-e)&&.01>Math.abs(d-k)&&.01>Math.abs(g-l)){if(.1>Math.abs(b+e)&&.1>Math.abs(d+k)&&.1>Math.abs(g+l)&&.1>Math.abs(a+
f+n-3))return this.set(1,0,0,0),this;c=Math.PI;a=(a+1)/2;f=(f+1)/2;n=(n+1)/2;b=(b+e)/4;d=(d+k)/4;g=(g+l)/4;a>f&&a>n?.01>a?(l=0,b=k=.707106781):(l=Math.sqrt(a),k=b/l,b=d/l):f>n?.01>f?(l=.707106781,k=0,b=.707106781):(k=Math.sqrt(f),l=b/k,b=g/k):.01>n?(k=l=.707106781,b=0):(b=Math.sqrt(n),l=d/b,k=g/b);this.set(l,k,b,c);return this}c=Math.sqrt((l-g)*(l-g)+(d-k)*(d-k)+(e-b)*(e-b));.001>Math.abs(c)&&(c=1);this.x=(l-g)/c;this.y=(d-k)/c;this.z=(e-b)/c;this.w=Math.acos((a+f+n-1)/2);return this},min:function(c){this.x=
Math.min(this.x,c.x);this.y=Math.min(this.y,c.y);this.z=Math.min(this.z,c.z);this.w=Math.min(this.w,c.w);return this},max:function(c){this.x=Math.max(this.x,c.x);this.y=Math.max(this.y,c.y);this.z=Math.max(this.z,c.z);this.w=Math.max(this.w,c.w);return this},clamp:function(c,a){this.x=Math.max(c.x,Math.min(a.x,this.x));this.y=Math.max(c.y,Math.min(a.y,this.y));this.z=Math.max(c.z,Math.min(a.z,this.z));this.w=Math.max(c.w,Math.min(a.w,this.w));return this},clampScalar:function(){var c,h;return function(b,
d){void 0===c&&(c=new a,h=new a);c.set(b,b,b,b);h.set(d,d,d,d);return this.clamp(c,h)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=
0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(c){return this.x*c.x+this.y*c.y+this.z*c.z+this.w*c.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*
this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(c){return this.multiplyScalar(c/this.length())},lerp:function(c,a){this.x+=(c.x-this.x)*a;this.y+=(c.y-this.y)*a;this.z+=(c.z-this.z)*a;this.w+=(c.w-this.w)*a;return this},lerpVectors:function(c,a,b){return this.subVectors(a,c).multiplyScalar(b).add(c)},equals:function(c){return c.x===
this.x&&c.y===this.y&&c.z===this.z&&c.w===this.w},fromArray:function(c,a){void 0===a&&(a=0);this.x=c[a];this.y=c[a+1];this.z=c[a+2];this.w=c[a+3];return this},toArray:function(c,a){void 0===c&&(c=[]);void 0===a&&(a=0);c[a]=this.x;c[a+1]=this.y;c[a+2]=this.z;c[a+3]=this.w;return c},fromAttribute:function(c,a,b){void 0===b&&(b=0);a=a*c.itemSize+b;this.x=c.array[a];this.y=c.array[a+1];this.z=c.array[a+2];this.w=c.array[a+3];return this}};Object.assign(e.prototype,b.prototype,{isWebGLRenderTarget:!0,
setSize:function(c,a){if(this.width!==c||this.height!==a)this.width=c,this.height=a,this.dispose();this.viewport.set(0,0,c,a);this.scissor.set(0,0,c,a)},clone:function(){return(new this.constructor).copy(this)},copy:function(c){this.width=c.width;this.height=c.height;this.viewport.copy(c.viewport);this.texture=c.texture.clone();this.depthBuffer=c.depthBuffer;this.stencilBuffer=c.stencilBuffer;this.depthTexture=c.depthTexture;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});
d.prototype=Object.create(e.prototype);d.prototype.constructor=d;d.prototype.isWebGLRenderTargetCube=!0;q.prototype={constructor:q,get x(){return this._x},set x(c){this._x=c;this.onChangeCallback()},get y(){return this._y},set y(c){this._y=c;this.onChangeCallback()},get z(){return this._z},set z(c){this._z=c;this.onChangeCallback()},get w(){return this._w},set w(c){this._w=c;this.onChangeCallback()},set:function(c,a,b,d){this._x=c;this._y=a;this._z=b;this._w=d;this.onChangeCallback();return this},
clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(c){this._x=c.x;this._y=c.y;this._z=c.z;this._w=c.w;this.onChangeCallback();return this},setFromEuler:function(c,a){if(!1===(c&&c.isEuler))throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var h=Math.cos(c._x/2),b=Math.cos(c._y/2),d=Math.cos(c._z/2),e=Math.sin(c._x/2),f=Math.sin(c._y/2),g=Math.sin(c._z/2),k=c.order;"XYZ"===k?(this._x=e*b*d+h*f*g,
this._y=h*f*d-e*b*g,this._z=h*b*g+e*f*d,this._w=h*b*d-e*f*g):"YXZ"===k?(this._x=e*b*d+h*f*g,this._y=h*f*d-e*b*g,this._z=h*b*g-e*f*d,this._w=h*b*d+e*f*g):"ZXY"===k?(this._x=e*b*d-h*f*g,this._y=h*f*d+e*b*g,this._z=h*b*g+e*f*d,this._w=h*b*d-e*f*g):"ZYX"===k?(this._x=e*b*d-h*f*g,this._y=h*f*d+e*b*g,this._z=h*b*g-e*f*d,this._w=h*b*d+e*f*g):"YZX"===k?(this._x=e*b*d+h*f*g,this._y=h*f*d+e*b*g,this._z=h*b*g-e*f*d,this._w=h*b*d-e*f*g):"XZY"===k&&(this._x=e*b*d-h*f*g,this._y=h*f*d-e*b*g,this._z=h*b*g+e*f*d,
this._w=h*b*d+e*f*g);if(!1!==a)this.onChangeCallback();return this},setFromAxisAngle:function(c,a){var h=a/2,b=Math.sin(h);this._x=c.x*b;this._y=c.y*b;this._z=c.z*b;this._w=Math.cos(h);this.onChangeCallback();return this},setFromRotationMatrix:function(c){var a=c.elements,b=a[0];c=a[4];var d=a[8],e=a[1],f=a[5],g=a[9],k=a[2],l=a[6];a=a[10];var n=b+f+a;0<n?(b=.5/Math.sqrt(n+1),this._w=.25/b,this._x=(l-g)*b,this._y=(d-k)*b,this._z=(e-c)*b):b>f&&b>a?(b=2*Math.sqrt(1+b-f-a),this._w=(l-g)/b,this._x=.25*
b,this._y=(c+e)/b,this._z=(d+k)/b):f>a?(b=2*Math.sqrt(1+f-b-a),this._w=(d-k)/b,this._x=(c+e)/b,this._y=.25*b,this._z=(g+l)/b):(b=2*Math.sqrt(1+a-b-f),this._w=(e-c)/b,this._x=(d+k)/b,this._y=(g+l)/b,this._z=.25*b);this.onChangeCallback();return this},setFromUnitVectors:function(){var c,a;return function(h,b){void 0===c&&(c=new f);a=h.dot(b)+1;1E-6>a?(a=0,Math.abs(h.x)>Math.abs(h.z)?c.set(-h.y,h.x,0):c.set(0,-h.z,h.y)):c.crossVectors(h,b);this._x=c.x;this._y=c.y;this._z=c.z;this._w=a;return this.normalize()}}(),
inverse:function(){return this.conjugate().normalize()},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(c){return this._x*c._x+this._y*c._y+this._z*c._z+this._w*c._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var c=this.length();0===c?(this._z=this._y=this._x=0,this._w=
1):(c=1/c,this._x*=c,this._y*=c,this._z*=c,this._w*=c);this.onChangeCallback();return this},multiply:function(c,a){return void 0!==a?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(c,a)):this.multiplyQuaternions(this,c)},premultiply:function(c){return this.multiplyQuaternions(c,this)},multiplyQuaternions:function(c,a){var h=c._x,b=c._y,d=c._z,e=c._w,f=a._x,g=a._y,k=a._z,l=a._w;this._x=h*l+e*f+b*k-d*g;
this._y=b*l+e*g+d*f-h*k;this._z=d*l+e*k+h*g-b*f;this._w=e*l-h*f-b*g-d*k;this.onChangeCallback();return this},slerp:function(c,a){if(0===a)return this;if(1===a)return this.copy(c);var h=this._x,b=this._y,d=this._z,e=this._w,f=e*c._w+h*c._x+b*c._y+d*c._z;0>f?(this._w=-c._w,this._x=-c._x,this._y=-c._y,this._z=-c._z,f=-f):this.copy(c);if(1<=f)return this._w=e,this._x=h,this._y=b,this._z=d,this;var g=Math.sqrt(1-f*f);if(.001>Math.abs(g))return this._w=.5*(e+this._w),this._x=.5*(h+this._x),this._y=.5*(b+
this._y),this._z=.5*(d+this._z),this;var k=Math.atan2(g,f);f=Math.sin((1-a)*k)/g;g=Math.sin(a*k)/g;this._w=e*f+this._w*g;this._x=h*f+this._x*g;this._y=b*f+this._y*g;this._z=d*f+this._z*g;this.onChangeCallback();return this},equals:function(c){return c._x===this._x&&c._y===this._y&&c._z===this._z&&c._w===this._w},fromArray:function(c,a){void 0===a&&(a=0);this._x=c[a];this._y=c[a+1];this._z=c[a+2];this._w=c[a+3];this.onChangeCallback();return this},toArray:function(c,a){void 0===c&&(c=[]);void 0===
a&&(a=0);c[a]=this._x;c[a+1]=this._y;c[a+2]=this._z;c[a+3]=this._w;return c},onChange:function(c){this.onChangeCallback=c;return this},onChangeCallback:function(){}};Object.assign(q,{slerp:function(c,a,b,d){return b.copy(c).slerp(a,d)},slerpFlat:function(c,a,b,d,e,f,g){var h=b[d+0],t=b[d+1],y=b[d+2];b=b[d+3];d=e[f+0];var k=e[f+1],C=e[f+2];e=e[f+3];if(b!==e||h!==d||t!==k||y!==C){f=1-g;var l=h*d+t*k+y*C+b*e,n=0<=l?1:-1,M=1-l*l;M>Number.EPSILON&&(M=Math.sqrt(M),l=Math.atan2(M,l*n),f=Math.sin(f*l)/M,
g=Math.sin(g*l)/M);n*=g;h=h*f+d*n;t=t*f+k*n;y=y*f+C*n;b=b*f+e*n;f===1-g&&(g=1/Math.sqrt(h*h+t*t+y*y+b*b),h*=g,t*=g,y*=g,b*=g)}c[a]=h;c[a+1]=t;c[a+2]=y;c[a+3]=b}});f.prototype={constructor:f,isVector3:!0,set:function(c,a,b){this.x=c;this.y=a;this.z=b;return this},setScalar:function(c){this.z=this.y=this.x=c;return this},setX:function(c){this.x=c;return this},setY:function(c){this.y=c;return this},setZ:function(c){this.z=c;return this},setComponent:function(c,a){switch(c){case 0:this.x=a;break;case 1:this.y=
a;break;case 2:this.z=a;break;default:throw Error("index is out of range: "+c);}},getComponent:function(c){switch(c){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+c);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(c){this.x=c.x;this.y=c.y;this.z=c.z;return this},add:function(c,a){if(void 0!==a)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
this.addVectors(c,a);this.x+=c.x;this.y+=c.y;this.z+=c.z;return this},addScalar:function(c){this.x+=c;this.y+=c;this.z+=c;return this},addVectors:function(c,a){this.x=c.x+a.x;this.y=c.y+a.y;this.z=c.z+a.z;return this},addScaledVector:function(c,a){this.x+=c.x*a;this.y+=c.y*a;this.z+=c.z*a;return this},sub:function(c,a){if(void 0!==a)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(c,a);this.x-=c.x;this.y-=c.y;this.z-=c.z;
return this},subScalar:function(c){this.x-=c;this.y-=c;this.z-=c;return this},subVectors:function(c,a){this.x=c.x-a.x;this.y=c.y-a.y;this.z=c.z-a.z;return this},multiply:function(c,a){if(void 0!==a)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(c,a);this.x*=c.x;this.y*=c.y;this.z*=c.z;return this},multiplyScalar:function(c){isFinite(c)?(this.x*=c,this.y*=c,this.z*=c):this.z=this.y=this.x=0;return this},multiplyVectors:function(c,
a){this.x=c.x*a.x;this.y=c.y*a.y;this.z=c.z*a.z;return this},applyEuler:function(){var c;return function(a){!1===(a&&a.isEuler)&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");void 0===c&&(c=new q);return this.applyQuaternion(c.setFromEuler(a))}}(),applyAxisAngle:function(){var c;return function(a,b){void 0===c&&(c=new q);return this.applyQuaternion(c.setFromAxisAngle(a,b))}}(),applyMatrix3:function(c){var a=this.x,b=this.y,d=this.z;c=
c.elements;this.x=c[0]*a+c[3]*b+c[6]*d;this.y=c[1]*a+c[4]*b+c[7]*d;this.z=c[2]*a+c[5]*b+c[8]*d;return this},applyMatrix4:function(c){var a=this.x,b=this.y,d=this.z;c=c.elements;this.x=c[0]*a+c[4]*b+c[8]*d+c[12];this.y=c[1]*a+c[5]*b+c[9]*d+c[13];this.z=c[2]*a+c[6]*b+c[10]*d+c[14];return this},applyProjection:function(c){var a=this.x,b=this.y,d=this.z;c=c.elements;var e=1/(c[3]*a+c[7]*b+c[11]*d+c[15]);this.x=(c[0]*a+c[4]*b+c[8]*d+c[12])*e;this.y=(c[1]*a+c[5]*b+c[9]*d+c[13])*e;this.z=(c[2]*a+c[6]*b+
c[10]*d+c[14])*e;return this},applyQuaternion:function(c){var a=this.x,b=this.y,d=this.z,e=c.x,f=c.y,g=c.z;c=c.w;var k=c*a+f*d-g*b,l=c*b+g*a-e*d,n=c*d+e*b-f*a;a=-e*a-f*b-g*d;this.x=k*c+a*-e+l*-g-n*-f;this.y=l*c+a*-f+n*-e-k*-g;this.z=n*c+a*-g+k*-f-l*-e;return this},project:function(){var c;return function(a){void 0===c&&(c=new p);c.multiplyMatrices(a.projectionMatrix,c.getInverse(a.matrixWorld));return this.applyProjection(c)}}(),unproject:function(){var c;return function(a){void 0===c&&(c=new p);
c.multiplyMatrices(a.matrixWorld,c.getInverse(a.projectionMatrix));return this.applyProjection(c)}}(),transformDirection:function(c){var a=this.x,b=this.y,d=this.z;c=c.elements;this.x=c[0]*a+c[4]*b+c[8]*d;this.y=c[1]*a+c[5]*b+c[9]*d;this.z=c[2]*a+c[6]*b+c[10]*d;return this.normalize()},divide:function(c){this.x/=c.x;this.y/=c.y;this.z/=c.z;return this},divideScalar:function(c){return this.multiplyScalar(1/c)},min:function(c){this.x=Math.min(this.x,c.x);this.y=Math.min(this.y,c.y);this.z=Math.min(this.z,
c.z);return this},max:function(c){this.x=Math.max(this.x,c.x);this.y=Math.max(this.y,c.y);this.z=Math.max(this.z,c.z);return this},clamp:function(c,a){this.x=Math.max(c.x,Math.min(a.x,this.x));this.y=Math.max(c.y,Math.min(a.y,this.y));this.z=Math.max(c.z,Math.min(a.z,this.z));return this},clampScalar:function(){var c,a;return function(h,b){void 0===c&&(c=new f,a=new f);c.set(h,h,h);a.set(b,b,b);return this.clamp(c,a)}}(),clampLength:function(c,a){var h=this.length();return this.multiplyScalar(Math.max(c,
Math.min(a,h))/h)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):
Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(c){return this.x*c.x+this.y*c.y+this.z*c.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(c){return this.multiplyScalar(c/
this.length())},lerp:function(c,a){this.x+=(c.x-this.x)*a;this.y+=(c.y-this.y)*a;this.z+=(c.z-this.z)*a;return this},lerpVectors:function(c,a,b){return this.subVectors(a,c).multiplyScalar(b).add(c)},cross:function(c,a){if(void 0!==a)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(c,a);var h=this.x,b=this.y,d=this.z;this.x=b*c.z-d*c.y;this.y=d*c.x-h*c.z;this.z=h*c.y-b*c.x;return this},crossVectors:function(c,a){var h=
c.x,b=c.y,d=c.z,e=a.x,f=a.y,g=a.z;this.x=b*g-d*f;this.y=d*e-h*g;this.z=h*f-b*e;return this},projectOnVector:function(c){var a=c.dot(this)/c.lengthSq();return this.copy(c).multiplyScalar(a)},projectOnPlane:function(){var c;return function(a){void 0===c&&(c=new f);c.copy(this).projectOnVector(a);return this.sub(c)}}(),reflect:function(){var c;return function(a){void 0===c&&(c=new f);return this.sub(c.copy(a).multiplyScalar(2*this.dot(a)))}}(),angleTo:function(c){c=this.dot(c)/Math.sqrt(this.lengthSq()*
c.lengthSq());return Math.acos(l.Math.clamp(c,-1,1))},distanceTo:function(c){return Math.sqrt(this.distanceToSquared(c))},distanceToSquared:function(c){var a=this.x-c.x,b=this.y-c.y;c=this.z-c.z;return a*a+b*b+c*c},distanceToManhattan:function(c){return Math.abs(this.x-c.x)+Math.abs(this.y-c.y)+Math.abs(this.z-c.z)},setFromSpherical:function(c){var a=Math.sin(c.phi)*c.radius;this.x=a*Math.sin(c.theta);this.y=Math.cos(c.phi)*c.radius;this.z=a*Math.cos(c.theta);return this},setFromMatrixPosition:function(c){return this.setFromMatrixColumn(c,
3)},setFromMatrixScale:function(c){var a=this.setFromMatrixColumn(c,0).length(),b=this.setFromMatrixColumn(c,1).length();c=this.setFromMatrixColumn(c,2).length();this.x=a;this.y=b;this.z=c;return this},setFromMatrixColumn:function(c,a){if("number"===typeof c){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var h=c;c=a;a=h}return this.fromArray(c.elements,4*a)},equals:function(c){return c.x===this.x&&c.y===this.y&&c.z===this.z},fromArray:function(c,a){void 0===a&&
(a=0);this.x=c[a];this.y=c[a+1];this.z=c[a+2];return this},toArray:function(c,a){void 0===c&&(c=[]);void 0===a&&(a=0);c[a]=this.x;c[a+1]=this.y;c[a+2]=this.z;return c},fromAttribute:function(c,a,b){void 0===b&&(b=0);a=a*c.itemSize+b;this.x=c.array[a];this.y=c.array[a+1];this.z=c.array[a+2];return this}};p.prototype={constructor:p,isMatrix4:!0,set:function(c,a,b,d,e,f,g,k,l,n,m,r,p,q,v,u){var h=this.elements;h[0]=c;h[4]=a;h[8]=b;h[12]=d;h[1]=e;h[5]=f;h[9]=g;h[13]=k;h[2]=l;h[6]=n;h[10]=m;h[14]=r;h[3]=
p;h[7]=q;h[11]=v;h[15]=u;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new p).fromArray(this.elements)},copy:function(c){this.elements.set(c.elements);return this},copyPosition:function(c){var a=this.elements;c=c.elements;a[12]=c[12];a[13]=c[13];a[14]=c[14];return this},extractBasis:function(c,a,b){c.setFromMatrixColumn(this,0);a.setFromMatrixColumn(this,1);b.setFromMatrixColumn(this,2);return this},makeBasis:function(c,a,b){this.set(c.x,
a.x,b.x,0,c.y,a.y,b.y,0,c.z,a.z,b.z,0,0,0,0,1);return this},extractRotation:function(){var c;return function(a){void 0===c&&(c=new f);var h=this.elements,b=a.elements,d=1/c.setFromMatrixColumn(a,0).length(),e=1/c.setFromMatrixColumn(a,1).length();a=1/c.setFromMatrixColumn(a,2).length();h[0]=b[0]*d;h[1]=b[1]*d;h[2]=b[2]*d;h[4]=b[4]*e;h[5]=b[5]*e;h[6]=b[6]*e;h[8]=b[8]*a;h[9]=b[9]*a;h[10]=b[10]*a;return this}}(),makeRotationFromEuler:function(c){!1===(c&&c.isEuler)&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");
var a=this.elements,b=c.x,d=c.y,e=c.z,f=Math.cos(b);b=Math.sin(b);var g=Math.cos(d);d=Math.sin(d);var k=Math.cos(e);e=Math.sin(e);if("XYZ"===c.order){c=f*k;var l=f*e,n=b*k,m=b*e;a[0]=g*k;a[4]=-g*e;a[8]=d;a[1]=l+n*d;a[5]=c-m*d;a[9]=-b*g;a[2]=m-c*d;a[6]=n+l*d;a[10]=f*g}else"YXZ"===c.order?(c=g*k,l=g*e,n=d*k,m=d*e,a[0]=c+m*b,a[4]=n*b-l,a[8]=f*d,a[1]=f*e,a[5]=f*k,a[9]=-b,a[2]=l*b-n,a[6]=m+c*b,a[10]=f*g):"ZXY"===c.order?(c=g*k,l=g*e,n=d*k,m=d*e,a[0]=c-m*b,a[4]=-f*e,a[8]=n+l*b,a[1]=l+n*b,a[5]=f*k,a[9]=
m-c*b,a[2]=-f*d,a[6]=b,a[10]=f*g):"ZYX"===c.order?(c=f*k,l=f*e,n=b*k,m=b*e,a[0]=g*k,a[4]=n*d-l,a[8]=c*d+m,a[1]=g*e,a[5]=m*d+c,a[9]=l*d-n,a[2]=-d,a[6]=b*g,a[10]=f*g):"YZX"===c.order?(c=f*g,l=f*d,n=b*g,m=b*d,a[0]=g*k,a[4]=m-c*e,a[8]=n*e+l,a[1]=e,a[5]=f*k,a[9]=-b*k,a[2]=-d*k,a[6]=l*e+n,a[10]=c-m*e):"XZY"===c.order&&(c=f*g,l=f*d,n=b*g,m=b*d,a[0]=g*k,a[4]=-e,a[8]=d*k,a[1]=c*e+m,a[5]=f*k,a[9]=l*e-n,a[2]=n*e-l,a[6]=b*k,a[10]=m*e+c);a[3]=0;a[7]=0;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return this},makeRotationFromQuaternion:function(c){var a=
this.elements,b=c.x,d=c.y,e=c.z,f=c.w,g=b+b,k=d+d,l=e+e;c=b*g;var n=b*k;b*=l;var m=d*k;d*=l;e*=l;g*=f;k*=f;f*=l;a[0]=1-(m+e);a[4]=n-f;a[8]=b+k;a[1]=n+f;a[5]=1-(c+e);a[9]=d-g;a[2]=b-k;a[6]=d+g;a[10]=1-(c+m);a[3]=0;a[7]=0;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return this},lookAt:function(){var c,a,b;return function(h,d,t){void 0===c&&(c=new f,a=new f,b=new f);var e=this.elements;b.subVectors(h,d).normalize();0===b.lengthSq()&&(b.z=1);c.crossVectors(t,b).normalize();0===c.lengthSq()&&(b.z+=1E-4,c.crossVectors(t,
b).normalize());a.crossVectors(b,c);e[0]=c.x;e[4]=a.x;e[8]=b.x;e[1]=c.y;e[5]=a.y;e[9]=b.y;e[2]=c.z;e[6]=a.z;e[10]=b.z;return this}}(),multiply:function(c,a){return void 0!==a?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(c,a)):this.multiplyMatrices(this,c)},premultiply:function(c){return this.multiplyMatrices(c,this)},multiplyMatrices:function(c,a){var h=c.elements,b=a.elements,d=this.elements,e=h[0],f=h[4],
g=h[8],k=h[12],l=h[1],n=h[5],m=h[9],r=h[13],p=h[2],q=h[6],v=h[10],u=h[14],x=h[3],w=h[7],B=h[11];h=h[15];var z=b[0],A=b[4],D=b[8],F=b[12],R=b[1],E=b[5],G=b[9],ea=b[13],K=b[2],H=b[6],T=b[10],L=b[14],P=b[3],Q=b[7],S=b[11];b=b[15];d[0]=e*z+f*R+g*K+k*P;d[4]=e*A+f*E+g*H+k*Q;d[8]=e*D+f*G+g*T+k*S;d[12]=e*F+f*ea+g*L+k*b;d[1]=l*z+n*R+m*K+r*P;d[5]=l*A+n*E+m*H+r*Q;d[9]=l*D+n*G+m*T+r*S;d[13]=l*F+n*ea+m*L+r*b;d[2]=p*z+q*R+v*K+u*P;d[6]=p*A+q*E+v*H+u*Q;d[10]=p*D+q*G+v*T+u*S;d[14]=p*F+q*ea+v*L+u*b;d[3]=x*z+w*R+B*
K+h*P;d[7]=x*A+w*E+B*H+h*Q;d[11]=x*D+w*G+B*T+h*S;d[15]=x*F+w*ea+B*L+h*b;return this},multiplyToArray:function(c,a,b){var h=this.elements;this.multiplyMatrices(c,a);b[0]=h[0];b[1]=h[1];b[2]=h[2];b[3]=h[3];b[4]=h[4];b[5]=h[5];b[6]=h[6];b[7]=h[7];b[8]=h[8];b[9]=h[9];b[10]=h[10];b[11]=h[11];b[12]=h[12];b[13]=h[13];b[14]=h[14];b[15]=h[15];return this},multiplyScalar:function(c){var a=this.elements;a[0]*=c;a[4]*=c;a[8]*=c;a[12]*=c;a[1]*=c;a[5]*=c;a[9]*=c;a[13]*=c;a[2]*=c;a[6]*=c;a[10]*=c;a[14]*=c;a[3]*=
c;a[7]*=c;a[11]*=c;a[15]*=c;return this},applyToVector3Array:function(){var c;return function(a,b,d){void 0===c&&(c=new f);void 0===b&&(b=0);void 0===d&&(d=a.length);for(var h=0;h<d;h+=3,b+=3)c.fromArray(a,b),c.applyMatrix4(this),c.toArray(a,b);return a}}(),applyToBuffer:function(){var c;return function(a,b,d){void 0===c&&(c=new f);void 0===b&&(b=0);void 0===d&&(d=a.length/a.itemSize);for(var h=0;h<d;h++,b++)c.x=a.getX(b),c.y=a.getY(b),c.z=a.getZ(b),c.applyMatrix4(this),a.setXYZ(c.x,c.y,c.z);return a}}(),
determinant:function(){var c=this.elements,a=c[0],b=c[4],d=c[8],e=c[12],f=c[1],g=c[5],k=c[9],l=c[13],n=c[2],m=c[6],r=c[10],p=c[14];return c[3]*(+e*k*m-d*l*m-e*g*r+b*l*r+d*g*p-b*k*p)+c[7]*(+a*k*p-a*l*r+e*f*r-d*f*p+d*l*n-e*k*n)+c[11]*(+a*l*m-a*g*p-e*f*m+b*f*p+e*g*n-b*l*n)+c[15]*(-d*g*n-a*k*m+a*g*r+d*f*m-b*f*r+b*k*n)},transpose:function(){var c=this.elements;var a=c[1];c[1]=c[4];c[4]=a;a=c[2];c[2]=c[8];c[8]=a;a=c[6];c[6]=c[9];c[9]=a;a=c[3];c[3]=c[12];c[12]=a;a=c[7];c[7]=c[13];c[13]=a;a=c[11];c[11]=c[14];
c[14]=a;return this},flattenToArrayOffset:function(c,a){console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.");return this.toArray(c,a)},getPosition:function(){var c;return function(){void 0===c&&(c=new f);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return c.setFromMatrixColumn(this,3)}}(),setPosition:function(c){var a=this.elements;a[12]=c.x;a[13]=c.y;a[14]=c.z;return this},getInverse:function(c,
a){var h=this.elements,b=c.elements,d=b[0],e=b[1],f=b[2],g=b[3],k=b[4],l=b[5],n=b[6],m=b[7],r=b[8],p=b[9],q=b[10],v=b[11],u=b[12],x=b[13],w=b[14];b=b[15];var B=p*w*m-x*q*m+x*n*v-l*w*v-p*n*b+l*q*b,z=u*q*m-r*w*m-u*n*v+k*w*v+r*n*b-k*q*b,A=r*x*m-u*p*m+u*l*v-k*x*v-r*l*b+k*p*b,D=u*p*n-r*x*n-u*l*q+k*x*q+r*l*w-k*p*w,F=d*B+e*z+f*A+g*D;if(0===F){if(!0===a)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");
return this.identity()}F=1/F;h[0]=B*F;h[1]=(x*q*g-p*w*g-x*f*v+e*w*v+p*f*b-e*q*b)*F;h[2]=(l*w*g-x*n*g+x*f*m-e*w*m-l*f*b+e*n*b)*F;h[3]=(p*n*g-l*q*g-p*f*m+e*q*m+l*f*v-e*n*v)*F;h[4]=z*F;h[5]=(r*w*g-u*q*g+u*f*v-d*w*v-r*f*b+d*q*b)*F;h[6]=(u*n*g-k*w*g-u*f*m+d*w*m+k*f*b-d*n*b)*F;h[7]=(k*q*g-r*n*g+r*f*m-d*q*m-k*f*v+d*n*v)*F;h[8]=A*F;h[9]=(u*p*g-r*x*g-u*e*v+d*x*v+r*e*b-d*p*b)*F;h[10]=(k*x*g-u*l*g+u*e*m-d*x*m-k*e*b+d*l*b)*F;h[11]=(r*l*g-k*p*g-r*e*m+d*p*m+k*e*v-d*l*v)*F;h[12]=D*F;h[13]=(r*x*f-u*p*f+u*e*q-d*x*
q-r*e*w+d*p*w)*F;h[14]=(u*l*f-k*x*f-u*e*n+d*x*n+k*e*w-d*l*w)*F;h[15]=(k*p*f-r*l*f+r*e*n-d*p*n-k*e*q+d*l*q)*F;return this},scale:function(c){var a=this.elements,b=c.x,d=c.y;c=c.z;a[0]*=b;a[4]*=d;a[8]*=c;a[1]*=b;a[5]*=d;a[9]*=c;a[2]*=b;a[6]*=d;a[10]*=c;a[3]*=b;a[7]*=d;a[11]*=c;return this},getMaxScaleOnAxis:function(){var c=this.elements;return Math.sqrt(Math.max(c[0]*c[0]+c[1]*c[1]+c[2]*c[2],c[4]*c[4]+c[5]*c[5]+c[6]*c[6],c[8]*c[8]+c[9]*c[9]+c[10]*c[10]))},makeTranslation:function(c,a,b){this.set(1,
0,0,c,0,1,0,a,0,0,1,b,0,0,0,1);return this},makeRotationX:function(c){var a=Math.cos(c);c=Math.sin(c);this.set(1,0,0,0,0,a,-c,0,0,c,a,0,0,0,0,1);return this},makeRotationY:function(c){var a=Math.cos(c);c=Math.sin(c);this.set(a,0,c,0,0,1,0,0,-c,0,a,0,0,0,0,1);return this},makeRotationZ:function(c){var a=Math.cos(c);c=Math.sin(c);this.set(a,-c,0,0,c,a,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(c,a){var h=Math.cos(a),b=Math.sin(a),d=1-h,e=c.x,f=c.y,g=c.z,k=d*e,l=d*f;this.set(k*e+h,k*
f-b*g,k*g+b*f,0,k*f+b*g,l*f+h,l*g-b*e,0,k*g-b*f,l*g+b*e,d*g*g+h,0,0,0,0,1);return this},makeScale:function(c,a,b){this.set(c,0,0,0,0,a,0,0,0,0,b,0,0,0,0,1);return this},compose:function(c,a,b){this.makeRotationFromQuaternion(a);this.scale(b);this.setPosition(c);return this},decompose:function(){var c,a;return function(h,b,d){void 0===c&&(c=new f,a=new p);var t=this.elements,e=c.set(t[0],t[1],t[2]).length(),g=c.set(t[4],t[5],t[6]).length(),y=c.set(t[8],t[9],t[10]).length();0>this.determinant()&&(e=
-e);h.x=t[12];h.y=t[13];h.z=t[14];a.elements.set(this.elements);h=1/e;t=1/g;var k=1/y;a.elements[0]*=h;a.elements[1]*=h;a.elements[2]*=h;a.elements[4]*=t;a.elements[5]*=t;a.elements[6]*=t;a.elements[8]*=k;a.elements[9]*=k;a.elements[10]*=k;b.setFromRotationMatrix(a);d.x=e;d.y=g;d.z=y;return this}}(),makeFrustum:function(c,a,b,d,e,f){var h=this.elements;h[0]=2*e/(a-c);h[4]=0;h[8]=(a+c)/(a-c);h[12]=0;h[1]=0;h[5]=2*e/(d-b);h[9]=(d+b)/(d-b);h[13]=0;h[2]=0;h[6]=0;h[10]=-(f+e)/(f-e);h[14]=-2*f*e/(f-e);
h[3]=0;h[7]=0;h[11]=-1;h[15]=0;return this},makePerspective:function(c,a,b,d){c=b*Math.tan(l.Math.DEG2RAD*c*.5);var h=-c;return this.makeFrustum(h*a,c*a,h,c,b,d)},makeOrthographic:function(c,a,b,d,e,f){var h=this.elements,t=1/(a-c),g=1/(b-d),k=1/(f-e);h[0]=2*t;h[4]=0;h[8]=0;h[12]=-((a+c)*t);h[1]=0;h[5]=2*g;h[9]=0;h[13]=-((b+d)*g);h[2]=0;h[6]=0;h[10]=-2*k;h[14]=-((f+e)*k);h[3]=0;h[7]=0;h[11]=0;h[15]=1;return this},equals:function(c){var a=this.elements;c=c.elements;for(var b=0;16>b;b++)if(a[b]!==c[b])return!1;
return!0},fromArray:function(c,a){void 0===a&&(a=0);for(var h=0;16>h;h++)this.elements[h]=c[h+a];return this},toArray:function(c,a){void 0===c&&(c=[]);void 0===a&&(a=0);var h=this.elements;c[a]=h[0];c[a+1]=h[1];c[a+2]=h[2];c[a+3]=h[3];c[a+4]=h[4];c[a+5]=h[5];c[a+6]=h[6];c[a+7]=h[7];c[a+8]=h[8];c[a+9]=h[9];c[a+10]=h[10];c[a+11]=h[11];c[a+12]=h[12];c[a+13]=h[13];c[a+14]=h[14];c[a+15]=h[15];return c}};w.prototype=Object.create(m.prototype);w.prototype.constructor=w;w.prototype.isCubeTexture=!0;Object.defineProperty(w.prototype,
"images",{get:function(){return this.image},set:function(c){this.image=c}});var qe=new m,re=new w,oe=[],pe=[];ha.prototype.setValue=function(c,a){for(var h=this.seq,b=0,d=h.length;b!==d;++b){var e=h[b];e.setValue(c,a[e.id])}};var Od=/([\w\d_]+)(\])?(\[|\.)?/g;ja.prototype.setValue=function(c,a,b){a=this.map[a];void 0!==a&&a.setValue(c,b,this.renderer)};ja.prototype.set=function(c,a,b){var h=this.map[b];void 0!==h&&h.setValue(c,a[b],this.renderer)};ja.prototype.setOptional=function(c,a,b){a=a[b];void 0!==
a&&this.setValue(c,b,a)};ja.upload=function(c,a,b,d){for(var h=0,t=a.length;h!==t;++h){var e=a[h],f=b[e.id];!1!==f.needsUpdate&&e.setValue(c,f.value,d)}};ja.seqWithValue=function(c,a){for(var h=[],b=0,d=c.length;b!==d;++b){var e=c[b];e.id in a&&h.push(e)}return h};ja.splitDynamic=function(c,a){for(var h=null,b=c.length,d=0,e=0;e!==b;++e){var f=c[e],g=a[f.id];g&&!0===g.dynamic?(null===h&&(h=[]),h.push(f)):(d<e&&(c[d]=f),++d)}d<b&&(c.length=d);return h};ja.evalDynamic=function(c,a,b,d,e){for(var h=
0,t=c.length;h!==t;++h){var f=a[c[h].id],g=f.onUpdateCallback;void 0!==g&&g.call(f,b,d,e)}};l.UniformsUtils={merge:function(c){for(var a={},b=0;b<c.length;b++){var d=this.clone(c[b]),e;for(e in d)a[e]=d[e]}return a},clone:function(c){var a={},b;for(b in c){a[b]={};for(var d in c[b]){var e=c[b][d];e&&e.isColor||e&&e.isVector2||e&&e.isVector3||e&&e.isVector4||e&&e.isMatrix3||e&&e.isMatrix4||e&&e.isTexture?a[b][d]=e.clone():Array.isArray(e)?a[b][d]=e.slice():a[b][d]=e}}return a}};var Fa={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",
alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",
aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\n\treturn any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",
bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",
clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",
clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\n",
cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",
defaultnormal_vertex:"#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",
emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n",
envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",
envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntenstiy;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",
envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",
fog_fragment:"#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",
lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",
lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tif ( testLightInRange( lightDistance, pointLight.distance ) ) {\n\t\t\tdirectLight.color = pointLight.color;\n\t\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\t#include <normal_flip>\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\t#include <normal_flip>\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",
lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",
lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",
lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",
lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t \tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\t\t\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",
logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",
map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",
metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",
normal_flip:"#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",
normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",
packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n  return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n  return 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n  return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n  return linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",
premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n",
roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",
shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",
shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",
shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",
skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",
skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",
specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n  return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",
uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",
uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",
uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",
cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",
depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",
distanceRGBA_frag:"uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",distanceRGBA_vert:"varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",
equirect_frag:"uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",
linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight;\n\treflectedLight.directDiffuse = vec3( 0.0 );\n\treflectedLight.directSpecular = vec3( 0.0 );\n\treflectedLight.indirectDiffuse = diffuseColor.rgb;\n\treflectedLight.indirectSpecular = vec3( 0.0 );\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n}\n",
meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n}\n",
meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n}\n",
meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nuniform float envMapIntensity;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",
normal_frag:"uniform float opacity;\nvarying vec3 vNormal;\n#include <common>\n#include <packing>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( vNormal ), opacity );\n\t#include <logdepthbuf_fragment>\n}\n",normal_vert:"varying vec3 vNormal;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvNormal = normalize( normalMatrix * normal );\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",
points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",
shadow_frag:"uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );\n}\n",shadow_vert:"#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"};V.prototype={constructor:V,
isColor:!0,r:1,g:1,b:1,set:function(c){c&&c.isColor?this.copy(c):"number"===typeof c?this.setHex(c):"string"===typeof c&&this.setStyle(c);return this},setScalar:function(c){this.b=this.g=this.r=c},setHex:function(c){c=Math.floor(c);this.r=(c>>16&255)/255;this.g=(c>>8&255)/255;this.b=(c&255)/255;return this},setRGB:function(c,a,b){this.r=c;this.g=a;this.b=b;return this},setHSL:function(){function c(c,a,b){0>b&&(b+=1);1<b&&--b;return b<1/6?c+6*(a-c)*b:.5>b?a:b<2/3?c+6*(a-c)*(2/3-b):c}return function(a,
b,d){a=l.Math.euclideanModulo(a,1);b=l.Math.clamp(b,0,1);d=l.Math.clamp(d,0,1);0===b?this.r=this.g=this.b=d:(b=.5>=d?d*(1+b):d+b-d*b,d=2*d-b,this.r=c(d,b,a+1/3),this.g=c(d,b,a),this.b=c(d,b,a-1/3));return this}}(),setStyle:function(c){function a(a){void 0!==a&&1>parseFloat(a)&&console.warn("THREE.Color: Alpha component of "+c+" will be ignored.")}var b;if(b=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(c)){var d=b[2];switch(b[1]){case "rgb":case "rgba":if(b=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=
Math.min(255,parseInt(b[1],10))/255,this.g=Math.min(255,parseInt(b[2],10))/255,this.b=Math.min(255,parseInt(b[3],10))/255,a(b[5]),this;if(b=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=Math.min(100,parseInt(b[1],10))/100,this.g=Math.min(100,parseInt(b[2],10))/100,this.b=Math.min(100,parseInt(b[3],10))/100,a(b[5]),this;break;case "hsl":case "hsla":if(b=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d)){d=parseFloat(b[1])/
360;var e=parseInt(b[2],10)/100,f=parseInt(b[3],10)/100;a(b[5]);return this.setHSL(d,e,f)}}}else if(b=/^#([A-Fa-f0-9]+)$/.exec(c)){b=b[1];d=b.length;if(3===d)return this.r=parseInt(b.charAt(0)+b.charAt(0),16)/255,this.g=parseInt(b.charAt(1)+b.charAt(1),16)/255,this.b=parseInt(b.charAt(2)+b.charAt(2),16)/255,this;if(6===d)return this.r=parseInt(b.charAt(0)+b.charAt(1),16)/255,this.g=parseInt(b.charAt(2)+b.charAt(3),16)/255,this.b=parseInt(b.charAt(4)+b.charAt(5),16)/255,this}c&&0<c.length&&(b=l.ColorKeywords[c],
void 0!==b?this.setHex(b):console.warn("THREE.Color: Unknown color "+c));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(c){this.r=c.r;this.g=c.g;this.b=c.b;return this},copyGammaToLinear:function(c,a){void 0===a&&(a=2);this.r=Math.pow(c.r,a);this.g=Math.pow(c.g,a);this.b=Math.pow(c.b,a);return this},copyLinearToGamma:function(c,a){void 0===a&&(a=2);var h=0<a?1/a:1;this.r=Math.pow(c.r,h);this.g=Math.pow(c.g,h);this.b=Math.pow(c.b,h);return this},convertGammaToLinear:function(){var c=
this.r,a=this.g,b=this.b;this.r=c*c;this.g=a*a;this.b=b*b;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(c){c=c||{h:0,s:0,l:0};var a=this.r,b=this.g,d=this.b,e=Math.max(a,b,d),f=Math.min(a,b,d),g,k=(f+e)/2;if(f===e)f=g=0;else{var l=e-f;f=.5>=k?l/(e+f):
l/(2-e-f);switch(e){case a:g=(b-d)/l+(b<d?6:0);break;case b:g=(d-a)/l+2;break;case d:g=(a-b)/l+4}g/=6}c.h=g;c.s=f;c.l=k;return c},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(c,a,b){var h=this.getHSL();h.h+=c;h.s+=a;h.l+=b;this.setHSL(h.h,h.s,h.l);return this},add:function(c){this.r+=c.r;this.g+=c.g;this.b+=c.b;return this},addColors:function(c,a){this.r=c.r+a.r;this.g=c.g+a.g;this.b=c.b+a.b;return this},addScalar:function(c){this.r+=
c;this.g+=c;this.b+=c;return this},sub:function(c){this.r=Math.max(0,this.r-c.r);this.g=Math.max(0,this.g-c.g);this.b=Math.max(0,this.b-c.b);return this},multiply:function(c){this.r*=c.r;this.g*=c.g;this.b*=c.b;return this},multiplyScalar:function(c){this.r*=c;this.g*=c;this.b*=c;return this},lerp:function(c,a){this.r+=(c.r-this.r)*a;this.g+=(c.g-this.g)*a;this.b+=(c.b-this.b)*a;return this},equals:function(c){return c.r===this.r&&c.g===this.g&&c.b===this.b},fromArray:function(c,a){void 0===a&&(a=
0);this.r=c[a];this.g=c[a+1];this.b=c[a+2];return this},toArray:function(c,a){void 0===c&&(c=[]);void 0===a&&(a=0);c[a]=this.r;c[a+1]=this.g;c[a+2]=this.b;return c},toJSON:function(){return this.getHex()}};l.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,
cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,
dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,
lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,
mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,
seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};var ua={common:{diffuse:{value:new V(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new a(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},
envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new g(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},
metalnessmap:{metalnessMap:{value:null}},fog:{fogDensity:{value:2.5E-4},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new V(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},
shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}}},points:{diffuse:{value:new V(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new a(0,0,1,1)}}},
Xc={basic:{uniforms:l.UniformsUtils.merge([ua.common,ua.aomap,ua.fog]),vertexShader:Fa.meshbasic_vert,fragmentShader:Fa.meshbasic_frag},lambert:{uniforms:l.UniformsUtils.merge([ua.common,ua.aomap,ua.lightmap,ua.emissivemap,ua.fog,ua.lights,{emissive:{value:new V(0)}}]),vertexShader:Fa.meshlambert_vert,fragmentShader:Fa.meshlambert_frag},phong:{uniforms:l.UniformsUtils.merge([ua.common,ua.aomap,ua.lightmap,ua.emissivemap,ua.bumpmap,ua.normalmap,ua.displacementmap,ua.fog,ua.lights,{emissive:{value:new V(0)},
specular:{value:new V(1118481)},shininess:{value:30}}]),vertexShader:Fa.meshphong_vert,fragmentShader:Fa.meshphong_frag},standard:{uniforms:l.UniformsUtils.merge([ua.common,ua.aomap,ua.lightmap,ua.emissivemap,ua.bumpmap,ua.normalmap,ua.displacementmap,ua.roughnessmap,ua.metalnessmap,ua.fog,ua.lights,{emissive:{value:new V(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Fa.meshphysical_vert,fragmentShader:Fa.meshphysical_frag},points:{uniforms:l.UniformsUtils.merge([ua.points,
ua.fog]),vertexShader:Fa.points_vert,fragmentShader:Fa.points_frag},dashed:{uniforms:l.UniformsUtils.merge([ua.common,ua.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Fa.linedashed_vert,fragmentShader:Fa.linedashed_frag},depth:{uniforms:l.UniformsUtils.merge([ua.common,ua.displacementmap]),vertexShader:Fa.depth_vert,fragmentShader:Fa.depth_frag},normal:{uniforms:{opacity:{value:1}},vertexShader:Fa.normal_vert,fragmentShader:Fa.normal_frag},cube:{uniforms:{tCube:{value:null},
tFlip:{value:-1},opacity:{value:1}},vertexShader:Fa.cube_vert,fragmentShader:Fa.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:Fa.equirect_vert,fragmentShader:Fa.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new f}},vertexShader:Fa.distanceRGBA_vert,fragmentShader:Fa.distanceRGBA_frag}};Xc.physical={uniforms:l.UniformsUtils.merge([Xc.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Fa.meshphysical_vert,fragmentShader:Fa.meshphysical_frag};
Ia.prototype={constructor:Ia,set:function(c,a){this.min.copy(c);this.max.copy(a);return this},setFromPoints:function(c){this.makeEmpty();for(var a=0,b=c.length;a<b;a++)this.expandByPoint(c[a]);return this},setFromCenterAndSize:function(){var c=new g;return function(a,b){var h=c.copy(b).multiplyScalar(.5);this.min.copy(a).sub(h);this.max.copy(a).add(h);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(c){this.min.copy(c.min);this.max.copy(c.max);return this},makeEmpty:function(){this.min.x=
this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(c){c=c||new g;return this.isEmpty()?c.set(0,0):c.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(c){c=c||new g;return this.isEmpty()?c.set(0,0):c.subVectors(this.max,this.min)},expandByPoint:function(c){this.min.min(c);this.max.max(c);return this},expandByVector:function(c){this.min.sub(c);this.max.add(c);return this},expandByScalar:function(c){this.min.addScalar(-c);
this.max.addScalar(c);return this},containsPoint:function(c){return c.x<this.min.x||c.x>this.max.x||c.y<this.min.y||c.y>this.max.y?!1:!0},containsBox:function(c){return this.min.x<=c.min.x&&c.max.x<=this.max.x&&this.min.y<=c.min.y&&c.max.y<=this.max.y?!0:!1},getParameter:function(c,a){return(a||new g).set((c.x-this.min.x)/(this.max.x-this.min.x),(c.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(c){return c.max.x<this.min.x||c.min.x>this.max.x||c.max.y<this.min.y||c.min.y>this.max.y?
!1:!0},clampPoint:function(c,a){return(a||new g).copy(c).clamp(this.min,this.max)},distanceToPoint:function(){var c=new g;return function(a){return c.copy(a).clamp(this.min,this.max).sub(a).length()}}(),intersect:function(c){this.min.max(c.min);this.max.min(c.max);return this},union:function(c){this.min.min(c.min);this.max.max(c.max);return this},translate:function(c){this.min.add(c);this.max.add(c);return this},equals:function(c){return c.min.equals(this.min)&&c.max.equals(this.max)}};Z.prototype=
{constructor:Z,isMaterial:!0,get needsUpdate(){return this._needsUpdate},set needsUpdate(c){!0===c&&this.update();this._needsUpdate=c},setValues:function(c){if(void 0!==c)for(var a in c){var b=c[a];if(void 0===b)console.warn("THREE.Material: '"+a+"' parameter is undefined.");else{var d=this[a];void 0===d?console.warn("THREE."+this.type+": '"+a+"' is not a property of this material."):d&&d.isColor?d.set(b):d&&d.isVector3&&b&&b.isVector3?d.copy(b):this[a]="overdraw"===a?Number(b):b}}},toJSON:function(c){function a(c){var a=
[],h;for(h in c){var b=c[h];delete b.metadata;a.push(b)}return a}var b=void 0===c;b&&(c={textures:{},images:{}});var d={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};d.uuid=this.uuid;d.type=this.type;""!==this.name&&(d.name=this.name);this.color&&this.color.isColor&&(d.color=this.color.getHex());void 0!==this.roughness&&(d.roughness=this.roughness);void 0!==this.metalness&&(d.metalness=this.metalness);this.emissive&&this.emissive.isColor&&(d.emissive=this.emissive.getHex());
this.specular&&this.specular.isColor&&(d.specular=this.specular.getHex());void 0!==this.shininess&&(d.shininess=this.shininess);this.map&&this.map.isTexture&&(d.map=this.map.toJSON(c).uuid);this.alphaMap&&this.alphaMap.isTexture&&(d.alphaMap=this.alphaMap.toJSON(c).uuid);this.lightMap&&this.lightMap.isTexture&&(d.lightMap=this.lightMap.toJSON(c).uuid);this.bumpMap&&this.bumpMap.isTexture&&(d.bumpMap=this.bumpMap.toJSON(c).uuid,d.bumpScale=this.bumpScale);this.normalMap&&this.normalMap.isTexture&&
(d.normalMap=this.normalMap.toJSON(c).uuid,d.normalScale=this.normalScale.toArray());this.displacementMap&&this.displacementMap.isTexture&&(d.displacementMap=this.displacementMap.toJSON(c).uuid,d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias);this.roughnessMap&&this.roughnessMap.isTexture&&(d.roughnessMap=this.roughnessMap.toJSON(c).uuid);this.metalnessMap&&this.metalnessMap.isTexture&&(d.metalnessMap=this.metalnessMap.toJSON(c).uuid);this.emissiveMap&&this.emissiveMap.isTexture&&
(d.emissiveMap=this.emissiveMap.toJSON(c).uuid);this.specularMap&&this.specularMap.isTexture&&(d.specularMap=this.specularMap.toJSON(c).uuid);this.envMap&&this.envMap.isTexture&&(d.envMap=this.envMap.toJSON(c).uuid,d.reflectivity=this.reflectivity);void 0!==this.size&&(d.size=this.size);void 0!==this.sizeAttenuation&&(d.sizeAttenuation=this.sizeAttenuation);1!==this.blending&&(d.blending=this.blending);2!==this.shading&&(d.shading=this.shading);0!==this.side&&(d.side=this.side);0!==this.vertexColors&&
(d.vertexColors=this.vertexColors);1>this.opacity&&(d.opacity=this.opacity);!0===this.transparent&&(d.transparent=this.transparent);d.depthFunc=this.depthFunc;d.depthTest=this.depthTest;d.depthWrite=this.depthWrite;0<this.alphaTest&&(d.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(d.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(d.wireframe=this.wireframe);1<this.wireframeLinewidth&&(d.wireframeLinewidth=this.wireframeLinewidth);"round"!==this.wireframeLinecap&&(d.wireframeLinecap=
this.wireframeLinecap);"round"!==this.wireframeLinejoin&&(d.wireframeLinejoin=this.wireframeLinejoin);d.skinning=this.skinning;d.morphTargets=this.morphTargets;b&&(b=a(c.textures),c=a(c.images),0<b.length&&(d.textures=b),0<c.length&&(d.images=c));return d},clone:function(){return(new this.constructor).copy(this)},copy:function(c){this.name=c.name;this.fog=c.fog;this.lights=c.lights;this.blending=c.blending;this.side=c.side;this.shading=c.shading;this.vertexColors=c.vertexColors;this.opacity=c.opacity;
this.transparent=c.transparent;this.blendSrc=c.blendSrc;this.blendDst=c.blendDst;this.blendEquation=c.blendEquation;this.blendSrcAlpha=c.blendSrcAlpha;this.blendDstAlpha=c.blendDstAlpha;this.blendEquationAlpha=c.blendEquationAlpha;this.depthFunc=c.depthFunc;this.depthTest=c.depthTest;this.depthWrite=c.depthWrite;this.colorWrite=c.colorWrite;this.precision=c.precision;this.polygonOffset=c.polygonOffset;this.polygonOffsetFactor=c.polygonOffsetFactor;this.polygonOffsetUnits=c.polygonOffsetUnits;this.alphaTest=
c.alphaTest;this.premultipliedAlpha=c.premultipliedAlpha;this.overdraw=c.overdraw;this.visible=c.visible;this.clipShadows=c.clipShadows;c=c.clippingPlanes;var a=null;if(null!==c){var b=c.length;a=Array(b);for(var d=0;d!==b;++d)a[d]=c[d].clone()}this.clippingPlanes=a;return this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};Object.assign(Z.prototype,b.prototype);var se=0;Aa.prototype=Object.create(Z.prototype);Aa.prototype.constructor=
Aa;Aa.prototype.isShaderMaterial=!0;Aa.prototype.copy=function(c){Z.prototype.copy.call(this,c);this.fragmentShader=c.fragmentShader;this.vertexShader=c.vertexShader;this.uniforms=l.UniformsUtils.clone(c.uniforms);this.defines=c.defines;this.wireframe=c.wireframe;this.wireframeLinewidth=c.wireframeLinewidth;this.lights=c.lights;this.clipping=c.clipping;this.skinning=c.skinning;this.morphTargets=c.morphTargets;this.morphNormals=c.morphNormals;this.extensions=c.extensions;return this};Aa.prototype.toJSON=
function(c){c=Z.prototype.toJSON.call(this,c);c.uniforms=this.uniforms;c.vertexShader=this.vertexShader;c.fragmentShader=this.fragmentShader;return c};Da.prototype=Object.create(Z.prototype);Da.prototype.constructor=Da;Da.prototype.isMeshDepthMaterial=!0;Da.prototype.copy=function(c){Z.prototype.copy.call(this,c);this.depthPacking=c.depthPacking;this.skinning=c.skinning;this.morphTargets=c.morphTargets;this.map=c.map;this.alphaMap=c.alphaMap;this.displacementMap=c.displacementMap;this.displacementScale=
c.displacementScale;this.displacementBias=c.displacementBias;this.wireframe=c.wireframe;this.wireframeLinewidth=c.wireframeLinewidth;return this};sa.prototype={constructor:sa,isBox3:!0,set:function(c,a){this.min.copy(c);this.max.copy(a);return this},setFromArray:function(c){for(var a=Infinity,b=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=-Infinity,k=0,l=c.length;k<l;k+=3){var n=c[k],m=c[k+1],r=c[k+2];n<a&&(a=n);m<b&&(b=m);r<d&&(d=r);n>e&&(e=n);m>f&&(f=m);r>g&&(g=r)}this.min.set(a,b,d);this.max.set(e,
f,g)},setFromPoints:function(c){this.makeEmpty();for(var a=0,b=c.length;a<b;a++)this.expandByPoint(c[a]);return this},setFromCenterAndSize:function(){var c=new f;return function(a,b){var h=c.copy(b).multiplyScalar(.5);this.min.copy(a).sub(h);this.max.copy(a).add(h);return this}}(),setFromObject:function(){var c=new f;return function(a){var h=this;a.updateMatrixWorld(!0);this.makeEmpty();a.traverse(function(a){var b=a.geometry;if(void 0!==b)if(b&&b.isGeometry){b=b.vertices;for(var d=0,e=b.length;d<
e;d++)c.copy(b[d]),c.applyMatrix4(a.matrixWorld),h.expandByPoint(c)}else if(b&&b.isBufferGeometry&&(e=b.attributes.position,void 0!==e)){var t;e&&e.isInterleavedBufferAttribute?(b=e.data.array,d=e.offset,t=e.data.stride):(b=e.array,d=0,t=3);for(e=b.length;d<e;d+=t)c.fromArray(b,d),c.applyMatrix4(a.matrixWorld),h.expandByPoint(c)}});return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(c){this.min.copy(c.min);this.max.copy(c.max);return this},makeEmpty:function(){this.min.x=
this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(c){c=c||new f;return this.isEmpty()?c.set(0,0,0):c.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(c){c=c||new f;return this.isEmpty()?c.set(0,0,0):c.subVectors(this.max,this.min)},expandByPoint:function(c){this.min.min(c);this.max.max(c);return this},expandByVector:function(c){this.min.sub(c);
this.max.add(c);return this},expandByScalar:function(c){this.min.addScalar(-c);this.max.addScalar(c);return this},containsPoint:function(c){return c.x<this.min.x||c.x>this.max.x||c.y<this.min.y||c.y>this.max.y||c.z<this.min.z||c.z>this.max.z?!1:!0},containsBox:function(c){return this.min.x<=c.min.x&&c.max.x<=this.max.x&&this.min.y<=c.min.y&&c.max.y<=this.max.y&&this.min.z<=c.min.z&&c.max.z<=this.max.z?!0:!1},getParameter:function(c,a){return(a||new f).set((c.x-this.min.x)/(this.max.x-this.min.x),
(c.y-this.min.y)/(this.max.y-this.min.y),(c.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(c){return c.max.x<this.min.x||c.min.x>this.max.x||c.max.y<this.min.y||c.min.y>this.max.y||c.max.z<this.min.z||c.min.z>this.max.z?!1:!0},intersectsSphere:function(){var c;return function(a){void 0===c&&(c=new f);this.clampPoint(a.center,c);return c.distanceToSquared(a.center)<=a.radius*a.radius}}(),intersectsPlane:function(c){var a,b;0<c.normal.x?(a=c.normal.x*this.min.x,b=c.normal.x*this.max.x):
(a=c.normal.x*this.max.x,b=c.normal.x*this.min.x);0<c.normal.y?(a+=c.normal.y*this.min.y,b+=c.normal.y*this.max.y):(a+=c.normal.y*this.max.y,b+=c.normal.y*this.min.y);0<c.normal.z?(a+=c.normal.z*this.min.z,b+=c.normal.z*this.max.z):(a+=c.normal.z*this.max.z,b+=c.normal.z*this.min.z);return a<=c.constant&&b>=c.constant},clampPoint:function(c,a){return(a||new f).copy(c).clamp(this.min,this.max)},distanceToPoint:function(){var c=new f;return function(a){return c.copy(a).clamp(this.min,this.max).sub(a).length()}}(),
getBoundingSphere:function(){var c=new f;return function(a){a=a||new za;this.getCenter(a.center);a.radius=.5*this.size(c).length();return a}}(),intersect:function(c){this.min.max(c.min);this.max.min(c.max);this.isEmpty()&&this.makeEmpty();return this},union:function(c){this.min.min(c.min);this.max.max(c.max);return this},applyMatrix4:function(){var c=[new f,new f,new f,new f,new f,new f,new f,new f];return function(a){if(this.isEmpty())return this;c[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(a);
c[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(a);c[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(a);c[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(a);c[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(a);c[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(a);c[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(a);c[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(a);this.setFromPoints(c);return this}}(),translate:function(c){this.min.add(c);this.max.add(c);
return this},equals:function(c){return c.min.equals(this.min)&&c.max.equals(this.max)}};za.prototype={constructor:za,set:function(c,a){this.center.copy(c);this.radius=a;return this},setFromPoints:function(){var c=new sa;return function(a,b){var h=this.center;void 0!==b?h.copy(b):c.setFromPoints(a).getCenter(h);for(var d=0,e=0,t=a.length;e<t;e++)d=Math.max(d,h.distanceToSquared(a[e]));this.radius=Math.sqrt(d);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(c){this.center.copy(c.center);
this.radius=c.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(c){return c.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(c){return c.distanceTo(this.center)-this.radius},intersectsSphere:function(c){var a=this.radius+c.radius;return c.center.distanceToSquared(this.center)<=a*a},intersectsBox:function(c){return c.intersectsSphere(this)},intersectsPlane:function(c){return Math.abs(this.center.dot(c.normal)-c.constant)<=this.radius},
clampPoint:function(c,a){var b=this.center.distanceToSquared(c),h=a||new f;h.copy(c);b>this.radius*this.radius&&(h.sub(this.center).normalize(),h.multiplyScalar(this.radius).add(this.center));return h},getBoundingBox:function(c){c=c||new sa;c.set(this.center,this.center);c.expandByScalar(this.radius);return c},applyMatrix4:function(c){this.center.applyMatrix4(c);this.radius*=c.getMaxScaleOnAxis();return this},translate:function(c){this.center.add(c);return this},equals:function(c){return c.center.equals(this.center)&&
c.radius===this.radius}};va.prototype={constructor:va,isMatrix3:!0,set:function(c,a,b,d,e,f,g,k,l){var h=this.elements;h[0]=c;h[1]=d;h[2]=g;h[3]=a;h[4]=e;h[5]=k;h[6]=b;h[7]=f;h[8]=l;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(c){c=c.elements;this.set(c[0],c[3],c[6],c[1],c[4],c[7],c[2],c[5],c[8]);return this},setFromMatrix4:function(c){c=c.elements;this.set(c[0],c[4],c[8],c[1],c[5],c[9],
c[2],c[6],c[10]);return this},applyToVector3Array:function(){var c;return function(a,b,d){void 0===c&&(c=new f);void 0===b&&(b=0);void 0===d&&(d=a.length);for(var h=0;h<d;h+=3,b+=3)c.fromArray(a,b),c.applyMatrix3(this),c.toArray(a,b);return a}}(),applyToBuffer:function(){var c;return function(a,b,d){void 0===c&&(c=new f);void 0===b&&(b=0);void 0===d&&(d=a.length/a.itemSize);for(var h=0;h<d;h++,b++)c.x=a.getX(b),c.y=a.getY(b),c.z=a.getZ(b),c.applyMatrix3(this),a.setXYZ(c.x,c.y,c.z);return a}}(),multiplyScalar:function(c){var a=
this.elements;a[0]*=c;a[3]*=c;a[6]*=c;a[1]*=c;a[4]*=c;a[7]*=c;a[2]*=c;a[5]*=c;a[8]*=c;return this},determinant:function(){var c=this.elements,a=c[0],b=c[1],d=c[2],e=c[3],f=c[4],g=c[5],k=c[6],l=c[7];c=c[8];return a*f*c-a*g*l-b*e*c+b*g*k+d*e*l-d*f*k},getInverse:function(c,a){c&&c.isMatrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var b=c.elements,h=this.elements,d=b[0],e=b[1],f=b[2],g=b[3],k=b[4],l=b[5],n=b[6],m=b[7];b=b[8];var r=b*k-l*m,p=l*n-b*g,q=m*g-k*n,v=d*
r+e*p+f*q;if(0===v){if(!0===a)throw Error("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");return this.identity()}v=1/v;h[0]=r*v;h[1]=(f*m-b*e)*v;h[2]=(l*e-f*k)*v;h[3]=p*v;h[4]=(b*d-f*n)*v;h[5]=(f*g-l*d)*v;h[6]=q*v;h[7]=(e*n-m*d)*v;h[8]=(k*d-e*g)*v;return this},transpose:function(){var c=this.elements;var a=c[1];c[1]=c[3];c[3]=a;a=c[2];c[2]=c[6];c[6]=a;a=c[5];c[5]=c[7];c[7]=a;return this},flattenToArrayOffset:function(c,
a){console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.");return this.toArray(c,a)},getNormalMatrix:function(c){return this.setFromMatrix4(c).getInverse(this).transpose()},transposeIntoArray:function(c){var a=this.elements;c[0]=a[0];c[1]=a[3];c[2]=a[6];c[3]=a[1];c[4]=a[4];c[5]=a[7];c[6]=a[2];c[7]=a[5];c[8]=a[8];return this},fromArray:function(c,a){void 0===a&&(a=0);for(var b=0;9>b;b++)this.elements[b]=c[b+a];return this},toArray:function(c,a){void 0===c&&(c=
[]);void 0===a&&(a=0);var b=this.elements;c[a]=b[0];c[a+1]=b[1];c[a+2]=b[2];c[a+3]=b[3];c[a+4]=b[4];c[a+5]=b[5];c[a+6]=b[6];c[a+7]=b[7];c[a+8]=b[8];return c}};ya.prototype={constructor:ya,set:function(c,a){this.normal.copy(c);this.constant=a;return this},setComponents:function(c,a,b,d){this.normal.set(c,a,b);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(c,a){this.normal.copy(c);this.constant=-a.dot(this.normal);return this},setFromCoplanarPoints:function(){var c=new f,a=new f;
return function(b,h,d){h=c.subVectors(d,h).cross(a.subVectors(b,h)).normalize();this.setFromNormalAndCoplanarPoint(h,b);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(c){this.normal.copy(c.normal);this.constant=c.constant;return this},normalize:function(){var c=1/this.normal.length();this.normal.multiplyScalar(c);this.constant*=c;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(c){return this.normal.dot(c)+
this.constant},distanceToSphere:function(c){return this.distanceToPoint(c.center)-c.radius},projectPoint:function(c,a){return this.orthoPoint(c,a).sub(c).negate()},orthoPoint:function(c,a){var b=this.distanceToPoint(c);return(a||new f).copy(this.normal).multiplyScalar(b)},intersectLine:function(){var c=new f;return function(a,b){var h=b||new f,d=a.delta(c),e=this.normal.dot(d);if(0===e){if(0===this.distanceToPoint(a.start))return h.copy(a.start)}else return e=-(a.start.dot(this.normal)+this.constant)/
e,0>e||1<e?void 0:h.copy(d).multiplyScalar(e).add(a.start)}}(),intersectsLine:function(c){var a=this.distanceToPoint(c.start);c=this.distanceToPoint(c.end);return 0>a&&0<c||0>c&&0<a},intersectsBox:function(c){return c.intersectsPlane(this)},intersectsSphere:function(c){return c.intersectsPlane(this)},coplanarPoint:function(c){return(c||new f).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var c=new f,a=new va;return function(b,h){var d=this.coplanarPoint(c).applyMatrix4(b),
e=h||a.getNormalMatrix(b);e=this.normal.applyMatrix3(e).normalize();this.constant=-d.dot(e);return this}}(),translate:function(c){this.constant-=c.dot(this.normal);return this},equals:function(c){return c.normal.equals(this.normal)&&c.constant===this.constant}};La.prototype={constructor:La,set:function(c,a,b,d,e,f){var h=this.planes;h[0].copy(c);h[1].copy(a);h[2].copy(b);h[3].copy(d);h[4].copy(e);h[5].copy(f);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(c){for(var a=
this.planes,b=0;6>b;b++)a[b].copy(c.planes[b]);return this},setFromMatrix:function(c){var a=this.planes,b=c.elements;c=b[0];var d=b[1],e=b[2],f=b[3],g=b[4],k=b[5],l=b[6],n=b[7],m=b[8],r=b[9],p=b[10],q=b[11],v=b[12],u=b[13],x=b[14];b=b[15];a[0].setComponents(f-c,n-g,q-m,b-v).normalize();a[1].setComponents(f+c,n+g,q+m,b+v).normalize();a[2].setComponents(f+d,n+k,q+r,b+u).normalize();a[3].setComponents(f-d,n-k,q-r,b-u).normalize();a[4].setComponents(f-e,n-l,q-p,b-x).normalize();a[5].setComponents(f+e,
n+l,q+p,b+x).normalize();return this},intersectsObject:function(){var c=new za;return function(a){var b=a.geometry;null===b.boundingSphere&&b.computeBoundingSphere();c.copy(b.boundingSphere).applyMatrix4(a.matrixWorld);return this.intersectsSphere(c)}}(),intersectsSprite:function(){var c=new za;return function(a){c.center.set(0,0,0);c.radius=.7071067811865476;c.applyMatrix4(a.matrixWorld);return this.intersectsSphere(c)}}(),intersectsSphere:function(c){var a=this.planes,b=c.center;c=-c.radius;for(var d=
0;6>d;d++)if(a[d].distanceToPoint(b)<c)return!1;return!0},intersectsBox:function(){var c=new f,a=new f;return function(b){for(var h=this.planes,d=0;6>d;d++){var e=h[d];c.x=0<e.normal.x?b.min.x:b.max.x;a.x=0<e.normal.x?b.max.x:b.min.x;c.y=0<e.normal.y?b.min.y:b.max.y;a.y=0<e.normal.y?b.max.y:b.min.y;c.z=0<e.normal.z?b.min.z:b.max.z;a.z=0<e.normal.z?b.max.z:b.min.z;var f=e.distanceToPoint(c);e=e.distanceToPoint(a);if(0>f&&0>e)return!1}return!0}}(),containsPoint:function(c){for(var a=this.planes,b=0;6>
b;b++)if(0>a[b].distanceToPoint(c))return!1;return!0}};ra.prototype={constructor:ra,set:function(c,a){this.origin.copy(c);this.direction.copy(a);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(c){this.origin.copy(c.origin);this.direction.copy(c.direction);return this},at:function(c,a){return(a||new f).copy(this.direction).multiplyScalar(c).add(this.origin)},lookAt:function(c){this.direction.copy(c).sub(this.origin).normalize();return this},recast:function(){var c=
new f;return function(a){this.origin.copy(this.at(a,c));return this}}(),closestPointToPoint:function(c,a){var b=a||new f;b.subVectors(c,this.origin);var h=b.dot(this.direction);return 0>h?b.copy(this.origin):b.copy(this.direction).multiplyScalar(h).add(this.origin)},distanceToPoint:function(c){return Math.sqrt(this.distanceSqToPoint(c))},distanceSqToPoint:function(){var c=new f;return function(a){var b=c.subVectors(a,this.origin).dot(this.direction);if(0>b)return this.origin.distanceToSquared(a);
c.copy(this.direction).multiplyScalar(b).add(this.origin);return c.distanceToSquared(a)}}(),distanceSqToSegment:function(){var c=new f,a=new f,b=new f;return function(h,d,e,f){c.copy(h).add(d).multiplyScalar(.5);a.copy(d).sub(h).normalize();b.copy(this.origin).sub(c);var t=.5*h.distanceTo(d),g=-this.direction.dot(a),k=b.dot(this.direction),l=-b.dot(a),y=b.lengthSq(),n=Math.abs(1-g*g),C;0<n?(h=g*l-k,d=g*k-l,C=t*n,0<=h?d>=-C?d<=C?(t=1/n,h*=t,d*=t,g=h*(h+g*d+2*k)+d*(g*h+d+2*l)+y):(d=t,h=Math.max(0,-(g*
d+k)),g=-h*h+d*(d+2*l)+y):(d=-t,h=Math.max(0,-(g*d+k)),g=-h*h+d*(d+2*l)+y):d<=-C?(h=Math.max(0,-(-g*t+k)),d=0<h?-t:Math.min(Math.max(-t,-l),t),g=-h*h+d*(d+2*l)+y):d<=C?(h=0,d=Math.min(Math.max(-t,-l),t),g=d*(d+2*l)+y):(h=Math.max(0,-(g*t+k)),d=0<h?t:Math.min(Math.max(-t,-l),t),g=-h*h+d*(d+2*l)+y)):(d=0<g?-t:t,h=Math.max(0,-(g*d+k)),g=-h*h+d*(d+2*l)+y);e&&e.copy(this.direction).multiplyScalar(h).add(this.origin);f&&f.copy(a).multiplyScalar(d).add(c);return g}}(),intersectSphere:function(){var c=new f;
return function(a,b){c.subVectors(a.center,this.origin);var h=c.dot(this.direction),d=c.dot(c)-h*h,e=a.radius*a.radius;if(d>e)return null;e=Math.sqrt(e-d);d=h-e;h+=e;return 0>d&&0>h?null:0>d?this.at(h,b):this.at(d,b)}}(),intersectsSphere:function(c){return this.distanceToPoint(c.center)<=c.radius},distanceToPlane:function(c){var a=c.normal.dot(this.direction);if(0===a)return 0===c.distanceToPoint(this.origin)?0:null;c=-(this.origin.dot(c.normal)+c.constant)/a;return 0<=c?c:null},intersectPlane:function(c,
a){var b=this.distanceToPlane(c);return null===b?null:this.at(b,a)},intersectsPlane:function(c){var a=c.distanceToPoint(this.origin);return 0===a||0>c.normal.dot(this.direction)*a?!0:!1},intersectBox:function(c,a){var b,h;var d=1/this.direction.x;var e=1/this.direction.y;var f=1/this.direction.z;var g=this.origin;0<=d?(b=(c.min.x-g.x)*d,d*=c.max.x-g.x):(b=(c.max.x-g.x)*d,d*=c.min.x-g.x);0<=e?(h=(c.min.y-g.y)*e,e*=c.max.y-g.y):(h=(c.max.y-g.y)*e,e*=c.min.y-g.y);if(b>e||h>d)return null;if(h>b||b!==
b)b=h;if(e<d||d!==d)d=e;0<=f?(h=(c.min.z-g.z)*f,f*=c.max.z-g.z):(h=(c.max.z-g.z)*f,f*=c.min.z-g.z);if(b>f||h>d)return null;if(h>b||b!==b)b=h;if(f<d||d!==d)d=f;return 0>d?null:this.at(0<=b?b:d,a)},intersectsBox:function(){var c=new f;return function(a){return null!==this.intersectBox(a,c)}}(),intersectTriangle:function(){var c=new f,a=new f,b=new f,d=new f;return function(h,e,f,t,g){a.subVectors(e,h);b.subVectors(f,h);d.crossVectors(a,b);e=this.direction.dot(d);if(0<e){if(t)return null;t=1}else if(0>
e)t=-1,e=-e;else return null;c.subVectors(this.origin,h);h=t*this.direction.dot(b.crossVectors(c,b));if(0>h)return null;f=t*this.direction.dot(a.cross(c));if(0>f||h+f>e)return null;h=-t*c.dot(d);return 0>h?null:this.at(h/e,g)}}(),applyMatrix4:function(c){this.direction.add(this.origin).applyMatrix4(c);this.origin.applyMatrix4(c);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(c){return c.origin.equals(this.origin)&&c.direction.equals(this.direction)}};fa.RotationOrders=
"XYZ YZX ZXY XZY YXZ ZYX".split(" ");fa.DefaultOrder="XYZ";fa.prototype={constructor:fa,isEuler:!0,get x(){return this._x},set x(c){this._x=c;this.onChangeCallback()},get y(){return this._y},set y(c){this._y=c;this.onChangeCallback()},get z(){return this._z},set z(c){this._z=c;this.onChangeCallback()},get order(){return this._order},set order(c){this._order=c;this.onChangeCallback()},set:function(c,a,b,d){this._x=c;this._y=a;this._z=b;this._order=d||this._order;this.onChangeCallback();return this},
clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(c){this._x=c._x;this._y=c._y;this._z=c._z;this._order=c._order;this.onChangeCallback();return this},setFromRotationMatrix:function(c,a,b){var h=l.Math.clamp,d=c.elements;c=d[0];var e=d[4],f=d[8],t=d[1],g=d[5],k=d[9],n=d[2],m=d[6];d=d[10];a=a||this._order;"XYZ"===a?(this._y=Math.asin(h(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(-k,d),this._z=Math.atan2(-e,c)):(this._x=Math.atan2(m,g),this._z=0)):"YXZ"===
a?(this._x=Math.asin(-h(k,-1,1)),.99999>Math.abs(k)?(this._y=Math.atan2(f,d),this._z=Math.atan2(t,g)):(this._y=Math.atan2(-n,c),this._z=0)):"ZXY"===a?(this._x=Math.asin(h(m,-1,1)),.99999>Math.abs(m)?(this._y=Math.atan2(-n,d),this._z=Math.atan2(-e,g)):(this._y=0,this._z=Math.atan2(t,c))):"ZYX"===a?(this._y=Math.asin(-h(n,-1,1)),.99999>Math.abs(n)?(this._x=Math.atan2(m,d),this._z=Math.atan2(t,c)):(this._x=0,this._z=Math.atan2(-e,g))):"YZX"===a?(this._z=Math.asin(h(t,-1,1)),.99999>Math.abs(t)?(this._x=
Math.atan2(-k,g),this._y=Math.atan2(-n,c)):(this._x=0,this._y=Math.atan2(f,d))):"XZY"===a?(this._z=Math.asin(-h(e,-1,1)),.99999>Math.abs(e)?(this._x=Math.atan2(m,g),this._y=Math.atan2(f,c)):(this._x=Math.atan2(-k,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+a);this._order=a;if(!1!==b)this.onChangeCallback();return this},setFromQuaternion:function(){var c;return function(a,b,d){void 0===c&&(c=new p);c.makeRotationFromQuaternion(a);return this.setFromRotationMatrix(c,
b,d)}}(),setFromVector3:function(c,a){return this.set(c.x,c.y,c.z,a||this._order)},reorder:function(){var c=new q;return function(a){c.setFromEuler(this);return this.setFromQuaternion(c,a)}}(),equals:function(c){return c._x===this._x&&c._y===this._y&&c._z===this._z&&c._order===this._order},fromArray:function(c){this._x=c[0];this._y=c[1];this._z=c[2];void 0!==c[3]&&(this._order=c[3]);this.onChangeCallback();return this},toArray:function(c,a){void 0===c&&(c=[]);void 0===a&&(a=0);c[a]=this._x;c[a+1]=
this._y;c[a+2]=this._z;c[a+3]=this._order;return c},toVector3:function(c){return c?c.set(this._x,this._y,this._z):new f(this._x,this._y,this._z)},onChange:function(c){this.onChangeCallback=c;return this},onChangeCallback:function(){}};Ga.prototype={constructor:Ga,set:function(c){this.mask=1<<c},enable:function(c){this.mask|=1<<c},toggle:function(c){this.mask^=1<<c},disable:function(c){this.mask&=~(1<<c)},test:function(c){return 0!==(this.mask&c.mask)}};ca.DefaultUp=new f(0,1,0);ca.DefaultMatrixAutoUpdate=
!0;Object.assign(ca.prototype,b.prototype,{isObject3D:!0,applyMatrix:function(c){this.matrix.multiplyMatrices(c,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(c,a){this.quaternion.setFromAxisAngle(c,a)},setRotationFromEuler:function(c){this.quaternion.setFromEuler(c,!0)},setRotationFromMatrix:function(c){this.quaternion.setFromRotationMatrix(c)},setRotationFromQuaternion:function(c){this.quaternion.copy(c)},rotateOnAxis:function(){var c=
new q;return function(a,b){c.setFromAxisAngle(a,b);this.quaternion.multiply(c);return this}}(),rotateX:function(){var c=new f(1,0,0);return function(a){return this.rotateOnAxis(c,a)}}(),rotateY:function(){var c=new f(0,1,0);return function(a){return this.rotateOnAxis(c,a)}}(),rotateZ:function(){var c=new f(0,0,1);return function(a){return this.rotateOnAxis(c,a)}}(),translateOnAxis:function(){var c=new f;return function(a,b){c.copy(a).applyQuaternion(this.quaternion);this.position.add(c.multiplyScalar(b));
return this}}(),translateX:function(){var c=new f(1,0,0);return function(a){return this.translateOnAxis(c,a)}}(),translateY:function(){var c=new f(0,1,0);return function(a){return this.translateOnAxis(c,a)}}(),translateZ:function(){var c=new f(0,0,1);return function(a){return this.translateOnAxis(c,a)}}(),localToWorld:function(c){return c.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var c=new p;return function(a){return a.applyMatrix4(c.getInverse(this.matrixWorld))}}(),lookAt:function(){var c=
new p;return function(a){c.lookAt(a,this.position,this.up);this.quaternion.setFromRotationMatrix(c)}}(),add:function(c){if(1<arguments.length){for(var a=0;a<arguments.length;a++)this.add(arguments[a]);return this}if(c===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",c),this;c&&c.isObject3D?(null!==c.parent&&c.parent.remove(c),c.parent=this,c.dispatchEvent({type:"added"}),this.children.push(c)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",
c);return this},remove:function(c){if(1<arguments.length)for(var a=0;a<arguments.length;a++)this.remove(arguments[a]);a=this.children.indexOf(c);-1!==a&&(c.parent=null,c.dispatchEvent({type:"removed"}),this.children.splice(a,1))},getObjectById:function(c){return this.getObjectByProperty("id",c)},getObjectByName:function(c){return this.getObjectByProperty("name",c)},getObjectByProperty:function(c,a){if(this[c]===a)return this;for(var b=0,h=this.children.length;b<h;b++){var d=this.children[b].getObjectByProperty(c,
a);if(void 0!==d)return d}},getWorldPosition:function(c){c=c||new f;this.updateMatrixWorld(!0);return c.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var c=new f,a=new f;return function(b){b=b||new q;this.updateMatrixWorld(!0);this.matrixWorld.decompose(c,b,a);return b}}(),getWorldRotation:function(){var c=new q;return function(a){a=a||new fa;this.getWorldQuaternion(c);return a.setFromQuaternion(c,this.rotation.order,!1)}}(),getWorldScale:function(){var c=new f,a=new q;return function(b){b=
b||new f;this.updateMatrixWorld(!0);this.matrixWorld.decompose(c,a,b);return b}}(),getWorldDirection:function(){var c=new q;return function(a){a=a||new f;this.getWorldQuaternion(c);return a.set(0,0,1).applyQuaternion(c)}}(),raycast:function(){},traverse:function(c){c(this);for(var a=this.children,b=0,d=a.length;b<d;b++)a[b].traverse(c)},traverseVisible:function(c){if(!1!==this.visible){c(this);for(var a=this.children,b=0,d=a.length;b<d;b++)a[b].traverseVisible(c)}},traverseAncestors:function(c){var a=
this.parent;null!==a&&(c(a),a.traverseAncestors(c))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(c){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===c)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,c=!0;for(var a=this.children,b=0,d=a.length;b<d;b++)a[b].updateMatrixWorld(c)},
toJSON:function(c){function a(c){var a=[],b;for(b in c){var h=c[b];delete h.metadata;a.push(h)}return a}var b=void 0===c||""===c,d={};b&&(c={geometries:{},materials:{},textures:{},images:{}},d.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var e={};e.uuid=this.uuid;e.type=this.type;""!==this.name&&(e.name=this.name);"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData);!0===this.castShadow&&(e.castShadow=!0);!0===this.receiveShadow&&(e.receiveShadow=!0);!1===this.visible&&
(e.visible=!1);e.matrix=this.matrix.toArray();void 0!==this.geometry&&(void 0===c.geometries[this.geometry.uuid]&&(c.geometries[this.geometry.uuid]=this.geometry.toJSON(c)),e.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===c.materials[this.material.uuid]&&(c.materials[this.material.uuid]=this.material.toJSON(c)),e.material=this.material.uuid);if(0<this.children.length){e.children=[];for(var f=0;f<this.children.length;f++)e.children.push(this.children[f].toJSON(c).object)}if(b){b=a(c.geometries);
f=a(c.materials);var g=a(c.textures);c=a(c.images);0<b.length&&(d.geometries=b);0<f.length&&(d.materials=f);0<g.length&&(d.textures=g);0<c.length&&(d.images=c)}d.object=e;return d},clone:function(c){return(new this.constructor).copy(this,c)},copy:function(c,a){void 0===a&&(a=!0);this.name=c.name;this.up.copy(c.up);this.position.copy(c.position);this.quaternion.copy(c.quaternion);this.scale.copy(c.scale);this.matrix.copy(c.matrix);this.matrixWorld.copy(c.matrixWorld);this.matrixAutoUpdate=c.matrixAutoUpdate;
this.matrixWorldNeedsUpdate=c.matrixWorldNeedsUpdate;this.visible=c.visible;this.castShadow=c.castShadow;this.receiveShadow=c.receiveShadow;this.frustumCulled=c.frustumCulled;this.renderOrder=c.renderOrder;this.userData=JSON.parse(JSON.stringify(c.userData));if(!0===a)for(var b=0;b<c.children.length;b++)this.add(c.children[b].clone());return this}});var te=0;Wa.prototype={constructor:Wa,set:function(c,a){this.start.copy(c);this.end.copy(a);return this},clone:function(){return(new this.constructor).copy(this)},
copy:function(c){this.start.copy(c.start);this.end.copy(c.end);return this},getCenter:function(c){return(c||new f).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(c){return(c||new f).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(c,a){var b=a||new f;return this.delta(b).multiplyScalar(c).add(this.start)},closestPointToPointParameter:function(){var c=new f,
a=new f;return function(b,h){c.subVectors(b,this.start);a.subVectors(this.end,this.start);var d=a.dot(a);d=a.dot(c)/d;h&&(d=l.Math.clamp(d,0,1));return d}}(),closestPointToPoint:function(c,a,b){c=this.closestPointToPointParameter(c,a);b=b||new f;return this.delta(b).multiplyScalar(c).add(this.start)},applyMatrix4:function(c){this.start.applyMatrix4(c);this.end.applyMatrix4(c);return this},equals:function(c){return c.start.equals(this.start)&&c.end.equals(this.end)}};Ha.normal=function(){var c=new f;
return function(a,b,d,e){e=e||new f;e.subVectors(d,b);c.subVectors(a,b);e.cross(c);a=e.lengthSq();return 0<a?e.multiplyScalar(1/Math.sqrt(a)):e.set(0,0,0)}}();Ha.barycoordFromPoint=function(){var c=new f,a=new f,b=new f;return function(h,d,e,g,t){c.subVectors(g,d);a.subVectors(e,d);b.subVectors(h,d);h=c.dot(c);d=c.dot(a);e=c.dot(b);var k=a.dot(a);g=a.dot(b);var l=h*k-d*d;t=t||new f;if(0===l)return t.set(-2,-1,-1);l=1/l;k=(k*e-d*g)*l;h=(h*g-d*e)*l;return t.set(1-k-h,h,k)}}();Ha.containsPoint=function(){var c=
new f;return function(a,b,d,e){a=Ha.barycoordFromPoint(a,b,d,e,c);return 0<=a.x&&0<=a.y&&1>=a.x+a.y}}();Ha.prototype={constructor:Ha,set:function(c,a,b){this.a.copy(c);this.b.copy(a);this.c.copy(b);return this},setFromPointsAndIndices:function(c,a,b,d){this.a.copy(c[a]);this.b.copy(c[b]);this.c.copy(c[d]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(c){this.a.copy(c.a);this.b.copy(c.b);this.c.copy(c.c);return this},area:function(){var c=new f,a=new f;return function(){c.subVectors(this.c,
this.b);a.subVectors(this.a,this.b);return.5*c.cross(a).length()}}(),midpoint:function(c){return(c||new f).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(c){return Ha.normal(this.a,this.b,this.c,c)},plane:function(c){return(c||new ya).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(c,a){return Ha.barycoordFromPoint(c,this.a,this.b,this.c,a)},containsPoint:function(c){return Ha.containsPoint(c,this.a,this.b,this.c)},closestPointToPoint:function(){var c,
a,b,d;return function(h,e){void 0===c&&(c=new ya,a=[new Wa,new Wa,new Wa],b=new f,d=new f);var g=e||new f,t=Infinity;c.setFromCoplanarPoints(this.a,this.b,this.c);c.projectPoint(h,b);if(!0===this.containsPoint(b))g.copy(b);else{a[0].set(this.a,this.b);a[1].set(this.b,this.c);a[2].set(this.c,this.a);for(var k=0;k<a.length;k++){a[k].closestPointToPoint(b,!0,d);var l=b.distanceToSquared(d);l<t&&(t=l,g.copy(d))}}return g}}(),equals:function(c){return c.a.equals(this.a)&&c.b.equals(this.b)&&c.c.equals(this.c)}};
ta.prototype={constructor:ta,clone:function(){return(new this.constructor).copy(this)},copy:function(c){this.a=c.a;this.b=c.b;this.c=c.c;this.normal.copy(c.normal);this.color.copy(c.color);this.materialIndex=c.materialIndex;for(var a=0,b=c.vertexNormals.length;a<b;a++)this.vertexNormals[a]=c.vertexNormals[a].clone();a=0;for(b=c.vertexColors.length;a<b;a++)this.vertexColors[a]=c.vertexColors[a].clone();return this}};oa.prototype=Object.create(Z.prototype);oa.prototype.constructor=oa;oa.prototype.isMeshBasicMaterial=
!0;oa.prototype.copy=function(c){Z.prototype.copy.call(this,c);this.color.copy(c.color);this.map=c.map;this.aoMap=c.aoMap;this.aoMapIntensity=c.aoMapIntensity;this.specularMap=c.specularMap;this.alphaMap=c.alphaMap;this.envMap=c.envMap;this.combine=c.combine;this.reflectivity=c.reflectivity;this.refractionRatio=c.refractionRatio;this.wireframe=c.wireframe;this.wireframeLinewidth=c.wireframeLinewidth;this.wireframeLinecap=c.wireframeLinecap;this.wireframeLinejoin=c.wireframeLinejoin;this.skinning=
c.skinning;this.morphTargets=c.morphTargets;return this};P.prototype={constructor:P,isBufferAttribute:!0,set needsUpdate(c){!0===c&&this.version++},setDynamic:function(c){this.dynamic=c;return this},copy:function(c){this.array=new c.array.constructor(c.array);this.itemSize=c.itemSize;this.count=c.count;this.normalized=c.normalized;this.dynamic=c.dynamic;return this},copyAt:function(c,a,b){c*=this.itemSize;b*=a.itemSize;for(var h=0,d=this.itemSize;h<d;h++)this.array[c+h]=a.array[b+h];return this},
copyArray:function(c){this.array.set(c);return this},copyColorsArray:function(c){for(var a=this.array,b=0,d=0,e=c.length;d<e;d++){var f=c[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",d),f=new V);a[b++]=f.r;a[b++]=f.g;a[b++]=f.b}return this},copyIndicesArray:function(c){for(var a=this.array,b=0,d=0,e=c.length;d<e;d++){var f=c[d];a[b++]=f.a;a[b++]=f.b;a[b++]=f.c}return this},copyVector2sArray:function(c){for(var a=this.array,b=0,d=0,e=c.length;d<e;d++){var f=
c[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",d),f=new g);a[b++]=f.x;a[b++]=f.y}return this},copyVector3sArray:function(c){for(var a=this.array,b=0,d=0,e=c.length;d<e;d++){var g=c[d];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",d),g=new f);a[b++]=g.x;a[b++]=g.y;a[b++]=g.z}return this},copyVector4sArray:function(c){for(var b=this.array,d=0,e=0,f=c.length;e<f;e++){var g=c[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",
e),g=new a);b[d++]=g.x;b[d++]=g.y;b[d++]=g.z;b[d++]=g.w}return this},set:function(c,a){void 0===a&&(a=0);this.array.set(c,a);return this},getX:function(c){return this.array[c*this.itemSize]},setX:function(c,a){this.array[c*this.itemSize]=a;return this},getY:function(c){return this.array[c*this.itemSize+1]},setY:function(c,a){this.array[c*this.itemSize+1]=a;return this},getZ:function(c){return this.array[c*this.itemSize+2]},setZ:function(c,a){this.array[c*this.itemSize+2]=a;return this},getW:function(c){return this.array[c*
this.itemSize+3]},setW:function(c,a){this.array[c*this.itemSize+3]=a;return this},setXY:function(c,a,b){c*=this.itemSize;this.array[c+0]=a;this.array[c+1]=b;return this},setXYZ:function(c,a,b,d){c*=this.itemSize;this.array[c+0]=a;this.array[c+1]=b;this.array[c+2]=d;return this},setXYZW:function(c,a,b,d,e){c*=this.itemSize;this.array[c+0]=a;this.array[c+1]=b;this.array[c+2]=d;this.array[c+3]=e;return this},clone:function(){return(new this.constructor).copy(this)}};Object.assign(ma.prototype,b.prototype,
{isGeometry:!0,applyMatrix:function(c){for(var a=(new va).getNormalMatrix(c),b=0,d=this.vertices.length;b<d;b++)this.vertices[b].applyMatrix4(c);b=0;for(d=this.faces.length;b<d;b++){c=this.faces[b];c.normal.applyMatrix3(a).normalize();for(var e=0,f=c.vertexNormals.length;e<f;e++)c.vertexNormals[e].applyMatrix3(a).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var c;
return function(a){void 0===c&&(c=new p);c.makeRotationX(a);this.applyMatrix(c);return this}}(),rotateY:function(){var c;return function(a){void 0===c&&(c=new p);c.makeRotationY(a);this.applyMatrix(c);return this}}(),rotateZ:function(){var c;return function(a){void 0===c&&(c=new p);c.makeRotationZ(a);this.applyMatrix(c);return this}}(),translate:function(){var c;return function(a,b,d){void 0===c&&(c=new p);c.makeTranslation(a,b,d);this.applyMatrix(c);return this}}(),scale:function(){var c;return function(a,
b,d){void 0===c&&(c=new p);c.makeScale(a,b,d);this.applyMatrix(c);return this}}(),lookAt:function(){var c;return function(a){void 0===c&&(c=new ca);c.lookAt(a);c.updateMatrix();this.applyMatrix(c.matrix)}}(),fromBufferGeometry:function(c){function a(c,a,h,d){var e=void 0!==l?[p[c].clone(),p[a].clone(),p[h].clone()]:[],f=void 0!==n?[b.colors[c].clone(),b.colors[a].clone(),b.colors[h].clone()]:[];d=new ta(c,a,h,e,f,d);b.faces.push(d);void 0!==m&&b.faceVertexUvs[0].push([q[c].clone(),q[a].clone(),q[h].clone()]);
void 0!==r&&b.faceVertexUvs[1].push([v[c].clone(),v[a].clone(),v[h].clone()])}var b=this,d=null!==c.index?c.index.array:void 0,e=c.attributes,k=e.position.array,l=void 0!==e.normal?e.normal.array:void 0,n=void 0!==e.color?e.color.array:void 0,m=void 0!==e.uv?e.uv.array:void 0,r=void 0!==e.uv2?e.uv2.array:void 0;void 0!==r&&(this.faceVertexUvs[1]=[]);for(var p=[],q=[],v=[],u=e=0;e<k.length;e+=3,u+=2)b.vertices.push(new f(k[e],k[e+1],k[e+2])),void 0!==l&&p.push(new f(l[e],l[e+1],l[e+2])),void 0!==n&&
b.colors.push(new V(n[e],n[e+1],n[e+2])),void 0!==m&&q.push(new g(m[u],m[u+1])),void 0!==r&&v.push(new g(r[u],r[u+1]));if(void 0!==d)if(k=c.groups,0<k.length)for(e=0;e<k.length;e++){var x=k[e],w=x.start,B=x.count;u=w;for(w+=B;u<w;u+=3)a(d[u],d[u+1],d[u+2],x.materialIndex)}else for(e=0;e<d.length;e+=3)a(d[e],d[e+1],d[e+2]);else for(e=0;e<k.length/3;e+=3)a(e,e+1,e+2);this.computeFaceNormals();null!==c.boundingBox&&(this.boundingBox=c.boundingBox.clone());null!==c.boundingSphere&&(this.boundingSphere=
c.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var c=this.boundingBox.getCenter().negate();this.translate(c.x,c.y,c.z);return c},normalize:function(){this.computeBoundingSphere();var c=this.boundingSphere.center,a=this.boundingSphere.radius;a=0===a?1:1/a;var b=new p;b.set(a,0,0,-a*c.x,0,a,0,-a*c.y,0,0,a,-a*c.z,0,0,0,1);this.applyMatrix(b);return this},computeFaceNormals:function(){for(var c=new f,a=new f,b=0,d=this.faces.length;b<d;b++){var e=this.faces[b],g=this.vertices[e.a],
k=this.vertices[e.b];c.subVectors(this.vertices[e.c],k);a.subVectors(g,k);c.cross(a);c.normalize();e.normal.copy(c)}},computeVertexNormals:function(c){void 0===c&&(c=!0);var a;var b=Array(this.vertices.length);var d=0;for(a=this.vertices.length;d<a;d++)b[d]=new f;if(c){var e=new f,g=new f;c=0;for(d=this.faces.length;c<d;c++){a=this.faces[c];var k=this.vertices[a.a];var l=this.vertices[a.b];var n=this.vertices[a.c];e.subVectors(n,l);g.subVectors(k,l);e.cross(g);b[a.a].add(e);b[a.b].add(e);b[a.c].add(e)}}else for(c=
0,d=this.faces.length;c<d;c++)a=this.faces[c],b[a.a].add(a.normal),b[a.b].add(a.normal),b[a.c].add(a.normal);d=0;for(a=this.vertices.length;d<a;d++)b[d].normalize();c=0;for(d=this.faces.length;c<d;c++)a=this.faces[c],k=a.vertexNormals,3===k.length?(k[0].copy(b[a.a]),k[1].copy(b[a.b]),k[2].copy(b[a.c])):(k[0]=b[a.a].clone(),k[1]=b[a.b].clone(),k[2]=b[a.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var c,a;var b=0;for(a=this.faces.length;b<a;b++){var d=
this.faces[b];d.__originalFaceNormal?d.__originalFaceNormal.copy(d.normal):d.__originalFaceNormal=d.normal.clone();d.__originalVertexNormals||(d.__originalVertexNormals=[]);var e=0;for(c=d.vertexNormals.length;e<c;e++)d.__originalVertexNormals[e]?d.__originalVertexNormals[e].copy(d.vertexNormals[e]):d.__originalVertexNormals[e]=d.vertexNormals[e].clone()}var g=new ma;g.faces=this.faces;e=0;for(c=this.morphTargets.length;e<c;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=
[];this.morphNormals[e].vertexNormals=[];d=this.morphNormals[e].faceNormals;var k=this.morphNormals[e].vertexNormals;b=0;for(a=this.faces.length;b<a;b++){var l=new f;var n={a:new f,b:new f,c:new f};d.push(l);k.push(n)}}k=this.morphNormals[e];g.vertices=this.morphTargets[e].vertices;g.computeFaceNormals();g.computeVertexNormals();b=0;for(a=this.faces.length;b<a;b++)d=this.faces[b],l=k.faceNormals[b],n=k.vertexNormals[b],l.copy(d.normal),n.a.copy(d.vertexNormals[0]),n.b.copy(d.vertexNormals[1]),n.c.copy(d.vertexNormals[2])}b=
0;for(a=this.faces.length;b<a;b++)d=this.faces[b],d.normal=d.__originalFaceNormal,d.vertexNormals=d.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){for(var c=0,a=this.vertices,b=0,d=a.length;b<d;b++)0<b&&(c+=a[b].distanceTo(a[b-1])),this.lineDistances[b]=c},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new sa);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===
this.boundingSphere&&(this.boundingSphere=new za);this.boundingSphere.setFromPoints(this.vertices)},merge:function(c,a,b){if(!1===(c&&c.isGeometry))console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",c);else{var h,d=this.vertices.length,e=this.vertices,f=c.vertices,g=this.faces,k=c.faces,t=this.faceVertexUvs[0],l=c.faceVertexUvs[0],n=this.colors,m=c.colors;void 0===b&&(b=0);void 0!==a&&(h=(new va).getNormalMatrix(a));c=0;for(var r=f.length;c<r;c++){var p=f[c].clone();
void 0!==a&&p.applyMatrix4(a);e.push(p)}c=0;for(r=m.length;c<r;c++)n.push(m[c].clone());c=0;for(r=k.length;c<r;c++){f=k[c];var q=f.vertexNormals;m=f.vertexColors;n=new ta(f.a+d,f.b+d,f.c+d);n.normal.copy(f.normal);void 0!==h&&n.normal.applyMatrix3(h).normalize();a=0;for(e=q.length;a<e;a++)p=q[a].clone(),void 0!==h&&p.applyMatrix3(h).normalize(),n.vertexNormals.push(p);n.color.copy(f.color);a=0;for(e=m.length;a<e;a++)p=m[a],n.vertexColors.push(p.clone());n.materialIndex=f.materialIndex+b;g.push(n)}c=
0;for(r=l.length;c<r;c++)if(b=l[c],h=[],void 0!==b){a=0;for(e=b.length;a<e;a++)h.push(b[a].clone());t.push(h)}}},mergeMesh:function(c){!1===(c&&c.isMesh)?console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",c):(c.matrixAutoUpdate&&c.updateMatrix(),this.merge(c.geometry,c.matrix))},mergeVertices:function(){var c={},a=[],b=[],d=Math.pow(10,4),e;var f=0;for(e=this.vertices.length;f<e;f++){var g=this.vertices[f];g=Math.round(g.x*d)+"_"+Math.round(g.y*d)+"_"+Math.round(g.z*d);
void 0===c[g]?(c[g]=f,a.push(this.vertices[f]),b[f]=a.length-1):b[f]=b[c[g]]}c=[];f=0;for(e=this.faces.length;f<e;f++)for(d=this.faces[f],d.a=b[d.a],d.b=b[d.b],d.c=b[d.c],d=[d.a,d.b,d.c],g=0;3>g;g++)if(d[g]===d[(g+1)%3]){c.push(f);break}for(f=c.length-1;0<=f;f--)for(d=c[f],this.faces.splice(d,1),b=0,e=this.faceVertexUvs.length;b<e;b++)this.faceVertexUvs[b].splice(d,1);f=this.vertices.length-a.length;this.vertices=a;return f},sortFacesByMaterialIndex:function(){for(var c=this.faces,a=c.length,b=0;b<
a;b++)c[b]._id=b;c.sort(function(c,a){return c.materialIndex-a.materialIndex});var d=this.faceVertexUvs[0],e=this.faceVertexUvs[1],f,g;d&&d.length===a&&(f=[]);e&&e.length===a&&(g=[]);for(b=0;b<a;b++){var k=c[b]._id;f&&f.push(d[k]);g&&g.push(e[k])}f&&(this.faceVertexUvs[0]=f);g&&(this.faceVertexUvs[1]=g)},toJSON:function(){function c(c,a,b){return b?c|1<<a:c&~(1<<a)}function a(c){var a=c.x.toString()+c.y.toString()+c.z.toString();if(void 0!==n[a])return n[a];n[a]=l.length/3;l.push(c.x,c.y,c.z);return n[a]}
function b(c){var a=c.r.toString()+c.g.toString()+c.b.toString();if(void 0!==r[a])return r[a];r[a]=m.length;m.push(c.getHex());return r[a]}function d(c){var a=c.x.toString()+c.y.toString();if(void 0!==q[a])return q[a];q[a]=p.length/2;p.push(c.x,c.y);return q[a]}var e={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};e.uuid=this.uuid;e.type=this.type;""!==this.name&&(e.name=this.name);if(void 0!==this.parameters){var f=this.parameters,g;for(g in f)void 0!==f[g]&&(e[g]=f[g]);return e}f=
[];for(g=0;g<this.vertices.length;g++){var k=this.vertices[g];f.push(k.x,k.y,k.z)}k=[];var l=[],n={},m=[],r={},p=[],q={};for(g=0;g<this.faces.length;g++){var v=this.faces[g],u=void 0!==this.faceVertexUvs[0][g],x=0<v.normal.length(),w=0<v.vertexNormals.length,B=1!==v.color.r||1!==v.color.g||1!==v.color.b,z=0<v.vertexColors.length,A=0;A=c(A,0,0);A=c(A,1,!0);A=c(A,2,!1);A=c(A,3,u);A=c(A,4,x);A=c(A,5,w);A=c(A,6,B);A=c(A,7,z);k.push(A);k.push(v.a,v.b,v.c);k.push(v.materialIndex);u&&(u=this.faceVertexUvs[0][g],
k.push(d(u[0]),d(u[1]),d(u[2])));x&&k.push(a(v.normal));w&&(x=v.vertexNormals,k.push(a(x[0]),a(x[1]),a(x[2])));B&&k.push(b(v.color));z&&(v=v.vertexColors,k.push(b(v[0]),b(v[1]),b(v[2])))}e.data={};e.data.vertices=f;e.data.normals=l;0<m.length&&(e.data.colors=m);0<p.length&&(e.data.uvs=[p]);e.data.faces=k;return e},clone:function(){return(new ma).copy(this)},copy:function(c){this.vertices=[];this.faces=[];this.faceVertexUvs=[[]];this.colors=[];for(var a=c.vertices,b=0,d=a.length;b<d;b++)this.vertices.push(a[b].clone());
a=c.colors;b=0;for(d=a.length;b<d;b++)this.colors.push(a[b].clone());a=c.faces;b=0;for(d=a.length;b<d;b++)this.faces.push(a[b].clone());b=0;for(d=c.faceVertexUvs.length;b<d;b++){a=c.faceVertexUvs[b];void 0===this.faceVertexUvs[b]&&(this.faceVertexUvs[b]=[]);for(var e=0,f=a.length;e<f;e++){for(var g=a[e],k=[],l=0,n=g.length;l<n;l++)k.push(g[l].clone());this.faceVertexUvs[b].push(k)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var xd=0;Object.assign(sb.prototype,b.prototype,
{computeBoundingBox:ma.prototype.computeBoundingBox,computeBoundingSphere:ma.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(c){var a,b=[],d;c=c.faces;for(var e=0;e<c.length;e++){var f=c[e];f.materialIndex!==d&&(d=f.materialIndex,
void 0!==a&&(a.count=3*e-a.start,b.push(a)),a={start:3*e,materialIndex:d})}void 0!==a&&(a.count=3*e-a.start,b.push(a));this.groups=b},fromGeometry:function(c){var a=c.faces,b=c.vertices,d=c.faceVertexUvs,e=d[0]&&0<d[0].length,f=d[1]&&0<d[1].length,k=c.morphTargets,l=k.length;if(0<l){var n=[];for(var m=0;m<l;m++)n[m]=[];this.morphTargets.position=n}var r=c.morphNormals,p=r.length;if(0<p){var q=[];for(m=0;m<p;m++)q[m]=[];this.morphTargets.normal=q}var v=c.skinIndices,u=c.skinWeights,x=v.length===b.length,
w=u.length===b.length;for(m=0;m<a.length;m++){var B=a[m];this.vertices.push(b[B.a],b[B.b],b[B.c]);var z=B.vertexNormals;3===z.length?this.normals.push(z[0],z[1],z[2]):(z=B.normal,this.normals.push(z,z,z));z=B.vertexColors;3===z.length?this.colors.push(z[0],z[1],z[2]):(z=B.color,this.colors.push(z,z,z));!0===e&&(z=d[0][m],void 0!==z?this.uvs.push(z[0],z[1],z[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",m),this.uvs.push(new g,new g,new g)));!0===f&&(z=d[1][m],void 0!==
z?this.uvs2.push(z[0],z[1],z[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",m),this.uvs2.push(new g,new g,new g)));for(z=0;z<l;z++){var A=k[z].vertices;n[z].push(A[B.a],A[B.b],A[B.c])}for(z=0;z<p;z++)A=r[z].vertexNormals[m],q[z].push(A.a,A.b,A.c);x&&this.skinIndices.push(v[B.a],v[B.b],v[B.c]);w&&this.skinWeights.push(u[B.a],u[B.b],u[B.c])}this.computeGroups(c);this.verticesNeedUpdate=c.verticesNeedUpdate;this.normalsNeedUpdate=c.normalsNeedUpdate;this.colorsNeedUpdate=
c.colorsNeedUpdate;this.uvsNeedUpdate=c.uvsNeedUpdate;this.groupsNeedUpdate=c.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.assign(ia.prototype,b.prototype,{isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(c){this.index=c},addAttribute:function(c,a,b){if(!1===(a&&a.isBufferAttribute)&&!1===(a&&a.isInterleavedBufferAttribute))console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(c,
new P(a,b));else if("index"===c)console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(a);else return this.attributes[c]=a,this},getAttribute:function(c){return this.attributes[c]},removeAttribute:function(c){delete this.attributes[c];return this},addGroup:function(c,a,b){this.groups.push({start:c,count:a,materialIndex:void 0!==b?b:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(c,a){this.drawRange.start=c;this.drawRange.count=a},applyMatrix:function(c){var a=
this.attributes.position;void 0!==a&&(c.applyToVector3Array(a.array),a.needsUpdate=!0);a=this.attributes.normal;void 0!==a&&((new va).getNormalMatrix(c).applyToVector3Array(a.array),a.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(){var c;return function(a){void 0===c&&(c=new p);c.makeRotationX(a);this.applyMatrix(c);return this}}(),rotateY:function(){var c;return function(a){void 0===c&&(c=
new p);c.makeRotationY(a);this.applyMatrix(c);return this}}(),rotateZ:function(){var c;return function(a){void 0===c&&(c=new p);c.makeRotationZ(a);this.applyMatrix(c);return this}}(),translate:function(){var c;return function(a,b,d){void 0===c&&(c=new p);c.makeTranslation(a,b,d);this.applyMatrix(c);return this}}(),scale:function(){var c;return function(a,b,d){void 0===c&&(c=new p);c.makeScale(a,b,d);this.applyMatrix(c);return this}}(),lookAt:function(){var c;return function(a){void 0===c&&(c=new ca);
c.lookAt(a);c.updateMatrix();this.applyMatrix(c.matrix)}}(),center:function(){this.computeBoundingBox();var c=this.boundingBox.getCenter().negate();this.translate(c.x,c.y,c.z);return c},setFromObject:function(c){var a=c.geometry;if(c&&c.isPoints||c&&c.isLine){c=new Oa(3*a.vertices.length,3);var b=new Oa(3*a.colors.length,3);this.addAttribute("position",c.copyVector3sArray(a.vertices));this.addAttribute("color",b.copyColorsArray(a.colors));a.lineDistances&&a.lineDistances.length===a.vertices.length&&
(c=new Oa(a.lineDistances.length,1),this.addAttribute("lineDistance",c.copyArray(a.lineDistances)));null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone())}else c&&c.isMesh&&a&&a.isGeometry&&this.fromGeometry(a);return this},updateFromObject:function(c){var a=c.geometry;if(c&&c.isMesh){var b=a.__directGeometry;!0===a.elementsNeedUpdate&&(b=void 0,a.elementsNeedUpdate=!1);if(void 0===b)return this.fromGeometry(a);b.verticesNeedUpdate=
a.verticesNeedUpdate;b.normalsNeedUpdate=a.normalsNeedUpdate;b.colorsNeedUpdate=a.colorsNeedUpdate;b.uvsNeedUpdate=a.uvsNeedUpdate;b.groupsNeedUpdate=a.groupsNeedUpdate;a.verticesNeedUpdate=!1;a.normalsNeedUpdate=!1;a.colorsNeedUpdate=!1;a.uvsNeedUpdate=!1;a.groupsNeedUpdate=!1;a=b}!0===a.verticesNeedUpdate&&(b=this.attributes.position,void 0!==b&&(b.copyVector3sArray(a.vertices),b.needsUpdate=!0),a.verticesNeedUpdate=!1);!0===a.normalsNeedUpdate&&(b=this.attributes.normal,void 0!==b&&(b.copyVector3sArray(a.normals),
b.needsUpdate=!0),a.normalsNeedUpdate=!1);!0===a.colorsNeedUpdate&&(b=this.attributes.color,void 0!==b&&(b.copyColorsArray(a.colors),b.needsUpdate=!0),a.colorsNeedUpdate=!1);a.uvsNeedUpdate&&(b=this.attributes.uv,void 0!==b&&(b.copyVector2sArray(a.uvs),b.needsUpdate=!0),a.uvsNeedUpdate=!1);a.lineDistancesNeedUpdate&&(b=this.attributes.lineDistance,void 0!==b&&(b.copyArray(a.lineDistances),b.needsUpdate=!0),a.lineDistancesNeedUpdate=!1);a.groupsNeedUpdate&&(a.computeGroups(c.geometry),this.groups=
a.groups,a.groupsNeedUpdate=!1);return this},fromGeometry:function(c){c.__directGeometry=(new sb).fromGeometry(c);return this.fromDirectGeometry(c.__directGeometry)},fromDirectGeometry:function(c){var a=new Float32Array(3*c.vertices.length);this.addAttribute("position",(new P(a,3)).copyVector3sArray(c.vertices));0<c.normals.length&&(a=new Float32Array(3*c.normals.length),this.addAttribute("normal",(new P(a,3)).copyVector3sArray(c.normals)));0<c.colors.length&&(a=new Float32Array(3*c.colors.length),
this.addAttribute("color",(new P(a,3)).copyColorsArray(c.colors)));0<c.uvs.length&&(a=new Float32Array(2*c.uvs.length),this.addAttribute("uv",(new P(a,2)).copyVector2sArray(c.uvs)));0<c.uvs2.length&&(a=new Float32Array(2*c.uvs2.length),this.addAttribute("uv2",(new P(a,2)).copyVector2sArray(c.uvs2)));0<c.indices.length&&(a=new (65535<c.vertices.length?Uint32Array:Uint16Array)(3*c.indices.length),this.setIndex((new P(a,1)).copyIndicesArray(c.indices)));this.groups=c.groups;for(var b in c.morphTargets){a=
[];for(var d=c.morphTargets[b],e=0,f=d.length;e<f;e++){var g=d[e],k=new Oa(3*g.length,3);a.push(k.copyVector3sArray(g))}this.morphAttributes[b]=a}0<c.skinIndices.length&&(b=new Oa(4*c.skinIndices.length,4),this.addAttribute("skinIndex",b.copyVector4sArray(c.skinIndices)));0<c.skinWeights.length&&(b=new Oa(4*c.skinWeights.length,4),this.addAttribute("skinWeight",b.copyVector4sArray(c.skinWeights)));null!==c.boundingSphere&&(this.boundingSphere=c.boundingSphere.clone());null!==c.boundingBox&&(this.boundingBox=
c.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new sa);var c=this.attributes.position.array;void 0!==c?this.boundingBox.setFromArray(c):this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var c=
new sa,a=new f;return function(){null===this.boundingSphere&&(this.boundingSphere=new za);var b=this.attributes.position;if(b){b=b.array;var d=this.boundingSphere.center;c.setFromArray(b);c.getCenter(d);for(var h=0,e=0,f=b.length;e<f;e+=3)a.fromArray(b,e),h=Math.max(h,d.distanceToSquared(a));this.boundingSphere.radius=Math.sqrt(h);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',
this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var c=this.index,a=this.attributes,b=this.groups;if(a.position){var d=a.position.array;if(void 0===a.normal)this.addAttribute("normal",new P(new Float32Array(d.length),3));else for(var e=a.normal.array,g=0,k=e.length;g<k;g++)e[g]=0;e=a.normal.array;var l=new f,n=new f,m=new f,r=new f,p=new f;if(c){c=c.array;0===b.length&&this.addGroup(0,c.length);for(var q=0,v=b.length;q<v;++q){g=b[q];k=g.start;var u=g.count;g=k;for(k+=u;g<
k;g+=3){u=3*c[g+0];var x=3*c[g+1];var w=3*c[g+2];l.fromArray(d,u);n.fromArray(d,x);m.fromArray(d,w);r.subVectors(m,n);p.subVectors(l,n);r.cross(p);e[u]+=r.x;e[u+1]+=r.y;e[u+2]+=r.z;e[x]+=r.x;e[x+1]+=r.y;e[x+2]+=r.z;e[w]+=r.x;e[w+1]+=r.y;e[w+2]+=r.z}}}else for(g=0,k=d.length;g<k;g+=9)l.fromArray(d,g),n.fromArray(d,g+3),m.fromArray(d,g+6),r.subVectors(m,n),p.subVectors(l,n),r.cross(p),e[g]=r.x,e[g+1]=r.y,e[g+2]=r.z,e[g+3]=r.x,e[g+4]=r.y,e[g+5]=r.z,e[g+6]=r.x,e[g+7]=r.y,e[g+8]=r.z;this.normalizeNormals();
a.normal.needsUpdate=!0}},merge:function(c,a){if(!1===(c&&c.isBufferGeometry))console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",c);else{void 0===a&&(a=0);var b=this.attributes,d;for(d in b)if(void 0!==c.attributes[d]){var h=b[d].array,e=c.attributes[d],f=e.array,g=0;for(e=e.itemSize*a;g<f.length;g++,e++)h[e]=f[g]}return this}},normalizeNormals:function(){for(var c=this.attributes.normal.array,a,b,d,e=0,f=c.length;e<f;e+=3)a=c[e],b=c[e+1],d=c[e+2],a=1/
Math.sqrt(a*a+b*b+d*d),c[e]*=a,c[e+1]*=a,c[e+2]*=a},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var c=new ia,a=this.index.array,b=this.attributes,d;for(d in b){var e=b[d],f=e.array;e=e.itemSize;for(var g=new f.constructor(a.length*e),k,l=0,n=0,m=a.length;n<m;n++){k=a[n]*e;for(var r=0;r<e;r++)g[l++]=f[k++]}c.addAttribute(d,new P(g,e))}return c},toJSON:function(){var c={metadata:{version:4.4,type:"BufferGeometry",
generator:"BufferGeometry.toJSON"}};c.uuid=this.uuid;c.type=this.type;""!==this.name&&(c.name=this.name);if(void 0!==this.parameters){var a=this.parameters;for(e in a)void 0!==a[e]&&(c[e]=a[e]);return c}c.data={attributes:{}};var b=this.index;null!==b&&(a=Array.prototype.slice.call(b.array),c.data.index={type:b.array.constructor.name,array:a});b=this.attributes;for(e in b){var d=b[e];a=Array.prototype.slice.call(d.array);c.data.attributes[e]={itemSize:d.itemSize,type:d.array.constructor.name,array:a,
normalized:d.normalized}}var e=this.groups;0<e.length&&(c.data.groups=JSON.parse(JSON.stringify(e)));e=this.boundingSphere;null!==e&&(c.data.boundingSphere={center:e.center.toArray(),radius:e.radius});return c},clone:function(){return(new ia).copy(this)},copy:function(c){var a=c.index;null!==a&&this.setIndex(a.clone());a=c.attributes;for(var b in a)this.addAttribute(b,a[b].clone());c=c.groups;b=0;for(a=c.length;b<a;b++){var d=c[b];this.addGroup(d.start,d.count,d.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});
ia.MaxIndex=65535;Ca.prototype=Object.assign(Object.create(ca.prototype),{constructor:Ca,isMesh:!0,setDrawMode:function(c){this.drawMode=c},copy:function(c){ca.prototype.copy.call(this,c);this.drawMode=c.drawMode;return this},updateMorphTargets:function(){var c=this.geometry.morphTargets;if(void 0!==c&&0<c.length){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=c.length;a<b;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[c[a].name]=a}},raycast:function(){function c(c,
a,b,d,h,e,f){Ha.barycoordFromPoint(c,a,b,d,z);h.multiplyScalar(z.x);e.multiplyScalar(z.y);f.multiplyScalar(z.z);h.add(e).add(f);return h.clone()}function a(c,a,b,d,h,e,f){var g=c.material;if(null===(1===g.side?b.intersectTriangle(e,h,d,!0,f):b.intersectTriangle(d,h,e,2!==g.side,f)))return null;A.copy(f);A.applyMatrix4(c.matrixWorld);b=a.ray.origin.distanceTo(A);return b<a.near||b>a.far?null:{distance:b,point:A.clone(),object:c}}function b(b,d,h,e,f,g,k,t){l.fromArray(e,3*g);n.fromArray(e,3*k);m.fromArray(e,
3*t);if(b=a(b,d,h,l,n,m,B))f&&(u.fromArray(f,2*g),x.fromArray(f,2*k),w.fromArray(f,2*t),b.uv=c(B,l,n,m,u,x,w)),b.face=new ta(g,k,t,Ha.normal(l,n,m)),b.faceIndex=g;return b}var d=new p,e=new ra,k=new za,l=new f,n=new f,m=new f,r=new f,q=new f,v=new f,u=new g,x=new g,w=new g,z=new f,B=new f,A=new f;return function(h,f){var g=this.geometry,t=this.material,y=this.matrixWorld;if(void 0!==t&&(null===g.boundingSphere&&g.computeBoundingSphere(),k.copy(g.boundingSphere),k.applyMatrix4(y),!1!==h.ray.intersectsSphere(k)&&
(d.getInverse(y),e.copy(h.ray).applyMatrix4(d),null===g.boundingBox||!1!==e.intersectsBox(g.boundingBox)))){var p,C;if(g&&g.isBufferGeometry){var M,aa;t=g.index;y=g.attributes;g=y.position.array;void 0!==y.uv&&(p=y.uv.array);if(null!==t){y=t.array;for(var Y=0,z=y.length;Y<z;Y+=3)if(t=y[Y],M=y[Y+1],aa=y[Y+2],C=b(this,h,e,g,p,t,M,aa))C.faceIndex=Math.floor(Y/3),f.push(C)}else for(Y=0,z=g.length;Y<z;Y+=9)if(t=Y/3,M=t+1,aa=t+2,C=b(this,h,e,g,p,t,M,aa))C.index=t,f.push(C)}else if(g&&g.isGeometry){y=t&&
t.isMultiMaterial;Y=!0===y?t.materials:null;z=g.vertices;M=g.faces;aa=g.faceVertexUvs[0];0<aa.length&&(p=aa);for(var A=0,D=M.length;A<D;A++){var F=M[A];C=!0===y?Y[F.materialIndex]:t;if(void 0!==C){aa=z[F.a];var ka=z[F.b];var Ba=z[F.c];if(!0===C.morphTargets){C=g.morphTargets;var R=this.morphTargetInfluences;l.set(0,0,0);n.set(0,0,0);m.set(0,0,0);for(var E=0,la=C.length;E<la;E++){var G=R[E];if(0!==G){var ea=C[E].vertices;l.addScaledVector(r.subVectors(ea[F.a],aa),G);n.addScaledVector(q.subVectors(ea[F.b],
ka),G);m.addScaledVector(v.subVectors(ea[F.c],Ba),G)}}l.add(aa);n.add(ka);m.add(Ba);aa=l;ka=n;Ba=m}if(C=a(this,h,e,aa,ka,Ba,B))p&&(R=p[A],u.copy(R[0]),x.copy(R[1]),w.copy(R[2]),C.uv=c(B,aa,ka,Ba,u,x,w)),C.face=F,C.faceIndex=A,f.push(C)}}}}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});tb.prototype=Object.create(ia.prototype);tb.prototype.constructor=tb;eb.prototype=Object.create(ia.prototype);eb.prototype.constructor=eb;Ea.prototype=Object.create(ca.prototype);
Ea.prototype.constructor=Ea;Ea.prototype.isCamera=!0;Ea.prototype.getWorldDirection=function(){var c=new q;return function(a){a=a||new f;this.getWorldQuaternion(c);return a.set(0,0,-1).applyQuaternion(c)}}();Ea.prototype.lookAt=function(){var c=new p;return function(a){c.lookAt(this.position,a,this.up);this.quaternion.setFromRotationMatrix(c)}}();Ea.prototype.clone=function(){return(new this.constructor).copy(this)};Ea.prototype.copy=function(c){ca.prototype.copy.call(this,c);this.matrixWorldInverse.copy(c.matrixWorldInverse);
this.projectionMatrix.copy(c.projectionMatrix);return this};cb.prototype=Object.assign(Object.create(Ea.prototype),{constructor:cb,isPerspectiveCamera:!0,copy:function(c){Ea.prototype.copy.call(this,c);this.fov=c.fov;this.zoom=c.zoom;this.near=c.near;this.far=c.far;this.focus=c.focus;this.aspect=c.aspect;this.view=null===c.view?null:Object.assign({},c.view);this.filmGauge=c.filmGauge;this.filmOffset=c.filmOffset;return this},setFocalLength:function(c){c=.5*this.getFilmHeight()/c;this.fov=2*l.Math.RAD2DEG*
Math.atan(c);this.updateProjectionMatrix()},getFocalLength:function(){var c=Math.tan(.5*l.Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/c},getEffectiveFOV:function(){return 2*l.Math.RAD2DEG*Math.atan(Math.tan(.5*l.Math.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(c,a,b,d,e,f){this.aspect=c/a;this.view={fullWidth:c,fullHeight:a,offsetX:b,offsetY:d,
width:e,height:f};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var c=this.near,a=c*Math.tan(.5*l.Math.DEG2RAD*this.fov)/this.zoom,b=2*a,d=this.aspect*b,e=-.5*d,f=this.view;if(null!==f){var g=f.fullWidth,k=f.fullHeight;e+=f.offsetX*d/g;a-=f.offsetY*b/k;d*=f.width/g;b*=f.height/k}f=this.filmOffset;0!==f&&(e+=c*f/this.getFilmWidth());this.projectionMatrix.makeFrustum(e,e+d,a-b,a,c,this.far)},toJSON:function(c){c=
ca.prototype.toJSON.call(this,c);c.object.fov=this.fov;c.object.zoom=this.zoom;c.object.near=this.near;c.object.far=this.far;c.object.focus=this.focus;c.object.aspect=this.aspect;null!==this.view&&(c.object.view=Object.assign({},this.view));c.object.filmGauge=this.filmGauge;c.object.filmOffset=this.filmOffset;return c}});Gb.prototype=Object.assign(Object.create(Ea.prototype),{constructor:Gb,isOrthographicCamera:!0,copy:function(c){Ea.prototype.copy.call(this,c);this.left=c.left;this.right=c.right;
this.top=c.top;this.bottom=c.bottom;this.near=c.near;this.far=c.far;this.zoom=c.zoom;this.view=null===c.view?null:Object.assign({},c.view);return this},setViewOffset:function(c,a,b,d,e,f){this.view={fullWidth:c,fullHeight:a,offsetX:b,offsetY:d,width:e,height:f};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var c=(this.right-this.left)/(2*this.zoom),a=(this.top-this.bottom)/(2*this.zoom),b=(this.right+this.left)/
2,d=(this.top+this.bottom)/2,e=b-c;b+=c;c=d+a;a=d-a;if(null!==this.view){b=this.zoom/(this.view.width/this.view.fullWidth);a=this.zoom/(this.view.height/this.view.fullHeight);var f=(this.right-this.left)/this.view.width;d=(this.top-this.bottom)/this.view.height;e+=this.view.offsetX/b*f;b=e+this.view.width/b*f;c-=this.view.offsetY/a*d;a=c-this.view.height/a*d}this.projectionMatrix.makeOrthographic(e,b,c,a,this.near,this.far)},toJSON:function(c){c=ca.prototype.toJSON.call(this,c);c.object.zoom=this.zoom;
c.object.left=this.left;c.object.right=this.right;c.object.top=this.top;c.object.bottom=this.bottom;c.object.near=this.near;c.object.far=this.far;null!==this.view&&(c.object.view=Object.assign({},this.view));return c}});var He=0;rb.prototype.isFogExp2=!0;rb.prototype.clone=function(){return new rb(this.color.getHex(),this.density)};rb.prototype.toJSON=function(c){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};lb.prototype.isFog=!0;lb.prototype.clone=function(){return new lb(this.color.getHex(),
this.near,this.far)};lb.prototype.toJSON=function(c){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}};Za.prototype=Object.create(ca.prototype);Za.prototype.constructor=Za;Za.prototype.copy=function(c,a){ca.prototype.copy.call(this,c,a);null!==c.background&&(this.background=c.background.clone());null!==c.fog&&(this.fog=c.fog.clone());null!==c.overrideMaterial&&(this.overrideMaterial=c.overrideMaterial.clone());this.autoUpdate=c.autoUpdate;this.matrixAutoUpdate=c.matrixAutoUpdate;
return this};Za.prototype.toJSON=function(c){var a=ca.prototype.toJSON.call(this,c);null!==this.background&&(a.object.background=this.background.toJSON(c));null!==this.fog&&(a.object.fog=this.fog.toJSON());return a};gb.prototype=Object.assign(Object.create(ca.prototype),{constructor:gb,isLensFlare:!0,copy:function(c){ca.prototype.copy.call(this,c);this.positionScreen.copy(c.positionScreen);this.customUpdateCallback=c.customUpdateCallback;for(var a=0,b=c.lensFlares.length;a<b;a++)this.lensFlares.push(c.lensFlares[a]);
return this},add:function(c,a,b,d,e,f){void 0===a&&(a=-1);void 0===b&&(b=0);void 0===f&&(f=1);void 0===e&&(e=new V(16777215));void 0===d&&(d=1);b=Math.min(b,Math.max(0,b));this.lensFlares.push({texture:c,size:a,distance:b,x:0,y:0,z:0,scale:1,rotation:0,opacity:f,color:e,blending:d})},updateLensFlares:function(){var c,a=this.lensFlares.length,b=2*-this.positionScreen.x,d=2*-this.positionScreen.y;for(c=0;c<a;c++){var e=this.lensFlares[c];e.x=this.positionScreen.x+b*e.distance;e.y=this.positionScreen.y+
d*e.distance;e.wantedRotation=e.x*Math.PI*.25;e.rotation+=.25*(e.wantedRotation-e.rotation)}}});wb.prototype=Object.create(Z.prototype);wb.prototype.constructor=wb;wb.prototype.copy=function(c){Z.prototype.copy.call(this,c);this.color.copy(c.color);this.map=c.map;this.rotation=c.rotation;return this};wc.prototype=Object.assign(Object.create(ca.prototype),{constructor:wc,isSprite:!0,raycast:function(){var c=new f;return function(a,b){c.setFromMatrixPosition(this.matrixWorld);var d=a.ray.distanceSqToPoint(c);
d>this.scale.x*this.scale.y/4||b.push({distance:Math.sqrt(d),point:this.position,face:null,object:this})}}(),clone:function(){return(new this.constructor(this.material)).copy(this)}});ec.prototype=Object.assign(Object.create(ca.prototype),{constructor:ec,copy:function(c){ca.prototype.copy.call(this,c,!1);c=c.levels;for(var a=0,b=c.length;a<b;a++){var d=c[a];this.addLevel(d.object.clone(),d.distance)}return this},addLevel:function(c,a){void 0===a&&(a=0);a=Math.abs(a);for(var b=this.levels,d=0;d<b.length&&
!(a<b[d].distance);d++);b.splice(d,0,{distance:a,object:c});this.add(c)},getObjectForDistance:function(c){for(var a=this.levels,b=1,d=a.length;b<d&&!(c<a[b].distance);b++);return a[b-1].object},raycast:function(){var c=new f;return function(a,b){c.setFromMatrixPosition(this.matrixWorld);var d=a.ray.origin.distanceTo(c);this.getObjectForDistance(d).raycast(a,b)}}(),update:function(){var c=new f,a=new f;return function(b){var d=this.levels;if(1<d.length){c.setFromMatrixPosition(b.matrixWorld);a.setFromMatrixPosition(this.matrixWorld);
b=c.distanceTo(a);d[0].object.visible=!0;for(var h=1,e=d.length;h<e;h++)if(b>=d[h].distance)d[h-1].object.visible=!1,d[h].object.visible=!0;else break;for(;h<e;h++)d[h].object.visible=!1}}}(),toJSON:function(c){c=ca.prototype.toJSON.call(this,c);c.object.levels=[];for(var a=this.levels,b=0,d=a.length;b<d;b++){var e=a[b];c.object.levels.push({object:e.object.uuid,distance:e.distance})}return c}});fc.prototype=Object.create(m.prototype);fc.prototype.constructor=fc;fc.prototype.isDataTexture=!0;Object.assign(Ma.prototype,
{calculateInverses:function(){this.boneInverses=[];for(var c=0,a=this.bones.length;c<a;c++){var b=new p;this.bones[c]&&b.getInverse(this.bones[c].matrixWorld);this.boneInverses.push(b)}},pose:function(){for(var c,a=0,b=this.bones.length;a<b;a++)(c=this.bones[a])&&c.matrixWorld.getInverse(this.boneInverses[a]);a=0;for(b=this.bones.length;a<b;a++)if(c=this.bones[a])c.parent&&c.parent.isBone?(c.matrix.getInverse(c.parent.matrixWorld),c.matrix.multiply(c.matrixWorld)):c.matrix.copy(c.matrixWorld),c.matrix.decompose(c.position,
c.quaternion,c.scale)},update:function(){var c=new p;return function(){for(var a=0,b=this.bones.length;a<b;a++)c.multiplyMatrices(this.bones[a]?this.bones[a].matrixWorld:this.identityMatrix,this.boneInverses[a]),c.toArray(this.boneMatrices,16*a);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new Ma(this.bones,this.boneInverses,this.useVertexTexture)}});Mb.prototype=Object.assign(Object.create(ca.prototype),{constructor:Mb,isBone:!0,copy:function(c){ca.prototype.copy.call(this,
c);this.skin=c.skin;return this}});Nb.prototype=Object.assign(Object.create(Ca.prototype),{constructor:Nb,isSkinnedMesh:!0,bind:function(c,a){this.skeleton=c;void 0===a&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),a=this.matrixWorld);this.bindMatrix.copy(a);this.bindMatrixInverse.getInverse(a)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry&&this.geometry.isGeometry)for(var c=0;c<this.geometry.skinWeights.length;c++){var b=this.geometry.skinWeights[c],
d=1/b.lengthManhattan();Infinity!==d?b.multiplyScalar(d):b.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){b=new a;var e=this.geometry.attributes.skinWeight;for(c=0;c<e.count;c++)b.x=e.getX(c),b.y=e.getY(c),b.z=e.getZ(c),b.w=e.getW(c),d=1/b.lengthManhattan(),Infinity!==d?b.multiplyScalar(d):b.set(1,0,0,0),e.setXYZW(c,b.x,b.y,b.z,b.w)}},updateMatrixWorld:function(c){Ca.prototype.updateMatrixWorld.call(this,!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):
"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return(new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture)).copy(this)}});Qa.prototype=Object.create(Z.prototype);Qa.prototype.constructor=Qa;Qa.prototype.isLineBasicMaterial=!0;Qa.prototype.copy=function(c){Z.prototype.copy.call(this,c);this.color.copy(c.color);this.linewidth=c.linewidth;this.linecap=c.linecap;
this.linejoin=c.linejoin;return this};xb.prototype=Object.assign(Object.create(ca.prototype),{constructor:xb,isLine:!0,raycast:function(){var c=new p,a=new ra,b=new za;return function(d,h){var e=d.linePrecision;e*=e;var g=this.geometry,k=this.matrixWorld;null===g.boundingSphere&&g.computeBoundingSphere();b.copy(g.boundingSphere);b.applyMatrix4(k);if(!1!==d.ray.intersectsSphere(b)){c.getInverse(k);a.copy(d.ray).applyMatrix4(c);var l=new f,t=new f;k=new f;var n=new f,m=this&&this.isLineSegments?2:1;
if(g&&g.isBufferGeometry){var r=g.index,y=g.attributes.position.array;if(null!==r){r=r.array;g=0;for(var p=r.length-1;g<p;g+=m){var q=r[g+1];l.fromArray(y,3*r[g]);t.fromArray(y,3*q);q=a.distanceSqToSegment(l,t,n,k);q>e||(n.applyMatrix4(this.matrixWorld),q=d.ray.origin.distanceTo(n),q<d.near||q>d.far||h.push({distance:q,point:k.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}else for(g=0,p=y.length/3-1;g<p;g+=m)l.fromArray(y,3*g),t.fromArray(y,3*g+3),q=a.distanceSqToSegment(l,
t,n,k),q>e||(n.applyMatrix4(this.matrixWorld),q=d.ray.origin.distanceTo(n),q<d.near||q>d.far||h.push({distance:q,point:k.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(g&&g.isGeometry)for(l=g.vertices,t=l.length,g=0;g<t-1;g+=m)q=a.distanceSqToSegment(l[g],l[g+1],n,k),q>e||(n.applyMatrix4(this.matrixWorld),q=d.ray.origin.distanceTo(n),q<d.near||q>d.far||h.push({distance:q,point:k.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,
object:this}))}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});Ka.prototype=Object.assign(Object.create(xb.prototype),{constructor:Ka,isLineSegments:!0});yb.prototype=Object.create(Z.prototype);yb.prototype.constructor=yb;yb.prototype.isPointsMaterial=!0;yb.prototype.copy=function(c){Z.prototype.copy.call(this,c);this.color.copy(c.color);this.map=c.map;this.size=c.size;this.sizeAttenuation=c.sizeAttenuation;return this};zc.prototype=Object.assign(Object.create(ca.prototype),
{constructor:zc,isPoints:!0,raycast:function(){var c=new p,a=new ra,b=new za;return function(d,h){function e(c,b){var e=a.distanceSqToPoint(c);if(e<n){var f=a.closestPointToPoint(c);f.applyMatrix4(l);var k=d.ray.origin.distanceTo(f);k<d.near||k>d.far||h.push({distance:k,distanceToRay:Math.sqrt(e),point:f.clone(),index:b,face:null,object:g})}}var g=this,k=this.geometry,l=this.matrixWorld,t=d.params.Points.threshold;null===k.boundingSphere&&k.computeBoundingSphere();b.copy(k.boundingSphere);b.applyMatrix4(l);
if(!1!==d.ray.intersectsSphere(b)){c.getInverse(l);a.copy(d.ray).applyMatrix4(c);t/=(this.scale.x+this.scale.y+this.scale.z)/3;var n=t*t;t=new f;if(k&&k.isBufferGeometry){var m=k.index;k=k.attributes.position.array;if(null!==m){var r=m.array;m=0;for(var y=r.length;m<y;m++){var p=r[m];t.fromArray(k,3*p);e(t,p)}}else for(m=0,r=k.length/3;m<r;m++)t.fromArray(k,3*m),e(t,m)}else for(t=k.vertices,m=0,r=t.length;m<r;m++)e(t[m],m)}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});
zb.prototype=Object.assign(Object.create(ca.prototype),{constructor:zb});Ab.prototype=Object.create(m.prototype);Ab.prototype.constructor=Ab;mb.prototype=Object.create(m.prototype);mb.prototype.constructor=mb;mb.prototype.isCompressedTexture=!0;Yc.prototype=Object.create(m.prototype);Yc.prototype.constructor=Yc;Hc.prototype=Object.create(m.prototype);Hc.prototype.constructor=Hc;Hc.prototype.isDepthTexture=!0;Ac.prototype=Object.create(ia.prototype);Ac.prototype.constructor=Ac;Vb.prototype=Object.create(ma.prototype);
Vb.prototype.constructor=Vb;$a.prototype=Object.create(ma.prototype);$a.prototype.constructor=$a;Ic.prototype=Object.create($a.prototype);Ic.prototype.constructor=Ic;Jc.prototype=Object.create($a.prototype);Jc.prototype.constructor=Jc;Wb.prototype=Object.create($a.prototype);Wb.prototype.constructor=Wb;Xb.prototype=Object.create($a.prototype);Xb.prototype.constructor=Xb;hb.prototype=Object.create(ma.prototype);hb.prototype.constructor=hb;hb.NoTaper=function(c){return 1};hb.SinusoidalTaper=function(c){return Math.sin(Math.PI*
c)};hb.FrenetFrames=function(c,a,b){var d=new f,h=[],e=[],g=[],k=new f,t=new p;a+=1;var n;this.tangents=h;this.normals=e;this.binormals=g;for(n=0;n<a;n++){var m=n/(a-1);h[n]=c.getTangentAt(m);h[n].normalize()}e[0]=new f;g[0]=new f;c=Number.MAX_VALUE;n=Math.abs(h[0].x);m=Math.abs(h[0].y);var r=Math.abs(h[0].z);n<=c&&(c=n,d.set(1,0,0));m<=c&&(c=m,d.set(0,1,0));r<=c&&d.set(0,0,1);k.crossVectors(h[0],d).normalize();e[0].crossVectors(h[0],k);g[0].crossVectors(h[0],e[0]);for(n=1;n<a;n++)e[n]=e[n-1].clone(),
g[n]=g[n-1].clone(),k.crossVectors(h[n-1],h[n]),k.length()>Number.EPSILON&&(k.normalize(),d=Math.acos(l.Math.clamp(h[n-1].dot(h[n]),-1,1)),e[n].applyMatrix4(t.makeRotationAxis(k,d))),g[n].crossVectors(h[n],e[n]);if(b)for(d=Math.acos(l.Math.clamp(e[0].dot(e[a-1]),-1,1)),d/=a-1,0<h[0].dot(k.crossVectors(e[0],e[a-1]))&&(d=-d),n=1;n<a;n++)e[n].applyMatrix4(t.makeRotationAxis(h[n],d*n)),g[n].crossVectors(h[n],e[n])};Ob.prototype=Object.create(ia.prototype);Ob.prototype.constructor=Ob;Kc.prototype=Object.create(ma.prototype);
Kc.prototype.constructor=Kc;Bc.prototype=Object.create(ia.prototype);Bc.prototype.constructor=Bc;Yb.prototype=Object.create(ma.prototype);Yb.prototype.constructor=Yb;l.ShapeUtils={area:function(c){for(var a=c.length,b=0,d=a-1,e=0;e<a;d=e++)b+=c[d].x*c[e].y-c[e].x*c[d].y;return.5*b},triangulate:function(){return function(c,a){var b=c.length;if(3>b)return null;var d=[],h=[],e=[],f;if(0<l.ShapeUtils.area(c))for(f=0;f<b;f++)h[f]=f;else for(f=0;f<b;f++)h[f]=b-1-f;var g=2*b;for(f=b-1;2<b;){if(0>=g--){console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()");
break}var k=f;b<=k&&(k=0);f=k+1;b<=f&&(f=0);var n=f+1;b<=n&&(n=0);a:{var m,r;var p=c[h[k]].x;var q=c[h[k]].y;var v=c[h[f]].x;var u=c[h[f]].y;var x=c[h[n]].x;var w=c[h[n]].y;if(Number.EPSILON>(v-p)*(w-q)-(u-q)*(x-p))var z=!1;else{var B,A,D,F;var R=x-v;var E=w-u;var G=p-x;var ea=q-w;var K=v-p;var H=u-q;for(z=0;z<b;z++)if(m=c[h[z]].x,r=c[h[z]].y,!(m===p&&r===q||m===v&&r===u||m===x&&r===w)&&(B=m-p,A=r-q,D=m-v,F=r-u,m-=x,r-=w,D=R*F-E*D,B=K*A-H*B,A=G*r-ea*m,D>=-Number.EPSILON&&A>=-Number.EPSILON&&B>=-Number.EPSILON)){z=
!1;break a}z=!0}}if(z){d.push([c[h[k]],c[h[f]],c[h[n]]]);e.push([h[k],h[f],h[n]]);k=f;for(n=f+1;n<b;k++,n++)h[k]=h[n];b--;g=2*b}}return a?e:d}}(),triangulateShape:function(c,a){function b(c){var a=c.length;2<a&&c[a-1].equals(c[0])&&c.pop()}function d(c,a,b){return c.x!==a.x?c.x<a.x?c.x<=b.x&&b.x<=a.x:a.x<=b.x&&b.x<=c.x:c.y<a.y?c.y<=b.y&&b.y<=a.y:a.y<=b.y&&b.y<=c.y}function h(c,a,b,h,e){var f=a.x-c.x,g=a.y-c.y,k=h.x-b.x,l=h.y-b.y,t=c.x-b.x,n=c.y-b.y,m=g*k-f*l,r=g*t-f*n;if(Math.abs(m)>Number.EPSILON){if(0<
m){if(0>r||r>m)return[];k=l*t-k*n;if(0>k||k>m)return[]}else{if(0<r||r<m)return[];k=l*t-k*n;if(0<k||k<m)return[]}if(0===k)return!e||0!==r&&r!==m?[c]:[];if(k===m)return!e||0!==r&&r!==m?[a]:[];if(0===r)return[b];if(r===m)return[h];e=k/m;return[{x:c.x+e*f,y:c.y+e*g}]}if(0!==r||l*t!==k*n)return[];g=0===f&&0===g;k=0===k&&0===l;if(g&&k)return c.x!==b.x||c.y!==b.y?[]:[c];if(g)return d(b,h,c)?[c]:[];if(k)return d(c,a,b)?[b]:[];0!==f?(c.x<a.x?(f=c,k=c.x,g=a,c=a.x):(f=a,k=a.x,g=c,c=c.x),b.x<h.x?(a=b,m=b.x,l=
h,b=h.x):(a=h,m=h.x,l=b,b=b.x)):(c.y<a.y?(f=c,k=c.y,g=a,c=a.y):(f=a,k=a.y,g=c,c=c.y),b.y<h.y?(a=b,m=b.y,l=h,b=h.y):(a=h,m=h.y,l=b,b=b.y));return k<=m?c<m?[]:c===m?e?[]:[a]:c<=b?[a,g]:[a,l]:k>b?[]:k===b?e?[]:[f]:c<=b?[f,g]:[f,l]}function e(c,a,b,d){var h=a.x-c.x,e=a.y-c.y;a=b.x-c.x;b=b.y-c.y;var f=d.x-c.x;d=d.y-c.y;c=h*b-e*a;h=h*d-e*f;return Math.abs(c)>Number.EPSILON?(a=f*b-d*a,0<c?0<=h&&0<=a:0<=h||0<=a):0<h}b(c);a.forEach(b);var f,g={};var k=c.concat();var n=0;for(f=a.length;n<f;n++)Array.prototype.push.apply(k,
a[n]);n=0;for(f=k.length;n<f;n++){var m=k[n].x+":"+k[n].y;void 0!==g[m]&&console.warn("THREE.ShapeUtils: Duplicate point",m,n);g[m]=n}n=function(c,a){function b(c,a){var b=g.length-1,d=c-1;0>d&&(d=b);var h=c+1;h>b&&(h=0);b=e(g[c],g[d],g[h],M[a]);if(!b)return!1;b=M.length-1;d=a-1;0>d&&(d=b);h=a+1;h>b&&(h=0);return e(M[a],M[d],M[h],g[c])?!0:!1}function d(c,a){var b,d;for(b=0;b<g.length;b++)if(d=b+1,d%=g.length,d=h(c,a,g[b],g[d],!0),0<d.length)return!0;return!1}function f(c,b){var d,e,f;for(d=0;d<k.length;d++){var g=
a[k[d]];for(e=0;e<g.length;e++)if(f=e+1,f%=g.length,f=h(c,b,g[e],g[f],!0),0<f.length)return!0}return!1}var g=c.concat(),k=[],l,t,n,m,r=[],p,y=0;for(l=a.length;y<l;y++)k.push(y);var q=0;for(var v=2*k.length;0<k.length;){v--;if(0>v){console.log("Infinite Loop! Holes left:"+k.length+", Probably Hole outside Shape!");break}for(t=q;t<g.length;t++){var C=g[t];l=-1;for(y=0;y<k.length;y++)if(n=k[y],m=C.x+":"+C.y+":"+n,void 0===r[m]){var M=a[n];for(p=0;p<M.length;p++)if(n=M[p],b(t,p)&&!d(C,n)&&!f(C,n)){l=
p;k.splice(y,1);q=g.slice(0,t+1);n=g.slice(t);p=M.slice(l);var u=M.slice(0,l+1);g=q.concat(p).concat(u).concat(n);q=t;break}if(0<=l)break;r[m]=!0}if(0<=l)break}}return g}(c,a);var r=l.ShapeUtils.triangulate(n,!1);n=0;for(f=r.length;n<f;n++){var p=r[n];for(k=0;3>k;k++)m=p[k].x+":"+p[k].y,m=g[m],void 0!==m&&(p[k]=m)}return r.concat()},isClockWise:function(c){return 0>l.ShapeUtils.area(c)},b2:function(){return function(c,a,b,d){var h=1-c;return h*h*a+2*(1-c)*c*b+c*c*d}}(),b3:function(){return function(c,
a,b,d,e){var h=1-c,f=1-c;return h*h*h*a+3*f*f*c*b+3*(1-c)*c*c*d+c*c*c*e}}()};ab.prototype=Object.create(ma.prototype);ab.prototype.constructor=ab;ab.prototype.addShapeList=function(c,a){for(var b=c.length,d=0;d<b;d++)this.addShape(c[d],a)};ab.prototype.addShape=function(c,a){function b(c,a,b){a||console.error("THREE.ExtrudeGeometry: vec does not exist");return a.clone().multiplyScalar(b).add(c)}function d(c,a,b){var d=c.x-a.x;var h=c.y-a.y;var e=b.x-c.x;var f=b.y-c.y,k=d*d+h*h;if(Math.abs(d*f-h*e)>
Number.EPSILON){var l=Math.sqrt(k),t=Math.sqrt(e*e+f*f);k=a.x-h/l;a=a.y+d/l;f=((b.x-f/t-k)*f-(b.y+e/t-a)*e)/(d*f-h*e);e=k+d*f-c.x;d=a+h*f-c.y;h=e*e+d*d;if(2>=h)return new g(e,d);h=Math.sqrt(h/2)}else c=!1,d>Number.EPSILON?e>Number.EPSILON&&(c=!0):d<-Number.EPSILON?e<-Number.EPSILON&&(c=!0):Math.sign(h)===Math.sign(f)&&(c=!0),c?(e=-h,h=Math.sqrt(k)):(e=d,d=h,h=Math.sqrt(k/2));return new g(e/h,d/h)}function h(c,a){for(J=c.length;0<=--J;){var b=J;var d=J-1;0>d&&(d=c.length-1);var h,e=u+2*p;for(h=0;h<
e;h++){var f=S*h,g=S*(h+1),k=a+b+f;f=a+d+f;var l=a+d+g;g=a+b+g;k+=ea;f+=ea;l+=ea;g+=ea;G.faces.push(new ta(k,f,g,null,null,1));G.faces.push(new ta(f,l,g,null,null,1));k=B.generateSideWallUV(G,k,f,l,g);G.faceVertexUvs[0].push([k[0],k[1],k[3]]);G.faceVertexUvs[0].push([k[1],k[2],k[3]])}}}function e(c,a,b){G.vertices.push(new f(c,a,b))}function k(c,a,b){c+=ea;a+=ea;b+=ea;G.faces.push(new ta(c,a,b,null,null,0));c=B.generateTopUV(G,c,a,b);G.faceVertexUvs[0].push(c)}var n=void 0!==a.amount?a.amount:100,
m=void 0!==a.bevelThickness?a.bevelThickness:6,r=void 0!==a.bevelSize?a.bevelSize:m-2,p=void 0!==a.bevelSegments?a.bevelSegments:3,q=void 0!==a.bevelEnabled?a.bevelEnabled:!0,v=void 0!==a.curveSegments?a.curveSegments:12,u=void 0!==a.steps?a.steps:1,x=a.extrudePath,w,z=!1,B=void 0!==a.UVGenerator?a.UVGenerator:ab.WorldUVGenerator,A,D,F,R;x&&(w=x.getSpacedPoints(u),z=!0,q=!1,A=void 0!==a.frames?a.frames:new hb.FrenetFrames(x,u,!1),D=new f,F=new f,R=new f);q||(r=m=p=0);var E,G=this,ea=this.vertices.length;
x=c.extractPoints(v);v=x.shape;var K=x.holes;if(x=!l.ShapeUtils.isClockWise(v)){v=v.reverse();var H=0;for(E=K.length;H<E;H++){var T=K[H];l.ShapeUtils.isClockWise(T)&&(K[H]=T.reverse())}x=!1}var L=l.ShapeUtils.triangulateShape(v,K),P=v;H=0;for(E=K.length;H<E;H++)T=K[H],v=v.concat(T);var Q,S=v.length,U,ca=L.length;x=[];var J=0;var O=P.length;var I=O-1;for(Q=J+1;J<O;J++,I++,Q++)I===O&&(I=0),Q===O&&(Q=0),x[J]=d(P[J],P[I],P[Q]);var ha=[],Z=x.concat();H=0;for(E=K.length;H<E;H++){T=K[H];var sa=[];J=0;O=
T.length;I=O-1;for(Q=J+1;J<O;J++,I++,Q++)I===O&&(I=0),Q===O&&(Q=0),sa[J]=d(T[J],T[I],T[Q]);ha.push(sa);Z=Z.concat(sa)}for(I=0;I<p;I++){O=I/p;var V=m*Math.cos(O*Math.PI/2);Q=r*Math.sin(O*Math.PI/2);J=0;for(O=P.length;J<O;J++){var fa=b(P[J],x[J],Q);e(fa.x,fa.y,-V)}H=0;for(E=K.length;H<E;H++)for(T=K[H],sa=ha[H],J=0,O=T.length;J<O;J++)fa=b(T[J],sa[J],Q),e(fa.x,fa.y,-V)}Q=r;for(J=0;J<S;J++)fa=q?b(v[J],Z[J],Q):v[J],z?(F.copy(A.normals[0]).multiplyScalar(fa.x),D.copy(A.binormals[0]).multiplyScalar(fa.y),
R.copy(w[0]).add(F).add(D),e(R.x,R.y,R.z)):e(fa.x,fa.y,0);for(O=1;O<=u;O++)for(J=0;J<S;J++)fa=q?b(v[J],Z[J],Q):v[J],z?(F.copy(A.normals[O]).multiplyScalar(fa.x),D.copy(A.binormals[O]).multiplyScalar(fa.y),R.copy(w[O]).add(F).add(D),e(R.x,R.y,R.z)):e(fa.x,fa.y,n/u*O);for(I=p-1;0<=I;I--){O=I/p;V=m*Math.cos(O*Math.PI/2);Q=r*Math.sin(O*Math.PI/2);J=0;for(O=P.length;J<O;J++)fa=b(P[J],x[J],Q),e(fa.x,fa.y,n+V);H=0;for(E=K.length;H<E;H++)for(T=K[H],sa=ha[H],J=0,O=T.length;J<O;J++)fa=b(T[J],sa[J],Q),z?e(fa.x,
fa.y+w[u-1].y,w[u-1].x+V):e(fa.x,fa.y,n+V)}(function(){if(q){var c=0*S;for(J=0;J<ca;J++)U=L[J],k(U[2]+c,U[1]+c,U[0]+c);c=S*(u+2*p);for(J=0;J<ca;J++)U=L[J],k(U[0]+c,U[1]+c,U[2]+c)}else{for(J=0;J<ca;J++)U=L[J],k(U[2],U[1],U[0]);for(J=0;J<ca;J++)U=L[J],k(U[0]+S*u,U[1]+S*u,U[2]+S*u)}})();(function(){var c=0;h(P,c);c+=P.length;H=0;for(E=K.length;H<E;H++)T=K[H],h(T,c),c+=T.length})()};ab.WorldUVGenerator={generateTopUV:function(c,a,b,d){c=c.vertices;a=c[a];b=c[b];d=c[d];return[new g(a.x,a.y),new g(b.x,
b.y),new g(d.x,d.y)]},generateSideWallUV:function(c,a,b,d,e){c=c.vertices;a=c[a];b=c[b];d=c[d];e=c[e];return.01>Math.abs(a.y-b.y)?[new g(a.x,1-a.z),new g(b.x,1-b.z),new g(d.x,1-d.z),new g(e.x,1-e.z)]:[new g(a.y,1-a.z),new g(b.y,1-b.z),new g(d.y,1-d.z),new g(e.y,1-e.z)]}};Zb.prototype=Object.create(ab.prototype);Zb.prototype.constructor=Zb;Ta.prototype=Object.create(ia.prototype);Ta.prototype.constructor=Ta;gc.prototype=Object.create(ma.prototype);gc.prototype.constructor=gc;$b.prototype=Object.create(ia.prototype);
$b.prototype.constructor=$b;Cc.prototype=Object.create(ma.prototype);Cc.prototype.constructor=Cc;hc.prototype=Object.create(ma.prototype);hc.prototype.constructor=hc;ic.prototype=Object.create(ia.prototype);ic.prototype.constructor=ic;jc.prototype=Object.create(ma.prototype);jc.prototype.constructor=jc;Pb.prototype=Object.create(ma.prototype);Pb.prototype.constructor=Pb;Pb.prototype.addShapeList=function(c,a){for(var b=0,d=c.length;b<d;b++)this.addShape(c[b],a);return this};Pb.prototype.addShape=
function(c,a){void 0===a&&(a={});var b=a.material,d=void 0===a.UVGenerator?ab.WorldUVGenerator:a.UVGenerator,h,e=this.vertices.length;var g=c.extractPoints(void 0!==a.curveSegments?a.curveSegments:12);var k=g.shape,n=g.holes;if(!l.ShapeUtils.isClockWise(k))for(k=k.reverse(),g=0,h=n.length;g<h;g++){var m=n[g];l.ShapeUtils.isClockWise(m)&&(n[g]=m.reverse())}var r=l.ShapeUtils.triangulateShape(k,n);g=0;for(h=n.length;g<h;g++)m=n[g],k=k.concat(m);n=k.length;h=r.length;for(g=0;g<n;g++)m=k[g],this.vertices.push(new f(m.x,
m.y,0));for(g=0;g<h;g++)n=r[g],k=n[0]+e,m=n[1]+e,n=n[2]+e,this.faces.push(new ta(k,m,n,null,null,b)),this.faceVertexUvs[0].push(d.generateTopUV(this,k,m,n))};kc.prototype=Object.create(ia.prototype);kc.prototype.constructor=kc;ac.prototype=Object.create(ia.prototype);ac.prototype.constructor=ac;nb.prototype=Object.create(ma.prototype);nb.prototype.constructor=nb;Bb.prototype=Object.create(nb.prototype);Bb.prototype.constructor=Bb;Hb.prototype=Object.create(ia.prototype);Hb.prototype.constructor=Hb;
Cb.prototype=Object.create(ia.prototype);Cb.prototype.constructor=Cb;ib.prototype=Object.create(ma.prototype);ib.prototype.constructor=ib;Ib.prototype=Object.create(ma.prototype);Ib.prototype.constructor=Ib;var dc=Object.freeze({WireframeGeometry:Ac,ParametricGeometry:Vb,TetrahedronGeometry:Ic,OctahedronGeometry:Jc,IcosahedronGeometry:Wb,DodecahedronGeometry:Xb,PolyhedronGeometry:$a,TubeGeometry:hb,TorusKnotGeometry:Kc,TorusKnotBufferGeometry:Ob,TorusGeometry:Yb,TorusBufferGeometry:Bc,TextGeometry:Zb,
SphereBufferGeometry:Ta,SphereGeometry:gc,RingGeometry:Cc,RingBufferGeometry:$b,PlaneBufferGeometry:eb,PlaneGeometry:hc,LatheGeometry:jc,LatheBufferGeometry:ic,ShapeGeometry:Pb,ExtrudeGeometry:ab,EdgesGeometry:kc,ConeGeometry:Bb,ConeBufferGeometry:Hb,CylinderGeometry:nb,CylinderBufferGeometry:ac,CircleBufferGeometry:Cb,CircleGeometry:ib,BoxBufferGeometry:tb,BoxGeometry:Ib});Qb.prototype=Object.create(Aa.prototype);Qb.prototype.constructor=Qb;Qb.prototype.isShadowMaterial=!0;Rb.prototype=Object.create(Aa.prototype);
Rb.prototype.constructor=Rb;Rb.prototype.isRawShaderMaterial=!0;lc.prototype={constructor:lc,isMultiMaterial:!0,toJSON:function(c){for(var a={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},b=this.materials,d=0,e=b.length;d<e;d++){var f=b[d].toJSON(c);delete f.metadata;a.materials.push(f)}a.visible=this.visible;return a},clone:function(){for(var c=new this.constructor,a=0;a<this.materials.length;a++)c.materials.push(this.materials[a].clone());
c.visible=this.visible;return c}};vb.prototype=Object.create(Z.prototype);vb.prototype.constructor=vb;vb.prototype.isMeshStandardMaterial=!0;vb.prototype.copy=function(c){Z.prototype.copy.call(this,c);this.defines={STANDARD:""};this.color.copy(c.color);this.roughness=c.roughness;this.metalness=c.metalness;this.map=c.map;this.lightMap=c.lightMap;this.lightMapIntensity=c.lightMapIntensity;this.aoMap=c.aoMap;this.aoMapIntensity=c.aoMapIntensity;this.emissive.copy(c.emissive);this.emissiveMap=c.emissiveMap;
this.emissiveIntensity=c.emissiveIntensity;this.bumpMap=c.bumpMap;this.bumpScale=c.bumpScale;this.normalMap=c.normalMap;this.normalScale.copy(c.normalScale);this.displacementMap=c.displacementMap;this.displacementScale=c.displacementScale;this.displacementBias=c.displacementBias;this.roughnessMap=c.roughnessMap;this.metalnessMap=c.metalnessMap;this.alphaMap=c.alphaMap;this.envMap=c.envMap;this.envMapIntensity=c.envMapIntensity;this.refractionRatio=c.refractionRatio;this.wireframe=c.wireframe;this.wireframeLinewidth=
c.wireframeLinewidth;this.wireframeLinecap=c.wireframeLinecap;this.wireframeLinejoin=c.wireframeLinejoin;this.skinning=c.skinning;this.morphTargets=c.morphTargets;this.morphNormals=c.morphNormals;return this};Sb.prototype=Object.create(vb.prototype);Sb.prototype.constructor=Sb;Sb.prototype.isMeshPhysicalMaterial=!0;Sb.prototype.copy=function(c){vb.prototype.copy.call(this,c);this.defines={PHYSICAL:""};this.reflectivity=c.reflectivity;this.clearCoat=c.clearCoat;this.clearCoatRoughness=c.clearCoatRoughness;
return this};Db.prototype=Object.create(Z.prototype);Db.prototype.constructor=Db;Db.prototype.isMeshPhongMaterial=!0;Db.prototype.copy=function(c){Z.prototype.copy.call(this,c);this.color.copy(c.color);this.specular.copy(c.specular);this.shininess=c.shininess;this.map=c.map;this.lightMap=c.lightMap;this.lightMapIntensity=c.lightMapIntensity;this.aoMap=c.aoMap;this.aoMapIntensity=c.aoMapIntensity;this.emissive.copy(c.emissive);this.emissiveMap=c.emissiveMap;this.emissiveIntensity=c.emissiveIntensity;
this.bumpMap=c.bumpMap;this.bumpScale=c.bumpScale;this.normalMap=c.normalMap;this.normalScale.copy(c.normalScale);this.displacementMap=c.displacementMap;this.displacementScale=c.displacementScale;this.displacementBias=c.displacementBias;this.specularMap=c.specularMap;this.alphaMap=c.alphaMap;this.envMap=c.envMap;this.combine=c.combine;this.reflectivity=c.reflectivity;this.refractionRatio=c.refractionRatio;this.wireframe=c.wireframe;this.wireframeLinewidth=c.wireframeLinewidth;this.wireframeLinecap=
c.wireframeLinecap;this.wireframeLinejoin=c.wireframeLinejoin;this.skinning=c.skinning;this.morphTargets=c.morphTargets;this.morphNormals=c.morphNormals;return this};ob.prototype=Object.create(Z.prototype);ob.prototype.constructor=ob;ob.prototype.isMeshNormalMaterial=!0;ob.prototype.copy=function(c){Z.prototype.copy.call(this,c);this.wireframe=c.wireframe;this.wireframeLinewidth=c.wireframeLinewidth;return this};Tb.prototype=Object.create(Z.prototype);Tb.prototype.constructor=Tb;Tb.prototype.isMeshLambertMaterial=
!0;Tb.prototype.copy=function(c){Z.prototype.copy.call(this,c);this.color.copy(c.color);this.map=c.map;this.lightMap=c.lightMap;this.lightMapIntensity=c.lightMapIntensity;this.aoMap=c.aoMap;this.aoMapIntensity=c.aoMapIntensity;this.emissive.copy(c.emissive);this.emissiveMap=c.emissiveMap;this.emissiveIntensity=c.emissiveIntensity;this.specularMap=c.specularMap;this.alphaMap=c.alphaMap;this.envMap=c.envMap;this.combine=c.combine;this.reflectivity=c.reflectivity;this.refractionRatio=c.refractionRatio;
this.wireframe=c.wireframe;this.wireframeLinewidth=c.wireframeLinewidth;this.wireframeLinecap=c.wireframeLinecap;this.wireframeLinejoin=c.wireframeLinejoin;this.skinning=c.skinning;this.morphTargets=c.morphTargets;this.morphNormals=c.morphNormals;return this};mc.prototype=Object.create(Z.prototype);mc.prototype.constructor=mc;mc.prototype.isLineDashedMaterial=!0;mc.prototype.copy=function(c){Z.prototype.copy.call(this,c);this.color.copy(c.color);this.linewidth=c.linewidth;this.scale=c.scale;this.dashSize=
c.dashSize;this.gapSize=c.gapSize;return this};var Je=Object.freeze({ShadowMaterial:Qb,SpriteMaterial:wb,RawShaderMaterial:Rb,ShaderMaterial:Aa,PointsMaterial:yb,MultiMaterial:lc,MeshPhysicalMaterial:Sb,MeshStandardMaterial:vb,MeshPhongMaterial:Db,MeshNormalMaterial:ob,MeshLambertMaterial:Tb,MeshDepthMaterial:Da,MeshBasicMaterial:oa,LineDashedMaterial:mc,LineBasicMaterial:Qa,Material:Z});l.Cache={enabled:!1,files:{},add:function(c,a){!1!==this.enabled&&(this.files[c]=a)},get:function(c){if(!1!==this.enabled)return this.files[c]},
remove:function(c){delete this.files[c]},clear:function(){this.files={}}};l.DefaultLoadingManager=new Zc;Object.assign(jb.prototype,{load:function(c,a,b,d){void 0!==this.path&&(c=this.path+c);var h=this,e=l.Cache.get(c);if(void 0!==e)return h.manager.itemStart(c),setTimeout(function(){a&&a(e);h.manager.itemEnd(c)},0),e;var f=new XMLHttpRequest;f.open("GET",c,!0);f.addEventListener("load",function(b){var e=b.target.response;l.Cache.add(c,e);200===this.status?(a&&a(e),h.manager.itemEnd(c)):0===this.status?
(console.warn("THREE.XHRLoader: HTTP Status 0 received."),a&&a(e),h.manager.itemEnd(c)):(d&&d(b),h.manager.itemError(c))},!1);void 0!==b&&f.addEventListener("progress",function(c){b(c)},!1);f.addEventListener("error",function(a){d&&d(a);h.manager.itemError(c)},!1);void 0!==this.responseType&&(f.responseType=this.responseType);void 0!==this.withCredentials&&(f.withCredentials=this.withCredentials);f.overrideMimeType&&f.overrideMimeType("text/plain");f.send(null);h.manager.itemStart(c);return f},setPath:function(c){this.path=
c;return this},setResponseType:function(c){this.responseType=c;return this},setWithCredentials:function(c){this.withCredentials=c;return this}});Object.assign(md.prototype,{load:function(c,a,b,d){function h(h){k.load(c[h],function(c){c=e._parser(c,!0);f[h]={width:c.width,height:c.height,format:c.format,mipmaps:c.mipmaps};l+=1;6===l&&(1===c.mipmapCount&&(g.minFilter=1006),g.format=c.format,g.needsUpdate=!0,a&&a(g))},b,d)}var e=this,f=[],g=new mb;g.image=f;var k=new jb(this.manager);k.setPath(this.path);
k.setResponseType("arraybuffer");if(Array.isArray(c))for(var l=0,t=0,n=c.length;t<n;++t)h(t);else k.load(c,function(c){c=e._parser(c,!0);if(c.isCubemap)for(var b=c.mipmaps.length/c.mipmapCount,d=0;d<b;d++){f[d]={mipmaps:[]};for(var h=0;h<c.mipmapCount;h++)f[d].mipmaps.push(c.mipmaps[d*c.mipmapCount+h]),f[d].format=c.format,f[d].width=c.width,f[d].height=c.height}else g.image.width=c.width,g.image.height=c.height,g.mipmaps=c.mipmaps;1===c.mipmapCount&&(g.minFilter=1006);g.format=c.format;g.needsUpdate=
!0;a&&a(g)},b,d);return g},setPath:function(c){this.path=c;return this}});Object.assign(Ub.prototype,{load:function(c,a,b,d){var h=this,e=new fc,f=new jb(this.manager);f.setResponseType("arraybuffer");f.load(c,function(c){if(c=h._parser(c))void 0!==c.image?e.image=c.image:void 0!==c.data&&(e.image.width=c.width,e.image.height=c.height,e.image.data=c.data),e.wrapS=void 0!==c.wrapS?c.wrapS:1001,e.wrapT=void 0!==c.wrapT?c.wrapT:1001,e.magFilter=void 0!==c.magFilter?c.magFilter:1006,e.minFilter=void 0!==
c.minFilter?c.minFilter:1008,e.anisotropy=void 0!==c.anisotropy?c.anisotropy:1,void 0!==c.format&&(e.format=c.format),void 0!==c.type&&(e.type=c.type),void 0!==c.mipmaps&&(e.mipmaps=c.mipmaps),1===c.mipmapCount&&(e.minFilter=1006),e.needsUpdate=!0,a&&a(e,c)},b,d);return e}});Object.assign(bc.prototype,{load:function(c,a,b,d){var h=this,e=document.createElementNS("http://www.w3.org/1999/xhtml","img");e.onload=function(){e.onload=null;URL.revokeObjectURL(e.src);a&&a(e);h.manager.itemEnd(c)};if(0===
c.indexOf("data:"))e.src=c;else{var f=new jb;f.setPath(this.path);f.setResponseType("blob");f.setWithCredentials(this.withCredentials);f.load(c,function(c){e.src=URL.createObjectURL(c)},b,d)}h.manager.itemStart(c);return e},setCrossOrigin:function(c){this.crossOrigin=c;return this},setWithCredentials:function(c){this.withCredentials=c;return this},setPath:function(c){this.path=c;return this}});Object.assign(Dc.prototype,{load:function(c,a,b,d){function h(b){f.load(c[b],function(c){e.images[b]=c;g++;
6===g&&(e.needsUpdate=!0,a&&a(e))},void 0,d)}var e=new w,f=new bc(this.manager);f.setCrossOrigin(this.crossOrigin);f.setPath(this.path);var g=0;for(b=0;b<c.length;++b)h(b);return e},setCrossOrigin:function(c){this.crossOrigin=c;return this},setPath:function(c){this.path=c;return this}});Object.assign(nc.prototype,{load:function(c,a,b,d){var h=new m,e=new bc(this.manager);e.setCrossOrigin(this.crossOrigin);e.setWithCredentials(this.withCredentials);e.setPath(this.path);e.load(c,function(b){var d=0<
c.search(/\.(jpg|jpeg)$/)||0===c.search(/^data:image\/jpeg/);h.format=d?1022:1023;h.image=b;h.needsUpdate=!0;void 0!==a&&a(h)},b,d);return h},setCrossOrigin:function(c){this.crossOrigin=c;return this},setWithCredentials:function(c){this.withCredentials=c;return this},setPath:function(c){this.path=c;return this}});Ua.prototype=Object.assign(Object.create(ca.prototype),{constructor:Ua,isLight:!0,copy:function(c){ca.prototype.copy.call(this,c);this.color.copy(c.color);this.intensity=c.intensity;return this},
toJSON:function(c){c=ca.prototype.toJSON.call(this,c);c.object.color=this.color.getHex();c.object.intensity=this.intensity;void 0!==this.groundColor&&(c.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(c.object.distance=this.distance);void 0!==this.angle&&(c.object.angle=this.angle);void 0!==this.decay&&(c.object.decay=this.decay);void 0!==this.penumbra&&(c.object.penumbra=this.penumbra);void 0!==this.shadow&&(c.object.shadow=this.shadow.toJSON());return c}});oc.prototype=Object.assign(Object.create(Ua.prototype),
{constructor:oc,isHemisphereLight:!0,copy:function(c){Ua.prototype.copy.call(this,c);this.groundColor.copy(c.groundColor);return this}});Object.assign(Eb.prototype,{copy:function(c){this.camera=c.camera.clone();this.bias=c.bias;this.radius=c.radius;this.mapSize.copy(c.mapSize);return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var c={};0!==this.bias&&(c.bias=this.bias);1!==this.radius&&(c.radius=this.radius);if(512!==this.mapSize.x||512!==this.mapSize.y)c.mapSize=
this.mapSize.toArray();c.camera=this.camera.toJSON(!1).object;delete c.camera.matrix;return c}});pc.prototype=Object.assign(Object.create(Eb.prototype),{constructor:pc,isSpotLightShadow:!0,update:function(c){var a=2*l.Math.RAD2DEG*c.angle,b=this.mapSize.width/this.mapSize.height;c=c.distance||500;var d=this.camera;if(a!==d.fov||b!==d.aspect||c!==d.far)d.fov=a,d.aspect=b,d.far=c,d.updateProjectionMatrix()}});Ec.prototype=Object.assign(Object.create(Ua.prototype),{constructor:Ec,isSpotLight:!0,copy:function(c){Ua.prototype.copy.call(this,
c);this.distance=c.distance;this.angle=c.angle;this.penumbra=c.penumbra;this.decay=c.decay;this.target=c.target.clone();this.shadow=c.shadow.clone();return this}});Fc.prototype=Object.assign(Object.create(Ua.prototype),{constructor:Fc,isPointLight:!0,copy:function(c){Ua.prototype.copy.call(this,c);this.distance=c.distance;this.decay=c.decay;this.shadow=c.shadow.clone();return this}});qc.prototype=Object.assign(Object.create(Eb.prototype),{constructor:qc});rc.prototype=Object.assign(Object.create(Ua.prototype),
{constructor:rc,isDirectionalLight:!0,copy:function(c){Ua.prototype.copy.call(this,c);this.target=c.target.clone();this.shadow=c.shadow.clone();return this}});sc.prototype=Object.assign(Object.create(Ua.prototype),{constructor:sc,isAmbientLight:!0});l.AnimationUtils={arraySlice:function(c,a,b){return l.AnimationUtils.isTypedArray(c)?new c.constructor(c.subarray(a,b)):c.slice(a,b)},convertArray:function(c,a,b){return!c||!b&&c.constructor===a?c:"number"===typeof a.BYTES_PER_ELEMENT?new a(c):Array.prototype.slice.call(c)},
isTypedArray:function(c){return ArrayBuffer.isView(c)&&!(c instanceof DataView)},getKeyframeOrder:function(c){for(var a=c.length,b=Array(a),d=0;d!==a;++d)b[d]=d;b.sort(function(a,b){return c[a]-c[b]});return b},sortedArray:function(c,a,b){for(var d=c.length,h=new c.constructor(d),e=0,f=0;f!==d;++e)for(var g=b[e]*a,k=0;k!==a;++k)h[f++]=c[g+k];return h},flattenJSON:function(c,a,b,d){for(var h=1,e=c[0];void 0!==e&&void 0===e[d];)e=c[h++];if(void 0!==e){var f=e[d];if(void 0!==f)if(Array.isArray(f)){do f=
e[d],void 0!==f&&(a.push(e.time),b.push.apply(b,f)),e=c[h++];while(void 0!==e)}else if(void 0!==f.toArray){do f=e[d],void 0!==f&&(a.push(e.time),f.toArray(b,b.length)),e=c[h++];while(void 0!==e)}else{do f=e[d],void 0!==f&&(a.push(e.time),b.push(f)),e=c[h++];while(void 0!==e)}}}};Na.prototype={constructor:Na,evaluate:function(c){var a=this.parameterPositions,b=this._cachedIndex,d=a[b],e=a[b-1];a:{b:{c:{d:if(!(c<d)){for(var f=b+2;;){if(void 0===d){if(c<e)break d;this._cachedIndex=b=a.length;return this.afterEnd_(b-
1,c,e)}if(b===f)break;e=d;d=a[++b];if(c<d)break b}d=a.length;break c}if(c>=e)break a;else{f=a[1];c<f&&(b=2,e=f);for(f=b-2;;){if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,c,d);if(b===f)break;d=e;e=a[--b-1];if(c>=e)break b}d=b;b=0}}for(;b<d;)e=b+d>>>1,c<a[e]?d=e:b=e+1;d=a[b];e=a[b-1];if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,c,d);if(void 0===d)return this._cachedIndex=b=a.length,this.afterEnd_(b-1,e,c)}this._cachedIndex=b;this.intervalChanged_(b,e,d)}return this.interpolate_(b,
e,c,d)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(c){var a=this.resultBuffer,b=this.sampleValues,d=this.valueSize;c*=d;for(var e=0;e!==d;++e)a[e]=b[c+e];return a},interpolate_:function(c,a,b,d){throw Error("call to abstract method");},intervalChanged_:function(c,a,b){}};Object.assign(Na.prototype,{beforeStart_:Na.prototype.copySampleValue_,afterEnd_:Na.prototype.copySampleValue_});tc.prototype=Object.assign(Object.create(Na.prototype),
{constructor:tc,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(c,a,b){var d=this.parameterPositions,h=c-2,e=c+1,f=d[h],g=d[e];if(void 0===f)switch(this.getSettings_().endingStart){case 2401:h=c;f=2*a-b;break;case 2402:h=d.length-2;f=a+d[h]-d[h+1];break;default:h=c,f=b}if(void 0===g)switch(this.getSettings_().endingEnd){case 2401:e=c;g=2*b-a;break;case 2402:e=1;g=b+d[1]-d[0];break;default:e=c-1,g=a}c=.5*(b-a);d=this.valueSize;this._weightPrev=c/(a-f);this._weightNext=
c/(g-b);this._offsetPrev=h*d;this._offsetNext=e*d},interpolate_:function(c,a,b,d){var h=this.resultBuffer,e=this.sampleValues,f=this.valueSize;c*=f;var g=c-f,k=this._offsetPrev,l=this._offsetNext,n=this._weightPrev,t=this._weightNext,m=(b-a)/(d-a);b=m*m;d=b*m;a=-n*d+2*n*b-n*m;n=(1+n)*d+(-1.5-2*n)*b+(-.5+n)*m+1;m=(-1-t)*d+(1.5+t)*b+.5*m;t=t*d-t*b;for(b=0;b!==f;++b)h[b]=a*e[k+b]+n*e[g+b]+m*e[c+b]+t*e[l+b];return h}});cc.prototype=Object.assign(Object.create(Na.prototype),{constructor:cc,interpolate_:function(c,
a,b,d){var h=this.resultBuffer,e=this.sampleValues,f=this.valueSize;c*=f;var g=c-f;a=(b-a)/(d-a);b=1-a;for(d=0;d!==f;++d)h[d]=e[g+d]*b+e[c+d]*a;return h}});Nc.prototype=Object.assign(Object.create(Na.prototype),{constructor:Nc,interpolate_:function(c,a,b,d){return this.copySampleValue_(c-1)}});var Lc={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(c){return new Nc(this.times,this.values,this.getValueSize(),c)},InterpolantFactoryMethodLinear:function(c){return new cc(this.times,
this.values,this.getValueSize(),c)},InterpolantFactoryMethodSmooth:function(c){return new tc(this.times,this.values,this.getValueSize(),c)},setInterpolation:function(c){switch(c){case 2300:var a=this.InterpolantFactoryMethodDiscrete;break;case 2301:a=this.InterpolantFactoryMethodLinear;break;case 2302:a=this.InterpolantFactoryMethodSmooth}if(void 0===a){a="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(c!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);
else throw Error(a);console.warn(a)}else this.createInterpolant=a},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(c){if(0!==c)for(var a=this.times,b=0,d=a.length;b!==d;++b)a[b]+=c;return this},scale:function(c){if(1!==c)for(var a=this.times,b=
0,d=a.length;b!==d;++b)a[b]*=c;return this},trim:function(c,a){for(var b=this.times,d=b.length,h=0,e=d-1;h!==d&&b[h]<c;)++h;for(;-1!==e&&b[e]>a;)--e;++e;if(0!==h||e!==d)h>=e&&(e=Math.max(e,1),h=e-1),d=this.getValueSize(),this.times=l.AnimationUtils.arraySlice(b,h,e),this.values=l.AnimationUtils.arraySlice(this.values,h*d,e*d);return this},validate:function(){var c=!0,a=this.getValueSize();0!==a-Math.floor(a)&&(console.error("invalid value size in track",this),c=!1);var b=this.times;a=this.values;
var d=b.length;0===d&&(console.error("track is empty",this),c=!1);for(var e=null,f=0;f!==d;f++){var g=b[f];if("number"===typeof g&&isNaN(g)){console.error("time is not a valid number",this,f,g);c=!1;break}if(null!==e&&e>g){console.error("out of order keys",this,f,g,e);c=!1;break}e=g}if(void 0!==a&&l.AnimationUtils.isTypedArray(a))for(f=0,b=a.length;f!==b;++f)if(d=a[f],isNaN(d)){console.error("value is not a valid number",this,f,d);c=!1;break}return c},optimize:function(){for(var c=this.times,a=this.values,
b=this.getValueSize(),d=2302===this.getInterpolation(),e=1,f=c.length-1,g=1;g<f;++g){var k=!1,n=c[g];if(n!==c[g+1]&&(1!==g||n!==n[0]))if(d)k=!0;else{var m=g*b,r=m-b,p=m+b;for(n=0;n!==b;++n){var q=a[m+n];if(q!==a[r+n]||q!==a[p+n]){k=!0;break}}}if(k){if(g!==e)for(c[e]=c[g],k=g*b,m=e*b,n=0;n!==b;++n)a[m+n]=a[k+n];++e}}if(0<f){c[e]=c[f];k=f*b;m=e*b;for(n=0;n!==b;++n)a[m+n]=a[k+n];++e}e!==c.length&&(this.times=l.AnimationUtils.arraySlice(c,0,e),this.values=l.AnimationUtils.arraySlice(a,0,e*b));return this}};
$c.prototype=Object.assign(Object.create(Lc),{constructor:$c,ValueTypeName:"vector"});yd.prototype=Object.assign(Object.create(Na.prototype),{constructor:yd,interpolate_:function(c,a,b,d){var h=this.resultBuffer,e=this.sampleValues,f=this.valueSize;c*=f;a=(b-a)/(d-a);for(b=c+f;c!==b;c+=4)q.slerpFlat(h,0,e,c-f,e,c,a);return h}});nd.prototype=Object.assign(Object.create(Lc),{constructor:nd,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(c){return new yd(this.times,
this.values,this.getValueSize(),c)},InterpolantFactoryMethodSmooth:void 0});ad.prototype=Object.assign(Object.create(Lc),{constructor:ad,ValueTypeName:"number"});zd.prototype=Object.assign(Object.create(Lc),{constructor:zd,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});Ad.prototype=Object.assign(Object.create(Lc),{constructor:Ad,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,
InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});Bd.prototype=Object.assign(Object.create(Lc),{constructor:Bd,ValueTypeName:"color"});Oc.prototype=Lc;Lc.constructor=Oc;Object.assign(Oc,{parse:function(c){if(void 0===c.type)throw Error("track type undefined, can not parse");var a=Oc._getTrackTypeForValueTypeName(c.type);if(void 0===c.times){var b=[],d=[];l.AnimationUtils.flattenJSON(c.keys,b,d,"value");c.times=b;c.values=d}return void 0!==a.parse?a.parse(c):new a(c.name,
c.times,c.values,c.interpolation)},toJSON:function(c){var a=c.constructor;if(void 0!==a.toJSON)a=a.toJSON(c);else{a={name:c.name,times:l.AnimationUtils.convertArray(c.times,Array),values:l.AnimationUtils.convertArray(c.values,Array)};var b=c.getInterpolation();b!==c.DefaultInterpolation&&(a.interpolation=b)}a.type=c.ValueTypeName;return a},_getTrackTypeForValueTypeName:function(c){switch(c.toLowerCase()){case "scalar":case "double":case "float":case "number":case "integer":return ad;case "vector":case "vector2":case "vector3":case "vector4":return $c;
case "color":return Bd;case "quaternion":return nd;case "bool":case "boolean":return Ad;case "string":return zd}throw Error("Unsupported typeName: "+c);}});Jb.prototype={constructor:Jb,resetDuration:function(){for(var c=0,a=0,b=this.tracks.length;a!==b;++a){var d=this.tracks[a];c=Math.max(c,d.times[d.times.length-1])}this.duration=c},trim:function(){for(var c=0;c<this.tracks.length;c++)this.tracks[c].trim(0,this.duration);return this},optimize:function(){for(var c=0;c<this.tracks.length;c++)this.tracks[c].optimize();
return this}};Object.assign(Jb,{parse:function(c){for(var a=[],b=c.tracks,d=1/(c.fps||1),e=0,f=b.length;e!==f;++e)a.push(Oc.parse(b[e]).scale(d));return new Jb(c.name,c.duration,a)},toJSON:function(c){var a=[],b=c.tracks;c={name:c.name,duration:c.duration,tracks:a};for(var d=0,e=b.length;d!==e;++d)a.push(Oc.toJSON(b[d]));return c},CreateFromMorphTargetSequence:function(c,a,b,d){for(var h=a.length,e=[],f=0;f<h;f++){var g=[],k=[];g.push((f+h-1)%h,f,(f+1)%h);k.push(0,1,0);var n=l.AnimationUtils.getKeyframeOrder(g);
g=l.AnimationUtils.sortedArray(g,1,n);k=l.AnimationUtils.sortedArray(k,1,n);d||0!==g[0]||(g.push(h),k.push(k[0]));e.push((new ad(".morphTargetInfluences["+a[f].name+"]",g,k)).scale(1/b))}return new Jb(c,-1,e)},findByName:function(c,a){var b=c;Array.isArray(c)||(b=c.geometry&&c.geometry.animations||c.animations);for(var d=0;d<b.length;d++)if(b[d].name===a)return b[d];return null},CreateClipsFromMorphTargetSequences:function(c,a,b){for(var d={},h=/^([\w-]*?)([\d]+)$/,e=0,f=c.length;e<f;e++){var g=c[e],
k=g.name.match(h);if(k&&1<k.length){var l=k[1];(k=d[l])||(d[l]=k=[]);k.push(g)}}c=[];for(l in d)c.push(Jb.CreateFromMorphTargetSequence(l,d[l],a,b));return c},parseAnimation:function(c,a){if(!c)return console.error("  no animation in JSONLoader data"),null;for(var b=function(c,a,b,d,h){if(0!==b.length){var e=[],f=[];l.AnimationUtils.flattenJSON(b,e,f,d);0!==e.length&&h.push(new c(a,e,f))}},d=[],h=c.name||"default",e=c.length||-1,f=c.fps||30,g=c.hierarchy||[],k=0;k<g.length;k++){var n=g[k].keys;if(n&&
0!==n.length)if(n[0].morphTargets){e={};for(var m=0;m<n.length;m++)if(n[m].morphTargets)for(var r=0;r<n[m].morphTargets.length;r++)e[n[m].morphTargets[r]]=-1;for(var p in e){var q=[],v=[];for(r=0;r!==n[m].morphTargets.length;++r){var u=n[m];q.push(u.time);v.push(u.morphTarget===p?1:0)}d.push(new ad(".morphTargetInfluence["+p+"]",q,v))}e=e.length*(f||1)}else m=".bones["+a[k].name+"]",b($c,m+".position",n,"pos",d),b(nd,m+".quaternion",n,"rot",d),b($c,m+".scale",n,"scl",d)}return 0===d.length?null:new Jb(h,
e,d)}});Object.assign(Cd.prototype,{load:function(c,a,b,d){var h=this;(new jb(h.manager)).load(c,function(c){a(h.parse(JSON.parse(c)))},b,d)},setTextures:function(c){this.textures=c},parse:function(c){function a(c){void 0===b[c]&&console.warn("THREE.MaterialLoader: Undefined texture",c);return b[c]}var b=this.textures,d=new Je[c.type];void 0!==c.uuid&&(d.uuid=c.uuid);void 0!==c.name&&(d.name=c.name);void 0!==c.color&&d.color.setHex(c.color);void 0!==c.roughness&&(d.roughness=c.roughness);void 0!==
c.metalness&&(d.metalness=c.metalness);void 0!==c.emissive&&d.emissive.setHex(c.emissive);void 0!==c.specular&&d.specular.setHex(c.specular);void 0!==c.shininess&&(d.shininess=c.shininess);void 0!==c.uniforms&&(d.uniforms=c.uniforms);void 0!==c.vertexShader&&(d.vertexShader=c.vertexShader);void 0!==c.fragmentShader&&(d.fragmentShader=c.fragmentShader);void 0!==c.vertexColors&&(d.vertexColors=c.vertexColors);void 0!==c.fog&&(d.fog=c.fog);void 0!==c.shading&&(d.shading=c.shading);void 0!==c.blending&&
(d.blending=c.blending);void 0!==c.side&&(d.side=c.side);void 0!==c.opacity&&(d.opacity=c.opacity);void 0!==c.transparent&&(d.transparent=c.transparent);void 0!==c.alphaTest&&(d.alphaTest=c.alphaTest);void 0!==c.depthTest&&(d.depthTest=c.depthTest);void 0!==c.depthWrite&&(d.depthWrite=c.depthWrite);void 0!==c.colorWrite&&(d.colorWrite=c.colorWrite);void 0!==c.wireframe&&(d.wireframe=c.wireframe);void 0!==c.wireframeLinewidth&&(d.wireframeLinewidth=c.wireframeLinewidth);void 0!==c.wireframeLinecap&&
(d.wireframeLinecap=c.wireframeLinecap);void 0!==c.wireframeLinejoin&&(d.wireframeLinejoin=c.wireframeLinejoin);void 0!==c.skinning&&(d.skinning=c.skinning);void 0!==c.morphTargets&&(d.morphTargets=c.morphTargets);void 0!==c.size&&(d.size=c.size);void 0!==c.sizeAttenuation&&(d.sizeAttenuation=c.sizeAttenuation);void 0!==c.map&&(d.map=a(c.map));void 0!==c.alphaMap&&(d.alphaMap=a(c.alphaMap),d.transparent=!0);void 0!==c.bumpMap&&(d.bumpMap=a(c.bumpMap));void 0!==c.bumpScale&&(d.bumpScale=c.bumpScale);
void 0!==c.normalMap&&(d.normalMap=a(c.normalMap));if(void 0!==c.normalScale){var e=c.normalScale;!1===Array.isArray(e)&&(e=[e,e]);d.normalScale=(new g).fromArray(e)}void 0!==c.displacementMap&&(d.displacementMap=a(c.displacementMap));void 0!==c.displacementScale&&(d.displacementScale=c.displacementScale);void 0!==c.displacementBias&&(d.displacementBias=c.displacementBias);void 0!==c.roughnessMap&&(d.roughnessMap=a(c.roughnessMap));void 0!==c.metalnessMap&&(d.metalnessMap=a(c.metalnessMap));void 0!==
c.emissiveMap&&(d.emissiveMap=a(c.emissiveMap));void 0!==c.emissiveIntensity&&(d.emissiveIntensity=c.emissiveIntensity);void 0!==c.specularMap&&(d.specularMap=a(c.specularMap));void 0!==c.envMap&&(d.envMap=a(c.envMap));void 0!==c.reflectivity&&(d.reflectivity=c.reflectivity);void 0!==c.lightMap&&(d.lightMap=a(c.lightMap));void 0!==c.lightMapIntensity&&(d.lightMapIntensity=c.lightMapIntensity);void 0!==c.aoMap&&(d.aoMap=a(c.aoMap));void 0!==c.aoMapIntensity&&(d.aoMapIntensity=c.aoMapIntensity);if(void 0!==
c.materials){e=0;for(var f=c.materials.length;e<f;e++)d.materials.push(this.parse(c.materials[e]))}return d}});Object.assign(Qd.prototype,{load:function(c,a,b,d){var h=this;(new jb(h.manager)).load(c,function(c){a(h.parse(JSON.parse(c)))},b,d)},parse:function(c){var a=new ia,b=c.data.index,d={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};
void 0!==b&&(b=new d[b.type](b.array),a.setIndex(new P(b,1)));var e=c.data.attributes;for(k in e){var g=e[k];b=new d[g.type](g.array);a.addAttribute(k,new P(b,g.itemSize,g.normalized))}d=c.data.groups||c.data.drawcalls||c.data.offsets;if(void 0!==d){var k=0;for(b=d.length;k!==b;++k)e=d[k],a.addGroup(e.start,e.count,e.materialIndex)}c=c.data.boundingSphere;void 0!==c&&(d=new f,void 0!==c.center&&d.fromArray(c.center),a.boundingSphere=new za(d,c.radius));return a}});Pc.prototype={constructor:Pc,crossOrigin:void 0,
extractUrlBase:function(c){c=c.split("/");if(1===c.length)return"./";c.pop();return c.join("/")+"/"},initMaterials:function(c,a,b){for(var d=[],h=0;h<c.length;++h)d[h]=this.createMaterial(c[h],a,b);return d},createMaterial:function(){var c,a,b;return function(d,h,e){function f(c,b,d,f,k){c=h+c;var n=Pc.Handlers.get(c);null!==n?c=n.load(c):(a.setCrossOrigin(e),c=a.load(c));void 0!==b&&(c.repeat.fromArray(b),1!==b[0]&&(c.wrapS=1E3),1!==b[1]&&(c.wrapT=1E3));void 0!==d&&c.offset.fromArray(d);void 0!==
f&&("repeat"===f[0]&&(c.wrapS=1E3),"mirror"===f[0]&&(c.wrapS=1002),"repeat"===f[1]&&(c.wrapT=1E3),"mirror"===f[1]&&(c.wrapT=1002));void 0!==k&&(c.anisotropy=k);b=l.Math.generateUUID();g[b]=c;return b}void 0===c&&(c=new V);void 0===a&&(a=new nc);void 0===b&&(b=new Cd);var g={},k={uuid:l.Math.generateUUID(),type:"MeshLambertMaterial"},n;for(n in d){var m=d[n];switch(n){case "DbgColor":case "DbgIndex":case "opticalDensity":case "illumination":break;case "DbgName":k.name=m;break;case "blending":k.blending=
Be[m];break;case "colorAmbient":case "mapAmbient":console.warn("THREE.Loader.createMaterial:",n,"is no longer supported.");break;case "colorDiffuse":k.color=c.fromArray(m).getHex();break;case "colorSpecular":k.specular=c.fromArray(m).getHex();break;case "colorEmissive":k.emissive=c.fromArray(m).getHex();break;case "specularCoef":k.shininess=m;break;case "shading":"basic"===m.toLowerCase()&&(k.type="MeshBasicMaterial");"phong"===m.toLowerCase()&&(k.type="MeshPhongMaterial");"standard"===m.toLowerCase()&&
(k.type="MeshStandardMaterial");break;case "mapDiffuse":k.map=f(m,d.mapDiffuseRepeat,d.mapDiffuseOffset,d.mapDiffuseWrap,d.mapDiffuseAnisotropy);break;case "mapDiffuseRepeat":case "mapDiffuseOffset":case "mapDiffuseWrap":case "mapDiffuseAnisotropy":break;case "mapEmissive":k.emissiveMap=f(m,d.mapEmissiveRepeat,d.mapEmissiveOffset,d.mapEmissiveWrap,d.mapEmissiveAnisotropy);break;case "mapEmissiveRepeat":case "mapEmissiveOffset":case "mapEmissiveWrap":case "mapEmissiveAnisotropy":break;case "mapLight":k.lightMap=
f(m,d.mapLightRepeat,d.mapLightOffset,d.mapLightWrap,d.mapLightAnisotropy);break;case "mapLightRepeat":case "mapLightOffset":case "mapLightWrap":case "mapLightAnisotropy":break;case "mapAO":k.aoMap=f(m,d.mapAORepeat,d.mapAOOffset,d.mapAOWrap,d.mapAOAnisotropy);break;case "mapAORepeat":case "mapAOOffset":case "mapAOWrap":case "mapAOAnisotropy":break;case "mapBump":k.bumpMap=f(m,d.mapBumpRepeat,d.mapBumpOffset,d.mapBumpWrap,d.mapBumpAnisotropy);break;case "mapBumpScale":k.bumpScale=m;break;case "mapBumpRepeat":case "mapBumpOffset":case "mapBumpWrap":case "mapBumpAnisotropy":break;
case "mapNormal":k.normalMap=f(m,d.mapNormalRepeat,d.mapNormalOffset,d.mapNormalWrap,d.mapNormalAnisotropy);break;case "mapNormalFactor":k.normalScale=[m,m];break;case "mapNormalRepeat":case "mapNormalOffset":case "mapNormalWrap":case "mapNormalAnisotropy":break;case "mapSpecular":k.specularMap=f(m,d.mapSpecularRepeat,d.mapSpecularOffset,d.mapSpecularWrap,d.mapSpecularAnisotropy);break;case "mapSpecularRepeat":case "mapSpecularOffset":case "mapSpecularWrap":case "mapSpecularAnisotropy":break;case "mapMetalness":k.metalnessMap=
f(m,d.mapMetalnessRepeat,d.mapMetalnessOffset,d.mapMetalnessWrap,d.mapMetalnessAnisotropy);break;case "mapMetalnessRepeat":case "mapMetalnessOffset":case "mapMetalnessWrap":case "mapMetalnessAnisotropy":break;case "mapRoughness":k.roughnessMap=f(m,d.mapRoughnessRepeat,d.mapRoughnessOffset,d.mapRoughnessWrap,d.mapRoughnessAnisotropy);break;case "mapRoughnessRepeat":case "mapRoughnessOffset":case "mapRoughnessWrap":case "mapRoughnessAnisotropy":break;case "mapAlpha":k.alphaMap=f(m,d.mapAlphaRepeat,
d.mapAlphaOffset,d.mapAlphaWrap,d.mapAlphaAnisotropy);break;case "mapAlphaRepeat":case "mapAlphaOffset":case "mapAlphaWrap":case "mapAlphaAnisotropy":break;case "flipSided":k.side=1;break;case "doubleSided":k.side=2;break;case "transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity");k.opacity=m;break;case "depthTest":case "depthWrite":case "colorWrite":case "opacity":case "reflectivity":case "transparent":case "visible":case "wireframe":k[n]=m;break;case "vertexColors":!0===
m&&(k.vertexColors=2);"face"===m&&(k.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",n,m)}}"MeshBasicMaterial"===k.type&&delete k.emissive;"MeshPhongMaterial"!==k.type&&delete k.specular;1>k.opacity&&(k.transparent=!0);b.setTextures(g);return b.parse(k)}}()};Pc.Handlers={handlers:[],add:function(c,a){this.handlers.push(c,a)},get:function(c){for(var a=this.handlers,b=0,d=a.length;b<d;b+=2){var e=a[b+1];if(a[b].test(c))return e}return null}};Object.assign(Rd.prototype,
{load:function(c,a,b,d){var h=this,e=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:Pc.prototype.extractUrlBase(c),f=new jb(this.manager);f.setWithCredentials(this.withCredentials);f.load(c,function(b){b=JSON.parse(b);var d=b.metadata;if(void 0!==d&&(d=d.type,void 0!==d)){if("object"===d.toLowerCase()){console.error("THREE.JSONLoader: "+c+" should be loaded with THREE.ObjectLoader instead.");return}if("scene"===d.toLowerCase()){console.error("THREE.JSONLoader: "+c+" should be loaded with THREE.SceneLoader instead.");
return}}b=h.parse(b,e);a(b.geometry,b.materials)},b,d)},setTexturePath:function(c){this.texturePath=c},parse:function(c,b){var d=new ma,h=void 0!==c.scale?1/c.scale:1;(function(a){var b,h,e,k,l,n,m,t=c.faces;var r=c.vertices;var p=c.normals,q=c.colors,v=0;if(void 0!==c.uvs){for(b=0;b<c.uvs.length;b++)c.uvs[b].length&&v++;for(b=0;b<v;b++)d.faceVertexUvs[b]=[]}var y=0;for(k=r.length;y<k;)b=new f,b.x=r[y++]*a,b.y=r[y++]*a,b.z=r[y++]*a,d.vertices.push(b);y=0;for(k=t.length;y<k;)if(a=t[y++],n=a&1,e=a&
2,b=a&8,l=a&16,m=a&32,r=a&64,a&=128,n){n=new ta;n.a=t[y];n.b=t[y+1];n.c=t[y+3];var u=new ta;u.a=t[y+1];u.b=t[y+2];u.c=t[y+3];y+=4;e&&(e=t[y++],n.materialIndex=e,u.materialIndex=e);e=d.faces.length;if(b)for(b=0;b<v;b++){var C=c.uvs[b];d.faceVertexUvs[b][e]=[];d.faceVertexUvs[b][e+1]=[];for(h=0;4>h;h++){var x=t[y++];var w=C[2*x];x=C[2*x+1];w=new g(w,x);2!==h&&d.faceVertexUvs[b][e].push(w);0!==h&&d.faceVertexUvs[b][e+1].push(w)}}l&&(l=3*t[y++],n.normal.set(p[l++],p[l++],p[l]),u.normal.copy(n.normal));
if(m)for(b=0;4>b;b++)l=3*t[y++],m=new f(p[l++],p[l++],p[l]),2!==b&&n.vertexNormals.push(m),0!==b&&u.vertexNormals.push(m);r&&(r=t[y++],r=q[r],n.color.setHex(r),u.color.setHex(r));if(a)for(b=0;4>b;b++)r=t[y++],r=q[r],2!==b&&n.vertexColors.push(new V(r)),0!==b&&u.vertexColors.push(new V(r));d.faces.push(n);d.faces.push(u)}else{n=new ta;n.a=t[y++];n.b=t[y++];n.c=t[y++];e&&(e=t[y++],n.materialIndex=e);e=d.faces.length;if(b)for(b=0;b<v;b++)for(C=c.uvs[b],d.faceVertexUvs[b][e]=[],h=0;3>h;h++)x=t[y++],w=
C[2*x],x=C[2*x+1],w=new g(w,x),d.faceVertexUvs[b][e].push(w);l&&(l=3*t[y++],n.normal.set(p[l++],p[l++],p[l]));if(m)for(b=0;3>b;b++)l=3*t[y++],m=new f(p[l++],p[l++],p[l]),n.vertexNormals.push(m);r&&(r=t[y++],n.color.setHex(q[r]));if(a)for(b=0;3>b;b++)r=t[y++],n.vertexColors.push(new V(q[r]));d.faces.push(n)}})(h);(function(){var b=void 0!==c.influencesPerVertex?c.influencesPerVertex:2;if(c.skinWeights)for(var h=0,e=c.skinWeights.length;h<e;h+=b)d.skinWeights.push(new a(c.skinWeights[h],1<b?c.skinWeights[h+
1]:0,2<b?c.skinWeights[h+2]:0,3<b?c.skinWeights[h+3]:0));if(c.skinIndices)for(h=0,e=c.skinIndices.length;h<e;h+=b)d.skinIndices.push(new a(c.skinIndices[h],1<b?c.skinIndices[h+1]:0,2<b?c.skinIndices[h+2]:0,3<b?c.skinIndices[h+3]:0));d.bones=c.bones;d.bones&&0<d.bones.length&&(d.skinWeights.length!==d.skinIndices.length||d.skinIndices.length!==d.vertices.length)&&console.warn("When skinning, number of vertices ("+d.vertices.length+"), skinIndices ("+d.skinIndices.length+"), and skinWeights ("+d.skinWeights.length+
") should match.")})();(function(a){if(void 0!==c.morphTargets)for(var b=0,h=c.morphTargets.length;b<h;b++){d.morphTargets[b]={};d.morphTargets[b].name=c.morphTargets[b].name;d.morphTargets[b].vertices=[];for(var e=d.morphTargets[b].vertices,g=c.morphTargets[b].vertices,k=0,l=g.length;k<l;k+=3){var n=new f;n.x=g[k]*a;n.y=g[k+1]*a;n.z=g[k+2]*a;e.push(n)}}if(void 0!==c.morphColors&&0<c.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),
a=d.faces,e=c.morphColors[0].colors,b=0,h=a.length;b<h;b++)a[b].color.fromArray(e,3*b)})(h);(function(){var a=[],b=[];void 0!==c.animation&&b.push(c.animation);void 0!==c.animations&&(c.animations.length?b=b.concat(c.animations):b.push(c.animations));for(var h=0;h<b.length;h++){var e=Jb.parseAnimation(b[h],d.bones);e&&a.push(e)}d.morphTargets&&(b=Jb.CreateClipsFromMorphTargetSequences(d.morphTargets,10),a=a.concat(b));0<a.length&&(d.animations=a)})();d.computeFaceNormals();d.computeBoundingSphere();
if(void 0===c.materials||0===c.materials.length)return{geometry:d};h=Pc.prototype.initMaterials(c.materials,b,this.crossOrigin);return{geometry:d,materials:h}}});Object.assign(ue.prototype,{load:function(c,a,b,d){""===this.texturePath&&(this.texturePath=c.substring(0,c.lastIndexOf("/")+1));var h=this;(new jb(h.manager)).load(c,function(c){h.parse(JSON.parse(c),a)},b,d)},setTexturePath:function(c){this.texturePath=c},setCrossOrigin:function(c){this.crossOrigin=c},parse:function(c,a){var b=this.parseGeometries(c.geometries),
d=this.parseImages(c.images,function(){void 0!==a&&a(h)});d=this.parseTextures(c.textures,d);d=this.parseMaterials(c.materials,d);var h=this.parseObject(c.object,b,d);c.animations&&(h.animations=this.parseAnimations(c.animations));void 0!==c.images&&0!==c.images.length||void 0===a||a(h);return h},parseGeometries:function(c){var a={};if(void 0!==c)for(var b=new Rd,d=new Qd,e=0,f=c.length;e<f;e++){var g=c[e];switch(g.type){case "PlaneGeometry":case "PlaneBufferGeometry":var k=new dc[g.type](g.width,
g.height,g.widthSegments,g.heightSegments);break;case "BoxGeometry":case "BoxBufferGeometry":case "CubeGeometry":k=new dc[g.type](g.width,g.height,g.depth,g.widthSegments,g.heightSegments,g.depthSegments);break;case "CircleGeometry":case "CircleBufferGeometry":k=new dc[g.type](g.radius,g.segments,g.thetaStart,g.thetaLength);break;case "CylinderGeometry":case "CylinderBufferGeometry":k=new dc[g.type](g.radiusTop,g.radiusBottom,g.height,g.radialSegments,g.heightSegments,g.openEnded,g.thetaStart,g.thetaLength);
break;case "ConeGeometry":case "ConeBufferGeometry":k=new dc[g.type](g.radius,g.height,g.radialSegments,g.heightSegments,g.openEnded,g.thetaStart,g.thetaLength);break;case "SphereGeometry":case "SphereBufferGeometry":k=new dc[g.type](g.radius,g.widthSegments,g.heightSegments,g.phiStart,g.phiLength,g.thetaStart,g.thetaLength);break;case "DodecahedronGeometry":case "IcosahedronGeometry":case "OctahedronGeometry":case "TetrahedronGeometry":k=new dc[g.type](g.radius,g.detail);break;case "RingGeometry":case "RingBufferGeometry":k=
new dc[g.type](g.innerRadius,g.outerRadius,g.thetaSegments,g.phiSegments,g.thetaStart,g.thetaLength);break;case "TorusGeometry":case "TorusBufferGeometry":k=new dc[g.type](g.radius,g.tube,g.radialSegments,g.tubularSegments,g.arc);break;case "TorusKnotGeometry":case "TorusKnotBufferGeometry":k=new dc[g.type](g.radius,g.tube,g.tubularSegments,g.radialSegments,g.p,g.q);break;case "LatheGeometry":case "LatheBufferGeometry":k=new dc[g.type](g.points,g.segments,g.phiStart,g.phiLength);break;case "BufferGeometry":k=
d.parse(g);break;case "Geometry":k=b.parse(g.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+g.type+'"');continue}k.uuid=g.uuid;void 0!==g.name&&(k.name=g.name);a[g.uuid]=k}return a},parseMaterials:function(c,a){var b={};if(void 0!==c){var d=new Cd;d.setTextures(a);for(var h=0,e=c.length;h<e;h++){var f=d.parse(c[h]);b[f.uuid]=f}}return b},parseAnimations:function(c){for(var a=[],b=0;b<c.length;b++){var d=Jb.parse(c[b]);a.push(d)}return a},
parseImages:function(c,a){function b(c){d.manager.itemStart(c);return f.load(c,function(){d.manager.itemEnd(c)},void 0,function(){d.manager.itemError(c)})}var d=this,h={};if(void 0!==c&&0<c.length){var e=new Zc(a),f=new bc(e);f.setCrossOrigin(this.crossOrigin);e=0;for(var g=c.length;e<g;e++){var k=c[e],l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(k.url)?k.url:d.texturePath+k.url;h[k.uuid]=b(l)}}return h},parseTextures:function(c,a){function b(c,a){if("number"===typeof c)return c;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",
c);return a[c]}var d={};if(void 0!==c)for(var h=0,e=c.length;h<e;h++){var f=c[h];void 0===f.image&&console.warn('THREE.ObjectLoader: No "image" specified for',f.uuid);void 0===a[f.image]&&console.warn("THREE.ObjectLoader: Undefined image",f.image);var g=new m(a[f.image]);g.needsUpdate=!0;g.uuid=f.uuid;void 0!==f.name&&(g.name=f.name);void 0!==f.mapping&&(g.mapping=b(f.mapping,Ce));void 0!==f.offset&&g.offset.fromArray(f.offset);void 0!==f.repeat&&g.repeat.fromArray(f.repeat);void 0!==f.wrap&&(g.wrapS=
b(f.wrap[0],ie),g.wrapT=b(f.wrap[1],ie));void 0!==f.minFilter&&(g.minFilter=b(f.minFilter,je));void 0!==f.magFilter&&(g.magFilter=b(f.magFilter,je));void 0!==f.anisotropy&&(g.anisotropy=f.anisotropy);void 0!==f.flipY&&(g.flipY=f.flipY);d[f.uuid]=g}return d},parseObject:function(){var c=new p;return function(a,b,d){function e(c){void 0===b[c]&&console.warn("THREE.ObjectLoader: Undefined geometry",c);return b[c]}function h(c){if(void 0!==c)return void 0===d[c]&&console.warn("THREE.ObjectLoader: Undefined material",
c),d[c]}switch(a.type){case "Scene":var f=new Za;void 0!==a.background&&Number.isInteger(a.background)&&(f.background=new V(a.background));void 0!==a.fog&&("Fog"===a.fog.type?f.fog=new lb(a.fog.color,a.fog.near,a.fog.far):"FogExp2"===a.fog.type&&(f.fog=new rb(a.fog.color,a.fog.density)));break;case "PerspectiveCamera":f=new cb(a.fov,a.aspect,a.near,a.far);void 0!==a.focus&&(f.focus=a.focus);void 0!==a.zoom&&(f.zoom=a.zoom);void 0!==a.filmGauge&&(f.filmGauge=a.filmGauge);void 0!==a.filmOffset&&(f.filmOffset=
a.filmOffset);void 0!==a.view&&(f.view=Object.assign({},a.view));break;case "OrthographicCamera":f=new Gb(a.left,a.right,a.top,a.bottom,a.near,a.far);break;case "AmbientLight":f=new sc(a.color,a.intensity);break;case "DirectionalLight":f=new rc(a.color,a.intensity);break;case "PointLight":f=new Fc(a.color,a.intensity,a.distance,a.decay);break;case "SpotLight":f=new Ec(a.color,a.intensity,a.distance,a.angle,a.penumbra,a.decay);break;case "HemisphereLight":f=new oc(a.color,a.groundColor,a.intensity);
break;case "Mesh":f=e(a.geometry);var g=h(a.material);f=f.bones&&0<f.bones.length?new Nb(f,g):new Ca(f,g);break;case "LOD":f=new ec;break;case "Line":f=new xb(e(a.geometry),h(a.material),a.mode);break;case "LineSegments":f=new Ka(e(a.geometry),h(a.material));break;case "PointCloud":case "Points":f=new zc(e(a.geometry),h(a.material));break;case "Sprite":f=new wc(h(a.material));break;case "Group":f=new zb;break;default:f=new ca}f.uuid=a.uuid;void 0!==a.name&&(f.name=a.name);void 0!==a.matrix?(c.fromArray(a.matrix),
c.decompose(f.position,f.quaternion,f.scale)):(void 0!==a.position&&f.position.fromArray(a.position),void 0!==a.rotation&&f.rotation.fromArray(a.rotation),void 0!==a.quaternion&&f.quaternion.fromArray(a.quaternion),void 0!==a.scale&&f.scale.fromArray(a.scale));void 0!==a.castShadow&&(f.castShadow=a.castShadow);void 0!==a.receiveShadow&&(f.receiveShadow=a.receiveShadow);a.shadow&&(void 0!==a.shadow.bias&&(f.shadow.bias=a.shadow.bias),void 0!==a.shadow.radius&&(f.shadow.radius=a.shadow.radius),void 0!==
a.shadow.mapSize&&f.shadow.mapSize.fromArray(a.shadow.mapSize),void 0!==a.shadow.camera&&(f.shadow.camera=this.parseObject(a.shadow.camera)));void 0!==a.visible&&(f.visible=a.visible);void 0!==a.userData&&(f.userData=a.userData);if(void 0!==a.children)for(var k in a.children)f.add(this.parseObject(a.children[k],b,d));if("LOD"===a.type)for(a=a.levels,g=0;g<a.length;g++){var l=a[g];k=f.getObjectByProperty("uuid",l.object);void 0!==k&&f.addLevel(k,l.distance)}return f}}()});pb.prototype={constructor:pb,
getPoint:function(c){console.warn("THREE.Curve: Warning, getPoint() not implemented!");return null},getPointAt:function(c){c=this.getUtoTmapping(c);return this.getPoint(c)},getPoints:function(c){c||(c=5);for(var a=[],b=0;b<=c;b++)a.push(this.getPoint(b/c));return a},getSpacedPoints:function(c){c||(c=5);for(var a=[],b=0;b<=c;b++)a.push(this.getPointAt(b/c));return a},getLength:function(){var c=this.getLengths();return c[c.length-1]},getLengths:function(c){c||(c=this.__arcLengthDivisions?this.__arcLengthDivisions:
200);if(this.cacheArcLengths&&this.cacheArcLengths.length===c+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var a=[],b=this.getPoint(0),d,e=0;a.push(0);for(d=1;d<=c;d++){var f=this.getPoint(d/c);e+=f.distanceTo(b);a.push(e);b=f}return this.cacheArcLengths=a},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(c,a){var b=this.getLengths(),d,e=b.length;var h=a?a:c*b[e-1];for(var f=0,g=e-1,k;f<=g;)if(d=Math.floor(f+(g-f)/2),k=b[d]-h,0>k)f=
d+1;else if(0<k)g=d-1;else{g=d;break}d=g;if(b[d]===h)return d/(e-1);f=b[d];return(d+(h-f)/(b[d+1]-f))/(e-1)},getTangent:function(c){var a=c-1E-4;c+=1E-4;0>a&&(a=0);1<c&&(c=1);a=this.getPoint(a);return this.getPoint(c).clone().sub(a).normalize()},getTangentAt:function(c){c=this.getUtoTmapping(c);return this.getTangent(c)}};pb.create=function(c,a){c.prototype=Object.create(pb.prototype);c.prototype.constructor=c;c.prototype.getPoint=a;return c};vc.prototype=Object.create(pb.prototype);vc.prototype.constructor=
vc;vc.prototype.isLineCurve=!0;vc.prototype.getPoint=function(c){if(1===c)return this.v2.clone();var a=this.v2.clone().sub(this.v1);a.multiplyScalar(c).add(this.v1);return a};vc.prototype.getPointAt=function(c){return this.getPoint(c)};vc.prototype.getTangent=function(c){return this.v2.clone().sub(this.v1).normalize()};od.prototype=Object.assign(Object.create(pb.prototype),{constructor:od,add:function(c){this.curves.push(c)},closePath:function(){var c=this.curves[0].getPoint(0),a=this.curves[this.curves.length-
1].getPoint(1);c.equals(a)||this.curves.push(new vc(a,c))},getPoint:function(c){var a=c*this.getLength(),b=this.getCurveLengths();for(c=0;c<b.length;){if(b[c]>=a)return a=b[c]-a,c=this.curves[c],b=c.getLength(),c.getPointAt(0===b?0:1-a/b);c++}return null},getLength:function(){var c=this.getCurveLengths();return c[c.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;
for(var c=[],a=0,b=0,d=this.curves.length;b<d;b++)a+=this.curves[b].getLength(),c.push(a);return this.cacheLengths=c},getSpacedPoints:function(c){c||(c=40);for(var a=[],b=0;b<=c;b++)a.push(this.getPoint(b/c));this.autoClose&&a.push(a[0]);return a},getPoints:function(c){c=c||12;for(var a=[],b,d=0,e=this.curves;d<e.length;d++){var f=e[d];f=f.getPoints(f&&f.isEllipseCurve?2*c:f&&f.isLineCurve?1:f&&f.isSplineCurve?c*f.points.length:c);for(var g=0;g<f.length;g++){var k=f[g];b&&b.equals(k)||(a.push(k),
b=k)}}this.autoClose&&1<a.length&&!a[a.length-1].equals(a[0])&&a.push(a[0]);return a},createPointsGeometry:function(c){c=this.getPoints(c);return this.createGeometry(c)},createSpacedPointsGeometry:function(c){c=this.getSpacedPoints(c);return this.createGeometry(c)},createGeometry:function(c){for(var a=new ma,b=0,d=c.length;b<d;b++){var e=c[b];a.vertices.push(new f(e.x,e.y,e.z||0))}return a}});Gc.prototype=Object.create(pb.prototype);Gc.prototype.constructor=Gc;Gc.prototype.isEllipseCurve=!0;Gc.prototype.getPoint=
function(c){for(var a=2*Math.PI,b=this.aEndAngle-this.aStartAngle,d=Math.abs(b)<Number.EPSILON;0>b;)b+=a;for(;b>a;)b-=a;b<Number.EPSILON&&(b=d?0:a);!0!==this.aClockwise||d||(b=b===a?-a:b-a);a=this.aStartAngle+c*b;c=this.aX+this.xRadius*Math.cos(a);var e=this.aY+this.yRadius*Math.sin(a);0!==this.aRotation&&(a=Math.cos(this.aRotation),b=Math.sin(this.aRotation),d=c-this.aX,e-=this.aY,c=d*a-e*b+this.aX,e=d*b+e*a+this.aY);return new g(c,e)};l.CurveUtils={tangentQuadraticBezier:function(c,a,b,d){return 2*
(1-c)*(b-a)+2*c*(d-b)},tangentCubicBezier:function(c,a,b,d,e){return-3*a*(1-c)*(1-c)+3*b*(1-c)*(1-c)-6*c*b*(1-c)+6*c*d*(1-c)-3*c*c*d+3*c*c*e},tangentSpline:function(c,a,b,d,e){return 6*c*c-6*c+(3*c*c-4*c+1)+(-6*c*c+6*c)+(3*c*c-2*c)},interpolate:function(c,a,b,d,e){c=.5*(b-c);d=.5*(d-a);var h=e*e;return(2*a-2*b+c+d)*e*h+(-3*a+3*b-2*c-d)*h+c*e+a}};Qc.prototype=Object.create(pb.prototype);Qc.prototype.constructor=Qc;Qc.prototype.isSplineCurve=!0;Qc.prototype.getPoint=function(c){var a=this.points;c*=
a.length-1;var b=Math.floor(c);c-=b;var d=a[0===b?b:b-1],e=a[b],f=a[b>a.length-2?a.length-1:b+1];a=a[b>a.length-3?a.length-1:b+2];b=l.CurveUtils.interpolate;return new g(b(d.x,e.x,f.x,a.x,c),b(d.y,e.y,f.y,a.y,c))};Rc.prototype=Object.create(pb.prototype);Rc.prototype.constructor=Rc;Rc.prototype.getPoint=function(c){var a=l.ShapeUtils.b3;return new g(a(c,this.v0.x,this.v1.x,this.v2.x,this.v3.x),a(c,this.v0.y,this.v1.y,this.v2.y,this.v3.y))};Rc.prototype.getTangent=function(c){var a=l.CurveUtils.tangentCubicBezier;
return(new g(a(c,this.v0.x,this.v1.x,this.v2.x,this.v3.x),a(c,this.v0.y,this.v1.y,this.v2.y,this.v3.y))).normalize()};Sc.prototype=Object.create(pb.prototype);Sc.prototype.constructor=Sc;Sc.prototype.getPoint=function(c){var a=l.ShapeUtils.b2;return new g(a(c,this.v0.x,this.v1.x,this.v2.x),a(c,this.v0.y,this.v1.y,this.v2.y))};Sc.prototype.getTangent=function(c){var a=l.CurveUtils.tangentQuadraticBezier;return(new g(a(c,this.v0.x,this.v1.x,this.v2.x),a(c,this.v0.y,this.v1.y,this.v2.y))).normalize()};
var ke=Object.assign(Object.create(od.prototype),{fromPoints:function(c){this.moveTo(c[0].x,c[0].y);for(var a=1,b=c.length;a<b;a++)this.lineTo(c[a].x,c[a].y)},moveTo:function(c,a){this.currentPoint.set(c,a)},lineTo:function(c,a){var b=new vc(this.currentPoint.clone(),new g(c,a));this.curves.push(b);this.currentPoint.set(c,a)},quadraticCurveTo:function(c,a,b,d){c=new Sc(this.currentPoint.clone(),new g(c,a),new g(b,d));this.curves.push(c);this.currentPoint.set(b,d)},bezierCurveTo:function(c,a,b,d,e,
f){c=new Rc(this.currentPoint.clone(),new g(c,a),new g(b,d),new g(e,f));this.curves.push(c);this.currentPoint.set(e,f)},splineThru:function(c){var a=[this.currentPoint.clone()].concat(c);a=new Qc(a);this.curves.push(a);this.currentPoint.copy(c[c.length-1])},arc:function(c,a,b,d,e,f){this.absarc(c+this.currentPoint.x,a+this.currentPoint.y,b,d,e,f)},absarc:function(c,a,b,d,e,f){this.absellipse(c,a,b,b,d,e,f)},ellipse:function(c,a,b,d,e,f,g,k){this.absellipse(c+this.currentPoint.x,a+this.currentPoint.y,
b,d,e,f,g,k)},absellipse:function(c,a,b,d,e,f,g,k){c=new Gc(c,a,b,d,e,f,g,k);0<this.curves.length&&(a=c.getPoint(0),a.equals(this.currentPoint)||this.lineTo(a.x,a.y));this.curves.push(c);c=c.getPoint(1);this.currentPoint.copy(c)}});Tc.prototype=Object.assign(Object.create(ke),{constructor:Tc,getPointsHoles:function(c){for(var a=[],b=0,d=this.holes.length;b<d;b++)a[b]=this.holes[b].getPoints(c);return a},extractAllPoints:function(c){return{shape:this.getPoints(c),holes:this.getPointsHoles(c)}},extractPoints:function(c){return this.extractAllPoints(c)}});
pd.prototype=ke;ke.constructor=pd;Sd.prototype={moveTo:function(c,a){this.currentPath=new pd;this.subPaths.push(this.currentPath);this.currentPath.moveTo(c,a)},lineTo:function(c,a){this.currentPath.lineTo(c,a)},quadraticCurveTo:function(c,a,b,d){this.currentPath.quadraticCurveTo(c,a,b,d)},bezierCurveTo:function(c,a,b,d,e,f){this.currentPath.bezierCurveTo(c,a,b,d,e,f)},splineThru:function(c){this.currentPath.splineThru(c)},toShapes:function(c,a){function b(c){for(var a=[],b=0,d=c.length;b<d;b++){var e=
c[b],h=new Tc;h.curves=e.curves;a.push(h)}return a}function d(c,a){for(var b=a.length,d=!1,e=b-1,h=0;h<b;e=h++){var f=a[e],g=a[h],k=g.x-f.x,l=g.y-f.y;if(Math.abs(l)>Number.EPSILON){if(0>l&&(f=a[h],k=-k,g=a[e],l=-l),!(c.y<f.y||c.y>g.y))if(c.y===f.y){if(c.x===f.x)return!0}else{e=l*(c.x-f.x)-k*(c.y-f.y);if(0===e)return!0;0>e||(d=!d)}}else if(c.y===f.y&&(g.x<=c.x&&c.x<=f.x||f.x<=c.x&&c.x<=g.x))return!0}return d}var e=l.ShapeUtils.isClockWise,h=this.subPaths;if(0===h.length)return[];if(!0===a)return b(h);
var f,g,k=[];if(1===h.length)return f=h[0],g=new Tc,g.curves=f.curves,k.push(g),k;var n=!e(h[0].getPoints());n=c?!n:n;g=[];var m=[],r=[],p=0;m[p]=void 0;r[p]=[];for(var q=0,v=h.length;q<v;q++){f=h[q];var u=f.getPoints();var x=e(u);(x=c?!x:x)?(!n&&m[p]&&p++,m[p]={s:new Tc,p:u},m[p].s.curves=f.curves,n&&p++,r[p]=[]):r[p].push({h:f,p:u[0]})}if(!m[0])return b(h);if(1<m.length){q=!1;f=[];e=0;for(h=m.length;e<h;e++)g[e]=[];e=0;for(h=m.length;e<h;e++)for(x=r[e],n=0;n<x.length;n++){p=x[n];u=!0;for(v=0;v<
m.length;v++)d(p.p,m[v].p)&&(e!==v&&f.push({froms:e,tos:v,hole:n}),u?(u=!1,g[v].push(p)):q=!0);u&&g[e].push(p)}0<f.length&&(q||(r=g))}q=0;for(e=m.length;q<e;q++)for(g=m[q].s,k.push(g),f=r[q],h=0,x=f.length;h<x;h++)g.holes.push(f[h].h);return k}};Object.assign(Td.prototype,{isFont:!0,generateShapes:function(c,a,b){void 0===a&&(a=100);void 0===b&&(b=4);var d=this.data;c=String(c).split("");var e=a/d.resolution,h=0;a=[];for(var f=0;f<c.length;f++){var g=e;var k=h,n=d.glyphs[c[f]]||d.glyphs["?"];if(n){var m=
new Sd,r=[],p=l.ShapeUtils.b2,q=l.ShapeUtils.b3,t,v,u;if(n.o)for(var x=n._cachedOutline||(n._cachedOutline=n.o.split(" ")),w=0,z=x.length;w<z;)switch(x[w++]){case "m":var B=x[w++]*g+k;var A=x[w++]*g;m.moveTo(B,A);break;case "l":B=x[w++]*g+k;A=x[w++]*g;m.lineTo(B,A);break;case "q":B=x[w++]*g+k;A=x[w++]*g;var D=x[w++]*g+k;var F=x[w++]*g;m.quadraticCurveTo(D,F,B,A);if(t=r[r.length-1]){var R=t.x;t=t.y;for(var E=1;E<=b;E++){var G=E/b;p(G,R,D,B);p(G,t,F,A)}}break;case "b":if(B=x[w++]*g+k,A=x[w++]*g,D=x[w++]*
g+k,F=x[w++]*g,v=x[w++]*g+k,u=x[w++]*g,m.bezierCurveTo(D,F,v,u,B,A),t=r[r.length-1])for(R=t.x,t=t.y,E=1;E<=b;E++)G=E/b,q(G,R,D,v,B),q(G,t,F,u,A)}g={offset:n.ha*g,path:m}}else g=void 0;h+=g.offset;a.push(g.path)}b=[];d=0;for(c=a.length;d<c;d++)Array.prototype.push.apply(b,a[d].toShapes());return b}});Object.assign(ve.prototype,{load:function(c,a,b,d){var e=this;(new jb(this.manager)).load(c,function(c){try{var b=JSON.parse(c)}catch(Y){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),
b=JSON.parse(c.substring(65,c.length-2))}c=e.parse(b);a&&a(c)},b,d)},parse:function(c){return new Td(c)}});var Vd;Object.assign(Wd.prototype,{load:function(c,a,b,d){var e=new jb(this.manager);e.setResponseType("arraybuffer");e.load(c,function(c){Ud().decodeAudioData(c,function(c){a(c)})},b,d)}});Object.assign(we.prototype,{update:function(){var c,a,b,d,e,f,g,k=new p,n=new p;return function(h){if(c!==this||a!==h.focus||b!==h.fov||d!==h.aspect*this.aspect||e!==h.near||f!==h.far||g!==h.zoom){c=this;
a=h.focus;b=h.fov;d=h.aspect*this.aspect;e=h.near;f=h.far;g=h.zoom;var m=h.projectionMatrix.clone(),r=this.eyeSep/2,p=r*e/a,q=e*Math.tan(l.Math.DEG2RAD*b*.5)/g;n.elements[12]=-r;k.elements[12]=r;r=-q*d+p;var t=q*d+p;m.elements[0]=2*e/(t-r);m.elements[8]=(t+r)/(t-r);this.cameraL.projectionMatrix.copy(m);r=-q*d-p;t=q*d-p;m.elements[0]=2*e/(t-r);m.elements[8]=(t+r)/(t-r);this.cameraR.projectionMatrix.copy(m)}this.cameraL.matrixWorld.copy(h.matrixWorld).multiply(n);this.cameraR.matrixWorld.copy(h.matrixWorld).multiply(k)}}()});
Dd.prototype=Object.create(ca.prototype);Dd.prototype.constructor=Dd;Xd.prototype=Object.assign(Object.create(ca.prototype),{constructor:Xd,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(c){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):
this.gain.disconnect(this.context.destination);this.filter=c;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(c){this.gain.gain.value=c},updateMatrixWorld:function(){var c=new f,a=new q,b=new f,d=new f;return function(e){ca.prototype.updateMatrixWorld.call(this,e);e=this.context.listener;var h=this.up;this.matrixWorld.decompose(c,a,b);d.set(0,0,-1).applyQuaternion(a);e.setPosition(c.x,c.y,
c.z);e.setOrientation(d.x,d.y,d.z,h.x,h.y,h.z)}}()});bd.prototype=Object.assign(Object.create(ca.prototype),{constructor:bd,getOutput:function(){return this.gain},setNodeSource:function(c){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=c;this.connect();return this},setBuffer:function(c){this.source.buffer=c;this.sourceType="buffer";this.autoplay&&this.play();return this},play:function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===
this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else{var c=this.context.createBufferSource();c.buffer=this.source.buffer;c.loop=this.source.loop;c.onended=this.source.onended;c.start(0,this.startTime);c.playbackRate.value=this.playbackRate;this.isPlaying=!0;this.source=c;return this.connect()}},pause:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.startTime=this.context.currentTime,
this.isPlaying=!1,this},stop:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.startTime=0,this.isPlaying=!1,this},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var c=1,a=this.filters.length;c<a;c++)this.filters[c-1].connect(this.filters[c]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<
this.filters.length){this.source.disconnect(this.filters[0]);for(var c=1,a=this.filters.length;c<a;c++)this.filters[c-1].disconnect(this.filters[c]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(c){c||(c=[]);!0===this.isPlaying?(this.disconnect(),this.filters=c,this.connect()):this.filters=c;return this},getFilter:function(){return this.getFilters()[0]},setFilter:function(c){return this.setFilters(c?
[c]:[])},setPlaybackRate:function(c){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.playbackRate=c,!0===this.isPlaying&&(this.source.playbackRate.value=this.playbackRate),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.source.loop},setLoop:function(c){!1===
this.hasPlaybackControl?console.warn("THREE.Audio: this Audio has no playback control."):this.source.loop=c},getVolume:function(){return this.gain.gain.value},setVolume:function(c){this.gain.gain.value=c;return this}});Yd.prototype=Object.assign(Object.create(bd.prototype),{constructor:Yd,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(c){this.panner.refDistance=c},getRolloffFactor:function(){return this.panner.rolloffFactor},
setRolloffFactor:function(c){this.panner.rolloffFactor=c},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(c){this.panner.distanceModel=c},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(c){this.panner.maxDistance=c},updateMatrixWorld:function(){var c=new f;return function(a){ca.prototype.updateMatrixWorld.call(this,a);c.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(c.x,c.y,c.z)}}()});Object.assign(Zd.prototype,
{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function(){for(var c=0,a=this.getFrequencyData(),b=0;b<a.length;b++)c+=a[b];return c/a.length}});Ed.prototype={constructor:Ed,accumulate:function(c,a){var b=this.buffer,d=this.valueSize,e=c*d+d,h=this.cumulativeWeight;if(0===h){for(h=0;h!==d;++h)b[e+h]=b[h];h=a}else h+=a,this._mixBufferRegion(b,e,0,a/h,d);this.cumulativeWeight=h},apply:function(c){var a=this.valueSize,b=this.buffer;c=c*
a+a;var d=this.cumulativeWeight,e=this.binding;this.cumulativeWeight=0;1>d&&this._mixBufferRegion(b,c,3*a,1-d,a);d=a;for(var f=a+a;d!==f;++d)if(b[d]!==b[d+a]){e.setValue(b,c);break}},saveOriginalState:function(){var c=this.buffer,a=this.valueSize,b=3*a;this.binding.getValue(c,b);for(var d=a;d!==b;++d)c[d]=c[b+d%a];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(c,a,b,d,e){if(.5<=d)for(d=0;d!==e;++d)c[a+d]=c[b+d]},_slerp:function(c,
a,b,d,e){q.slerpFlat(c,a,c,a,c,b,d)},_lerp:function(c,a,b,d,e){for(var h=1-d,f=0;f!==e;++f){var g=a+f;c[g]=c[g]*h+c[b+f]*d}}};Pa.prototype={constructor:Pa,getValue:function(c,a){this.bind();this.getValue(c,a)},setValue:function(c,a){this.bind();this.setValue(c,a)},bind:function(){var c=this.node,a=this.parsedPath,b=a.objectName,d=a.propertyName,e=a.propertyIndex;c||(this.node=c=Pa.findNode(this.rootNode,a.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;
if(c){if(b){var f=a.objectIndex;switch(b){case "materials":if(!c.material){console.error("  can not bind to material as node does not have a material",this);return}if(!c.material.materials){console.error("  can not bind to material.materials as node.material does not have a materials array",this);return}c=c.material.materials;break;case "bones":if(!c.skeleton){console.error("  can not bind to bones as node does not have a skeleton",this);return}c=c.skeleton.bones;for(b=0;b<c.length;b++)if(c[b].name===
f){f=b;break}break;default:if(void 0===c[b]){console.error("  can not bind to objectName of node, undefined",this);return}c=c[b]}if(void 0!==f){if(void 0===c[f]){console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,c);return}c=c[f]}}f=c[d];if(void 0===f)console.error("  trying to update property for track: "+a.nodeName+"."+d+" but it wasn't found.",c);else{a=this.Versioning.None;void 0!==c.needsUpdate?(a=this.Versioning.NeedsUpdate,this.targetObject=c):void 0!==c.matrixWorldNeedsUpdate&&
(a=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=c);b=this.BindingType.Direct;if(void 0!==e){if("morphTargetInfluences"===d){if(!c.geometry){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);return}if(!c.geometry.morphTargets){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);return}for(b=0;b<this.node.geometry.morphTargets.length;b++)if(c.geometry.morphTargets[b].name===e){e=
b;break}}b=this.BindingType.ArrayElement;this.resolvedProperty=f;this.propertyIndex=e}else void 0!==f.fromArray&&void 0!==f.toArray?(b=this.BindingType.HasFromToArray,this.resolvedProperty=f):void 0!==f.length?(b=this.BindingType.EntireArray,this.resolvedProperty=f):this.propertyName=d;this.getValue=this.GetterByBindingType[b];this.setValue=this.SetterByBindingTypeAndVersioning[b][a]}}else console.error("  trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=
null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}};Object.assign(Pa.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:Pa.prototype.getValue,_setValue_unbound:Pa.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(c,a){c[a]=this.node[this.propertyName]},function(c,a){for(var b=this.resolvedProperty,
d=0,e=b.length;d!==e;++d)c[a++]=b[d]},function(c,a){c[a]=this.resolvedProperty[this.propertyIndex]},function(c,a){this.resolvedProperty.toArray(c,a)}],SetterByBindingTypeAndVersioning:[[function(c,a){this.node[this.propertyName]=c[a]},function(c,a){this.node[this.propertyName]=c[a];this.targetObject.needsUpdate=!0},function(c,a){this.node[this.propertyName]=c[a];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(c,a){for(var b=this.resolvedProperty,d=0,e=b.length;d!==e;++d)b[d]=c[a++]},function(c,
a){for(var b=this.resolvedProperty,d=0,e=b.length;d!==e;++d)b[d]=c[a++];this.targetObject.needsUpdate=!0},function(c,a){for(var b=this.resolvedProperty,d=0,e=b.length;d!==e;++d)b[d]=c[a++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(c,a){this.resolvedProperty[this.propertyIndex]=c[a]},function(c,a){this.resolvedProperty[this.propertyIndex]=c[a];this.targetObject.needsUpdate=!0},function(c,a){this.resolvedProperty[this.propertyIndex]=c[a];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(c,
a){this.resolvedProperty.fromArray(c,a)},function(c,a){this.resolvedProperty.fromArray(c,a);this.targetObject.needsUpdate=!0},function(c,a){this.resolvedProperty.fromArray(c,a);this.targetObject.matrixWorldNeedsUpdate=!0}]]});Pa.Composite=function(c,a,b){b=b||Pa.parseTrackName(a);this._targetGroup=c;this._bindings=c.subscribe_(a,b)};Pa.Composite.prototype={constructor:Pa.Composite,getValue:function(c,a){this.bind();var b=this._bindings[this._targetGroup.nCachedObjects_];void 0!==b&&b.getValue(c,a)},
setValue:function(c,a){for(var b=this._bindings,d=this._targetGroup.nCachedObjects_,e=b.length;d!==e;++d)b[d].setValue(c,a)},bind:function(){for(var c=this._bindings,a=this._targetGroup.nCachedObjects_,b=c.length;a!==b;++a)c[a].bind()},unbind:function(){for(var c=this._bindings,a=this._targetGroup.nCachedObjects_,b=c.length;a!==b;++a)c[a].unbind()}};Pa.create=function(c,a,b){return c&&c.isAnimationObjectGroup?new Pa.Composite(c,a,b):new Pa(c,a,b)};Pa.parseTrackName=function(c){var a=/^((?:\w+[\/:])*)(\w+)?(?:\.(\w+)(?:\[(.+)\])?)?\.(\w+)(?:\[(.+)\])?$/.exec(c);
if(!a)throw Error("cannot parse trackName at all: "+c);a={nodeName:a[2],objectName:a[3],objectIndex:a[4],propertyName:a[5],propertyIndex:a[6]};if(null===a.propertyName||0===a.propertyName.length)throw Error("can not parse propertyName from trackName: "+c);return a};Pa.findNode=function(c,a){if(!a||""===a||"root"===a||"."===a||-1===a||a===c.name||a===c.uuid)return c;if(c.skeleton){var b=function(c){for(var b=0;b<c.bones.length;b++){var d=c.bones[b];if(d.name===a)return d}return null}(c.skeleton);if(b)return b}if(c.children){var d=
function(c){for(var b=0;b<c.length;b++){var e=c[b];if(e.name===a||e.uuid===a||(e=d(e.children)))return e}return null};if(b=d(c.children))return b}return null};$d.prototype={constructor:$d,isAnimationObjectGroup:!0,add:function(c){for(var a=this._objects,b=a.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._paths,g=this._parsedPaths,k=this._bindings,l=k.length,n=0,m=arguments.length;n!==m;++n){var r=arguments[n],p=r.uuid,q=e[p];if(void 0===q){q=b++;e[p]=q;a.push(r);p=0;for(var v=l;p!==v;++p)k[p].push(new Pa(r,
f[p],g[p]))}else if(q<d){var u=a[q],x=--d;v=a[x];e[v.uuid]=q;a[q]=v;e[p]=x;a[x]=r;p=0;for(v=l;p!==v;++p){var w=k[p],z=w[q];w[q]=w[x];void 0===z&&(z=new Pa(r,f[p],g[p]));w[x]=z}}else a[q]!==u&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=d},remove:function(c){for(var a=this._objects,b=this.nCachedObjects_,d=this._indicesByUUID,e=this._bindings,f=e.length,g=0,k=arguments.length;g!==k;++g){var l=
arguments[g],n=l.uuid,m=d[n];if(void 0!==m&&m>=b){var r=b++,p=a[r];d[p.uuid]=m;a[m]=p;d[n]=r;a[r]=l;l=0;for(n=f;l!==n;++l){p=e[l];var q=p[m];p[m]=p[r];p[r]=q}}}this.nCachedObjects_=b},uncache:function(c){for(var a=this._objects,b=a.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._bindings,g=f.length,k=0,l=arguments.length;k!==l;++k){var n=arguments[k].uuid,m=e[n];if(void 0!==m)if(delete e[n],m<d){n=--d;var r=a[n],p=--b,q=a[p];e[r.uuid]=m;a[m]=r;e[q.uuid]=n;a[n]=q;a.pop();r=0;for(q=g;r!==
q;++r){var v=f[r],u=v[p];v[m]=v[n];v[n]=u;v.pop()}}else for(p=--b,q=a[p],e[q.uuid]=m,a[m]=q,a.pop(),r=0,q=g;r!==q;++r)v=f[r],v[m]=v[p],v.pop()}this.nCachedObjects_=d},subscribe_:function(c,a){var b=this._bindingsIndicesByPath,d=b[c],e=this._bindings;if(void 0!==d)return e[d];var h=this._paths,f=this._parsedPaths,g=this._objects,k=this.nCachedObjects_,l=Array(g.length);d=e.length;b[c]=d;h.push(c);f.push(a);e.push(l);b=k;for(d=g.length;b!==d;++b)l[b]=new Pa(g[b],c,a);return l},unsubscribe_:function(c){var a=
this._bindingsIndicesByPath,b=a[c];if(void 0!==b){var d=this._paths,e=this._parsedPaths,f=this._bindings,g=f.length-1,k=f[g];a[c[g]]=b;f[b]=k;f.pop();e[b]=e[g];e.pop();d[b]=d[g];d.pop()}}};ae.prototype={constructor:ae,play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},reset:function(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&
!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(c){this._startTime=c;return this},setLoop:function(c,a){this.loop=c;this.repetitions=a;return this},setEffectiveWeight:function(c){this.weight=c;this._effectiveWeight=this.enabled?c:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(c){return this._scheduleFading(c,0,1)},fadeOut:function(c){return this._scheduleFading(c,
1,0)},crossFadeFrom:function(c,a,b){c.fadeOut(a);this.fadeIn(a);if(b){b=this._clip.duration;var d=c._clip.duration,e=b/d;c.warp(1,d/b,a);this.warp(e,1,a)}return this},crossFadeTo:function(c,a,b){return c.crossFadeFrom(this,a,b)},stopFading:function(){var c=this._weightInterpolant;null!==c&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(c));return this},setEffectiveTimeScale:function(c){this.timeScale=c;this._effectiveTimeScale=this.paused?0:c;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},
setDuration:function(c){this.timeScale=this._clip.duration/c;return this.stopWarping()},syncWith:function(c){this.time=c.time;this.timeScale=c.timeScale;return this.stopWarping()},halt:function(c){return this.warp(this._effectiveTimeScale,0,c)},warp:function(c,a,b){var d=this._mixer,e=d.time,h=this._timeScaleInterpolant,f=this.timeScale;null===h&&(this._timeScaleInterpolant=h=d._lendControlInterpolant());d=h.parameterPositions;h=h.sampleValues;d[0]=e;d[1]=e+b;h[0]=c/f;h[1]=a/f;return this},stopWarping:function(){var c=
this._timeScaleInterpolant;null!==c&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(c));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(c,a,b,d){var e=this._startTime;if(null!==e){a=(c-e)*b;if(0>a||0===b)return;this._startTime=null;a*=b}a*=this._updateTimeScale(c);b=this._updateTime(a);c=this._updateWeight(c);if(0<c){a=this._interpolants;e=this._propertyBindings;
for(var h=0,f=a.length;h!==f;++h)a[h].evaluate(b),e[h].accumulate(d,c)}},_updateWeight:function(c){var a=0;if(this.enabled){a=this.weight;var b=this._weightInterpolant;if(null!==b){var d=b.evaluate(c)[0];a*=d;c>b.parameterPositions[1]&&(this.stopFading(),0===d&&(this.enabled=!1))}}return this._effectiveWeight=a},_updateTimeScale:function(c){var a=0;if(!this.paused){a=this.timeScale;var b=this._timeScaleInterpolant;if(null!==b){var d=b.evaluate(c)[0];a*=d;c>b.parameterPositions[1]&&(this.stopWarping(),
0===a?this.paused=!0:this.timeScale=a)}}return this._effectiveTimeScale=a},_updateTime:function(c){var a=this.time+c;if(0===c)return a;var b=this._clip.duration,d=this.loop,e=this._loopCount;if(2200===d)a:{if(-1===e&&(this.loopCount=0,this._setEndings(!0,!0,!1)),a>=b)a=b;else if(0>a)a=0;else break a;this.clampWhenFinished?this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>c?-1:1})}else{d=2202===d;-1===e&&(0<=c?(e=0,this._setEndings(!0,0===this.repetitions,
d)):this._setEndings(0===this.repetitions,!0,d));if(a>=b||0>a){var f=Math.floor(a/b);a-=b*f;e+=Math.abs(f);var g=this.repetitions-e;0>g?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,a=0<c?b:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<c?1:-1})):(0===g?(c=0>c,this._setEndings(c,!c,d)):this._setEndings(!1,!1,d),this._loopCount=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:f}))}if(d&&1===(e&1))return this.time=a,b-a}return this.time=a},_setEndings:function(c,
a,b){var d=this._interpolantSettings;b?(d.endingStart=2401,d.endingEnd=2401):(d.endingStart=c?this.zeroSlopeAtStart?2401:2400:2402,d.endingEnd=a?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(c,a,b){var d=this._mixer,e=d.time,h=this._weightInterpolant;null===h&&(this._weightInterpolant=h=d._lendControlInterpolant());d=h.parameterPositions;h=h.sampleValues;d[0]=e;h[0]=a;d[1]=e+c;h[1]=b;return this}};Object.assign(be.prototype,b.prototype,{clipAction:function(c,a){var b=a||this._root,
d=b.uuid,e="string"===typeof c?Jb.findByName(b,c):c;b=null!==e?e.uuid:c;var h=this._actionsByClip[b],f=null;if(void 0!==h){f=h.actionByRoot[d];if(void 0!==f)return f;f=h.knownActions[0];null===e&&(e=f._clip)}if(null===e)return null;e=new ae(this,e,a);this._bindAction(e,f);this._addInactiveAction(e,b,d);return e},existingAction:function(c,a){var b=a||this._root,d=b.uuid;b="string"===typeof c?Jb.findByName(b,c):c;b=this._actionsByClip[b?b.uuid:c];return void 0!==b?b.actionByRoot[d]||null:null},stopAllAction:function(){for(var c=
this._actions,a=this._nActiveActions,b=this._bindings,d=this._nActiveBindings,e=this._nActiveBindings=this._nActiveActions=0;e!==a;++e)c[e].reset();for(e=0;e!==d;++e)b[e].useCount=0;return this},update:function(c){c*=this.timeScale;for(var a=this._actions,b=this._nActiveActions,d=this.time+=c,e=Math.sign(c),f=this._accuIndex^=1,g=0;g!==b;++g){var k=a[g];k.enabled&&k._update(d,c,e,f)}c=this._bindings;a=this._nActiveBindings;for(g=0;g!==a;++g)c[g].apply(f);return this},getRoot:function(){return this._root},
uncacheClip:function(c){var a=this._actions;c=c.uuid;var b=this._actionsByClip,d=b[c];if(void 0!==d){d=d.knownActions;for(var e=0,f=d.length;e!==f;++e){var g=d[e];this._deactivateAction(g);var k=g._cacheIndex,l=a[a.length-1];g._cacheIndex=null;g._byClipCacheIndex=null;l._cacheIndex=k;a[k]=l;a.pop();this._removeInactiveBindingsForAction(g)}delete b[c]}},uncacheRoot:function(c){c=c.uuid;var a=this._actionsByClip;for(d in a){var b=a[d].actionByRoot[c];void 0!==b&&(this._deactivateAction(b),this._removeInactiveAction(b))}var d=
this._bindingsByRootAndName[c];if(void 0!==d)for(var e in d)c=d[e],c.restoreOriginalState(),this._removeInactiveBinding(c)},uncacheAction:function(c,a){var b=this.existingAction(c,a);null!==b&&(this._deactivateAction(b),this._removeInactiveAction(b))}});Object.assign(be.prototype,{_bindAction:function(c,a){var b=c._localRoot||this._root,d=c._clip.tracks,e=d.length,f=c._propertyBindings,h=c._interpolants,g=b.uuid,k=this._bindingsByRootAndName,l=k[g];void 0===l&&(l={},k[g]=l);for(k=0;k!==e;++k){var n=
d[k],m=n.name,r=l[m];if(void 0===r){r=f[k];if(void 0!==r){null===r._cacheIndex&&(++r.referenceCount,this._addInactiveBinding(r,g,m));continue}r=new Ed(Pa.create(b,m,a&&a._propertyBindings[k].binding.parsedPath),n.ValueTypeName,n.getValueSize());++r.referenceCount;this._addInactiveBinding(r,g,m)}f[k]=r;h[k].resultBuffer=r.buffer}},_activateAction:function(c){if(!this._isActiveAction(c)){if(null===c._cacheIndex){var a=(c._localRoot||this._root).uuid,b=c._clip.uuid,d=this._actionsByClip[b];this._bindAction(c,
d&&d.knownActions[0]);this._addInactiveAction(c,b,a)}a=c._propertyBindings;b=0;for(d=a.length;b!==d;++b){var e=a[b];0===e.useCount++&&(this._lendBinding(e),e.saveOriginalState())}this._lendAction(c)}},_deactivateAction:function(c){if(this._isActiveAction(c)){for(var a=c._propertyBindings,b=0,d=a.length;b!==d;++b){var e=a[b];0===--e.useCount&&(e.restoreOriginalState(),this._takeBackBinding(e))}this._takeBackAction(c)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip=
{};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var c=this;this.stats={actions:{get total(){return c._actions.length},get inUse(){return c._nActiveActions}},bindings:{get total(){return c._bindings.length},get inUse(){return c._nActiveBindings}},controlInterpolants:{get total(){return c._controlInterpolants.length},get inUse(){return c._nActiveControlInterpolants}}}},_isActiveAction:function(c){c=c._cacheIndex;
return null!==c&&c<this._nActiveActions},_addInactiveAction:function(c,a,b){var d=this._actions,e=this._actionsByClip,f=e[a];void 0===f?(f={knownActions:[c],actionByRoot:{}},c._byClipCacheIndex=0,e[a]=f):(a=f.knownActions,c._byClipCacheIndex=a.length,a.push(c));c._cacheIndex=d.length;d.push(c);f.actionByRoot[b]=c},_removeInactiveAction:function(c){var a=this._actions,b=a[a.length-1],d=c._cacheIndex;b._cacheIndex=d;a[d]=b;a.pop();c._cacheIndex=null;b=c._clip.uuid;d=this._actionsByClip;var e=d[b],f=
e.knownActions,g=f[f.length-1],k=c._byClipCacheIndex;g._byClipCacheIndex=k;f[k]=g;f.pop();c._byClipCacheIndex=null;delete e.actionByRoot[(a._localRoot||this._root).uuid];0===f.length&&delete d[b];this._removeInactiveBindingsForAction(c)},_removeInactiveBindingsForAction:function(c){c=c._propertyBindings;for(var a=0,b=c.length;a!==b;++a){var d=c[a];0===--d.referenceCount&&this._removeInactiveBinding(d)}},_lendAction:function(a){var c=this._actions,b=a._cacheIndex,d=this._nActiveActions++,e=c[d];a._cacheIndex=
d;c[d]=a;e._cacheIndex=b;c[b]=e},_takeBackAction:function(a){var c=this._actions,b=a._cacheIndex,d=--this._nActiveActions,e=c[d];a._cacheIndex=d;c[d]=a;e._cacheIndex=b;c[b]=e},_addInactiveBinding:function(a,b,d){var c=this._bindingsByRootAndName,e=c[b],f=this._bindings;void 0===e&&(e={},c[b]=e);e[d]=a;a._cacheIndex=f.length;f.push(a)},_removeInactiveBinding:function(a){var c=this._bindings,b=a.binding,d=b.rootNode.uuid;b=b.path;var e=this._bindingsByRootAndName,f=e[d],g=c[c.length-1];a=a._cacheIndex;
g._cacheIndex=a;c[a]=g;c.pop();delete f[b];a:{for(var k in f)break a;delete e[d]}},_lendBinding:function(a){var c=this._bindings,b=a._cacheIndex,d=this._nActiveBindings++,e=c[d];a._cacheIndex=d;c[d]=a;e._cacheIndex=b;c[b]=e},_takeBackBinding:function(a){var c=this._bindings,b=a._cacheIndex,d=--this._nActiveBindings,e=c[d];a._cacheIndex=d;c[d]=a;e._cacheIndex=b;c[b]=e},_lendControlInterpolant:function(){var a=this._controlInterpolants,b=this._nActiveControlInterpolants++,d=a[b];void 0===d&&(d=new cc(new Float32Array(2),
new Float32Array(2),1,this._controlInterpolantsResultBuffer),d.__cacheIndex=b,a[b]=d);return d},_takeBackControlInterpolant:function(a){var c=this._controlInterpolants,b=a.__cacheIndex,d=--this._nActiveControlInterpolants,e=c[d];a.__cacheIndex=d;c[d]=a;e.__cacheIndex=b;c[b]=e},_controlInterpolantsResultBuffer:new Float32Array(1)});ce.prototype={constructor:ce,onUpdate:function(a){this.dynamic=!0;this.onUpdateCallback=a;return this}};Uc.prototype=Object.create(ia.prototype);Uc.prototype.constructor=
Uc;Uc.prototype.isInstancedBufferGeometry=!0;Uc.prototype.addGroup=function(a,b,d){this.groups.push({start:a,count:b,instances:d})};Uc.prototype.copy=function(a){var c=a.index;null!==c&&this.setIndex(c.clone());c=a.attributes;for(var b in c)this.addAttribute(b,c[b].clone());a=a.groups;b=0;for(c=a.length;b<c;b++){var d=a[b];this.addGroup(d.start,d.count,d.instances)}return this};de.prototype={constructor:de,isInterleavedBufferAttribute:!0,get count(){return this.data.count},get array(){return this.data.array},
setX:function(a,b){this.data.array[a*this.data.stride+this.offset]=b;return this},setY:function(a,b){this.data.array[a*this.data.stride+this.offset+1]=b;return this},setZ:function(a,b){this.data.array[a*this.data.stride+this.offset+2]=b;return this},setW:function(a,b){this.data.array[a*this.data.stride+this.offset+3]=b;return this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+1]},getZ:function(a){return this.data.array[a*
this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,b,d){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=d;return this},setXYZ:function(a,b,d,e){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=d;this.data.array[a+2]=e;return this},setXYZW:function(a,b,d,e,f){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=d;this.data.array[a+2]=e;this.data.array[a+
3]=f;return this}};cd.prototype={constructor:cd,isInterleavedBuffer:!0,set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.count=a.count;this.stride=a.stride;this.dynamic=a.dynamic;return this},copyAt:function(a,b,d){a*=this.stride;d*=b.stride;for(var c=0,e=this.stride;c<e;c++)this.array[a+c]=b.array[d+c];return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},clone:function(){return(new this.constructor).copy(this)}};
dd.prototype=Object.create(cd.prototype);dd.prototype.constructor=dd;dd.prototype.isInstancedInterleavedBuffer=!0;dd.prototype.copy=function(a){cd.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};ed.prototype=Object.create(P.prototype);ed.prototype.constructor=ed;ed.prototype.isInstancedBufferAttribute=!0;ed.prototype.copy=function(a){P.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};ee.prototype={constructor:ee,linePrecision:1,set:function(a,
b){this.ray.set(a,b)},setFromCamera:function(a,b){b&&b.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(b.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(b).sub(this.ray.origin).normalize()):b&&b.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(b.near+b.far)/(b.near-b.far)).unproject(b),this.ray.direction.set(0,0,-1).transformDirection(b.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,b){var c=[];fe(a,this,c,b);c.sort(xe);
return c},intersectObjects:function(a,b){var c=[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),c;for(var d=0,e=a.length;d<e;d++)fe(a[d],this,c,b);c.sort(xe);return c}};ge.prototype={constructor:ge,start:function(){this.oldTime=this.startTime=(performance||Date).now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&
!this.running&&this.start();if(this.running){var b=(performance||Date).now();a=(b-this.oldTime)/1E3;this.oldTime=b;this.elapsedTime+=a}return a}};he.prototype={constructor:he,set:function(a,b,d){this.radius=a;this.phi=b;this.theta=d;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius.copy(a.radius);this.phi.copy(a.phi);this.theta.copy(a.theta);return this},makeSafe:function(){this.phi=Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi));return this},setFromVector3:function(a){this.radius=
a.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a.x,a.z),this.phi=Math.acos(l.Math.clamp(a.y/this.radius,-1,1)));return this}};kb.prototype=Object.create(Ca.prototype);kb.prototype.constructor=kb;kb.prototype.createAnimation=function(a,b,d,e){b={start:b,end:d,length:d-b+1,fps:e,duration:(d-b)/e,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=b;this.animationsList.push(b)};kb.prototype.autoCreateAnimations=
function(a){for(var c=/([a-z]+)_?(\d+)/i,b,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var k=e.morphTargets[f].name.match(c);if(k&&1<k.length){var l=k[1];d[l]||(d[l]={start:Infinity,end:-Infinity});k=d[l];f<k.start&&(k.start=f);f>k.end&&(k.end=f);b||(b=l)}}for(l in d)k=d[l],this.createAnimation(l,k.start,k.end,a);this.firstAnimation=b};kb.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1};kb.prototype.setAnimationDirectionBackward=
function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0};kb.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)};kb.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)};kb.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)};kb.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)};
kb.prototype.getAnimationTime=function(a){var c=0;if(a=this.animationsMap[a])c=a.time;return c};kb.prototype.getAnimationDuration=function(a){var c=-1;if(a=this.animationsMap[a])c=a.duration;return c};kb.prototype.playAnimation=function(a){var c=this.animationsMap[a];c?(c.time=0,c.active=!0):console.warn("THREE.MorphBlendMesh: animation["+a+"] undefined in .playAnimation()")};kb.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1};kb.prototype.update=function(a){for(var c=0,
b=this.animationsList.length;c<b;c++){var d=this.animationsList[c];if(d.active){var e=d.duration/d.length;d.time+=d.direction*a;if(d.mirroredLoop){if(d.time>d.duration||0>d.time)d.direction*=-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),0>d.time&&(d.time=0,d.directionBackwards=!1)}else d.time%=d.duration,0>d.time&&(d.time+=d.duration);var f=d.start+l.Math.clamp(Math.floor(d.time/e),0,d.length-1),g=d.weight;f!==d.currentFrame&&(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=
1*g,this.morphTargetInfluences[f]=0,d.lastFrame=d.currentFrame,d.currentFrame=f);e=d.time%e/e;d.directionBackwards&&(e=1-e);d.currentFrame!==d.lastFrame?(this.morphTargetInfluences[d.currentFrame]=e*g,this.morphTargetInfluences[d.lastFrame]=(1-e)*g):this.morphTargetInfluences[d.currentFrame]=g}}};qd.prototype=Object.create(ca.prototype);qd.prototype.constructor=qd;qd.prototype.isImmediateRenderObject=!0;rd.prototype=Object.create(Ka.prototype);rd.prototype.constructor=rd;rd.prototype.update=function(){var a=
new f,b=new f,d=new va;return function(){var c=["a","b","c"];this.object.updateMatrixWorld(!0);d.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,f=this.geometry.attributes.position,g=this.object.geometry;if(g&&g.isGeometry)for(var h=g.vertices,k=g.faces,l=g=0,n=k.length;l<n;l++)for(var m=k[l],r=0,p=m.vertexNormals.length;r<p;r++){var q=m.vertexNormals[r];a.copy(h[m[c[r]]]).applyMatrix4(e);b.copy(q).applyMatrix3(d).normalize().multiplyScalar(this.size).add(a);f.setXYZ(g,a.x,
a.y,a.z);g+=1;f.setXYZ(g,b.x,b.y,b.z);g+=1}else if(g&&g.isBufferGeometry)for(c=g.attributes.position,h=g.attributes.normal,r=g=0,p=c.count;r<p;r++)a.set(c.getX(r),c.getY(r),c.getZ(r)).applyMatrix4(e),b.set(h.getX(r),h.getY(r),h.getZ(r)),b.applyMatrix3(d).normalize().multiplyScalar(this.size).add(a),f.setXYZ(g,a.x,a.y,a.z),g+=1,f.setXYZ(g,b.x,b.y,b.z),g+=1;f.needsUpdate=!0;return this}}();fd.prototype=Object.create(ca.prototype);fd.prototype.constructor=fd;fd.prototype.dispose=function(){this.cone.geometry.dispose();
this.cone.material.dispose()};fd.prototype.update=function(){var a=new f,b=new f;return function(){var c=this.light.distance?this.light.distance:1E3,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c);a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(b.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();gd.prototype=Object.create(Ka.prototype);gd.prototype.constructor=gd;gd.prototype.getBoneList=
function(a){var c=[];a&&a.isBone&&c.push(a);for(var b=0;b<a.children.length;b++)c.push.apply(c,this.getBoneList(a.children[b]));return c};gd.prototype.update=function(){for(var a=this.geometry,b=(new p).getInverse(this.root.matrixWorld),d=new p,e=0,f=0;f<this.bones.length;f++){var g=this.bones[f];g.parent&&g.parent.isBone&&(d.multiplyMatrices(b,g.matrixWorld),a.vertices[e].setFromMatrixPosition(d),d.multiplyMatrices(b,g.parent.matrixWorld),a.vertices[e+1].setFromMatrixPosition(d),e+=2)}a.verticesNeedUpdate=
!0;a.computeBoundingSphere()};hd.prototype=Object.create(Ca.prototype);hd.prototype.constructor=hd;hd.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};hd.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};id.prototype=Object.create(ca.prototype);id.prototype.constructor=id;id.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};id.prototype.update=function(){var a=
new f;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=!0}}();sd.prototype=Object.create(Ka.prototype);sd.prototype.constructor=sd;sd.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};
td.prototype=Object.create(Ka.prototype);td.prototype.constructor=td;td.prototype.update=function(){var a=new f,b=new f,d=new va;return function(){this.object.updateMatrixWorld(!0);d.getNormalMatrix(this.object.matrixWorld);var c=this.object.matrixWorld,e=this.geometry.attributes.position,f=this.object.geometry,g=f.vertices;f=f.faces;for(var h=0,k=0,l=f.length;k<l;k++){var n=f[k],m=n.normal;a.copy(g[n.a]).add(g[n.b]).add(g[n.c]).divideScalar(3).applyMatrix4(c);b.copy(m).applyMatrix3(d).normalize().multiplyScalar(this.size).add(a);
e.setXYZ(h,a.x,a.y,a.z);h+=1;e.setXYZ(h,b.x,b.y,b.z);h+=1}e.needsUpdate=!0;return this}}();jd.prototype=Object.create(ca.prototype);jd.prototype.constructor=jd;jd.prototype.dispose=function(){var a=this.children[0],b=this.children[1];a.geometry.dispose();a.material.dispose();b.geometry.dispose();b.material.dispose()};jd.prototype.update=function(){var a=new f,b=new f,d=new f;return function(){a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);d.subVectors(b,
a);var c=this.children[0],e=this.children[1];c.lookAt(d);c.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);e.lookAt(d);e.scale.z=d.length()}}();ud.prototype=Object.create(Ka.prototype);ud.prototype.constructor=ud;ud.prototype.update=function(){function a(a,c,f,h){e.set(c,f,h).unproject(g);a=d[a];if(void 0!==a)for(c=0,f=a.length;c<f;c++)b.vertices[a[c]].copy(e)}var b,d,e=new f,g=new Ea;return function(){b=this.geometry;d=this.pointMap;g.projectionMatrix.copy(this.camera.projectionMatrix);
a("c",0,0,-1);a("t",0,0,1);a("n1",-1,-1,-1);a("n2",1,-1,-1);a("n3",-1,1,-1);a("n4",1,1,-1);a("f1",-1,-1,1);a("f2",1,-1,1);a("f3",-1,1,1);a("f4",1,1,1);a("u1",.7,1.1,-1);a("u2",-.7,1.1,-1);a("u3",0,2,-1);a("cf1",-1,0,1);a("cf2",1,0,1);a("cf3",0,-1,1);a("cf4",0,1,1);a("cn1",-1,0,-1);a("cn2",1,0,-1);a("cn3",0,-1,-1);a("cn4",0,1,-1);b.verticesNeedUpdate=!0}}();vd.prototype=Object.create(Ca.prototype);vd.prototype.constructor=vd;vd.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);
this.box.getCenter(this.position)};wd.prototype=Object.create(Ka.prototype);wd.prototype.constructor=wd;wd.prototype.update=function(){var a=new sa;return function(c){c&&c.isBox3?a.copy(c):a.setFromObject(c);if(!a.isEmpty()){c=a.min;var b=a.max,d=this.geometry.attributes.position,e=d.array;e[0]=b.x;e[1]=b.y;e[2]=b.z;e[3]=c.x;e[4]=b.y;e[5]=b.z;e[6]=c.x;e[7]=c.y;e[8]=b.z;e[9]=b.x;e[10]=c.y;e[11]=b.z;e[12]=b.x;e[13]=b.y;e[14]=c.z;e[15]=c.x;e[16]=b.y;e[17]=c.z;e[18]=c.x;e[19]=c.y;e[20]=c.z;e[21]=b.x;
e[22]=c.y;e[23]=c.z;d.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();var ye=new ia;ye.addAttribute("position",new Oa([0,0,0,0,1,0],3));var ze=new ac(0,.5,1,5,1);ze.translate(0,-.5,0);Vc.prototype=Object.create(ca.prototype);Vc.prototype.constructor=Vc;Vc.prototype.setDirection=function(){var a=new f,b;return function(c){.99999<c.y?this.quaternion.set(0,0,0,1):-.99999>c.y?this.quaternion.set(1,0,0,0):(a.set(c.z,0,-c.x).normalize(),b=Math.acos(c.y),this.quaternion.setFromAxisAngle(a,b))}}();
Vc.prototype.setLength=function(a,b,d){void 0===b&&(b=.2*a);void 0===d&&(d=.2*b);this.line.scale.set(1,Math.max(0,a-b),1);this.line.updateMatrix();this.cone.scale.set(d,b,d);this.cone.position.y=a;this.cone.updateMatrix()};Vc.prototype.setColor=function(a){this.line.material.color.copy(a);this.cone.material.color.copy(a)};Fd.prototype=Object.create(Ka.prototype);Fd.prototype.constructor=Fd;l.CatmullRomCurve3=function(){function a(){}var b=new f,d=new a,e=new a,g=new a;a.prototype.init=function(a,
c,b,d){this.c0=a;this.c1=b;this.c2=-3*a+3*c-2*b-d;this.c3=2*a-2*c+b+d};a.prototype.initNonuniformCatmullRom=function(a,c,b,d,e,f,g){this.init(c,b,((c-a)/e-(b-a)/(e+f)+(b-c)/f)*f,((b-c)/f-(d-c)/(f+g)+(d-b)/g)*f)};a.prototype.initCatmullRom=function(a,c,b,d,e){this.init(c,b,e*(b-a),e*(d-c))};a.prototype.calc=function(a){var c=a*a;return this.c0+this.c1*a+this.c2*c+this.c3*c*a};return pb.create(function(a){this.points=a||[];this.closed=!1},function(a){var c=this.points;var h=c.length;2>h&&console.log("duh, you need at least 2 points");
a*=h-(this.closed?0:1);var k=Math.floor(a);a-=k;this.closed?k+=0<k?0:(Math.floor(Math.abs(k)/c.length)+1)*c.length:0===a&&k===h-1&&(k=h-2,a=1);var l;this.closed||0<k?l=c[(k-1)%h]:(b.subVectors(c[0],c[1]).add(c[0]),l=b);var n=c[k%h];var m=c[(k+1)%h];this.closed||k+2<h?c=c[(k+2)%h]:(b.subVectors(c[h-1],c[h-2]).add(c[h-1]),c=b);if(void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var r="chordal"===this.type?.5:.25;h=Math.pow(l.distanceToSquared(n),r);k=Math.pow(n.distanceToSquared(m),
r);r=Math.pow(m.distanceToSquared(c),r);1E-4>k&&(k=1);1E-4>h&&(h=k);1E-4>r&&(r=k);d.initNonuniformCatmullRom(l.x,n.x,m.x,c.x,h,k,r);e.initNonuniformCatmullRom(l.y,n.y,m.y,c.y,h,k,r);g.initNonuniformCatmullRom(l.z,n.z,m.z,c.z,h,k,r)}else"catmullrom"===this.type&&(h=void 0!==this.tension?this.tension:.5,d.initCatmullRom(l.x,n.x,m.x,c.x,h),e.initCatmullRom(l.y,n.y,m.y,c.y,h),g.initCatmullRom(l.z,n.z,m.z,c.z,h));return new f(d.calc(a),e.calc(a),g.calc(a))})}();Ae.prototype=Object.create(l.CatmullRomCurve3.prototype);
var Ke=pb.create(function(a){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3");this.points=void 0===a?[]:a},function(a){var c=this.points;a*=c.length-1;var b=Math.floor(a);a-=b;var d=c[0==b?b:b-1],e=c[b],g=c[b>c.length-2?c.length-1:b+1];c=c[b>c.length-3?c.length-1:b+2];b=l.CurveUtils.interpolate;return new f(b(d.x,e.x,g.x,c.x,a),b(d.y,e.y,g.y,c.y,a),b(d.z,e.z,g.z,c.z,a))});l.CubicBezierCurve3=pb.create(function(a,b,d,e){this.v0=a;this.v1=b;this.v2=d;this.v3=
e},function(a){var c=l.ShapeUtils.b3;return new f(c(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),c(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),c(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z))});l.QuadraticBezierCurve3=pb.create(function(a,b,d){this.v0=a;this.v1=b;this.v2=d},function(a){var c=l.ShapeUtils.b2;return new f(c(a,this.v0.x,this.v1.x,this.v2.x),c(a,this.v0.y,this.v1.y,this.v2.y),c(a,this.v0.z,this.v1.z,this.v2.z))});l.LineCurve3=pb.create(function(a,b){this.v1=a;this.v2=b},function(a){if(1===
a)return this.v2.clone();var c=new f;c.subVectors(this.v2,this.v1);c.multiplyScalar(a);c.add(this.v1);return c});Gd.prototype=Object.create(Gc.prototype);Gd.prototype.constructor=Gd;l.SceneUtils={createMultiMaterialObject:function(a,b){for(var c=new zb,d=0,e=b.length;d<e;d++)c.add(new Ca(a,b[d]));return c},detach:function(a,b,d){a.applyMatrix(b.matrixWorld);b.remove(a);d.add(a)},attach:function(a,b,d){var c=new p;c.getInverse(d.matrixWorld);a.applyMatrix(c);b.remove(a);d.add(a)}};Object.assign(Ia.prototype,
{center:function(a){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},size:function(a){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(a)}});Object.assign(sa.prototype,
{center:function(a){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionSphere:function(a){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)},
size:function(a){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(a)}});Object.assign(Wa.prototype,{center:function(a){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");return this.getCenter(a)}});Object.assign(va.prototype,{multiplyVector3:function(a){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");
return this.applyToVector3Array(a)}});Object.assign(p.prototype,{extractPosition:function(a){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},setRotationFromQuaternion:function(a){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},multiplyVector3:function(a){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");
return a.applyProjection(this)},multiplyVector4:function(a){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},rotateAxis:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");
a.transformDirection(this)},crossVector:function(a){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},translate:function(a){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(a){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(a){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(a){console.error("THREE.Matrix4: .rotateZ() has been removed.")},
rotateByAxis:function(a,b){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")}});Object.assign(ya.prototype,{isIntersectionLine:function(a){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(a)}});Object.assign(q.prototype,{multiplyVector3:function(a){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return a.applyQuaternion(this)}});Object.assign(ra.prototype,
{isIntersectionBox:function(a){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionPlane:function(a){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(a)},isIntersectionSphere:function(a){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)}});Object.assign(Tc.prototype,{extrude:function(a){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");
return new ab(this,a)},makeGeometry:function(a){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new Pb(this,a)}});Object.assign(f.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},
getPositionFromMatrix:function(a){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(b,
a)}});Object.assign(ca.prototype,{getChildByName:function(a){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(a)},renderDepth:function(a){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(a,b){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)}});Object.defineProperties(ca.prototype,
{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=a}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(a){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});
Object.defineProperties(ec.prototype,{objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});cb.prototype.setLens=function(a,b){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==b&&(this.filmGauge=b);this.setFocalLength(a)};Object.defineProperties(Ua.prototype,{onlyShadow:{set:function(a){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");
this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=a}},shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");
this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=a}},shadowCameraVisible:{set:function(a){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");
this.shadow.bias=a}},shadowDarkness:{set:function(a){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=a}}});Object.defineProperties(P.prototype,{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");
return this.array.length}}});Object.assign(ia.prototype,{addIndex:function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(a)},addDrawCall:function(a,b,d){void 0!==d&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.");console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(a,b)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");
this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});Object.defineProperties(ia.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}}});
Object.defineProperties(Z.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(a){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},wrapRGB:{get:function(){console.warn("THREE."+this.type+": .wrapRGB has been removed.");return new V}}});Object.defineProperties(Db.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return!1},set:function(a){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});
Object.defineProperties(Aa.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");return this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=a}}});b.prototype=Object.assign(Object.create({constructor:b,apply:function(a){console.warn("THREE.EventDispatcher: .apply is deprecated, just inherit or Object.assign the prototype to mix-in.");
Object.assign(a,this)}}),b.prototype);Object.assign(db.prototype,{supportsFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");
return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},
supportsBlendMinMax:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return this.capabilities.vertexTextures},supportsInstancedArrays:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");
this.setScissorTest(a)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}});Object.defineProperties(db.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},
set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=a}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.");this.shadowMap.cullFace=a}}});Object.defineProperties(Va.prototype,
{cullFace:{get:function(){return this.renderReverseSided?2:1},set:function(a){a=1!==a;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+a+".");this.renderReverseSided=a}}});Object.defineProperties(e.prototype,{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=a}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");
return this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=a}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=a}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},
set:function(a){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=a}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=a}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},
set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=a}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=a}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");
this.texture.format=a}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=a}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");
this.texture.generateMipmaps=a}}});Object.assign(bd.prototype,{load:function(a){console.warn("THREE.Audio: .load has been deprecated. Please use THREE.AudioLoader.");var c=this;(new Wd).load(a,function(a){c.setBuffer(a)});return this}});Object.assign(Zd.prototype,{getData:function(a){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()}});Object.defineProperty(l,"AudioContext",{get:function(){return l.getAudioContext()}});l.WebGLRenderTargetCube=
d;l.WebGLRenderTarget=e;l.WebGLRenderer=db;l.ShaderLib=Xc;l.UniformsLib=ua;l.ShaderChunk=Fa;l.FogExp2=rb;l.Fog=lb;l.Scene=Za;l.LensFlare=gb;l.Sprite=wc;l.LOD=ec;l.SkinnedMesh=Nb;l.Skeleton=Ma;l.Bone=Mb;l.Mesh=Ca;l.LineSegments=Ka;l.Line=xb;l.Points=zc;l.Group=zb;l.VideoTexture=Ab;l.DataTexture=fc;l.CompressedTexture=mb;l.CubeTexture=w;l.CanvasTexture=Yc;l.DepthTexture=Hc;l.TextureIdCount=function(){return ne++};l.Texture=m;l.MaterialIdCount=function(){return se++};l.CompressedTextureLoader=md;l.BinaryTextureLoader=
Ub;l.DataTextureLoader=Ub;l.CubeTextureLoader=Dc;l.TextureLoader=nc;l.ObjectLoader=ue;l.MaterialLoader=Cd;l.BufferGeometryLoader=Qd;l.LoadingManager=Zc;l.JSONLoader=Rd;l.ImageLoader=bc;l.FontLoader=ve;l.XHRLoader=jb;l.Loader=Pc;l.AudioLoader=Wd;l.SpotLightShadow=pc;l.SpotLight=Ec;l.PointLight=Fc;l.HemisphereLight=oc;l.DirectionalLightShadow=qc;l.DirectionalLight=rc;l.AmbientLight=sc;l.LightShadow=Eb;l.Light=Ua;l.StereoCamera=we;l.PerspectiveCamera=cb;l.OrthographicCamera=Gb;l.CubeCamera=Dd;l.Camera=
Ea;l.AudioListener=Xd;l.PositionalAudio=Yd;l.getAudioContext=Ud;l.AudioAnalyser=Zd;l.Audio=bd;l.VectorKeyframeTrack=$c;l.StringKeyframeTrack=zd;l.QuaternionKeyframeTrack=nd;l.NumberKeyframeTrack=ad;l.ColorKeyframeTrack=Bd;l.BooleanKeyframeTrack=Ad;l.PropertyMixer=Ed;l.PropertyBinding=Pa;l.KeyframeTrack=Oc;l.AnimationObjectGroup=$d;l.AnimationMixer=be;l.AnimationClip=Jb;l.Uniform=ce;l.InstancedBufferGeometry=Uc;l.BufferGeometry=ia;l.GeometryIdCount=function(){return xd++};l.Geometry=ma;l.InterleavedBufferAttribute=
de;l.InstancedInterleavedBuffer=dd;l.InterleavedBuffer=cd;l.InstancedBufferAttribute=ed;l.DynamicBufferAttribute=function(a,b){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return(new P(a,b)).setDynamic(!0)};l.Float64Attribute=function(a,b){return new P(new Float64Array(a),b)};l.Float32Attribute=Oa;l.Uint32Attribute=Lb;l.Int32Attribute=function(a,b){return new P(new Int32Array(a),b)};l.Uint16Attribute=pa;l.Int16Attribute=
function(a,b){return new P(new Int16Array(a),b)};l.Uint8ClampedAttribute=function(a,b){return new P(new Uint8ClampedArray(a),b)};l.Uint8Attribute=function(a,b){return new P(new Uint8Array(a),b)};l.Int8Attribute=function(a,b){return new P(new Int8Array(a),b)};l.BufferAttribute=P;l.Face3=ta;l.Object3DIdCount=function(){return te++};l.Object3D=ca;l.Raycaster=ee;l.Layers=Ga;l.EventDispatcher=b;l.Clock=ge;l.QuaternionLinearInterpolant=yd;l.LinearInterpolant=cc;l.DiscreteInterpolant=Nc;l.CubicInterpolant=
tc;l.Interpolant=Na;l.Triangle=Ha;l.Spline=function(a){function c(a,c,b,d,e,f,g){a=.5*(b-a);d=.5*(d-c);return(2*(c-b)+a+d)*g+(-3*(c-b)-2*a-d)*f+a*e+c}this.points=a;var b=[],d={x:0,y:0,z:0},e,g,k,l,n,m,r,p,q;this.initFromArray=function(a){this.points=[];for(var c=0;c<a.length;c++)this.points[c]={x:a[c][0],y:a[c][1],z:a[c][2]}};this.getPoint=function(a){e=(this.points.length-1)*a;g=Math.floor(e);k=e-g;b[0]=0===g?g:g-1;b[1]=g;b[2]=g>this.points.length-2?this.points.length-1:g+1;b[3]=g>this.points.length-
3?this.points.length-1:g+2;m=this.points[b[0]];r=this.points[b[1]];p=this.points[b[2]];q=this.points[b[3]];l=k*k;n=k*l;d.x=c(m.x,r.x,p.x,q.x,k,l,n);d.y=c(m.y,r.y,p.y,q.y,k,l,n);d.z=c(m.z,r.z,p.z,q.z,k,l,n);return d};this.getControlPointsArray=function(){var a,c=this.points.length,b=[];for(a=0;a<c;a++){var d=this.points[a];b[a]=[d.x,d.y,d.z]}return b};this.getLength=function(a){var c=0,b=new f,d=new f,e=[],g=0;e[0]=0;a||(a=100);var h=this.points.length*a;b.copy(this.points[0]);for(a=1;a<h;a++){var k=
a/h;var l=this.getPoint(k);d.copy(l);g+=d.distanceTo(b);b.copy(l);k*=this.points.length-1;k=Math.floor(k);k!==c&&(e[k]=g,c=k)}e[e.length]=g;return{chunks:e,total:g}};this.reparametrizeByArcLength=function(a){var c,b=[],d=new f,e=this.getLength();b.push(d.copy(this.points[0]).clone());for(c=1;c<this.points.length;c++){var g=e.chunks[c]-e.chunks[c-1];var h=Math.ceil(a*g/e.total);var k=(c-1)/(this.points.length-1);var l=c/(this.points.length-1);for(g=1;g<h-1;g++){var n=k+1/h*g*(l-k);n=this.getPoint(n);
b.push(d.copy(n).clone())}b.push(d.copy(this.points[c]).clone())}this.points=b}};l.Spherical=he;l.Plane=ya;l.Frustum=La;l.Sphere=za;l.Ray=ra;l.Matrix4=p;l.Matrix3=va;l.Box3=sa;l.Box2=Ia;l.Line3=Wa;l.Euler=fa;l.Vector4=a;l.Vector3=f;l.Vector2=g;l.Quaternion=q;l.Color=V;l.MorphBlendMesh=kb;l.ImmediateRenderObject=qd;l.VertexNormalsHelper=rd;l.SpotLightHelper=fd;l.SkeletonHelper=gd;l.PointLightHelper=hd;l.HemisphereLightHelper=id;l.GridHelper=sd;l.FaceNormalsHelper=td;l.DirectionalLightHelper=jd;l.CameraHelper=
ud;l.BoundingBoxHelper=vd;l.BoxHelper=wd;l.ArrowHelper=Vc;l.AxisHelper=Fd;l.ClosedSplineCurve3=Ae;l.SplineCurve3=Ke;l.ArcCurve=Gd;l.EllipseCurve=Gc;l.SplineCurve=Qc;l.CubicBezierCurve=Rc;l.QuadraticBezierCurve=Sc;l.LineCurve=vc;l.Shape=Tc;l.ShapePath=Sd;l.Path=pd;l.Font=Td;l.CurvePath=od;l.Curve=pb;l.WireframeGeometry=Ac;l.ParametricGeometry=Vb;l.TetrahedronGeometry=Ic;l.OctahedronGeometry=Jc;l.IcosahedronGeometry=Wb;l.DodecahedronGeometry=Xb;l.PolyhedronGeometry=$a;l.TubeGeometry=hb;l.TorusKnotGeometry=
Kc;l.TorusKnotBufferGeometry=Ob;l.TorusGeometry=Yb;l.TorusBufferGeometry=Bc;l.TextGeometry=Zb;l.SphereBufferGeometry=Ta;l.SphereGeometry=gc;l.RingGeometry=Cc;l.RingBufferGeometry=$b;l.PlaneBufferGeometry=eb;l.PlaneGeometry=hc;l.LatheGeometry=jc;l.LatheBufferGeometry=ic;l.ShapeGeometry=Pb;l.ExtrudeGeometry=ab;l.EdgesGeometry=kc;l.ConeGeometry=Bb;l.ConeBufferGeometry=Hb;l.CylinderGeometry=nb;l.CylinderBufferGeometry=ac;l.CircleBufferGeometry=Cb;l.CircleGeometry=ib;l.BoxBufferGeometry=tb;l.BoxGeometry=
Ib;l.ShadowMaterial=Qb;l.SpriteMaterial=wb;l.RawShaderMaterial=Rb;l.ShaderMaterial=Aa;l.PointsMaterial=yb;l.MultiMaterial=lc;l.MeshPhysicalMaterial=Sb;l.MeshStandardMaterial=vb;l.MeshPhongMaterial=Db;l.MeshNormalMaterial=ob;l.MeshLambertMaterial=Tb;l.MeshDepthMaterial=Da;l.MeshBasicMaterial=oa;l.LineDashedMaterial=mc;l.LineBasicMaterial=Qa;l.Material=Z;l.REVISION="81";l.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};l.CullFaceNone=0;l.CullFaceBack=1;l.CullFaceFront=2;l.CullFaceFrontBack=3;l.FrontFaceDirectionCW=
0;l.FrontFaceDirectionCCW=1;l.BasicShadowMap=0;l.PCFShadowMap=1;l.PCFSoftShadowMap=2;l.FrontSide=0;l.BackSide=1;l.DoubleSide=2;l.FlatShading=1;l.SmoothShading=2;l.NoColors=0;l.FaceColors=1;l.VertexColors=2;l.NoBlending=0;l.NormalBlending=1;l.AdditiveBlending=2;l.SubtractiveBlending=3;l.MultiplyBlending=4;l.CustomBlending=5;l.BlendingMode=Be;l.AddEquation=100;l.SubtractEquation=101;l.ReverseSubtractEquation=102;l.MinEquation=103;l.MaxEquation=104;l.ZeroFactor=200;l.OneFactor=201;l.SrcColorFactor=202;
l.OneMinusSrcColorFactor=203;l.SrcAlphaFactor=204;l.OneMinusSrcAlphaFactor=205;l.DstAlphaFactor=206;l.OneMinusDstAlphaFactor=207;l.DstColorFactor=208;l.OneMinusDstColorFactor=209;l.SrcAlphaSaturateFactor=210;l.NeverDepth=0;l.AlwaysDepth=1;l.LessDepth=2;l.LessEqualDepth=3;l.EqualDepth=4;l.GreaterEqualDepth=5;l.GreaterDepth=6;l.NotEqualDepth=7;l.MultiplyOperation=0;l.MixOperation=1;l.AddOperation=2;l.NoToneMapping=0;l.LinearToneMapping=1;l.ReinhardToneMapping=2;l.Uncharted2ToneMapping=3;l.CineonToneMapping=
4;l.UVMapping=300;l.CubeReflectionMapping=301;l.CubeRefractionMapping=302;l.EquirectangularReflectionMapping=303;l.EquirectangularRefractionMapping=304;l.SphericalReflectionMapping=305;l.CubeUVReflectionMapping=306;l.CubeUVRefractionMapping=307;l.TextureMapping=Ce;l.RepeatWrapping=1E3;l.ClampToEdgeWrapping=1001;l.MirroredRepeatWrapping=1002;l.TextureWrapping=ie;l.NearestFilter=1003;l.NearestMipMapNearestFilter=1004;l.NearestMipMapLinearFilter=1005;l.LinearFilter=1006;l.LinearMipMapNearestFilter=1007;
l.LinearMipMapLinearFilter=1008;l.TextureFilter=je;l.UnsignedByteType=1009;l.ByteType=1010;l.ShortType=1011;l.UnsignedShortType=1012;l.IntType=1013;l.UnsignedIntType=1014;l.FloatType=1015;l.HalfFloatType=1016;l.UnsignedShort4444Type=1017;l.UnsignedShort5551Type=1018;l.UnsignedShort565Type=1019;l.UnsignedInt248Type=1020;l.AlphaFormat=1021;l.RGBFormat=1022;l.RGBAFormat=1023;l.LuminanceFormat=1024;l.LuminanceAlphaFormat=1025;l.RGBEFormat=1023;l.DepthFormat=1026;l.DepthStencilFormat=1027;l.RGB_S3TC_DXT1_Format=
2001;l.RGBA_S3TC_DXT1_Format=2002;l.RGBA_S3TC_DXT3_Format=2003;l.RGBA_S3TC_DXT5_Format=2004;l.RGB_PVRTC_4BPPV1_Format=2100;l.RGB_PVRTC_2BPPV1_Format=2101;l.RGBA_PVRTC_4BPPV1_Format=2102;l.RGBA_PVRTC_2BPPV1_Format=2103;l.RGB_ETC1_Format=2151;l.LoopOnce=2200;l.LoopRepeat=2201;l.LoopPingPong=2202;l.InterpolateDiscrete=2300;l.InterpolateLinear=2301;l.InterpolateSmooth=2302;l.ZeroCurvatureEnding=2400;l.ZeroSlopeEnding=2401;l.WrapAroundEnding=2402;l.TrianglesDrawMode=0;l.TriangleStripDrawMode=1;l.TriangleFanDrawMode=
2;l.LinearEncoding=3E3;l.sRGBEncoding=3001;l.GammaEncoding=3007;l.RGBEEncoding=3002;l.LogLuvEncoding=3003;l.RGBM7Encoding=3004;l.RGBM16Encoding=3005;l.RGBDEncoding=3006;l.BasicDepthPacking=3200;l.RGBADepthPacking=3201;l.CubeGeometry=Ib;l.Face4=function(a,b,d,e,f,g,k){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new ta(a,b,d,f,g,k)};l.LineStrip=0;l.LinePieces=1;l.MeshFaceMaterial=lc;l.PointCloud=function(a,b){console.warn("THREE.PointCloud has been renamed to THREE.Points.");
return new zc(a,b)};l.Particle=wc;l.ParticleSystem=function(a,b){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new zc(a,b)};l.PointCloudMaterial=function(a){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new yb(a)};l.ParticleBasicMaterial=function(a){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new yb(a)};l.ParticleSystemMaterial=function(a){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");
return new yb(a)};l.Vertex=function(a,b,d){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new f(a,b,d)};l.EdgesHelper=function(a,b){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new Ka(new kc(a.geometry),new Qa({color:void 0!==b?b:16777215}))};l.WireframeHelper=function(a,b){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");return new Ka(new Ac(a.geometry),new Qa({color:void 0!==
b?b:16777215}))};l.GeometryUtils={merge:function(a,b,d){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var c;b.isMesh&&(b.matrixAutoUpdate&&b.updateMatrix(),c=b.matrix,b=b.geometry);a.merge(b,c,d)},center:function(a){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return a.center()}};l.ImageUtils={crossOrigin:void 0,loadTexture:function(a,b,d,e){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");
var c=new nc;c.setCrossOrigin(this.crossOrigin);a=c.load(a,d,void 0,e);b&&(a.mapping=b);return a},loadTextureCube:function(a,b,d,e){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var c=new Dc;c.setCrossOrigin(this.crossOrigin);a=c.load(a,d,void 0,e);b&&(a.mapping=b);return a},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};
l.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};l.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");
this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};Object.defineProperty(l,"__esModule",{value:!0})});THREE.SpriteCanvasMaterial=function(l){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(b,g){};this.setValues(l)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;THREE.SpriteCanvasMaterial.prototype.clone=function(){var l=new THREE.SpriteCanvasMaterial;l.copy(this);l.color.copy(this.color);l.program=this.program;return l};
THREE.CanvasRenderer=function(l){function b(a,b,d,e){f(b);p(d);w(e);u(a.getStyle());H.stroke();P.expandByScalar(2*b)}function g(a){k(a.getStyle());H.fill()}function m(a){if(0===a.version||a instanceof THREE.CompressedTexture||a instanceof THREE.DataTexture)return{canvas:void 0,version:a.version};var b=a.image;if(!1===b.complete)return{canvas:void 0,version:0};var d=document.createElement("canvas");d.width=b.width;d.height=b.height;var e=d.getContext("2d");e.setTransform(1,0,0,-1,0,b.height);e.drawImage(b,
0,0);b=a.wrapS===THREE.RepeatWrapping;e=a.wrapT===THREE.RepeatWrapping;var f="no-repeat";!0===b&&!0===e?f="repeat":!0===b?f="repeat-x":!0===e&&(f="repeat-y");d=H.createPattern(d,f);if(a.onUpdate)a.onUpdate(a);return{canvas:d,version:a.version}}function a(a,b,d,e,f,g,l,n,r,p,q,v,u){var x=La[u.id];if(void 0===x||x.version!==u.version)x=m(u),La[u.id]=x;if(void 0!==x.canvas){k(x.canvas);x=u.offset.x/u.repeat.x;var w=u.offset.y/u.repeat.y,z=u.image.width*u.repeat.x;u=u.image.height*u.repeat.y;l=(l+x)*
z;n=(n+w)*u;d-=a;e-=b;f-=a;g-=b;r=(r+x)*z-l;p=(p+w)*u-n;q=(q+x)*z-l;v=(v+w)*u-n;u=r*v-q*p;0!==u&&(x=1/u,u=(v*d-p*f)*x,p=(v*e-p*g)*x,d=(r*f-q*d)*x,e=(r*g-q*e)*x,a=a-u*l-d*n,b=b-p*l-e*n,H.save(),H.transform(u,p,d,e,a,b),H.fill(),H.restore())}else k("rgba( 0, 0, 0, 1)"),H.fill()}function e(a,b,d){var e=b.x-a.x,f=b.y-a.y,g=e*e+f*f;0!==g&&(d/=Math.sqrt(g),e*=d,f*=d,b.x+=e,b.y+=f,a.x-=e,a.y-=f)}function d(a){X!==a&&(X=H.globalAlpha=a)}function q(a){R!==a&&(a===THREE.NormalBlending?H.globalCompositeOperation=
"source-over":a===THREE.AdditiveBlending?H.globalCompositeOperation="lighter":a===THREE.SubtractiveBlending&&(H.globalCompositeOperation="darker"),R=a)}function f(a){S!==a&&(S=H.lineWidth=a)}function p(a){ea!==a&&(ea=H.lineCap=a)}function w(a){U!==a&&(U=H.lineJoin=a)}function u(a){J!==a&&(J=H.strokeStyle=a)}function k(a){T!==a&&(T=H.fillStyle=a)}function r(a){qa.length!==a.length&&(H.setLineDash(a),qa=a)}console.log("THREE.CanvasRenderer",THREE.REVISION);l=l||{};var n=this,v,x,z,A=new THREE.Projector,
D=void 0!==l.canvas?l.canvas:document.createElement("canvas"),E=D.width,F=D.height,G=Math.floor(E/2),K=Math.floor(F/2),I=0,B=0,Q=E,O=F,L=1,H=D.getContext("2d",{alpha:!0===l.alpha}),W=new THREE.Color(0),ba=!0===l.alpha?0:1,X=1,R=0,J=null,T=null,S=null,ea=null,U=null,qa=[],ha,ja,V;new THREE.RenderableVertex;new THREE.RenderableVertex;var Ia,na,wa,Z,Aa,Da,sa=new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;new THREE.Color;var za=new THREE.Color,va=new THREE.Color,ya=new THREE.Color,La=
{},Va,ra,fa,Ga,ca,Wa,Ha,ta=new THREE.Box2,oa=new THREE.Box2,P=new THREE.Box2,pa=new THREE.Color,Lb=new THREE.Color,Oa=new THREE.Color,ma=new THREE.Vector3,sb=new THREE.Vector3,ia=new THREE.Vector3,Ca=new THREE.Matrix3;void 0===H.setLineDash&&(H.setLineDash=function(){});this.domElement=D;this.sortElements=this.sortObjects=this.autoClear=!0;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getContext=function(){return H};this.getContextAttributes=
function(){return H.getContextAttributes()};this.getPixelRatio=function(){return L};this.setPixelRatio=function(a){void 0!==a&&(L=a)};this.setSize=function(a,b,d){E=a*L;F=b*L;D.width=E;D.height=F;G=Math.floor(E/2);K=Math.floor(F/2);!1!==d&&(D.style.width=a+"px",D.style.height=b+"px");ta.min.set(-G,-K);ta.max.set(G,K);oa.min.set(-G,-K);oa.max.set(G,K);X=1;R=0;U=ea=S=T=J=null;this.setViewport(0,0,a,b)};this.setViewport=function(a,b,d,e){I=a*L;B=b*L;Q=d*L;O=e*L};this.setScissor=function(){};this.setScissorTest=
function(){};this.setClearColor=function(a,b){W.set(a);ba=void 0!==b?b:1;oa.min.set(-G,-K);oa.max.set(G,K)};this.setClearColorHex=function(a,b){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(a,b)};this.getClearColor=function(){return W};this.getClearAlpha=function(){return ba};this.getMaxAnisotropy=function(){return 0};this.clear=function(){!1===oa.isEmpty()&&(oa.intersect(ta),oa.expandByScalar(2),oa.min.x+=G,oa.min.y=-oa.min.y+
K,oa.max.x+=G,oa.max.y=-oa.max.y+K,1>ba&&H.clearRect(oa.min.x|0,oa.max.y|0,oa.max.x-oa.min.x|0,oa.min.y-oa.max.y|0),0<ba&&(q(THREE.NormalBlending),d(1),k("rgba("+Math.floor(255*W.r)+","+Math.floor(255*W.g)+","+Math.floor(255*W.b)+","+ba+")"),H.fillRect(oa.min.x|0,oa.max.y|0,oa.max.x-oa.min.x|0,oa.min.y-oa.max.y|0)),oa.makeEmpty())};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(l,D){if(!1===D instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");
else{!0===this.autoClear&&this.clear();n.info.render.vertices=0;n.info.render.faces=0;H.setTransform(Q/E,0,0,-O/F,I,F-B);H.translate(G,K);v=A.projectScene(l,D,this.sortObjects,this.sortElements);x=v.elements;z=v.lights;Ca.getNormalMatrix(D.matrixWorldInverse);pa.setRGB(0,0,0);Lb.setRGB(0,0,0);Oa.setRGB(0,0,0);for(var R=0,ea=z.length;R<ea;R++){var J=z[R],T=J.color;J instanceof THREE.AmbientLight?pa.add(T):J instanceof THREE.DirectionalLight?Lb.add(T):J instanceof THREE.PointLight&&Oa.add(T)}R=0;for(ea=
x.length;R<ea;R++){var L=x[R],S=L.material;if(void 0!==S&&0!==S.opacity){P.makeEmpty();if(L instanceof THREE.RenderableSprite){ha=L;ha.x*=G;ha.y*=K;J=ha;var U=L;T=S;d(T.opacity);q(T.blending);var W=U.scale.x*G;U=U.scale.y*K;L=.5*Math.sqrt(W*W+U*U);P.min.set(J.x-L,J.y-L);P.max.set(J.x+L,J.y+L);if(T instanceof THREE.SpriteMaterial){var X=T.map;if(null!==X){L=La[X.id];if(void 0===L||L.version!==X.version)L=m(X),La[X.id]=L;if(void 0!==L.canvas){k(L.canvas);var ba=X.image;L=ba.width*X.offset.x;S=ba.height*
X.offset.y;var qa=ba.width*X.repeat.x;X=ba.height*X.repeat.y;ba=W/qa;var eb=U/X;H.save();H.translate(J.x,J.y);0!==T.rotation&&H.rotate(T.rotation);H.translate(-W/2,-U/2);H.scale(ba,eb);H.translate(-L,-S);H.fillRect(L,S,qa,X);H.restore()}}else k(T.color.getStyle()),H.save(),H.translate(J.x,J.y),0!==T.rotation&&H.rotate(T.rotation),H.scale(W,-U),H.fillRect(-.5,-.5,1,1),H.restore()}else T instanceof THREE.SpriteCanvasMaterial&&(u(T.color.getStyle()),k(T.color.getStyle()),H.save(),H.translate(J.x,J.y),
0!==T.rotation&&H.rotate(T.rotation),H.scale(W,U),T.program(H),H.restore())}else if(L instanceof THREE.RenderableLine){if(ha=L.v1,ja=L.v2,ha.positionScreen.x*=G,ha.positionScreen.y*=K,ja.positionScreen.x*=G,ja.positionScreen.y*=K,P.setFromPoints([ha.positionScreen,ja.positionScreen]),!0===ta.intersectsBox(P))if(J=ha,T=ja,W=L,U=S,d(U.opacity),q(U.blending),H.beginPath(),H.moveTo(J.positionScreen.x,J.positionScreen.y),H.lineTo(T.positionScreen.x,T.positionScreen.y),U instanceof THREE.LineBasicMaterial){f(U.linewidth);
p(U.linecap);w(U.linejoin);if(U.vertexColors!==THREE.VertexColors)u(U.color.getStyle());else if(L=W.vertexColors[0].getStyle(),W=W.vertexColors[1].getStyle(),L===W)u(L);else{try{var tb=H.createLinearGradient(J.positionScreen.x,J.positionScreen.y,T.positionScreen.x,T.positionScreen.y);tb.addColorStop(0,L);tb.addColorStop(1,W)}catch(Wc){tb=L}u(tb)}H.stroke();P.expandByScalar(2*U.linewidth)}else U instanceof THREE.LineDashedMaterial&&(f(U.linewidth),p(U.linecap),w(U.linejoin),u(U.color.getStyle()),r([U.dashSize,
U.gapSize]),H.stroke(),P.expandByScalar(2*U.linewidth),r([]))}else if(L instanceof THREE.RenderableFace){ha=L.v1;ja=L.v2;V=L.v3;if(-1>ha.positionScreen.z||1<ha.positionScreen.z)continue;if(-1>ja.positionScreen.z||1<ja.positionScreen.z)continue;if(-1>V.positionScreen.z||1<V.positionScreen.z)continue;ha.positionScreen.x*=G;ha.positionScreen.y*=K;ja.positionScreen.x*=G;ja.positionScreen.y*=K;V.positionScreen.x*=G;V.positionScreen.y*=K;0<S.overdraw&&(e(ha.positionScreen,ja.positionScreen,S.overdraw),
e(ja.positionScreen,V.positionScreen,S.overdraw),e(V.positionScreen,ha.positionScreen,S.overdraw));P.setFromPoints([ha.positionScreen,ja.positionScreen,V.positionScreen]);if(!0===ta.intersectsBox(P)){T=ha;W=ja;U=V;J=S;n.info.render.vertices+=3;n.info.render.faces++;d(J.opacity);q(J.blending);Ia=T.positionScreen.x;na=T.positionScreen.y;wa=W.positionScreen.x;Z=W.positionScreen.y;Aa=U.positionScreen.x;Da=U.positionScreen.y;S=Ia;qa=na;X=wa;ba=Z;eb=Aa;var Hd=Da;H.beginPath();H.moveTo(S,qa);H.lineTo(X,
ba);H.lineTo(eb,Hd);H.closePath();if((J instanceof THREE.MeshLambertMaterial||J instanceof THREE.MeshPhongMaterial)&&null===J.map){za.copy(J.color);va.copy(J.emissive);J.vertexColors===THREE.FaceColors&&za.multiply(L.color);sa.copy(pa);sb.copy(T.positionWorld).add(W.positionWorld).add(U.positionWorld).divideScalar(3);T=sb;W=L.normalModel;U=sa;L=0;for(S=z.length;L<S;L++)qa=z[L],ya.copy(qa.color),qa instanceof THREE.DirectionalLight?(X=ma.setFromMatrixPosition(qa.matrixWorld).normalize(),ba=W.dot(X),
0>=ba||(ba*=qa.intensity,U.add(ya.multiplyScalar(ba)))):qa instanceof THREE.PointLight&&(X=ma.setFromMatrixPosition(qa.matrixWorld),ba=W.dot(ma.subVectors(X,T).normalize()),0>=ba||(ba*=0==qa.distance?1:1-Math.min(T.distanceTo(X)/qa.distance,1),0!=ba&&(ba*=qa.intensity,U.add(ya.multiplyScalar(ba)))));sa.multiply(za).add(va);!0===J.wireframe?b(sa,J.wireframeLinewidth,J.wireframeLinecap,J.wireframeLinejoin):g(sa)}else J instanceof THREE.MeshBasicMaterial||J instanceof THREE.MeshLambertMaterial||J instanceof
THREE.MeshPhongMaterial?null!==J.map?J.map.mapping===THREE.UVMapping&&(Va=L.uvs,a(Ia,na,wa,Z,Aa,Da,Va[0].x,Va[0].y,Va[1].x,Va[1].y,Va[2].x,Va[2].y,J.map)):null!==J.envMap?J.envMap.mapping===THREE.SphericalReflectionMapping&&(ia.copy(L.vertexNormalsModel[0]).applyMatrix3(Ca),ra=.5*ia.x+.5,fa=.5*ia.y+.5,ia.copy(L.vertexNormalsModel[1]).applyMatrix3(Ca),Ga=.5*ia.x+.5,ca=.5*ia.y+.5,ia.copy(L.vertexNormalsModel[2]).applyMatrix3(Ca),Wa=.5*ia.x+.5,Ha=.5*ia.y+.5,a(Ia,na,wa,Z,Aa,Da,ra,fa,Ga,ca,Wa,Ha,J.envMap)):
(sa.copy(J.color),J.vertexColors===THREE.FaceColors&&sa.multiply(L.color),!0===J.wireframe?b(sa,J.wireframeLinewidth,J.wireframeLinecap,J.wireframeLinejoin):g(sa)):(J instanceof THREE.MeshNormalMaterial?(ia.copy(L.normalModel).applyMatrix3(Ca),sa.setRGB(ia.x,ia.y,ia.z).multiplyScalar(.5).addScalar(.5)):sa.setRGB(1,1,1),!0===J.wireframe?b(sa,J.wireframeLinewidth,J.wireframeLinecap,J.wireframeLinejoin):g(sa))}}oa.union(P)}}H.setTransform(1,0,0,1,0,0)}}};var dat=dat||{};dat.gui=dat.gui||{};
dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};dat.utils.css=function(){return{load:function(l,b){b=b||document;var g=b.createElement("link");g.type="text/css";g.rel="stylesheet";g.href=l;b.getElementsByTagName("head")[0].appendChild(g)},inject:function(l,b){b=b||document;var g=document.createElement("style");g.type="text/css";g.innerHTML=l;b.getElementsByTagName("head")[0].appendChild(g)}}}();
dat.utils.common=function(){var l=Array.prototype.forEach,b=Array.prototype.slice;return{BREAK:{},extend:function(g){this.each(b.call(arguments,1),function(b){for(var a in b)this.isUndefined(b[a])||(g[a]=b[a])},this);return g},defaults:function(g){this.each(b.call(arguments,1),function(b){for(var a in b)this.isUndefined(g[a])&&(g[a]=b[a])},this);return g},compose:function(){var g=b.call(arguments);return function(){for(var l=b.call(arguments),a=g.length-1;0<=a;a--)l=[g[a].apply(this,l)];return l[0]}},
each:function(b,m,a){if(l&&b.forEach===l)b.forEach(m,a);else if(b.length===b.length+0)for(var e=0,d=b.length;e<d&&!(e in b&&m.call(a,b[e],e)===this.BREAK);e++);else for(e in b)if(m.call(a,b[e],e)===this.BREAK)break},defer:function(b){setTimeout(b,0)},toArray:function(g){return g.toArray?g.toArray():b.call(g)},isUndefined:function(b){return void 0===b},isNull:function(b){return null===b},isNaN:function(b){return b!==b},isArray:Array.isArray||function(b){return b.constructor===Array},isObject:function(b){return b===
Object(b)},isNumber:function(b){return b===b+0},isString:function(b){return b===b+""},isBoolean:function(b){return!1===b||!0===b},isFunction:function(b){return"[object Function]"===Object.prototype.toString.call(b)}}}();
dat.controllers.Controller=function(l){var b=function(b,l){this.initialValue=b[l];this.domElement=document.createElement("div");this.object=b;this.property=l;this.__onFinishChange=this.__onChange=void 0};l.extend(b.prototype,{onChange:function(b){this.__onChange=b;return this},onFinishChange:function(b){this.__onFinishChange=b;return this},setValue:function(b){this.object[this.property]=b;this.__onChange&&this.__onChange.call(this,b);this.updateDisplay();return this},getValue:function(){return this.object[this.property]},
updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return b}(dat.utils.common);
dat.dom.dom=function(l){function b(a){if("0"===a||l.isUndefined(a))return 0;a=a.match(m);return l.isNull(a)?0:parseFloat(a[1])}var g={};l.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(a,b){l.each(a,function(a){g[a]=b})});var m=/(\d+(\.\d+)?)px/,a={makeSelectable:function(a,b){void 0!==a&&void 0!==a.style&&(a.onselectstart=b?function(){return!1}:function(){},a.style.MozUserSelect=b?"auto":"none",a.style.KhtmlUserSelect=
b?"auto":"none",a.unselectable=b?"on":"off")},makeFullscreen:function(a,b,g){l.isUndefined(b)&&(b=!0);l.isUndefined(g)&&(g=!0);a.style.position="absolute";b&&(a.style.left=0,a.style.right=0);g&&(a.style.top=0,a.style.bottom=0)},fakeEvent:function(a,b,m,f){m=m||{};var d=g[b];if(!d)throw Error("Event type "+b+" not supported.");var e=document.createEvent(d);switch(d){case "MouseEvents":e.initMouseEvent(b,m.bubbles||!1,m.cancelable||!0,window,m.clickCount||1,0,0,m.x||m.clientX||0,m.y||m.clientY||0,!1,
!1,!1,!1,0,null);break;case "KeyboardEvents":d=e.initKeyboardEvent||e.initKeyEvent;l.defaults(m,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0});d(b,m.bubbles||!1,m.cancelable,window,m.ctrlKey,m.altKey,m.shiftKey,m.metaKey,m.keyCode,m.charCode);break;default:e.initEvent(b,m.bubbles||!1,m.cancelable||!0)}l.defaults(e,f);a.dispatchEvent(e)},bind:function(b,d,g,f){b.addEventListener?b.addEventListener(d,g,f||!1):b.attachEvent&&b.attachEvent("on"+d,g);return a},
unbind:function(b,d,g,f){b.removeEventListener?b.removeEventListener(d,g,f||!1):b.detachEvent&&b.detachEvent("on"+d,g);return a},addClass:function(b,d){if(void 0===b.className)b.className=d;else if(b.className!==d){var e=b.className.split(/ +/);-1==e.indexOf(d)&&(e.push(d),b.className=e.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return a},removeClass:function(b,d){if(d){if(void 0!==b.className)if(b.className===d)b.removeAttribute("class");else{var e=b.className.split(/ +/),f=e.indexOf(d);-1!=
f&&(e.splice(f,1),b.className=e.join(" "))}}else b.className=void 0;return a},hasClass:function(a,b){return(new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)")).test(a.className)||!1},getWidth:function(a){a=getComputedStyle(a);return b(a["border-left-width"])+b(a["border-right-width"])+b(a["padding-left"])+b(a["padding-right"])+b(a.width)},getHeight:function(a){a=getComputedStyle(a);return b(a["border-top-width"])+b(a["border-bottom-width"])+b(a["padding-top"])+b(a["padding-bottom"])+b(a.height)},getOffset:function(a){var b=
{left:0,top:0};if(a.offsetParent){do b.left+=a.offsetLeft,b.top+=a.offsetTop;while(a=a.offsetParent)}return b},isActive:function(a){return a===document.activeElement&&(a.type||a.href)}};return a}(dat.utils.common);
dat.controllers.OptionController=function(l,b,g){var m=function(a,e,d){m.superclass.call(this,a,e);var l=this;this.__select=document.createElement("select");if(g.isArray(d)){var f={};g.each(d,function(a){f[a]=a});d=f}g.each(d,function(a,b){var d=document.createElement("option");d.innerHTML=b;d.setAttribute("value",a);l.__select.appendChild(d)});this.updateDisplay();b.bind(this.__select,"change",function(){l.setValue(this.options[this.selectedIndex].value)});this.domElement.appendChild(this.__select)};
m.superclass=l;g.extend(m.prototype,l.prototype,{setValue:function(a){a=m.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());return a},updateDisplay:function(){this.__select.value=this.getValue();return m.superclass.prototype.updateDisplay.call(this)}});return m}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.NumberController=function(l,b){var g=function(l,a,e){g.superclass.call(this,l,a);e=e||{};this.__min=e.min;this.__max=e.max;this.__step=e.step;b.isUndefined(this.__step)?this.__impliedStep=0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step;l=this.__impliedStep;l=l.toString();l=-1<l.indexOf(".")?l.length-l.indexOf(".")-1:0;this.__precision=l};g.superclass=l;b.extend(g.prototype,l.prototype,{setValue:function(b){void 0!==
this.__min&&b<this.__min?b=this.__min:void 0!==this.__max&&b>this.__max&&(b=this.__max);void 0!==this.__step&&0!=b%this.__step&&(b=Math.round(b/this.__step)*this.__step);return g.superclass.prototype.setValue.call(this,b)},min:function(b){this.__min=b;return this},max:function(b){this.__max=b;return this},step:function(b){this.__step=b;return this}});return g}(dat.controllers.Controller,dat.utils.common);
dat.controllers.NumberControllerBox=function(l,b,g){var m=function(a,e,d){function l(){var a=parseFloat(w.__input.value);g.isNaN(a)||w.setValue(a)}function f(a){var b=u-a.clientY;w.setValue(w.getValue()+b*w.__impliedStep);u=a.clientY}function p(){b.unbind(window,"mousemove",f);b.unbind(window,"mouseup",p)}this.__truncationSuspended=!1;m.superclass.call(this,a,e,d);var w=this,u;this.__input=document.createElement("input");this.__input.setAttribute("type","text");b.bind(this.__input,"change",l);b.bind(this.__input,
"blur",function(){l();w.__onFinishChange&&w.__onFinishChange.call(w,w.getValue())});b.bind(this.__input,"mousedown",function(a){b.bind(window,"mousemove",f);b.bind(window,"mouseup",p);u=a.clientY});b.bind(this.__input,"keydown",function(a){13===a.keyCode&&(w.__truncationSuspended=!0,this.blur(),w.__truncationSuspended=!1)});this.updateDisplay();this.domElement.appendChild(this.__input)};m.superclass=l;g.extend(m.prototype,l.prototype,{updateDisplay:function(){var a=this.__input;if(this.__truncationSuspended)var b=
this.getValue();else{b=this.getValue();var d=Math.pow(10,this.__precision);b=Math.round(b*d)/d}a.value=b;return m.superclass.prototype.updateDisplay.call(this)}});return m}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);
dat.controllers.NumberControllerSlider=function(l,b,g,m,a){function e(a,b,d,e,g){return e+(a-b)/(d-b)*(g-e)}var d=function(a,f,g,l,m){function k(a){a.preventDefault();var d=b.getOffset(n.__background),f=b.getWidth(n.__background);n.setValue(e(a.clientX,d.left,d.left+f,n.__min,n.__max));return!1}function r(){b.unbind(window,"mousemove",k);b.unbind(window,"mouseup",r);n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}d.superclass.call(this,a,f,{min:g,max:l,step:m});var n=this;this.__background=
document.createElement("div");this.__foreground=document.createElement("div");b.bind(this.__background,"mousedown",function(a){b.bind(window,"mousemove",k);b.bind(window,"mouseup",r);k(a)});b.addClass(this.__background,"slider");b.addClass(this.__foreground,"slider-fg");this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};d.superclass=l;d.useDefaultStyles=function(){g.inject(a)};m.extend(d.prototype,l.prototype,{updateDisplay:function(){var a=
(this.getValue()-this.__min)/(this.__max-this.__min);this.__foreground.style.width=100*a+"%";return d.superclass.prototype.updateDisplay.call(this)}});return d}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");
dat.controllers.FunctionController=function(l,b,g){var m=function(a,e,d){m.superclass.call(this,a,e);var g=this;this.__button=document.createElement("div");this.__button.innerHTML=void 0===d?"Fire":d;b.bind(this.__button,"click",function(a){a.preventDefault();g.fire();return!1});b.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};m.superclass=l;g.extend(m.prototype,l.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this);this.__onFinishChange&&this.__onFinishChange.call(this,
this.getValue());this.getValue().call(this.object)}});return m}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.BooleanController=function(l,b,g){var m=function(a,e){m.superclass.call(this,a,e);var d=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");b.bind(this.__checkbox,"change",function(){d.setValue(!d.__prev)},!1);this.domElement.appendChild(this.__checkbox);this.updateDisplay()};m.superclass=l;g.extend(m.prototype,l.prototype,{setValue:function(a){a=m.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&
this.__onFinishChange.call(this,this.getValue());this.__prev=this.getValue();return a},updateDisplay:function(){!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1;return m.superclass.prototype.updateDisplay.call(this)}});return m}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.color.toString=function(l){return function(b){if(1==b.a||l.isUndefined(b.a)){for(b=b.hex.toString(16);6>b.length;)b="0"+b;return"#"+b}return"rgba("+Math.round(b.r)+","+Math.round(b.g)+","+Math.round(b.b)+","+b.a+")"}}(dat.utils.common);
dat.color.interpret=function(l,b){var g,m,a=[{litmus:b.isString,conversions:{THREE_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString()+a[1].toString()+a[2].toString()+a[2].toString()+a[3].toString()+a[3].toString())}},write:l},SIX_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9]{6})$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString())}},write:l},CSS_RGB:{read:function(a){a=a.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3])}},write:l},CSS_RGBA:{read:function(a){a=a.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3]),a:parseFloat(a[4])}},write:l}}},{litmus:b.isNumber,conversions:{HEX:{read:function(a){return{space:"HEX",hex:a,conversionName:"HEX"}},write:function(a){return a.hex}}}},{litmus:b.isArray,conversions:{RGB_ARRAY:{read:function(a){return 3!=
a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2]}},write:function(a){return[a.r,a.g,a.b]}},RGBA_ARRAY:{read:function(a){return 4!=a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2],a:a[3]}},write:function(a){return[a.r,a.g,a.b,a.a]}}}},{litmus:b.isObject,conversions:{RGBA_OBJ:{read:function(a){return b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)&&b.isNumber(a.a)?{space:"RGB",r:a.r,g:a.g,b:a.b,a:a.a}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b,a:a.a}}},RGB_OBJ:{read:function(a){return b.isNumber(a.r)&&
b.isNumber(a.g)&&b.isNumber(a.b)?{space:"RGB",r:a.r,g:a.g,b:a.b}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b}}},HSVA_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)&&b.isNumber(a.a)?{space:"HSV",h:a.h,s:a.s,v:a.v,a:a.a}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v,a:a.a}}},HSV_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)?{space:"HSV",h:a.h,s:a.s,v:a.v}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v}}}}}];return function(){m=!1;
var e=1<arguments.length?b.toArray(arguments):arguments[0];b.each(a,function(a){if(a.litmus(e))return b.each(a.conversions,function(a,d){g=a.read(e);if(!1===m&&!1!==g)return m=g,g.conversionName=d,g.conversion=a,b.BREAK}),b.BREAK});return m}}(dat.color.toString,dat.utils.common);
dat.GUI=dat.gui.GUI=function(l,b,g,m,a,e,d,q,f,p,w,u,k,r,n){function v(b,d,e,f){if(void 0===d[e])throw Error("Object "+d+' has no property "'+e+'"');f.color?d=new w(d,e):(d=[d,e].concat(f.factoryArgs),d=m.apply(b,d));f.before instanceof a&&(f.before=f.before.__li);A(b,d);r.addClass(d.domElement,"c");e=document.createElement("span");r.addClass(e,"property-name");e.innerHTML=d.property;var g=document.createElement("div");g.appendChild(e);g.appendChild(d.domElement);f=x(b,g,f.before);r.addClass(f,X.CLASS_CONTROLLER_ROW);
r.addClass(f,typeof d.getValue());z(b,f,d);b.__controllers.push(d);return d}function x(a,b,d){var e=document.createElement("li");b&&e.appendChild(b);d?a.__ul.insertBefore(e,params.before):a.__ul.appendChild(e);a.onResize();return e}function z(a,b,g){g.__li=b;g.__gui=a;n.extend(g,{options:function(b){if(1<arguments.length)return g.remove(),v(a,g.object,g.property,{before:g.__li.nextElementSibling,factoryArgs:[n.toArray(arguments)]});if(n.isArray(b)||n.isObject(b))return g.remove(),v(a,g.object,g.property,
{before:g.__li.nextElementSibling,factoryArgs:[b]})},name:function(a){g.__li.firstElementChild.firstElementChild.innerHTML=a;return g},listen:function(){g.__gui.listen(g);return g},remove:function(){g.__gui.remove(g);return g}});if(g instanceof f){var k=new q(g.object,g.property,{min:g.__min,max:g.__max,step:g.__step});n.each(["updateDisplay","onChange","onFinishChange"],function(a){var b=g[a],d=k[a];g[a]=k[a]=function(){var a=Array.prototype.slice.call(arguments);b.apply(g,a);return d.apply(k,a)}});
r.addClass(b,"has-slider");g.domElement.insertBefore(k.domElement,g.domElement.firstElementChild)}else if(g instanceof q){var l=function(b){return n.isNumber(g.__min)&&n.isNumber(g.__max)?(g.remove(),v(a,g.object,g.property,{before:g.__li.nextElementSibling,factoryArgs:[g.__min,g.__max,g.__step]})):b};g.min=n.compose(l,g.min);g.max=n.compose(l,g.max)}else g instanceof e?(r.bind(b,"click",function(){r.fakeEvent(g.__checkbox,"click")}),r.bind(g.__checkbox,"click",function(a){a.stopPropagation()})):
g instanceof d?(r.bind(b,"click",function(){r.fakeEvent(g.__button,"click")}),r.bind(b,"mouseover",function(){r.addClass(g.__button,"hover")}),r.bind(b,"mouseout",function(){r.removeClass(g.__button,"hover")})):g instanceof w&&(r.addClass(b,"color"),g.updateDisplay=n.compose(function(a){b.style.borderLeftColor=g.__color.toString();return a},g.updateDisplay),g.updateDisplay());g.setValue=n.compose(function(b){a.getRoot().__preset_select&&g.isModified()&&I(a.getRoot(),!0);return b},g.setValue)}function A(a,
b){var d=a.getRoot(),e=d.__rememberedObjects.indexOf(b.object);if(-1!=e){var f=d.__rememberedObjectIndecesToControllers[e];void 0===f&&(f={},d.__rememberedObjectIndecesToControllers[e]=f);f[b.property]=b;if(d.load&&d.load.remembered){d=d.load.remembered;if(d[a.preset])d=d[a.preset];else if(d.Default)d=d.Default;else return;d[e]&&void 0!==d[e][b.property]&&(e=d[e][b.property],b.initialValue=e,b.setValue(e))}}}function D(a){var b=a.__save_row=document.createElement("li");r.addClass(a.domElement,"has-save");
a.__ul.insertBefore(b,a.__ul.firstChild);r.addClass(b,"save-row");var d=document.createElement("span");d.innerHTML="&nbsp;";r.addClass(d,"button gears");var e=document.createElement("span");e.innerHTML="Save";r.addClass(e,"button");r.addClass(e,"save");var f=document.createElement("span");f.innerHTML="New";r.addClass(f,"button");r.addClass(f,"save-as");var g=document.createElement("span");g.innerHTML="Revert";r.addClass(g,"button");r.addClass(g,"revert");var k=a.__preset_select=document.createElement("select");
a.load&&a.load.remembered?n.each(a.load.remembered,function(b,d){K(a,d,d==a.preset)}):K(a,"Default",!1);r.bind(k,"change",function(){for(var b=0;b<a.__preset_select.length;b++)a.__preset_select[b].innerHTML=a.__preset_select[b].value;a.preset=this.value});b.appendChild(k);b.appendChild(d);b.appendChild(e);b.appendChild(f);b.appendChild(g);if(Q){var l=function(){m.style.display=a.useLocalStorage?"block":"none"};b=document.getElementById("dg-save-locally");var m=document.getElementById("dg-local-explain");
b.style.display="block";b=document.getElementById("dg-local-storage");"true"===localStorage.getItem(document.location.href+".isLocal")&&b.setAttribute("checked","checked");l();r.bind(b,"change",function(){a.useLocalStorage=!a.useLocalStorage;l()})}var p=document.getElementById("dg-new-constructor");r.bind(p,"keydown",function(a){!a.metaKey||67!==a.which&&67!=a.keyCode||O.hide()});r.bind(d,"click",function(){p.innerHTML=JSON.stringify(a.getSaveObject(),void 0,2);O.show();p.focus();p.select()});r.bind(e,
"click",function(){a.save()});r.bind(f,"click",function(){var b=prompt("Enter a new preset name.");b&&a.saveAs(b)});r.bind(g,"click",function(){a.revert()})}function E(a){function b(b){b.preventDefault();f=b.clientX;r.addClass(a.__closeButton,X.CLASS_DRAG);r.bind(window,"mousemove",d);r.bind(window,"mouseup",e);return!1}function d(b){b.preventDefault();a.width+=f-b.clientX;a.onResize();f=b.clientX;return!1}function e(){r.removeClass(a.__closeButton,X.CLASS_DRAG);r.unbind(window,"mousemove",d);r.unbind(window,
"mouseup",e)}a.__resize_handle=document.createElement("div");n.extend(a.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var f;r.bind(a.__resize_handle,"mousedown",b);r.bind(a.__closeButton,"mousedown",b);a.domElement.insertBefore(a.__resize_handle,a.domElement.firstElementChild)}function F(a,b){a.domElement.style.width=b+"px";a.__save_row&&a.autoPlace&&(a.__save_row.style.width=b+"px");a.__closeButton&&(a.__closeButton.style.width=b+"px")}
function G(a,b){var d={};n.each(a.__rememberedObjects,function(e,f){var g={};n.each(a.__rememberedObjectIndecesToControllers[f],function(a,d){g[d]=b?a.initialValue:a.getValue()});d[f]=g});return d}function K(a,b,d){var e=document.createElement("option");e.innerHTML=b;e.value=b;a.__preset_select.appendChild(e);d&&(a.__preset_select.selectedIndex=a.__preset_select.length-1)}function I(a,b){var d=a.__preset_select[a.__preset_select.selectedIndex];d.innerHTML=b?d.value+"*":d.value}function B(a){0!=a.length&&
u(function(){B(a)});n.each(a,function(a){a.updateDisplay()})}l.inject(g);try{var Q="localStorage"in window&&null!==window.localStorage}catch(R){Q=!1}var O,L=!0,H,W=!1,ba=[],X=function(a){function b(){localStorage.setItem(document.location.href+".gui",JSON.stringify(e.getSaveObject()))}function d(){var a=e.getRoot();a.width+=1;n.defer(function(){--a.width})}var e=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);r.addClass(this.domElement,
"dg");this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];a=a||{};a=n.defaults(a,{autoPlace:!0,width:X.DEFAULT_WIDTH});a=n.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace});n.isUndefined(a.load)?a.load={preset:"Default"}:a.preset&&(a.load.preset=a.preset);n.isUndefined(a.parent)&&a.hideable&&ba.push(this);a.resizable=n.isUndefined(a.parent)&&a.resizable;a.autoPlace&&n.isUndefined(a.scrollable)&&(a.scrollable=
!0);var f=Q&&"true"===localStorage.getItem(document.location.href+".isLocal");Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},preset:{get:function(){return e.parent?e.getRoot().preset:a.load.preset},set:function(b){e.parent?e.getRoot().preset=b:a.load.preset=b;for(b=0;b<this.__preset_select.length;b++)this.__preset_select[b].value==this.preset&&(this.__preset_select.selectedIndex=
b);e.revert()}},width:{get:function(){return a.width},set:function(b){a.width=b;F(e,b)}},name:{get:function(){return a.name},set:function(b){a.name=b;k&&(k.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(b){a.closed=b;a.closed?r.addClass(e.__ul,X.CLASS_CLOSED):r.removeClass(e.__ul,X.CLASS_CLOSED);this.onResize();e.__closeButton&&(e.__closeButton.innerHTML=b?X.TEXT_OPEN:X.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return f},set:function(a){Q&&
((f=a)?r.bind(window,"unload",b):r.unbind(window,"unload",b),localStorage.setItem(document.location.href+".isLocal",a))}}});if(n.isUndefined(a.parent)){a.closed=!1;r.addClass(this.domElement,X.CLASS_MAIN);r.makeSelectable(this.domElement,!1);if(Q&&f){e.useLocalStorage=!0;var g=localStorage.getItem(document.location.href+".gui");g&&(a.load=JSON.parse(g))}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=X.TEXT_CLOSED;r.addClass(this.__closeButton,X.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);
r.bind(this.__closeButton,"click",function(){e.closed=!e.closed})}else{void 0===a.closed&&(a.closed=!0);var k=document.createTextNode(a.name);r.addClass(k,"controller-name");g=x(e,k);r.addClass(this.__ul,X.CLASS_CLOSED);r.addClass(g,"title");r.bind(g,"click",function(a){a.preventDefault();e.closed=!e.closed;return!1});a.closed||(this.closed=!1)}a.autoPlace&&(n.isUndefined(a.parent)&&(L&&(H=document.createElement("div"),r.addClass(H,"dg"),r.addClass(H,X.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(H),
L=!1),H.appendChild(this.domElement),r.addClass(this.domElement,X.CLASS_AUTO_PLACE)),this.parent||F(e,a.width));r.bind(window,"resize",function(){e.onResize()});r.bind(this.__ul,"webkitTransitionEnd",function(){e.onResize()});r.bind(this.__ul,"transitionend",function(){e.onResize()});r.bind(this.__ul,"oTransitionEnd",function(){e.onResize()});this.onResize();a.resizable&&E(this);e.getRoot();a.parent||d()};X.toggleHide=function(){W=!W;n.each(ba,function(a){a.domElement.style.zIndex=W?-999:999;a.domElement.style.opacity=
W?0:1})};X.CLASS_AUTO_PLACE="a";X.CLASS_AUTO_PLACE_CONTAINER="ac";X.CLASS_MAIN="main";X.CLASS_CONTROLLER_ROW="cr";X.CLASS_TOO_TALL="taller-than-window";X.CLASS_CLOSED="closed";X.CLASS_CLOSE_BUTTON="close-button";X.CLASS_DRAG="drag";X.DEFAULT_WIDTH=245;X.TEXT_CLOSED="Close Controls";X.TEXT_OPEN="Open Controls";r.bind(window,"keydown",function(a){"text"===document.activeElement.type||72!==a.which&&72!=a.keyCode||X.toggleHide()},!1);n.extend(X.prototype,{add:function(a,b){return v(this,a,b,{factoryArgs:Array.prototype.slice.call(arguments,
2)})},addColor:function(a,b){return v(this,a,b,{color:!0})},remove:function(a){this.__ul.removeChild(a.__li);this.__controllers.slice(this.__controllers.indexOf(a),1);var b=this;n.defer(function(){b.onResize()})},destroy:function(){this.autoPlace&&H.removeChild(this.domElement)},addFolder:function(a){if(void 0!==this.__folders[a])throw Error('You already have a folder in this GUI by the name "'+a+'"');var b={name:a,parent:this};b.autoPlace=this.autoPlace;this.load&&this.load.folders&&this.load.folders[a]&&
(b.closed=this.load.folders[a].closed,b.load=this.load.folders[a]);b=new X(b);this.__folders[a]=b;a=x(this,b.domElement);r.addClass(a,"folder");return b},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var a=this.getRoot();if(a.scrollable){var b=r.getOffset(a.__ul).top,d=0;n.each(a.__ul.childNodes,function(b){a.autoPlace&&b===a.__save_row||(d+=r.getHeight(b))});window.innerHeight-b-20<d?(r.addClass(a.domElement,X.CLASS_TOO_TALL),a.__ul.style.height=window.innerHeight-
b-20+"px"):(r.removeClass(a.domElement,X.CLASS_TOO_TALL),a.__ul.style.height="auto")}a.__resize_handle&&n.defer(function(){a.__resize_handle.style.height=a.__ul.offsetHeight+"px"});a.__closeButton&&(a.__closeButton.style.width=a.width+"px")},remember:function(){n.isUndefined(O)&&(O=new k,O.domElement.innerHTML=b);if(this.parent)throw Error("You can only call remember on a top level GUI.");var a=this;n.each(Array.prototype.slice.call(arguments),function(b){0==a.__rememberedObjects.length&&D(a);-1==
a.__rememberedObjects.indexOf(b)&&a.__rememberedObjects.push(b)});this.autoPlace&&F(this,this.width)},getRoot:function(){for(var a=this;a.parent;)a=a.parent;return a},getSaveObject:function(){var a=this.load;a.closed=this.closed;0<this.__rememberedObjects.length&&(a.preset=this.preset,a.remembered||(a.remembered={}),a.remembered[this.preset]=G(this));a.folders={};n.each(this.__folders,function(b,d){a.folders[d]=b.getSaveObject()});return a},save:function(){this.load.remembered||(this.load.remembered=
{});this.load.remembered[this.preset]=G(this);I(this,!1)},saveAs:function(a){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=G(this,!0));this.load.remembered[a]=G(this);this.preset=a;K(this,a,!0)},revert:function(a){n.each(this.__controllers,function(b){this.getRoot().load.remembered?A(a||this.getRoot(),b):b.setValue(b.initialValue)},this);n.each(this.__folders,function(a){a.revert(a)});a||I(this.getRoot(),!1)},listen:function(a){var b=0==this.__listening.length;this.__listening.push(a);
b&&B(this.__listening)}});return X}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',
".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",
dat.controllers.factory=function(l,b,g,m,a,e,d){return function(q,f,p,w){var u=q[f];if(d.isArray(p)||d.isObject(p))return new l(q,f,p);if(d.isNumber(u))return d.isNumber(p)&&d.isNumber(w)?new g(q,f,p,w):new b(q,f,{min:p,max:w});if(d.isString(u))return new m(q,f);if(d.isFunction(u))return new a(q,f,"");if(d.isBoolean(u))return new e(q,f)}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(l,b,g){var m=
function(a,e){function d(){g.setValue(g.__input.value)}m.superclass.call(this,a,e);var g=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");b.bind(this.__input,"keyup",d);b.bind(this.__input,"change",d);b.bind(this.__input,"blur",function(){g.__onFinishChange&&g.__onFinishChange.call(g,g.getValue())});b.bind(this.__input,"keydown",function(a){13===a.keyCode&&this.blur()});this.updateDisplay();this.domElement.appendChild(this.__input)};m.superclass=l;g.extend(m.prototype,
l.prototype,{updateDisplay:function(){b.isActive(this.__input)||(this.__input.value=this.getValue());return m.superclass.prototype.updateDisplay.call(this)}});return m}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,
dat.controllers.ColorController=function(l,b,g,m,a){function e(b,d,e,g){b.style.background="";a.each(f,function(a){b.style.cssText+="background: "+a+"linear-gradient("+d+", "+e+" 0%, "+g+" 100%); "})}function d(a){a.style.background="";a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";
a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var q=function(f,l){function p(a){v(a);b.bind(window,"mousemove",v);b.bind(window,
"mouseup",k)}function k(){b.unbind(window,"mousemove",v);b.unbind(window,"mouseup",k)}function r(){var a=m(this.value);!1!==a?(w.__color.__state=a,w.setValue(w.__color.toOriginal())):this.value=w.__color.toString()}function n(){b.unbind(window,"mousemove",x);b.unbind(window,"mouseup",n)}function v(a){a.preventDefault();var d=b.getWidth(w.__saturation_field),e=b.getOffset(w.__saturation_field),f=(a.clientX-e.left+document.body.scrollLeft)/d;a=1-(a.clientY-e.top+document.body.scrollTop)/d;1<a?a=1:0>
a&&(a=0);1<f?f=1:0>f&&(f=0);w.__color.v=a;w.__color.s=f;w.setValue(w.__color.toOriginal());return!1}function x(a){a.preventDefault();var d=b.getHeight(w.__hue_field),e=b.getOffset(w.__hue_field);a=1-(a.clientY-e.top+document.body.scrollTop)/d;1<a?a=1:0>a&&(a=0);w.__color.h=360*a;w.setValue(w.__color.toOriginal());return!1}q.superclass.call(this,f,l);this.__color=new g(this.getValue());this.__temp=new g(0);var w=this;this.domElement=document.createElement("div");b.makeSelectable(this.domElement,!1);
this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");
this.__input.type="text";this.__input_textShadow="0 1px 1px ";b.bind(this.__input,"keydown",function(a){13===a.keyCode&&r.call(this)});b.bind(this.__input,"blur",r);b.bind(this.__selector,"mousedown",function(a){b.addClass(this,"drag").bind(window,"mouseup",function(a){b.removeClass(w.__selector,"drag")})});var A=document.createElement("div");a.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});a.extend(this.__field_knob.style,
{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});a.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});a.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});a.extend(A.style,{width:"100%",height:"100%",
background:"none"});e(A,"top","rgba(0,0,0,0)","#000");a.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});d(this.__hue_field);a.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});b.bind(this.__saturation_field,"mousedown",p);b.bind(this.__field_knob,"mousedown",p);b.bind(this.__hue_field,"mousedown",function(a){x(a);b.bind(window,
"mousemove",x);b.bind(window,"mouseup",n)});this.__saturation_field.appendChild(A);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay()};q.superclass=l;a.extend(q.prototype,l.prototype,{updateDisplay:function(){var b=m(this.getValue());if(!1!==b){var d=!1;
a.each(g.COMPONENTS,function(e){if(!a.isUndefined(b[e])&&!a.isUndefined(this.__color.__state[e])&&b[e]!==this.__color.__state[e])return d=!0,{}},this);d&&a.extend(this.__color.__state,b)}a.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var f=.5>this.__color.v||.5<this.__color.s?255:0,k=255-f;a.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+f+
","+f+","+f+")"});this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px";this.__temp.s=1;this.__temp.v=1;e(this.__saturation_field,"left","#fff",this.__temp.toString());a.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+f+","+f+","+f+")",textShadow:this.__input_textShadow+"rgba("+k+","+k+","+k+",.7)"})}});var f=["-moz-","-o-","-webkit-","-ms-",""];return q}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(l,b,g,m){function a(a,
b,e){Object.defineProperty(a,b,{get:function(){if("RGB"===this.__state.space)return this.__state[b];d(this,b,e);return this.__state[b]},set:function(a){"RGB"!==this.__state.space&&(d(this,b,e),this.__state.space="RGB");this.__state[b]=a}})}function e(a,b){Object.defineProperty(a,b,{get:function(){if("HSV"===this.__state.space)return this.__state[b];q(this);return this.__state[b]},set:function(a){"HSV"!==this.__state.space&&(q(this),this.__state.space="HSV");this.__state[b]=a}})}function d(a,d,e){if("HEX"===
a.__state.space)a.__state[d]=b.component_from_hex(a.__state.hex,e);else if("HSV"===a.__state.space)m.extend(a.__state,b.hsv_to_rgb(a.__state.h,a.__state.s,a.__state.v));else throw"Corrupted color state";}function q(a){var d=b.rgb_to_hsv(a.r,a.g,a.b);m.extend(a.__state,{s:d.s,v:d.v});m.isNaN(d.h)?m.isUndefined(a.__state.h)&&(a.__state.h=0):a.__state.h=d.h}var f=function(){this.__state=l.apply(this,arguments);if(!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||
1};f.COMPONENTS="r g b h s v hex a".split(" ");m.extend(f.prototype,{toString:function(){return g(this)},toOriginal:function(){return this.__state.conversion.write(this)}});a(f.prototype,"r",2);a(f.prototype,"g",1);a(f.prototype,"b",0);e(f.prototype,"h");e(f.prototype,"s");e(f.prototype,"v");Object.defineProperty(f.prototype,"a",{get:function(){return this.__state.a},set:function(a){this.__state.a=a}});Object.defineProperty(f.prototype,"hex",{get:function(){this.__state.hex=b.rgb_to_hex(this.r,this.g,
this.b);return this.__state.hex},set:function(a){this.__state.space="HEX";this.__state.hex=a}});return f}(dat.color.interpret,dat.color.math=function(){var l;return{hsv_to_rgb:function(b,g,l){var a=b/60-Math.floor(b/60),e=l*(1-g),d=l*(1-a*g);g=l*(1-(1-a)*g);b=[[l,g,e],[d,l,e],[e,l,g],[e,d,l],[g,e,l],[l,e,d]][Math.floor(b/60)%6];return{r:255*b[0],g:255*b[1],b:255*b[2]}},rgb_to_hsv:function(b,g,l){var a=Math.max(b,g,l),e=a-Math.min(b,g,l);if(0==a)return{h:NaN,s:0,v:0};b=(b==a?(g-l)/e:g==a?2+(l-b)/e:
4+(b-g)/e)/6;0>b&&(b+=1);return{h:360*b,s:e/a,v:a/255}},rgb_to_hex:function(b,g,l){b=this.hex_with_component(0,2,b);b=this.hex_with_component(b,1,g);return b=this.hex_with_component(b,0,l)},component_from_hex:function(b,g){return b>>8*g&255},hex_with_component:function(b,g,m){return m<<(l=8*g)|b&~(255<<l)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(l,b){window.setTimeout(l,1E3/60)}}(),dat.dom.CenteredDiv=function(l,b){var g=function(){this.backgroundElement=document.createElement("div");b.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});l.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=document.createElement("div");
b.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var g=this;l.bind(this.backgroundElement,"click",function(){g.hide()})};g.prototype.show=function(){var g=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=0;this.domElement.style.webkitTransform=
"scale(1.1)";this.layout();b.defer(function(){g.backgroundElement.style.opacity=1;g.domElement.style.opacity=1;g.domElement.style.webkitTransform="scale(1)"})};g.prototype.hide=function(){var b=this,a=function(){b.domElement.style.display="none";b.backgroundElement.style.display="none";l.unbind(b.domElement,"webkitTransitionEnd",a);l.unbind(b.domElement,"transitionend",a);l.unbind(b.domElement,"oTransitionEnd",a)};l.bind(this.domElement,"webkitTransitionEnd",a);l.bind(this.domElement,"transitionend",
a);l.bind(this.domElement,"oTransitionEnd",a);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};g.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-l.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-l.getHeight(this.domElement)/2+"px"};return g}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);
Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(l){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var l=document.createElement("div");l.id="webgl-error-message";l.style.fontFamily="monospace";l.style.fontSize="13px";l.style.fontWeight="normal";l.style.textAlign="center";l.style.background=
"#fff";l.style.color="#000";l.style.padding="1.5em";l.style.width="400px";l.style.margin="5em auto 0";this.webgl||(l.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.');
return l},addGetWebGLMessage:function(l){l=l||{};var b=void 0!==l.parent?l.parent:document.body;l=void 0!==l.id?l.id:"oldie";var g=Detector.getWebGLErrorMessage();g.id=l;b.appendChild(g)}};
(function(){function l(){}function b(){}function g(){this.skinIndices=[];this.skinWeights=[];this.matrices=[]}function m(){this.hierarchy=[]}function a(){this.id=this.name=this.node=null;this.vertices=[];this.indices=[];this.normals=[];this.uvs=[];this.bones=[];this.skins=null}function e(){this.index=this.node=this.ref=this.map=this.uv=null}function d(){this.index=this.node=this.ref=this.map=this.normal=null}function q(){this.attrData=this.attrFlag=this.values=this.times=this.internalId=this.id=this.version=
null}function f(){this.attr=this.id=null;this.attrZ=this.attrY=this.attrX=!1;this.curveIdx=this.containerBoneId=this.containerInternalId=this.internalId=null;this.curves=[]}function p(){this.curves={};this.length=0;this.fps=30;this.frames=0}function w(){this.textures=[];this.perGeoMap={}}function u(){this.name=this.fileName="";this.id=null;this.parentIds=[]}THREE.FBXLoader=function(a,b){THREE.Loader.call(this,a);this.manager=void 0!==b?b:THREE.DefaultLoadingManager;this.textureBasePath=this.textureLoader=
null};THREE.FBXLoader.prototype=Object.create(THREE.Loader.prototype);THREE.FBXLoader.prototype.constructor=THREE.FBXLoader;THREE.FBXLoader.prototype.load=function(a,b,d,e){var f=this;(new THREE.XHRLoader(f.manager)).load(a,function(d){f.isFbxFormatASCII(d)?f.isFbxVersionSupported(d)?(f.textureBasePath=f.extractUrlBase(a),b(f.parse(d))):console.warn("FBXLoader: !!! FBX Version below 7 not supported !!!"):console.warn("FBXLoader: !!! FBX Binary format not supported !!!")},d,e)};THREE.FBXLoader.prototype.setCrossOrigin=
function(a){this.crossOrigin=a};THREE.FBXLoader.prototype.isFbxFormatASCII=function(a){CORRECT="Kaydara\\FBX\\Binary\\\\".split("");for(var b=0,d=0;d<CORRECT.length;++d){var e=a[0];a=a.slice(b+1);b++;num=e;if(num==CORRECT[d])return!1}return!0};THREE.FBXLoader.prototype.isFbxVersionSupported=function(a){return(match=a.match(/FBXVersion: (\d+)/))?(a=parseInt(match[1]),console.log("FBXLoader: FBX version "+a),7E3<=a):!1};THREE.FBXLoader.prototype.parse=function(a){console.time("FBXLoader");console.time("FBXLoader: TextParser");
a=(new b).parse(a);console.timeEnd("FBXLoader: TextParser");console.time("FBXLoader: ObjectParser");this.hierarchy=(new m).parseHierarchy(a);this.weights=(new g).parse(a,this.hierarchy);this.animations=(new p).parse(a,this.hierarchy);this.textures=(new w).parse(a,this.hierarchy);console.timeEnd("FBXLoader: ObjectParser");console.time("FBXLoader: GeometryParser");geometries=this.parseGeometries(a);console.timeEnd("FBXLoader: GeometryParser");a=new THREE.Group;for(var d=0;d<geometries.length;++d)void 0!==
geometries[d]&&a.add(geometries[d]);console.timeEnd("FBXLoader");return a};THREE.FBXLoader.prototype.parseGeometries=function(a){if(!("Geometry"in a.Objects.subNodes))return[];var b=0,d;for(d in a.Objects.subNodes.Geometry)d.match(/^\d+$/)&&b++;var e=[];if(0<b)for(d in a.Objects.subNodes.Geometry)"Mesh"===a.Objects.subNodes.Geometry[d].attrType&&e.push(this.parseGeometry(a.Objects.subNodes.Geometry[d],a));else e.push(this.parseGeometry(a.Objects.subNodes.Geometry,a));return e};THREE.FBXLoader.prototype.parseGeometry=
function(b,d){geo=(new a).parse(b);geo.addBones(this.hierarchy.hierarchy);var e=new THREE.BufferGeometry;e.name=geo.name;e.addAttribute("position",new THREE.BufferAttribute(new Float32Array(geo.vertices),3));void 0!==geo.normals&&0<geo.normals.length&&e.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(geo.normals),3));void 0!==geo.uvs&&0<geo.uvs.length&&e.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(geo.uvs),2));void 0!==geo.indices&&65535<geo.indices.length?e.setIndex(new THREE.BufferAttribute(new Uint32Array(geo.indices),
1)):void 0!==geo.indices&&e.setIndex(new THREE.BufferAttribute(new Uint16Array(geo.indices),1));e.verticesNeedUpdate=!0;e.computeBoundingSphere();e.computeBoundingBox();var f=this.textures.getById(d.searchConnectionParent(geo.id));if(void 0!==f&&0<f.length){null===this.textureLoader&&(this.textureLoader=new THREE.TextureLoader);var g=this.textureLoader.load(this.textureBasePath+"/"+f[0].fileName)}g=void 0!==g?new THREE.MeshBasicMaterial({map:g}):new THREE.MeshBasicMaterial({color:3342591});e=(new THREE.Geometry).fromBufferGeometry(e);
e.bones=geo.bones;e.skinIndices=this.weights.skinIndices;e.skinWeights=this.weights.skinWeights;if(void 0===geo.bones||void 0===geo.skins||void 0===this.animations||0===this.animations.length){e=new THREE.Mesh(e,g);f=d.Connections.properties.connections;var k=d.Objects.subNodes.Model;for(g=0;g<f.length;g++)if(f[g][0]===b.id){e.name=k[f[g][1]].attrName;if(k[f[g][1]].properties.Lcl_Translation){f=k[f[g][1]].properties.Lcl_Translation.value.split(",");for(g=0;g<f.length;g++)f[g]=parseFloat(f[g]);e.position.x=
f[0];e.position.y=f[1];e.position.z=f[2]}break}}else g.skinning=!0,e=new THREE.SkinnedMesh(e,g),this.addAnimation(e,this.weights.matrices,this.animations);return e};THREE.FBXLoader.prototype.addAnimation=function(a,b,d){b={name:"animationtest",fps:30,length:d.length,hierarchy:[]};for(var e=0;e<a.geometry.bones.length;++e){var f=a.geometry.bones[e].name;f=f.replace(/.*:/,"");b.hierarchy.push({parent:a.geometry.bones[e].parent,name:f,keys:[]})}var g=function(a,b){if(void 0===a)return!1;switch(b){case "S":if(void 0===
a.S)return!1;var d=a.S;break;case "R":if(void 0===a.R)return!1;d=a.R;break;case "T":if(void 0===a.T)return!1;d=a.T}return void 0===d.curves.x||void 0===d.curves.y||void 0===d.curves.z?!1:!0},k=function(a,b){var d=void 0!==a.curves.y.values[b],e=void 0!==a.curves.z.values[b];return void 0!==a.curves.x.values[b]&&d&&e};f=function(a,b){var e={};e.time=frame/d.fps;e.pos=b.pos;e.rot=b.rotq;e.scl=b.scl;if(void 0===a)return e;try{if(g(a,"T")&&k(a.T,frame)){var f=new THREE.Vector3(a.T.curves.x.values[frame],
a.T.curves.y.values[frame],a.T.curves.z.values[frame]);e.pos=[f.x,f.y,f.z]}else delete e.pos;if(g(a,"R")&&k(a.R,frame)){var l=degToRad(a.R.curves.x.values[frame]),n=degToRad(a.R.curves.y.values[frame]),m=degToRad(a.R.curves.z.values[frame]),r=new THREE.Vector3(l,n,m),p=quatFromVec(r.x,r.y,r.z);e.rot=[p.x,p.y,p.z,p.w]}else delete e.rot;if(g(a,"S")&&k(a.S,frame)){var q=new THREE.Vector3(a.S.curves.x.values[frame],a.S.curves.y.values[frame],a.S.curves.z.values[frame]);e.scl=[q.x,q.y,q.z]}else delete e.scl}catch(R){console.log(b),
console.log(R)}return e};var l=a.geometry.bones;for(frame=0;frame<d.frames;frame++)for(e=0;e<l.length;e++)for(var n=l[e],m=d.curves[e],r=0;r<b.hierarchy.length;r++)b.hierarchy[r].name===n.name&&b.hierarchy[r].keys.push(f(m,n));void 0===a.geometry.animations&&(a.geometry.animations=[]);a.geometry.animations.push(THREE.AnimationClip.parseAnimation(b,a.geometry.bones))};THREE.FBXLoader.prototype.parseMaterials=function(a){if(!("Material"in a.subNodes))return[];var b=0,d;for(d in a.subNodes.Materials)d.match(/^\d+$/)&&
b++;var e=[];if(0<b)for(d in a.subNodes.Material)e.push(parseMaterial(a.subNodes.Material[d]));else e.push(parseMaterial(a.subNodes.Material));return e};THREE.FBXLoader.prototype.parseMaterial=function(a){};THREE.FBXLoader.prototype.loadFile=function(a,b,d,e,f){var g=new THREE.XHRLoader(this.manager);g.setResponseType(f);return g.load(a,function(a){b(a)},d,e)};THREE.FBXLoader.prototype.loadFileAsBuffer=function(a,b,d,e){this.loadFile(a,onLoad,d,e,"arraybuffer")};THREE.FBXLoader.prototype.loadFileAsText=
function(a,b,d,e){this.loadFile(a,b,d,e,"text")};l.prototype.add=function(a,b){this[a]=b};l.prototype.searchConnectionParent=function(a){void 0===this.__cache_search_connection_parent&&(this.__cache_search_connection_parent=[]);if(void 0!==this.__cache_search_connection_parent[a])return this.__cache_search_connection_parent[a];this.__cache_search_connection_parent[a]=[];for(var b=this.Connections.properties.connections,d=[],e=0;e<b.length;++e)b[e][0]==a&&d.push(0===b[e][1]?-1:b[e][1]);if(0<d.length)return this.__cache_search_connection_parent[a]=
this.__cache_search_connection_parent[a].concat(d),d;this.__cache_search_connection_parent[a]=[-1];return[-1]};l.prototype.searchConnectionChildren=function(a){void 0===this.__cache_search_connection_children&&(this.__cache_search_connection_children=[]);if(void 0!==this.__cache_search_connection_children[a])return this.__cache_search_connection_children[a];this.__cache_search_connection_children[a]=[];for(var b=this.Connections.properties.connections,d=[],e=0;e<b.length;++e)b[e][1]==a&&d.push(0===
b[e][0]?-1:b[e][0]);if(0<d.length)return this.__cache_search_connection_children[a]=this.__cache_search_connection_children[a].concat(d),d;this.__cache_search_connection_children[a]=[-1];return[-1]};l.prototype.searchConnectionType=function(a,b){var d=a+","+b;void 0===this.__cache_search_connection_type&&(this.__cache_search_connection_type="");if(void 0!==this.__cache_search_connection_type[d])return this.__cache_search_connection_type[d];this.__cache_search_connection_type[d]="";for(var e=this.Connections.properties.connections,
f=0;f<e.length;++f)if(e[f][0]==a&&e[f][1]==b)return this.__cache_search_connection_type[d]=e[f][2],e[f][2];return this.__cache_search_connection_type[a]=null};b.prototype={getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(a){this.nodeStack.push(a);this.currentIndent+=1},popStack:function(){this.nodeStack.pop();--this.currentIndent},setCurrentProp:function(a,
b){this.currentProp=a;this.currentPropName=b},parse:function(a){this.currentIndent=0;this.allNodes=new l;this.nodeStack=[];this.currentProp=[];this.currentPropName="";a=a.split("\n");for(var b in a){var d=a[b];if(!d.match(/^[\s\t]*;/)&&!d.match(/^[\s\t]*$/))if(match=d.match(new RegExp("^\\t{"+this.currentIndent+"}(\\w+):(.*){",""))){var e=match[1].trim().replace(/^"/,"").replace(/"$/,""),f=match[2].split(",").map(function(a){return a.trim().replace(/^"/,"").replace(/"$/,"")});this.parseNodeBegin(d,
e,f||null)}else(match=d.match(new RegExp("^\\t{"+this.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)")))?(e=match[1].replace(/^"/,"").replace(/"$/,"").trim(),f=match[2].replace(/^"/,"").replace(/"$/,"").trim(),this.parseNodeProperty(d,e,f)):d.match(new RegExp("^\\t{"+(this.currentIndent-1)+"}}"))?this.nodeEnd():d.match(/^[^\s\t}]/)&&this.parseNodePropertyContinued(d)}return this.allNodes},parseNodeBegin:function(a,b,d){a={name:b,properties:{},subNodes:{}};var e=this.parseNodeAttr(d),f=this.getCurrentNode();
if(0===this.currentIndent)this.allNodes.add(b,a);else if(b in f.subNodes){var g=f.subNodes[b];this.isFlattenNode(f.subNodes[b])&&(""===e.id?(f.subNodes[b]=[],f.subNodes[b].push(g)):(f.subNodes[b]={},f.subNodes[b][g.id]=g));""===e.id?f.subNodes[b].push(a):f.subNodes[b][e.id]=a}else f.subNodes[b]=a;d&&(a.id=e.id,a.attrName=e.name,a.attrType=e.type);this.pushStack(a)},parseNodeAttr:function(a){var b=a[0];""!==a[0]&&(b=parseInt(a[0]),isNaN(b)&&(b=a[0]));if(1<a.length){var d=a[1].replace(/^(\w+)::/,"");
var e=a[2]}return{id:b,name:d||"",type:e||""}},parseNodeProperty:function(a,b,d){var e=this.getCurrentNode(),f=e.name;if(void 0!==f&&f.match(/Properties(\d)+/))this.parseNodeSpecialProperty(a,b,d);else{if("C"==b){b=d.split(",").slice(1);a=parseInt(b[0]);f=parseInt(b[1]);var g=d.split(",").slice(3);b="connections";d=[a,f];d=d.concat(g);void 0===e.properties[b]&&(e.properties[b]=[])}"Node"==b&&(a=parseInt(d),e.properties.id=a,e.id=a);b in e.properties?Array.isArray(e.properties[b])?e.properties[b].push(d):
e.properties[b]+=d:Array.isArray(e.properties[b])?e.properties[b].push(d):e.properties[b]=d;this.setCurrentProp(e.properties,b)}},parseNodePropertyContinued:function(a){this.currentProp[this.currentPropName]+=a},parseNodeSpecialProperty:function(a,b,d){var e=d.split('",').map(function(a){return a.trim().replace(/^"/,"").replace(/\s/,"_")});a=e[0];b=e[1];d=e[2];var f=e[3];e=e[4];switch(b){case "int":e=parseInt(e);break;case "double":e=parseFloat(e);break;case "ColorRGB":case "Vector3D":e=e.split(","),
e=new THREE.Vector3(e[0],e[1],e[2])}this.getPrevNode().properties[a]={type:b,type2:d,flag:f,value:e};this.setCurrentProp(this.getPrevNode().properties,a)},nodeEnd:function(a){this.popStack()},isFlattenNode:function(a){return"subNodes"in a&&"properties"in a?!0:!1}};g.prototype.parseCluster=function(a,b,d){a=a.searchConnectionParent(b);var e=toInt(d.subNodes.Indexes.properties.a.split(",")),f=toFloat(d.subNodes.Weights.properties.a.split(",")),g=toMat44(toFloat(d.subNodes.Transform.properties.a.split(","))),
k=toMat44(toFloat(d.subNodes.TransformLink.properties.a.split(",")));return{parent:a,id:parseInt(b),indices:e,weights:f,transform:g,transformlink:k,linkMode:d.properties.Mode}};g.prototype.parse=function(a,b){this.skinIndices=[];this.skinWeights=[];this.matrices=[];var d=a.Objects.subNodes.Deformer,e={};for(k in d)if("Cluster"===d[k].attrType&&"Indexes"in d[k].subNodes){var f=this.parseCluster(a,k,d[k]),g=a.searchConnectionChildren(f.id)[0];e[g]=f}d=[];var k=b.hierarchy;for(f=0;f<k.length;++f)if(g=
k[f].internalId,void 0===e[g])this.matrices.push(new THREE.Matrix4);else{g=e[g];this.matrices.push(g.transform);for(var l=0;l<g.indices.length;++l){void 0===d[g.indices[l]]&&(d[g.indices[l]]={},d[g.indices[l]].joint=[],d[g.indices[l]].weight=[]);var m=a.searchConnectionChildren(g.id);1<m.length&&console.warn("FBXLoader: node "+g.id+" have many weight kids: "+m);d[g.indices[l]].joint.push(b.getBoneIdfromInternalId(a,m[0]));d[g.indices[l]].weight.push(g.weights[l])}}for(e=0;e<d.length;e++)k=new THREE.Vector4(d[e].joint[0]?
d[e].joint[0]:0,d[e].joint[1]?d[e].joint[1]:0,d[e].joint[2]?d[e].joint[2]:0,d[e].joint[3]?d[e].joint[3]:0),f=new THREE.Vector4(d[e].weight[0]?d[e].weight[0]:0,d[e].weight[1]?d[e].weight[1]:0,d[e].weight[2]?d[e].weight[2]:0,d[e].weight[3]?d[e].weight[3]:0),this.skinIndices.push(k),this.skinWeights.push(f);return this};m.prototype.parseHierarchy=function(a){var b=a.Objects.subNodes.Model,d=[];for(e in b)void 0!==b[e].attrType&&d.push(b[e]);this.hierarchy=[];for(b=0;b<d.length;++b){var e=d[b];var f=
a.searchConnectionParent(e.id)[0],g=[0,0,0],k=[0,0,0,1],l=[1,1,1];"Lcl_Translation"in e.properties&&(g=toFloat(e.properties.Lcl_Translation.value.split(",")));if("Lcl_Rotation"in e.properties){k=toRad(toFloat(e.properties.Lcl_Rotation.value.split(",")));var m=new THREE.Quaternion;m.setFromEuler(new THREE.Euler(k[0],k[1],k[2],"ZYX"));k=[m.x,m.y,m.z,m.w]}"Lcl_Scaling"in e.properties&&(l=toFloat(e.properties.Lcl_Scaling.value.split(",")));m=e.attrName;m=m.replace(/:/,"");m=m.replace(/_/,"");m=m.replace(/-/,
"");this.hierarchy.push({parent:f,name:m,pos:g,rotq:k,scl:l,internalId:e.id})}this.reindexParentId();this.restoreBindPose(a);return this};m.prototype.reindexParentId=function(){for(var a=0;a<this.hierarchy.length;a++)for(var b=0;b<this.hierarchy.length;++b)if(this.hierarchy[a].parent==this.hierarchy[b].internalId){this.hierarchy[a].parent=b;break}};m.prototype.restoreBindPose=function(a){var b=a.Objects.subNodes.Pose;if(void 0!==b){var d=b.subNodes.PoseNode;b={};for(var e={},f=0;f<d.length;++f){var g=
toMat44(d[f].subNodes.Matrix.properties.a.split(",")),k=toMat44(d[f].subNodes.Matrix.properties.a.split(","));b[d[f].id]=g;e[d[f].id]=k}for(d=0;d<this.hierarchy.length;++d)if(f=this.hierarchy[d],g=f.internalId,void 0!==e[g]){k=new THREE.Vector3(0,0,0);for(var l=new THREE.Quaternion,m=new THREE.Vector3(1,1,1),p,q=a.searchConnectionParent(g),u=0;u<q.length;++u)if(this.isBoneNode(q[u])){p=q[u];break}void 0!==p&&void 0!==b[p]&&(q=new THREE.Matrix4,q.getInverse(e[p]),q.multiply(b[g]),b[g]=q);b[g].decompose(k,
l,m);f.pos=[k.x,k.y,k.z];f.rotq=[l.x,l.y,l.z,l.w];f.scl=[m.x,m.y,m.z]}}};m.prototype.searchRealId=function(a){for(var b=0;b<this.hierarchy.length;b++)if(a==this.hierarchy[b].internalId)return b;return-1};m.prototype.getByInternalId=function(a){for(var b=0;b<this.hierarchy.length;b++)if(a==this.hierarchy[b].internalId)return this.hierarchy[b];return null};m.prototype.isBoneNode=function(a){for(var b=0;b<this.hierarchy.length;++b)if(a===this.hierarchy[b].internalId)return!0;return!1};m.prototype.getBoneIdfromInternalId=
function(a,b){void 0===a.__cache_get_boneid_from_internalid&&(a.__cache_get_boneid_from_internalid=[]);if(void 0!==a.__cache_get_boneid_from_internalid[b])return a.__cache_get_boneid_from_internalid[b];for(var d=0;d<this.hierarchy.length;++d)if(this.hierarchy[d].internalId==b)return a.__cache_get_boneid_from_internalid[b]=d;return-1};a.prototype.parse=function(a){this.node=a;this.name=a.attrName;this.id=a.id;this.vertices=this.getVertices();if(void 0===this.vertices)console.log("FBXLoader: Geometry.parse(): pass"+
this.node.id);else return this.indices=this.getPolygonVertexIndices(),this.uvs=(new e).parse(this.node,this),this.normals=(new d).parse(this.node,this),3<this.getPolygonTopologyMax()&&(this.indices=this.convertPolyIndicesToTri(this.indices,this.getPolygonTopologyArray())),this};a.prototype.getVertices=function(){if(this.node.__cache_vertices)return this.node.__cache_vertices;if(void 0===this.node.subNodes.Vertices)return console.warn("this.node: "+this.node.attrName+"("+this.node.id+") does not have Vertices"),
this.node.__cache_vertices=void 0,null;var a=this.node.subNodes.Vertices.properties.a.split(",").map(function(a){return parseFloat(a)});this.node.__cache_vertices=a;return this.node.__cache_vertices};a.prototype.getPolygonVertexIndices=function(){if(this.node.__cache_indices&&this.node.__cache_poly_topology_max)return this.node.__cache_indices;if(void 0===this.node.subNodes)console.error("this.node.subNodes undefined"),console.log(this.node);else if(void 0===this.node.subNodes.PolygonVertexIndex)console.warn("this.node: "+
this.node.attrName+"("+this.node.id+") does not have PolygonVertexIndex "),this.node.__cache_indices=void 0;else{for(var a=this.node.subNodes.PolygonVertexIndex.properties.a.split(","),b=1,d=null,e=[],f=0;f<a.length;++f){var g=parseInt(a[f]);0>g?(b>d&&(d=b),a[f]=g^-1,e.push(b),b=1):(a[f]=g,b++)}null===d&&(console.warn("FBXLoader: topology N not found: "+this.node.attrName),console.warn(this.node),d=3);this.node.__cache_poly_topology_max=d;this.node.__cache_poly_topology_arr=e;this.node.__cache_indices=
a;return this.node.__cache_indices}};a.prototype.getPolygonTopologyMax=function(){if(this.node.__cache_indices&&this.node.__cache_poly_topology_max)return this.node.__cache_poly_topology_max;this.getPolygonVertexIndices(this.node);return this.node.__cache_poly_topology_max};a.prototype.getPolygonTopologyArray=function(){if(this.node.__cache_indices&&this.node.__cache_poly_topology_max)return this.node.__cache_poly_topology_arr;this.getPolygonVertexIndices(this.node);return this.node.__cache_poly_topology_arr};
a.prototype.convertPolyIndicesToTri=function(a,b){for(var d=[],e=0,f=0,g;e<a.length;){g=b[f];for(var k=0;k<=g-3;k++)d.push(a[e]),d.push(a[e+(g-2-k)]),d.push(a[e+(g-1-k)]);f++;e+=g}return d};a.prototype.addBones=function(a){this.bones=a};e.prototype.getUV=function(a){return this.node&&this.uv&&this.map&&this.ref?this.uv:this._parseText(a)};e.prototype.getMap=function(a){this.node&&this.uv&&this.map&&this.ref||this._parseText(a);return this.map};e.prototype.getRef=function(a){this.node&&this.uv&&this.map&&
this.ref||this._parseText(a);return this.ref};e.prototype.getIndex=function(a){this.node&&this.uv&&this.map&&this.ref||this._parseText(a);return this.index};e.prototype.getNode=function(a){return null!==this.node?this.node:this.node=a.subNodes.LayerElementUV};e.prototype._parseText=function(a){a=this.getNode(a);if(void 0===a)return[];var b=0;for(d in a)d.match(/^\d+$/)&&b++;0<b&&(console.warn("multi uv not supported"),a=a[d]);var d=a.subNodes.UVIndex.properties.a;b=a.properties.MappingInformationType;
var e=a.properties.ReferenceInformationType;this.uv=toFloat(a.subNodes.UV.properties.a.split(","));this.index=toInt(d.split(","));this.map=b;this.ref=e;return this.uv};e.prototype.parse=function(a,b){this.uvNode=this.getNode(a);this.uv=this.getUV(a);var d=this.getMap(a),e=this.getRef(a),f=this.getIndex(a),g=b.getPolygonTopologyArray();switch(d){case "ByPolygonVertex":switch(e){case "Direct":this.uv=this.parseUV_ByPolygonVertex_Direct(this.uv,f,g,2);break;case "IndexToDirect":this.uv=this.parseUV_ByPolygonVertex_IndexToDirect(this.uv,
f)}var k=this.uv,l=b.getPolygonVertexIndices(a);d={};e=[];for(g=f=0;g<l.length;++g)if(!(l[g]in d)){d[l[g]]={};for(var m=0;2>m;++m)d[l[g]][m]=k[2*g+m];f=f<l[g]?l[g]:f}try{for(g=0;g<=f;g++)for(k=0;2>k;k++)e.push(d[g][k])}catch(F){}this.uv=e;break;case "ByPolygon":switch(e){case "Direct":this.uv=this.parseUV_ByPolygon_Direct();break;case "IndexToDirect":this.uv=this.parseUV_ByPolygon_IndexToDirect()}}return this.uv};e.prototype.parseUV_ByPolygonVertex_Direct=function(a,b,d,e){return parse_Data_ByPolygonVertex_Direct(a,
b,d,e)};e.prototype.parseUV_ByPolygonVertex_IndexToDirect=function(a,b){for(var d=[],e=0;e<b.length;++e)for(var f=0;2>f;++f)d.push(a[2*b[e]+f]);return d};e.prototype.parseUV_ByPolygon_Direct=function(a){console.warn("not implemented");return a};e.prototype.parseUV_ByPolygon_IndexToDirect=function(a){console.warn("not implemented");return a};e.prototype.parseUV_ByVertex_Direct=function(a){console.warn("not implemented");return a};d.prototype.getNormal=function(a){this.node&&this.normal&&this.map&&
this.ref||this._parseText(a);return this.normal};d.prototype.getMap=function(a){this.node&&this.normal&&this.map&&this.ref||this._parseText(a);return this.map};d.prototype.getRef=function(a){this.node&&this.normal&&this.map&&this.ref||this._parseText(a);return this.ref};d.prototype.getNode=function(a){return this.node?this.node:this.node=a.subNodes.LayerElementNormal};d.prototype._parseText=function(a){var b=this.getNode(a);if(void 0===b)console.warn("node: "+a.attrName+"("+a.id+") does not have LayerElementNormal");
else{a=b.properties.MappingInformationType;var d=b.properties.ReferenceInformationType;this.normal=toFloat(b.subNodes.Normals.properties.a.split(","));this.map=a;this.ref=d}};d.prototype.parse=function(a,b){var d=this.getNormal(a);this.getNode(a);var e=this.getMap(a),f=this.getRef(a),g=b.getPolygonVertexIndices(a),k=b.getPolygonTopologyArray(a);switch(e){case "ByPolygonVertex":switch(f){case "Direct":d=this.parseNormal_ByPolygonVertex_Direct(d,g,k,3);break;case "IndexToDirect":d=this.parseNormal_ByPolygonVertex_IndexToDirect()}break;
case "ByPolygon":switch(f){case "Direct":d=this.parseNormal_ByPolygon_Direct();break;case "IndexToDirect":d=this.parseNormal_ByPolygon_IndexToDirect()}}return d};d.prototype.parseNormal_ByPolygonVertex_Direct=function(a,b,d,e){return parse_Data_ByPolygonVertex_Direct(a,b,d,e)};d.prototype.parseNormal_ByPolygonVertex_IndexToDirect=function(a){console.warn("not implemented");return a};d.prototype.parseNormal_ByPolygon_Direct=function(a){console.warn("not implemented");return a};d.prototype.parseNormal_ByPolygon_IndexToDirect=
function(a){console.warn("not implemented");return a};d.prototype.parseNormal_ByVertex_Direct=function(a){console.warn("not implemented");return a};q.prototype.fromNode=function(a){this.internalId=this.id=a.id;this.times=a.subNodes.KeyTime.properties.a;this.values=a.subNodes.KeyValueFloat.properties.a;this.attrFlag=a.subNodes.KeyAttrFlags.properties.a;this.attrData=a.subNodes.KeyAttrDataFloat.properties.a;this.times=toFloat(this.times.split(","));this.values=toFloat(this.values.split(","));this.attrData=
toFloat(this.attrData.split(","));this.attrFlag=toInt(this.attrFlag.split(","));this.times=this.times.map(function(a){return a/46186158E3});return this};q.prototype.getLength=function(){return this.times[this.times.length-1]};f.prototype.fromNode=function(a,b,d){this.id=b.id;this.attr=b.attrName;this.internalId=b.id;if(this.attr.match(/S|R|T/))for(var e in b.properties)e.match(/X/)&&(this.attrX=!0),e.match(/Y/)&&(this.attrY=!0),e.match(/Z/)&&(this.attrZ=!0);else return null;this.containerIndices=
a.searchConnectionParent(this.id);this.curveIdx=a.searchConnectionChildren(this.id);for(a=this.containerIndices.length-1;0<=a&&!(b=d.searchRealId(this.containerIndices[a]),0<=b&&(this.containerBoneId=b,this.containerId=this.containerIndices[a]),0<=b);--a);return this};f.prototype.setCurve=function(a){this.curves.push(a)};p.prototype.parse=function(a,b){var d=a.Objects.subNodes.AnimationCurveNode,e=a.Objects.subNodes.AnimationCurve,g=[],k;for(k in d)if(k.match(/\d+/)){var l=(new f).fromNode(a,d[k],
b);g.push(l)}d={};for(l=0;l<g.length;++l)null!==g[l]&&(d[g[l].id]=g[l]);l=[];g=0;for(k in e)if(k.match(/\d+/)){var m=(new q).fromNode(e[k]);l.push(m);g=m.getLength()?m.getLength():g;var p=a.searchConnectionParent(m.id)[0],r=a.searchConnectionType(m.id,p);r.match(/X/)&&(r="x");r.match(/Y/)&&(r="y");r.match(/Z/)&&(r="z");d[p].curves[r]=m}for(var u in d)e=d[u].containerBoneId,void 0===this.curves[e]&&(this.curves[e]={}),this.curves[e][d[u].attr]=d[u];this.length=g;this.frames=this.length*this.fps;return this};
w.prototype.add=function(a){void 0===this.textures&&(this.textures=[]);this.textures.push(a);for(var b=0;b<a.parentIds.length;++b)void 0===this.perGeoMap[a.parentIds[b]]&&(this.perGeoMap[a.parentIds[b]]=[]),this.perGeoMap[a.parentIds[b]].push(this.textures[this.textures.length-1])};w.prototype.parse=function(a,b){var d=a.Objects.subNodes.Texture,e;for(e in d){var f=(new u).parse(d[e],a);this.add(f)}return this};w.prototype.getById=function(a){return this.perGeoMap[a]};u.prototype.parse=function(a,
b){this.id=a.id;this.name=a.attrName;this.fileName=this.parseFileName(a.properties.FileName);this.parentIds=this.searchParents(this.id,b);return this};u.prototype.parseFileName=function(a){if(void 0===a)return"";var b=a.split(/[\\\/]/);return 0<b.length?b[b.length-1]:a};u.prototype.searchParents=function(a,b){return b.searchConnectionParent(a)};parse_Data_ByPolygonVertex_Direct=function(a,b,d,e){d=[];for(var f=0,g=0;g<b.length;++g){d[b[g]]=[];for(var k=0;k<e;++k)d[b[g]][k]=a[f+k];f+=e}a=[];for(b=
0;b<d.length;++b)if(void 0!==d[b])for(f=0;f<e;++f)void 0!==d[b][f]&&a.push(d[b][f]);return a};degToRad=function(a){return a*Math.PI/180};radToDeg=function(a){return 180*a/Math.PI};quatFromVec=function(a,b,d){a=new THREE.Euler(a,b,d,"ZYX");b=new THREE.Quaternion;b.setFromEuler(a);return b};toInt=function(a){return a.map(function(a){return parseInt(a)})};toFloat=function(a){return a.map(function(a){return parseFloat(a)})};toRad=function(a){return a.map(function(a){return degToRad(a)})};toMat44=function(a){var b=
new THREE.Matrix4;b.set(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]);return b}})();THREE.OBJLoader=function(l){this.manager=void 0!==l?l:THREE.DefaultLoadingManager;this.materials=null};
THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(l,b,g,m){var a=this,e=new THREE.XHRLoader(a.manager);e.setPath(this.path);e.load(l,function(d){b(a.parse(d))},g,m)},setPath:function(l){this.path=l},setMaterials:function(l){this.materials=l},parse:function(l){function b(a){Q={name:a,geometry:{vertices:[],normals:[],uvs:[]},material:{name:"",smooth:!0}};p.push(Q)}function g(a){a=parseInt(a);return 3*(0<=a?a-1:a+u.length/3)}function m(a){a=parseInt(a);return 3*(0<=a?a-1:a+k.length/
3)}function a(a){a=parseInt(a);return 2*(0<=a?a-1:a+r.length/2)}function e(a,b,d){Q.geometry.vertices.push(u[a],u[a+1],u[a+2],u[b],u[b+1],u[b+2],u[d],u[d+1],u[d+2])}function d(a,b,d){Q.geometry.normals.push(k[a],k[a+1],k[a+2],k[b],k[b+1],k[b+2],k[d],k[d+1],k[d+2])}function q(a,b,d){Q.geometry.uvs.push(r[a],r[a+1],r[b],r[b+1],r[d],r[d+1])}function f(b,f,k,l,n,p,r,v,u,w,x,B){b=g(b);f=g(f);k=g(k);if(void 0===l)e(b,f,k);else{var A=g(l);e(b,f,A);e(f,k,A)}void 0!==n&&(b=a(n),f=a(p),k=a(r),void 0===l?q(b,
f,k):(A=a(v),q(b,f,A),q(f,k,A)));void 0!==u&&(b=m(u),f=m(w),k=m(x),void 0===l?d(b,f,k):(A=m(B),d(b,f,A),d(f,k,A)))}console.time("OBJLoader");var p=[],w=!1,u=[],k=[],r=[];b("");var n=/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,v=/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,x=/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,z=/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,A=/^f\s+((-?\d+)\/(-?\d+))\s+((-?\d+)\/(-?\d+))\s+((-?\d+)\/(-?\d+))(?:\s+((-?\d+)\/(-?\d+)))?/,
D=/^f\s+((-?\d+)\/(-?\d+)\/(-?\d+))\s+((-?\d+)\/(-?\d+)\/(-?\d+))\s+((-?\d+)\/(-?\d+)\/(-?\d+))(?:\s+((-?\d+)\/(-?\d+)\/(-?\d+)))?/,E=/^f\s+((-?\d+)\/\/(-?\d+))\s+((-?\d+)\/\/(-?\d+))\s+((-?\d+)\/\/(-?\d+))(?:\s+((-?\d+)\/\/(-?\d+)))?/,F=/^[og]\s*(.+)?/,G=/^s\s+(\d+|on|off)/,K=l.split("\n");for(l=0;l<K.length;l++){var I=K[l];I=I.trim();var B;if(0!==I.length&&"#"!==I.charAt(0))if(null!==(B=n.exec(I)))u.push(parseFloat(B[1]),parseFloat(B[2]),parseFloat(B[3]));else if(null!==(B=v.exec(I)))k.push(parseFloat(B[1]),
parseFloat(B[2]),parseFloat(B[3]));else if(null!==(B=x.exec(I)))r.push(parseFloat(B[1]),parseFloat(B[2]));else if(null!==(B=z.exec(I)))f(B[1],B[2],B[3],B[4]);else if(null!==(B=A.exec(I)))f(B[2],B[5],B[8],B[11],B[3],B[6],B[9],B[12]);else if(null!==(B=D.exec(I)))f(B[2],B[6],B[10],B[14],B[3],B[7],B[11],B[15],B[4],B[8],B[12],B[16]);else if(null!==(B=E.exec(I)))f(B[2],B[5],B[8],B[11],void 0,void 0,void 0,void 0,B[3],B[6],B[9],B[12]);else if(null!==(B=F.exec(I)))I=B[0].substr(1).trim(),!1===w?(w=!0,Q.name=
I):b(I);else if(/^usemtl /.test(I))Q.material.name=I.substring(7).trim();else if(!/^mtllib /.test(I))if(null!==(B=G.exec(I)))Q.material.smooth="1"===B[1]||"on"===B[1];else throw Error("Unexpected line: "+I);}w=new THREE.Group;l=0;for(n=p.length;l<n;l++){var Q=p[l];v=Q.geometry;x=new THREE.BufferGeometry;x.addAttribute("position",new THREE.BufferAttribute(new Float32Array(v.vertices),3));0<v.normals.length?x.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(v.normals),3)):x.computeVertexNormals();
0<v.uvs.length&&x.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(v.uvs),2));var O;null!==this.materials&&(O=this.materials.create(Q.material.name));O||(O=new THREE.MeshPhongMaterial,O.name=Q.material.name);O.shading=Q.material.smooth?THREE.SmoothShading:THREE.FlatShading;v=new THREE.Mesh(x,O);v.name=Q.name;w.add(v)}console.timeEnd("OBJLoader");return w}};THREE.RenderableObject=function(){this.id=0;this.object=null;this.renderOrder=this.z=0};
THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.renderOrder=this.z=0};
THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(l){this.positionWorld.copy(l.positionWorld);this.positionScreen.copy(l.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.renderOrder=this.z=0};
THREE.RenderableSprite=function(){this.id=0;this.object=null;this.rotation=this.z=this.y=this.x=0;this.scale=new THREE.Vector2;this.material=null;this.renderOrder=0};
THREE.Projector=function(){function l(){if(u===r){var a=new THREE.RenderableVertex;k.push(a);r++;u++;return a}return k[u++]}function b(){if(v===z){var a=new THREE.RenderableFace;x.push(a);z++;v++;return a}return x[v++]}function g(){if(D===F){var a=new THREE.RenderableLine;E.push(a);F++;D++;return a}return E[D++]}function m(){if(K===B){var a=new THREE.RenderableSprite;I.push(a);B++;K++;return a}return I[K++]}function a(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?
b.z-a.z:a.id!==b.id?a.id-b.id:0}function e(a,b){var d=0,e=1,f=a.z+a.w,g=b.z+b.w,k=-a.z+a.w,l=-b.z+b.w;if(0<=f&&0<=g&&0<=k&&0<=l)return!0;if(0>f&&0>g||0>k&&0>l)return!1;0>f?d=Math.max(d,f/(f-g)):0>g&&(e=Math.min(e,f/(f-g)));0>k?d=Math.max(d,k/(k-l)):0>l&&(e=Math.min(e,k/(k-l)));if(e<d)return!1;a.lerp(b,d);b.lerp(a,1-e);return!0}var d,q,f=[],p=0,w,u,k=[],r=0,n,v,x=[],z=0,A,D,E=[],F=0,G,K,I=[],B=0,Q={objects:[],lights:[],elements:[]},O=new THREE.Vector3,L=new THREE.Vector4,H=new THREE.Box3(new THREE.Vector3(-1,
-1,-1),new THREE.Vector3(1,1,1)),W=new THREE.Box3,ba=Array(3),X=new THREE.Matrix4,R=new THREE.Matrix4,J,T=new THREE.Matrix4,S=new THREE.Matrix3,ea=new THREE.Frustum,U=new THREE.Vector4,qa=new THREE.Vector4;this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};
var ha=new function(){function a(a){var b=a.positionWorld,d=a.positionScreen;b.copy(a.position).applyMatrix4(J);d.copy(b).applyMatrix4(R);b=1/d.w;d.x*=b;d.y*=b;d.z*=b;a.visible=-1<=d.x&&1>=d.x&&-1<=d.y&&1>=d.y&&-1<=d.z&&1>=d.z}function d(a,b,d){if(!0===a.visible||!0===b.visible||!0===d.visible)return!0;ba[0]=a.positionScreen;ba[1]=b.positionScreen;ba[2]=d.positionScreen;return H.intersectsBox(W.setFromPoints(ba))}function e(a,b,d){return 0>(d.positionScreen.x-a.positionScreen.x)*(b.positionScreen.y-
a.positionScreen.y)-(d.positionScreen.y-a.positionScreen.y)*(b.positionScreen.x-a.positionScreen.x)}var f=[],m=[],p=null,q=null,r=new THREE.Matrix3;return{setObject:function(a){p=a;q=p.material;r.getNormalMatrix(p.matrixWorld);f.length=0;m.length=0},projectVertex:a,checkTriangleVisibility:d,checkBackfaceCulling:e,pushVertex:function(b,d,e){w=l();w.position.set(b,d,e);a(w)},pushNormal:function(a,b,d){f.push(a,b,d)},pushUv:function(a,b){m.push(a,b)},pushLine:function(a,b){var d=k[a],e=k[b];A=g();A.id=
p.id;A.v1.copy(d);A.v2.copy(e);A.z=(d.positionScreen.z+e.positionScreen.z)/2;A.renderOrder=p.renderOrder;A.material=p.material;Q.elements.push(A)},pushTriangle:function(a,g,l){var v=k[a],u=k[g],w=k[l];if(!1!==d(v,u,w)&&(q.side===THREE.DoubleSide||!0===e(v,u,w))){n=b();n.id=p.id;n.v1.copy(v);n.v2.copy(u);n.v3.copy(w);n.z=(v.positionScreen.z+u.positionScreen.z+w.positionScreen.z)/3;n.renderOrder=p.renderOrder;n.normalModel.fromArray(f,3*a);n.normalModel.applyMatrix3(r).normalize();for(v=0;3>v;v++)u=
n.vertexNormalsModel[v],u.fromArray(f,3*arguments[v]),u.applyMatrix3(r).normalize(),n.uvs[v].fromArray(m,2*arguments[v]);n.vertexNormalsLength=3;n.material=p.material;Q.elements.push(n)}}}};this.projectScene=function(r,w,x,B){K=D=v=0;Q.elements.length=0;!0===r.autoUpdate&&r.updateMatrixWorld();null===w.parent&&w.updateMatrixWorld();X.copy(w.matrixWorldInverse.getInverse(w.matrixWorld));R.multiplyMatrices(w.projectionMatrix,X);ea.setFromMatrix(R);q=0;Q.objects.length=0;Q.lights.length=0;r.traverseVisible(function(a){if(a instanceof
THREE.Light)Q.lights.push(a);else if((a instanceof THREE.Mesh||a instanceof THREE.Line||a instanceof THREE.Sprite)&&!1!==a.material.visible&&(!1===a.frustumCulled||!0===ea.intersectsObject(a))){if(q===p){var b=new THREE.RenderableObject;f.push(b);p++;q++;d=b}else d=f[q++];d.id=a.id;d.object=a;O.setFromMatrixPosition(a.matrixWorld);O.applyProjection(R);d.z=O.z;d.renderOrder=a.renderOrder;Q.objects.push(d)}});!0===x&&Q.objects.sort(a);r=0;for(x=Q.objects.length;r<x;r++){var z=Q.objects[r].object,F=
z.geometry;ha.setObject(z);J=z.matrixWorld;u=0;if(z instanceof THREE.Mesh)if(F instanceof THREE.BufferGeometry){var E=F.attributes;z=F.groups;if(void 0!==E.position){for(var H=E.position.array,I=0,W=H.length;I<W;I+=3)ha.pushVertex(H[I],H[I+1],H[I+2]);if(void 0!==E.normal){var ba=E.normal.array;I=0;for(W=ba.length;I<W;I+=3)ha.pushNormal(ba[I],ba[I+1],ba[I+2])}if(void 0!==E.uv)for(E=E.uv.array,I=0,W=E.length;I<W;I+=2)ha.pushUv(E[I],E[I+1]);if(null!==F.index)if(H=F.index.array,0<z.length)for(r=0;r<z.length;r++)for(W=
z[r],I=W.start,W=W.start+W.count;I<W;I+=3)ha.pushTriangle(H[I],H[I+1],H[I+2]);else for(I=0,W=H.length;I<W;I+=3)ha.pushTriangle(H[I],H[I+1],H[I+2]);else for(I=0,W=H.length/3;I<W;I+=3)ha.pushTriangle(I,I+1,I+2)}}else{if(F instanceof THREE.Geometry){var V=F.vertices;I=F.faces;W=F.faceVertexUvs[0];S.getNormalMatrix(J);H=z.material;E=H instanceof THREE.MultiMaterial;ba=!0===E?z.material:null;for(var ja=0,na=V.length;ja<na;ja++){var ra=V[ja];O.copy(ra);if(!0===H.morphTargets)for(var fa=F.morphTargets,Ga=
z.morphTargetInfluences,ca=0,Wa=fa.length;ca<Wa;ca++){var Ha=Ga[ca];if(0!==Ha){var ta=fa[ca].vertices[ja];O.x+=(ta.x-ra.x)*Ha;O.y+=(ta.y-ra.y)*Ha;O.z+=(ta.z-ra.z)*Ha}}ha.pushVertex(O.x,O.y,O.z)}V=0;for(ja=I.length;V<ja;V++)if(na=I[V],H=!0===E?ba.materials[na.materialIndex]:z.material,void 0!==H&&(Ga=H.side,F=k[na.a],ra=k[na.b],fa=k[na.c],!1!==ha.checkTriangleVisibility(F,ra,fa))){ca=ha.checkBackfaceCulling(F,ra,fa);if(Ga!==THREE.DoubleSide){if(Ga===THREE.FrontSide&&!1===ca)continue;if(Ga===THREE.BackSide&&
!0===ca)continue}n=b();n.id=z.id;n.v1.copy(F);n.v2.copy(ra);n.v3.copy(fa);n.normalModel.copy(na.normal);!1!==ca||Ga!==THREE.BackSide&&Ga!==THREE.DoubleSide||n.normalModel.negate();n.normalModel.applyMatrix3(S).normalize();Wa=na.vertexNormals;Ha=0;for(ta=Math.min(Wa.length,3);Ha<ta;Ha++){var oa=n.vertexNormalsModel[Ha];oa.copy(Wa[Ha]);!1!==ca||Ga!==THREE.BackSide&&Ga!==THREE.DoubleSide||oa.negate();oa.applyMatrix3(S).normalize()}n.vertexNormalsLength=Wa.length;Ga=W[V];if(void 0!==Ga)for(ca=0;3>ca;ca++)n.uvs[ca].copy(Ga[ca]);
n.color=na.color;n.material=H;n.z=(F.positionScreen.z+ra.positionScreen.z+fa.positionScreen.z)/3;n.renderOrder=z.renderOrder;Q.elements.push(n)}}}else if(z instanceof THREE.Line)if(F instanceof THREE.BufferGeometry){if(E=F.attributes,void 0!==E.position){H=E.position.array;I=0;for(W=H.length;I<W;I+=3)ha.pushVertex(H[I],H[I+1],H[I+2]);if(null!==F.index)for(H=F.index.array,I=0,W=H.length;I<W;I+=2)ha.pushLine(H[I],H[I+1]);else for(E=z instanceof THREE.LineSegments?2:1,I=0,W=H.length/3-1;I<W;I+=E)ha.pushLine(I,
I+1)}}else{if(F instanceof THREE.Geometry&&(T.multiplyMatrices(R,J),V=z.geometry.vertices,0!==V.length))for(F=l(),F.positionScreen.copy(V[0]).applyMatrix4(T),E=z instanceof THREE.LineSegments?2:1,ja=1,na=V.length;ja<na;ja++)F=l(),F.positionScreen.copy(V[ja]).applyMatrix4(T),0<(ja+1)%E||(ra=k[u-2],U.copy(F.positionScreen),qa.copy(ra.positionScreen),!0===e(U,qa)&&(U.multiplyScalar(1/U.w),qa.multiplyScalar(1/qa.w),A=g(),A.id=z.id,A.v1.positionScreen.copy(U),A.v2.positionScreen.copy(qa),A.z=Math.max(U.z,
qa.z),A.renderOrder=z.renderOrder,A.material=z.material,z.material.vertexColors===THREE.VertexColors&&(A.vertexColors[0].copy(z.geometry.colors[ja]),A.vertexColors[1].copy(z.geometry.colors[ja-1])),Q.elements.push(A)))}else z instanceof THREE.Sprite&&(L.set(J.elements[12],J.elements[13],J.elements[14],1),L.applyMatrix4(R),I=1/L.w,L.z*=I,-1<=L.z&&1>=L.z&&(G=m(),G.id=z.id,G.x=L.x*I,G.y=L.y*I,G.z=L.z,G.renderOrder=z.renderOrder,G.object=z,G.rotation=z.rotation,G.scale.x=z.scale.x*Math.abs(G.x-(L.x+w.projectionMatrix.elements[0])/
(L.w+w.projectionMatrix.elements[12])),G.scale.y=z.scale.y*Math.abs(G.y-(L.y+w.projectionMatrix.elements[5])/(L.w+w.projectionMatrix.elements[13])),G.material=z.material,Q.elements.push(G)))}!0===B&&Q.elements.sort(a);return Q}};
function TimeSeries(l){l=l||{};l.resetBoundsInterval=l.resetBoundsInterval||3E3;l.resetBounds=void 0===l.resetBounds?!0:l.resetBounds;this.options=l;this.data=[];this.label=l.label||"";this.maxDataLength=l.maxDataLength||1E3;this.dataPool=[];this.minValue=this.maxValue=Number.NaN;l.resetBounds&&(this.boundsTimer=setInterval(function(b){return function(){b.resetBounds()}}(this),l.resetBoundsInterval))}
TimeSeries.prototype.resetBounds=function(){this.minValue=this.maxValue=Number.NaN;for(var l=0;l<this.data.length;l++)this.maxValue=isNaN(this.maxValue)?this.data[l][1]:Math.max(this.maxValue,this.data[l][1]),this.minValue=isNaN(this.minValue)?this.data[l][1]:Math.min(this.minValue,this.data[l][1])};
TimeSeries.prototype.append=function(l,b){this.lastTimeStamp=l;var g=this.dataPool.length?this.dataPool.pop():[l,b];g[0]=l;g[1]=b;this.data.push(g);this.maxValue=isNaN(this.maxValue)?b:Math.max(this.maxValue,b);for(this.minValue=isNaN(this.minValue)?b:Math.min(this.minValue,b);this.data.length>this.maxDataLength;)this.dataPool.push(this.data.shift())};
function SmoothieChart(l){l=l||{};l.grid=l.grid||{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:1,millisPerLine:1E3,verticalSections:2};l.millisPerPixel=l.millisPerPixel||20;l.fps=l.fps||50;l.maxValueScale=l.maxValueScale||1;l.minValue=l.minValue;l.maxValue=l.maxValue;l.labels=l.labels||{fillStyle:"#ffffff"};l.interpolation=l.interpolation||"bezier";l.scaleSmoothing=l.scaleSmoothing||.125;l.maxDataSetLength=l.maxDataSetLength||2;l.timestampFormatter=l.timestampFormatter||null;this.options=l;
this.seriesSet=[];this.currentValueRange=1;this.currentVisMinValue=0}SmoothieChart.prototype.addTimeSeries=function(l,b){this.seriesSet.push({timeSeries:l,options:b||{}})};SmoothieChart.prototype.removeTimeSeries=function(l){this.seriesSet.splice(this.seriesSet.indexOf(l),1)};SmoothieChart.prototype.streamTo=function(l,b){var g=this;this.render_on_tick=function(){g.render(l,g.seriesSet[0].timeSeries.lastTimeStamp)};this.start()};
SmoothieChart.prototype.start=function(){this.timer||(this.timer=setInterval(this.render_on_tick,1E3/this.options.fps))};SmoothieChart.prototype.stop=function(){this.timer&&(clearInterval(this.timer),this.timer=void 0)};SmoothieChart.timeFormatter=function(l){function b(b){return(10>b?"0":"")+b}return b(l.getHours())+":"+b(l.getMinutes())+":"+b(l.getSeconds())};
SmoothieChart.prototype.render=function(l,b){var g=l.getContext("2d"),m=this.options,a=l.clientWidth,e=l.clientHeight;g.save();b-=b%m.millisPerPixel;g.translate(0,0);g.beginPath();g.rect(0,0,a,e);g.clip();g.save();g.fillStyle=m.grid.fillStyle;g.clearRect(0,0,a,e);g.fillRect(0,0,a,e);g.restore();g.save();g.lineWidth=m.grid.lineWidth||1;g.strokeStyle=m.grid.strokeStyle||"#ffffff";if(0<m.grid.millisPerLine)for(var d=b-b%m.grid.millisPerLine;d>=b-a*m.millisPerPixel;d-=m.grid.millisPerLine){g.beginPath();
var q=Math.round(a-(b-d)/m.millisPerPixel);g.moveTo(q,0);g.lineTo(q,e);g.stroke();if(m.timestampFormatter){var f=m.timestampFormatter(new Date(d)),p=g.measureText(f).width/2+g.measureText(A).width+4;q<a-p&&(g.fillStyle=m.labels.fillStyle,g.fillText(f,q-g.measureText(f).width/2,e-2))}g.closePath()}for(A=1;A<m.grid.verticalSections;A++)d=Math.round(A*e/m.grid.verticalSections),g.beginPath(),g.moveTo(0,d),g.lineTo(a,d),g.stroke(),g.closePath();g.beginPath();g.strokeRect(0,0,a,e);g.closePath();g.restore();
A=q=Number.NaN;for(f=0;f<this.seriesSet.length;f++){var w=this.seriesSet[f].timeSeries;isNaN(w.maxValue)||(q=isNaN(q)?w.maxValue:Math.max(q,w.maxValue));isNaN(w.minValue)||(A=isNaN(A)?w.minValue:Math.min(A,w.minValue))}if(!isNaN(q)||!isNaN(A)){q=null!=m.maxValue?m.maxValue:q*m.maxValueScale;null!=m.minValue&&(A=m.minValue);this.currentValueRange+=m.scaleSmoothing*(q-A-this.currentValueRange);this.currentVisMinValue+=m.scaleSmoothing*(A-this.currentVisMinValue);p=this.currentValueRange;var u=this.currentVisMinValue;
for(f=0;f<this.seriesSet.length;f++){g.save();w=this.seriesSet[f].timeSeries;w=w.data;for(var k=this.seriesSet[f].options;w.length>=m.maxDataSetLength&&w[1][0]<b-a*m.millisPerPixel;)w.splice(0,1);g.lineWidth=k.lineWidth||1;g.fillStyle=k.fillStyle;g.strokeStyle=k.strokeStyle||"#ffffff";g.beginPath();var r=0,n=0,v=0;for(d=0;d<w.length;d++){var x=Math.round(a-(b-w[d][0])/m.millisPerPixel),z=w[d][1]-u;z=Math.max(Math.min(e-(p?Math.round(z/p*e):0),e-1),1);if(0==d)r=x,g.moveTo(x,z);else switch(m.interpolation){case "line":g.lineTo(x,
z);break;default:g.bezierCurveTo(Math.round((n+x)/2),v,Math.round(n+x)/2,z,x,z)}n=x;v=z}0<w.length&&k.fillStyle&&(g.lineTo(a+k.lineWidth+1,v),g.lineTo(a+k.lineWidth+1,e+k.lineWidth+1),g.lineTo(r,e+k.lineWidth),g.fill());g.stroke();g.closePath();g.restore()}if(!m.labels.disabled){m.labelOffsetY||(m.labelOffsetY=0);g.fillStyle=m.labels.fillStyle;d=parseFloat(q).toFixed(2);var A=parseFloat(A).toFixed(2);g.fillText(d,a-g.measureText(d).width-2,10);g.fillText(A,a-g.measureText(A).width-2,e-2);for(d=0;d<
this.seriesSet.length;d++)w=this.seriesSet[d].timeSeries,a=w.label,g.fillStyle=w.options.fillStyle||"rgb(255,255,255)",a&&g.fillText(a,2,10*(d+1)+m.labelOffsetY)}}g.restore()};
THREE.SoftwareRenderer=function(l){function b(){for(var a=r*n*4,b=0;b<a;b+=4)B[b]=255*K.r|0,B[b+1]=255*K.g|0,B[b+2]=255*K.b|0,B[b+3]=255;w.fillStyle=K.getStyle();w.fillRect(0,0,r,n)}function g(a,b){var d=0,e=0,f=255*a.color.r,g=255*a.color.g,k=255*a.color.b,l=new Uint8Array(768);if(b){for(;204>d;)l[e++]=Math.min(d*f/204,255),l[e++]=Math.min(d*g/204,255),l[e++]=Math.min(d*k/204,255),++d;for(;256>d;)l[e++]=Math.min(f+(d-204)*(255-f)/82,255),l[e++]=Math.min(g+(d-204)*(255-g)/82,255),l[e++]=Math.min(k+
(d-204)*(255-k)/82,255),++d}else for(;256>d;)l[e++]=Math.min(d*f/255,255),l[e++]=Math.min(d*g/255,255),l[e++]=Math.min(d*k/255,255),++d;return l}function m(a,b,d,e,f,g,l,m,n){l=4*d;m=k[n.map.id];if(m.data){var p=m.width,q=p-1;m=m.data;f=4*((g*p&q)*p+(f*p&q));if(n.transparent){g=m[f+1];p=m[f+2];q=m[f+3]*n.opacity/255;var r=a[l+1],v=a[l+2];a[l]=m[f]*q+a[l]*(1-q);a[l+1]=g*q+r*(1-q);a[l+2]=p*q+v*(1-q);a[l+3]=(n.opacity<<8)-1;255==a[l+3]&&(b[d]=e)}else a[l]=m[f],a[l+1]=m[f+1],a[l+2]=m[f+2],a[l+3]=(n.opacity<<
8)-1,b[d]=e}}function a(a,b,d,e,f,g,l,m,n){m=4*d;var p=k[n.map.id];if(p.data){var q=p.width;l=3*(0<l?~~l:0);var r=q-1;p=p.data;f=4*((g*q&r)*q+(f*q&r));if(n.transparent){g=n.palette[l+1]*p[f+1];q=n.palette[l+2]*p[f+2];r=p[f+3]*n.opacity/256;var v=a[m+1],u=a[m+2];a[m]=n.palette[l]*p[f]*r+a[m]*(1-r);a[m+1]=g*r+v*(1-r);a[m+2]=q*r+u*(1-r);a[m+3]=(n.opacity<<8)-1;255==a[m+3]&&(b[d]=e)}else a[m]=n.palette[l]*p[f]>>8,a[m+1]=n.palette[l+1]*p[f+1]>>8,a[m+2]=n.palette[l+2]*p[f+2]>>8,a[m+3]=(n.opacity<<8)-1,
b[d]=e}}function e(a){a=a.target;a.removeEventListener("update",e);delete u[a.id]}function d(b){var d=b.id,f=u[d];f&&b.map&&!k[b.map.id]&&delete u[d];if(void 0===u[d]){b.addEventListener("update",e);if(b instanceof THREE.MeshBasicMaterial||b instanceof THREE.MeshLambertMaterial||b instanceof THREE.MeshPhongMaterial||b instanceof THREE.SpriteMaterial)if(b instanceof THREE.MeshLambertMaterial?b.palette||(b.palette=g(b,!1)):b instanceof THREE.MeshPhongMaterial&&!b.palette&&(b.palette=g(b,!0)),b.map){f=
new THREE.SoftwareRenderer.Texture;f.fromImage(b.map.image);if(!f.data)return;k[b.map.id]=f;f=b instanceof THREE.MeshBasicMaterial||b instanceof THREE.SpriteMaterial?m:a}else b=b.vertexColors===THREE.FaceColors?"var colorOffset = offset * 4;\nbuffer[ colorOffset ] = face.color.r * 255;\nbuffer[ colorOffset + 1 ] = face.color.g * 255;\nbuffer[ colorOffset + 2 ] = face.color.b * 255;\nbuffer[ colorOffset + 3 ] = material.opacity * 255;\ndepthBuf[ offset ] = depth;":"var colorOffset = offset * 4;\nbuffer[ colorOffset ] = material.color.r * 255;\nbuffer[ colorOffset + 1 ] = material.color.g * 255;\nbuffer[ colorOffset + 2 ] = material.color.b * 255;\nbuffer[ colorOffset + 3 ] = material.opacity * 255;\ndepthBuf[ offset ] = depth;",
f=new Function("buffer, depthBuf, offset, depth, u, v, n, face, material",b);else f=b instanceof THREE.LineBasicMaterial?new Function("buffer, depthBuf, offset, depth, color1, color2, material","var colorOffset = offset * 4;\nbuffer[ colorOffset ] = material.color.r * (color1.r+color2.r) * 0.5 * 255;\nbuffer[ colorOffset + 1 ] = material.color.g * (color1.g+color2.g) * 0.5 * 255;\nbuffer[ colorOffset + 2 ] = material.color.b * (color1.b+color2.b) * 0.5 * 255;\nbuffer[ colorOffset + 3 ] = 255;\ndepthBuf[ offset ] = depth;"):
new Function("buffer, depthBuf, offset, depth, u, v, n, face, material","var colorOffset = offset * 4;\nbuffer[ colorOffset ] = u * 255;\nbuffer[ colorOffset + 1 ] = v * 255;\nbuffer[ colorOffset + 2 ] = 0;\nbuffer[ colorOffset + 3 ] = 255;\ndepthBuf[ offset ] = depth;");u[d]=f}return f}function q(a,b,d,e,g,k,l,m,p){if(!(-1>a.z||1<a.z||-1>b.z||1<b.z||-1>d.z||1<d.z)){var u=a.x*z+E|0,w=b.x*z+E|0,x=d.x*z+E|0,I=a.y*A+F|0,K=b.y*A+F|0,O=d.y*A+F|0,J=m.vertexNormalsModel&&m.vertexNormalsModel.length,P=e&&
g&&k,ca=Math.max(Math.sqrt((u-w)*(u-w)+(I-K)*(I-K)),Math.sqrt((w-x)*(w-x)+(K-O)*(K-O)),Math.sqrt((x-u)*(x-u)+(O-I)*(O-I)));if(!(m instanceof THREE.RenderableSprite)&&1600<ca){var R={vertexNormalsModel:[],color:m.color};if(P){if(ra===Va.length){var V=new THREE.Vector2;Va.push(V);++ra;var X=new THREE.Vector2;Va.push(X);++ra;var ha=new THREE.Vector2;Va.push(ha)}else V=Va[ra],++ra,X=Va[ra],++ra,ha=Va[ra];++ra;var Z=b.w/a.w*(1+b.z)/(1+a.z);V.copy(e).multiplyScalar(Z).add(g).multiplyScalar(1/(Z+1));Z=d.w/
b.w*(1+d.z)/(1+b.z);X.copy(g).multiplyScalar(Z).add(k).multiplyScalar(1/(Z+1));Z=a.w/d.w*(1+a.z)/(1+d.z);ha.copy(k).multiplyScalar(Z).add(e).multiplyScalar(1/(Z+1))}if(va===za.length){var qa=new THREE.Vector4;za.push(qa);++va;var ta=new THREE.Vector4;za.push(ta);++va;var oa=new THREE.Vector4;za.push(oa)}else qa=za[va],++va,ta=za[va],++va,oa=za[va];++va;qa.copy(a).add(b).multiplyScalar(.5);ta.copy(b).add(d).multiplyScalar(.5);oa.copy(d).add(a).multiplyScalar(.5);if(J){if(La===ya.length){var ja=new THREE.Vector3;
ya.push(ja);++La;var fa=new THREE.Vector3;ya.push(fa);++La;var na=new THREE.Vector3;ya.push(na)}else ja=ya[La],++La,fa=ya[La],++La,na=ya[La];++La;ja.copy(m.vertexNormalsModel[0]).add(m.vertexNormalsModel[1]).normalize();fa.copy(m.vertexNormalsModel[1]).add(m.vertexNormalsModel[2]).normalize();na.copy(m.vertexNormalsModel[2]).add(m.vertexNormalsModel[0]).normalize()}J&&(R.vertexNormalsModel[0]=m.vertexNormalsModel[0],R.vertexNormalsModel[1]=ja,R.vertexNormalsModel[2]=na);q(a,qa,oa,e,V,ha,l,R,p);J&&
(R.vertexNormalsModel[0]=m.vertexNormalsModel[1],R.vertexNormalsModel[1]=fa,R.vertexNormalsModel[2]=ja);q(b,ta,qa,g,X,V,l,R,p);J&&(R.vertexNormalsModel[0]=ja,R.vertexNormalsModel[1]=fa,R.vertexNormalsModel[2]=na);q(qa,ta,oa,V,X,ha,l,R,p);J&&(R.vertexNormalsModel[0]=m.vertexNormalsModel[2],R.vertexNormalsModel[1]=na,R.vertexNormalsModel[2]=fa);q(d,oa,ta,k,ha,X,l,R,p)}else{var pa=a.z*D+G|0,sa=b.z*D+G|0,Ha=d.z*D+G|0;P=!1;if(e&&g&&k){P=!0;var wa=e.x;var Wa=1-e.y;var Aa=g.x;var Da=1-g.y;var Ga=k.x;var Ia=
1-k.y}if(J){var Jd=m.vertexNormalsModel[0];var Kd=m.vertexNormalsModel[1];var Ld=m.vertexNormalsModel[2];var kd=255*Jd.z;var Md=255*Kd.z;var Nd=255*Ld.z}var qb=u-w,db=K-I,rb=w-x,lb=O-K,Za=x-u,gb=I-O,wb=Math.max(Math.min(u,w,x)+15>>4,0),wc=Math.min(Math.max(u,w,x)+15>>4,r),ec=Math.max(Math.min(I,K,O)+15>>4,0),fc=Math.min(Math.max(I,K,O)+15>>4,n);T=Math.min(wb,T);ea=Math.max(wc,ea);S=Math.min(ec,S);U=Math.max(fc,U);var Ma=ba;wb&=~(Ma-1);ec&=~(Ma-1);var Mb=wb<<4,Nb=ec<<4,Qa=db*(Mb-u)+qb*(Nb-I),xb=lb*
(Mb-w)+rb*(Nb-K),Ka=gb*(Mb-x)+Za*(Nb-O);(0<db||0==db&&0<qb)&&Qa++;(0<lb||0==lb&&0<rb)&&xb++;(0<gb||0==gb&&0<Za)&&Ka++;Qa=Qa-1>>4;xb=xb-1>>4;Ka=Ka-1>>4;var yb=pa-sa,zc=Ha-pa,zb=1/(qb*gb-Za*db),Ab=zb*(yb*gb-zc*db),mb=zb*(yb*Za-qb*zc),Yc=pa+(Mb-u)*Ab+(Nb-I)*mb|0;Ab=16*Ab|0;mb=16*mb|0;if(P){var Hc=wa-Aa,Ac=Ga-wa,Vb=zb*(Hc*gb-Ac*db),$a=zb*(Hc*Za-qb*Ac),Ic=Wa-Da,Jc=Ia-Wa;var Wb=zb*(Ic*gb-Jc*db);var Xb=zb*(Ic*Za-qb*Jc);var hb=wa+(Mb-u)*Vb+(Nb-I)*$a;var Ob=Wa+(Mb-u)*Wb+(Nb-I)*Xb;Vb*=16;$a*=16;Wb*=16;Xb*=
16}if(J){var Kc=kd-Md,Bc=Nd-kd,Yb=zb*(Kc*gb-Bc*db);var ab=zb*(Kc*Za-qb*Bc);var Zb=kd+(Mb-u)*Yb+(Nb-I)*ab;Yb*=16;ab*=16}var Ta=Ma-1,gc=0,$b=0,Cc=0,hc=0,ic=0,jc=0,Pb=0,kc=0;0<=qb?$b-=Ta*qb:gc-=Ta*qb;0<=db?$b-=Ta*db:gc-=Ta*db;0<=rb?hc-=Ta*rb:Cc-=Ta*rb;0<=lb?hc-=Ta*lb:Cc-=Ta*lb;0<=Za?jc-=Ta*Za:ic-=Ta*Za;0<=gb?jc-=Ta*gb:ic-=Ta*gb;0<=Ab?kc+=Ta*Ab:Pb+=Ta*Ab;0<=mb?kc+=Ta*mb:Pb+=Ta*mb;var ac=r-Ma,nb=Qa,Bb=xb,Hb=Ka,Cb=Yc,ib=-Ma,Ib=ib*db,Qb=ib*lb,Rb=ib*gb,lc=ib*Ab;if(P){var vb=ib*Vb;var Sb=ib*Wb}var Db;J&&(Db=
ib*Yb);for(var ob=wb,Tb=ec;Tb<fc;Tb+=Ma){for(;ob>=wb&&ob<wc&&nb>=$b&&Bb>=hc&&Hb>=jc;)ob+=ib,nb+=Ib,Bb+=Qb,Hb+=Rb,Cb+=lc,P&&(hb+=vb,Ob+=Sb),J&&(Zb+=Db);ib=-ib;Ib=-Ib;Qb=-Qb;Rb=-Rb;lc=-lc;P&&(vb=-vb,Sb=-Sb);for(J&&(Db=-Db);;){ob+=ib;nb+=Ib;Bb+=Qb;Hb+=Rb;Cb+=lc;P&&(hb+=vb,Ob+=Sb);J&&(Zb+=Db);if(ob<wb||ob>=wc)break;if(nb<$b)if(0>Ib)break;else continue;if(Bb<hc)if(0>Qb)break;else continue;if(Hb<jc)if(0>Rb)break;else continue;var mc=ob>>W,Zc=Tb>>W,jb=mc+Zc*v;if(!(L[jb]<Cb+Pb)){var md=H[jb];md&2&&f(mc,Zc);
H[jb]=md&-4;var Ub=ob+Tb*r;if(nb>=gc&&Bb>=Cc&&Hb>=ic){L[jb]=Math.min(L[jb],Cb+kc);var bc=nb,Dc=Bb,nc=Cb;if(P){var Ua=hb;var oc=Ob}var Eb;J&&(Eb=Zb);for(var pc=0;pc<Ma;pc++){var Ec=bc,Fc=Dc,qc=nc;if(P){var rc=Ua;var sc=oc}var Na;J&&(Na=Eb);for(var tc=0;tc<Ma;tc++){var cc=qc;cc<Q[Ub]&&l(B,Q,Ub,cc,rc,sc,Na,m,p);Ec+=db;Fc+=lb;qc+=Ab;P&&(rc+=Vb,sc+=Wb);J&&(Na+=Yb);Ub++}bc+=qb;Dc+=rb;nc+=mb;P&&(Ua+=$a,oc+=Xb);J&&(Eb+=ab);Ub+=ac}}else{bc=nb;Dc=Bb;var Nc=Hb;nc=Cb;P&&(Ua=hb,oc=Ob);J&&(Eb=Zb);for(pc=0;pc<Ma;pc++){Ec=
bc;Fc=Dc;var uc=Nc;qc=nc;P&&(rc=Ua,sc=oc);J&&(Na=Eb);for(tc=0;tc<Ma;tc++)0<=(Ec|Fc|uc)&&(cc=qc,cc<Q[Ub]&&l(B,Q,Ub,cc,rc,sc,Na,m,p)),Ec+=db,Fc+=lb,uc+=gb,qc+=Ab,P&&(rc+=Vb,sc+=Wb),J&&(Na+=Yb),Ub++;bc+=qb;Dc+=rb;Nc+=Za;nc+=mb;P&&(Ua+=$a,oc+=Xb);J&&(Eb+=ab);Ub+=ac}}}}nb+=Ma*qb;Bb+=Ma*rb;Hb+=Ma*Za;Cb+=Ma*mb;P&&(hb+=Ma*$a,Ob+=Ma*Xb);J&&(Zb+=Ma*ab)}}}}function f(a,b){for(var d=a*ba+b*ba*r,e=4*d,f=r-ba,g=4*f,k=0;k<ba;k++){for(var l=0;l<ba;l++)Q[d++]=16777216,B[e++]=255*K.r|0,B[e++]=255*K.g|0,B[e++]=255*
K.b|0,B[e++]=255;d+=f;e+=g}}console.log("THREE.SoftwareRenderer",THREE.REVISION);l=l||{};var p=void 0!==l.canvas?l.canvas:document.createElement("canvas"),w=p.getContext("2d",{alpha:!0===l.alpha}),u={},k={},r,n,v,x,z,A,D,E,F,G,K=new THREE.Color(0),I,B,Q,O,L,H,W=3,ba=1<<W,X=!1,R=new THREE.Vector3(0,0,1),J=new THREE.Vector3,T=Infinity,S=Infinity,ea=0,U=0,qa=Infinity,ha=Infinity,ja=0,V=0,Ia=new THREE.Projector,na=new THREE.Vector4,wa=new THREE.Vector4,Z=new THREE.Vector4,Aa=new THREE.Vector2,Da=new THREE.Vector2,
sa=new THREE.Vector2,za=[],va=0,ya=[],La=0,Va=[],ra=0;this.domElement=p;this.autoClear=!0;this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.setClearColor=function(a,d){K.set(a);b()};this.setPixelRatio=function(){};this.setSize=function(a,d){v=Math.floor(a/ba);x=Math.floor(d/ba);r=v*ba;n=x*ba;z=16*r/2;A=-16*n/2;D=8388608;E=16*r/2+.5;F=16*n/2+.5;G=8388608.5;p.width=r;p.height=n;w.fillStyle=K.getStyle();w.fillRect(0,0,r,n);I=w.getImageData(0,0,r,n);B=I.data;Q=new Int32Array(B.length/
4);O=v*x;L=new Int32Array(O);H=new Uint8Array(O);for(var e=0,f=Q.length;e<f;e++)Q[e]=16777216;for(e=0;e<O;e++)H[e]=1;b()};this.setSize(p.width,p.height);this.clear=function(){S=T=Infinity;for(var a=ra=La=va=U=ea=0;a<O;a++)L[a]=16777216,H[a]=H[a]&1?1:2};this.render=function(a,e){!0===this.autoClear&&this.clear();for(var g=Ia.projectScene(a,e,!1,!1).elements,k=0,l=g.length;k<l;k++){var m=g[k],u=m.material,P=d(u);if(P)if(m instanceof THREE.RenderableFace)m.uvs?q(m.v1.positionScreen,m.v2.positionScreen,
m.v3.positionScreen,m.uvs[0],m.uvs[1],m.uvs[2],P,m,u):q(m.v1.positionScreen,m.v2.positionScreen,m.v3.positionScreen,null,null,null,P,m,u);else if(m instanceof THREE.RenderableSprite){var pa=.5*m.scale.x,fa=.5*m.scale.y;na.copy(m);na.x-=pa;na.y+=fa;wa.copy(m);wa.x-=pa;wa.y-=fa;Z.copy(m);Z.x+=pa;Z.y+=fa;u.map?(Aa.set(0,1),Da.set(0,0),sa.set(1,1),q(na,wa,Z,Aa,Da,sa,P,m,u)):q(na,wa,Z,null,null,null,P,m,u);na.copy(m);na.x+=pa;na.y+=fa;wa.copy(m);wa.x-=pa;wa.y-=fa;Z.copy(m);Z.x+=pa;Z.y-=fa;u.map?(Aa.set(1,
1),Da.set(0,0),sa.set(1,0),q(na,wa,Z,Aa,Da,sa,P,m,u)):q(na,wa,Z,null,null,null,P,m,u)}else if(m instanceof THREE.RenderableLine){P=d(u);var ra=m.v1.positionScreen,ma=m.v2.positionScreen;pa=m.vertexColors[0];m=m.vertexColors[1];if(!X){X=!0;W=0;ba=1<<W;fa=p.height;v=Math.floor(p.width/ba);x=Math.floor(fa/ba);r=v*ba;n=x*ba;z=16*r/2;A=-16*n/2;D=8388608;E=16*r/2+.5;F=16*n/2+.5;G=8388608.5;p.width=r;p.height=n;w.fillStyle=K.getStyle();w.fillRect(0,0,r,n);I=w.getImageData(0,0,r,n);B=I.data;Q=new Int32Array(B.length/
4);O=v*x;L=new Int32Array(O);H=new Uint8Array(O);fa=0;for(var va=Q.length;fa<va;fa++)Q[fa]=16777216;for(fa=0;fa<O;fa++)H[fa]=1;b()}if(!(-1>ra.z||1<ra.z||-1>ma.z||1<ma.z)){fa=Math.floor(.5*(u.linewidth-1));var ia=ra.x*z+E|0;va=ma.x*z+E|0;var Ca=ra.y*A+F|0,za=ma.y*A+F|0;var ya=ra.z*D+G|0;ma=ma.z*D+G|0;var Ea=ia-va,Ga=Ca-za;var La=Math.min(Math.max(ia,va)+15>>4,r);var Va=Math.max(Math.min(Ca,za)+15>>4,0);var ub=Math.min(Math.max(Ca,za)+15>>4,n);ra=Math.max(Math.min(ya,ma)+15>>4,0);Ca=Math.max(ya,ma)+
15>>4;T=Math.min(Math.max(Math.min(ia,va)+15>>4,0),T);ea=Math.max(La,ea);S=Math.min(Va,S);U=Math.max(ub,U);ia=Math.sqrt(Ga*Ga+Ea*Ea);Ea/=ia;Ga/=ia;Va=(ya-ma)/ia;J.set(Ea,Ga,Va);J.cross(R);for(J.normalize();0<ia;){La=va+ia*Ea;ya=za+ia*Ga;ub=ma+ia*Va;La=La+15>>4;ya=ya+15>>4;ub=ub+15>>4;for(var yc=-fa;yc<=fa;++yc){var bb=Math.floor(La+J.x*yc);var Ya=Math.floor(ya+J.y*yc);if(!(T>=bb||ea<=bb||S>=Ya||U<=Ya)){var Fb=bb>>W,Ja=Ya>>W,Xa=Fb+Ja*v;if(!(L[Xa]<ra)){L[Xa]=Math.min(L[Xa],Ca);var Kb=H[Xa];Kb&2&&f(Fb,
Ja);H[Xa]=Kb&-4;Ya=bb+Ya*r;ub<Q[Ya]&&P(B,Q,Ya,ub,pa,m,u)}}}--ia}}}}for(k=g=0;k<x;k++)for(l=0;l<v;l++)H[g]&2&&(f(l,k),H[g]=1),g++;g=Math.min(T,qa);k=Math.min(S,ha);l=Math.max(ea,ja)-g;pa=Math.max(U,V)-k;Infinity!==g&&w.putImageData(I,0,0,g,k,l,pa);qa=T;ha=S;ja=ea;V=U}};
THREE.SoftwareRenderer.Texture=function(){var l;this.fromImage=function(b){if(!(!b||0>=b.width||0>=b.height)){void 0===l&&(l=document.createElement("canvas"));var g=b.width>b.height?b.width:b.height;g=THREE.Math.nextPowerOfTwo(g);if(l.width!=g||l.height!=g)l.width=g,l.height=g;var m=l.getContext("2d");m.clearRect(0,0,g,g);m.drawImage(b,0,0,g,g);this.data=m.getImageData(0,0,g,g).data;this.height=this.width=g;this.srcUrl=b.src}}};
var Stats=function(){var l=0,b=0,g=Date.now(),m=g,a=g,e=0,d=1E3,q=0,f=[[16,16,48],[0,255,255]],p=0,w=1E3,u=0,k=[[16,48,16],[0,255,0]];var r=document.createElement("div");r.style.cursor="pointer";r.style.width="80px";r.style.opacity="0.9";r.style.zIndex="10001";r.addEventListener("mousedown",function(a){a.preventDefault();l=(l+1)%2;0==l?(n.style.display="block",A.style.display="none"):(n.style.display="none",A.style.display="block")},!1);var n=document.createElement("div");n.style.textAlign="left";
n.style.lineHeight="1.2em";n.style.backgroundColor="rgb("+Math.floor(f[0][0]/2)+","+Math.floor(f[0][1]/2)+","+Math.floor(f[0][2]/2)+")";n.style.padding="0 0 3px 3px";r.appendChild(n);var v=document.createElement("div");v.style.fontFamily="Helvetica, Arial, sans-serif";v.style.fontSize="9px";v.style.color="rgb("+f[1][0]+","+f[1][1]+","+f[1][2]+")";v.style.fontWeight="bold";v.innerHTML="FPS";n.appendChild(v);var x=document.createElement("div");x.style.position="relative";x.style.width="74px";x.style.height=
"30px";x.style.backgroundColor="rgb("+f[1][0]+","+f[1][1]+","+f[1][2]+")";for(n.appendChild(x);74>x.children.length;){var z=document.createElement("span");z.style.width="1px";z.style.height="30px";z.style.cssFloat="left";z.style.backgroundColor="rgb("+f[0][0]+","+f[0][1]+","+f[0][2]+")";x.appendChild(z)}var A=document.createElement("div");A.style.textAlign="left";A.style.lineHeight="1.2em";A.style.backgroundColor="rgb("+Math.floor(k[0][0]/2)+","+Math.floor(k[0][1]/2)+","+Math.floor(k[0][2]/2)+")";
A.style.padding="0 0 3px 3px";A.style.display="none";r.appendChild(A);var D=document.createElement("div");D.style.fontFamily="Helvetica, Arial, sans-serif";D.style.fontSize="9px";D.style.color="rgb("+k[1][0]+","+k[1][1]+","+k[1][2]+")";D.style.fontWeight="bold";D.innerHTML="MS";A.appendChild(D);var E=document.createElement("div");E.style.position="relative";E.style.width="74px";E.style.height="30px";E.style.backgroundColor="rgb("+k[1][0]+","+k[1][1]+","+k[1][2]+")";for(A.appendChild(E);74>E.children.length;)z=
document.createElement("span"),z.style.width="1px",z.style.height=30*Math.random()+"px",z.style.cssFloat="left",z.style.backgroundColor="rgb("+k[0][0]+","+k[0][1]+","+k[0][2]+")",E.appendChild(z);return{domElement:r,update:function(){g=Date.now();p=g-m;w=Math.min(w,p);u=Math.max(u,p);D.textContent=p+" MS ("+w+"-"+u+")";var f=Math.min(30,30-p/200*30);E.appendChild(E.firstChild).style.height=f+"px";m=g;b++;g>a+1E3&&(e=Math.round(1E3*b/(g-a)),d=Math.min(d,e),q=Math.max(q,e),v.textContent=e+" FPS ("+
d+"-"+q+")",f=Math.min(30,30-e/100*30),x.appendChild(x.firstChild).style.height=f+"px",a=g,b=0)}}};
THREE.TrackballControls=function(l,b){function g(a){!1!==d.enabled&&(window.removeEventListener("keydown",g),w=p,p===q.NONE)&&(a.keyCode!==d.keys[q.ROTATE]||d.noRotate?a.keyCode!==d.keys[q.ZOOM]||d.noZoom?a.keyCode!==d.keys[q.PAN]||d.noPan||(p=q.PAN):p=q.ZOOM:p=q.ROTATE)}function m(a){!1!==d.enabled&&(a.preventDefault(),a.stopPropagation(),p!==q.ROTATE||d.noRotate?p!==q.ZOOM||d.noZoom?p!==q.PAN||d.noPan||D.copy(K(a.pageX,a.pageY)):v.copy(K(a.pageX,a.pageY)):r.copy(I(a.pageX,a.pageY)))}function a(b){!1!==
d.enabled&&(b.preventDefault(),b.stopPropagation(),p=q.NONE,document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",a),d.dispatchEvent(G))}function e(a){if(!1!==d.enabled){a.preventDefault();a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3);n.y+=.01*b;d.dispatchEvent(F);d.dispatchEvent(G)}}var d=this,q={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=l;this.domElement=void 0!==b?b:document;this.enabled=!0;this.screen=
{left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noRoll=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var f=new THREE.Vector3,p=q.NONE,w=q.NONE,u=new THREE.Vector3,k=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Vector2,v=new THREE.Vector2,x=0,z=0,A=new THREE.Vector2,D=new THREE.Vector2;this.target0=this.target.clone();
this.position0=this.object.position.clone();this.up0=this.object.up.clone();var E={type:"change"},F={type:"start"},G={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft;this.screen.top=a.top+window.pageYOffset-b.clientTop;
this.screen.width=a.width;this.screen.height=a.height}};this.handleEvent=function(a){if("function"==typeof this[a.type])this[a.type](a)};var K=function(){var a=new THREE.Vector2;return function(b,e){a.set((b-d.screen.left)/d.screen.width,(e-d.screen.top)/d.screen.height);return a}}(),I=function(){var a=new THREE.Vector3,b=new THREE.Vector3,e=new THREE.Vector3;return function(f,g){e.set((f-.5*d.screen.width-d.screen.left)/(.5*d.screen.width),(.5*d.screen.height+d.screen.top-g)/(.5*d.screen.height),
0);var k=e.length();d.noRoll?e.z=k<Math.SQRT1_2?Math.sqrt(1-k*k):.5/k:1<k?e.normalize():e.z=Math.sqrt(1-k*k);u.copy(d.object.position).sub(d.target);a.copy(d.object.up).setLength(e.y);a.add(b.copy(d.object.up).cross(u).setLength(e.x));a.add(u.setLength(e.z));return a}}();this.rotateCamera=function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(){var e=Math.acos(k.dot(r)/k.length()/r.length());e&&(a.crossVectors(k,r).normalize(),e*=d.rotateSpeed,b.setFromAxisAngle(a,-e),u.applyQuaternion(b),
d.object.up.applyQuaternion(b),r.applyQuaternion(b),d.staticMoving?k.copy(r):(b.setFromAxisAngle(a,e*(d.dynamicDampingFactor-1)),k.applyQuaternion(b)))}}();this.zoomCamera=function(){if(p===q.TOUCH_ZOOM_PAN){var a=x/z;x=z;u.multiplyScalar(a)}else a=1+(v.y-n.y)*d.zoomSpeed,1!==a&&0<a&&(u.multiplyScalar(a),d.staticMoving?n.copy(v):n.y+=(v.y-n.y)*this.dynamicDampingFactor)};this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,e=new THREE.Vector3;return function(){a.copy(D).sub(A);a.lengthSq()&&
(a.multiplyScalar(u.length()*d.panSpeed),e.copy(u).cross(d.object.up).setLength(a.x),e.add(b.copy(d.object.up).setLength(a.y)),d.object.position.add(e),d.target.add(e),d.staticMoving?A.copy(D):A.add(a.subVectors(D,A).multiplyScalar(d.dynamicDampingFactor)))}}();this.checkDistances=function(){d.noZoom&&d.noPan||(u.lengthSq()>d.maxDistance*d.maxDistance&&d.object.position.addVectors(d.target,u.setLength(d.maxDistance)),u.lengthSq()<d.minDistance*d.minDistance&&d.object.position.addVectors(d.target,
u.setLength(d.minDistance)))};this.update=function(){u.subVectors(d.object.position,d.target);d.noRotate||d.rotateCamera();d.noZoom||d.zoomCamera();d.noPan||d.panCamera();d.object.position.addVectors(d.target,u);d.checkDistances();d.object.lookAt(d.target);1E-6<f.distanceToSquared(d.object.position)&&(d.dispatchEvent(E),f.copy(d.object.position))};this.reset=function(){w=p=q.NONE;d.target.copy(d.target0);d.object.position.copy(d.position0);d.object.up.copy(d.up0);u.subVectors(d.object.position,d.target);
d.object.lookAt(d.target);d.dispatchEvent(E);f.copy(d.object.position)};this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1);this.domElement.addEventListener("mousedown",function(b){!1!==d.enabled&&(b.preventDefault(),b.stopPropagation(),p===q.NONE&&(p=b.button),p!==q.ROTATE||d.noRotate?p!==q.ZOOM||d.noZoom?p!==q.PAN||d.noPan||(A.copy(K(b.pageX,b.pageY)),D.copy(A)):(n.copy(K(b.pageX,b.pageY)),v.copy(n)):(k.copy(I(b.pageX,b.pageY)),r.copy(k)),document.addEventListener("mousemove",
m,!1),document.addEventListener("mouseup",a,!1),d.dispatchEvent(F))},!1);this.domElement.addEventListener("mousewheel",e,!1);this.domElement.addEventListener("DOMMouseScroll",e,!1);this.domElement.addEventListener("touchstart",function(a){if(!1!==d.enabled){switch(a.touches.length){case 1:p=q.TOUCH_ROTATE;k.copy(I(a.touches[0].pageX,a.touches[0].pageY));r.copy(k);break;case 2:p=q.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;z=x=Math.sqrt(b*b+e*
e);A.copy(K((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));D.copy(A);break;default:p=q.NONE}d.dispatchEvent(F)}},!1);this.domElement.addEventListener("touchend",function(a){if(!1!==d.enabled){switch(a.touches.length){case 1:r.copy(I(a.touches[0].pageX,a.touches[0].pageY));k.copy(r);break;case 2:x=z=0,D.copy(K((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2)),A.copy(D)}p=q.NONE;d.dispatchEvent(G)}},!1);this.domElement.addEventListener("touchmove",
function(a){if(!1!==d.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:r.copy(I(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;z=Math.sqrt(b*b+e*e);D.copy(K((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));break;default:p=q.NONE}},!1);window.addEventListener("keydown",g,!1);window.addEventListener("keyup",function(a){!1!==d.enabled&&(p=w,window.addEventListener("keydown",
g,!1))},!1);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);
function CScenario(){var l,b,g,m,a,e,d,q,f,p,w,u,k;if(SHOW_3D_RENDER)var r=new CANNON.Demo;this.getDemo=function(){return r};this._init=function(){l=TIME_STEP_WORLD;b=SHOW_3D_RENDER?r.getWorld():new CANNON.World;b.gravity.set(0,0,-9.81*FPS);b.broadphase=new CANNON.NaiveBroadphase;b.solver.iterations=20;g=new CANNON.Material;m=new CANNON.Material;var a=new CANNON.ContactMaterial(g,m,{friction:.3,restitution:.7,contactEquationStiffness:1E8,contactEquationRelaxation:3,frictionEquationStiffness:1E8,frictionEquationRegularizationTime:3});
b.addContactMaterial(a);s_oScenario.createNet();s_oScenario._createBallBody();k=s_oScenario.oCharacterBody(PLAYER_POS_3D[s_iServiceSide],PROXY_COLLISION_PLAYER);u=s_oScenario.oCharacterBody(OPPONENT_POS_3D[s_iServiceSide],PROXY_COLLISION_PLAYER);a=new THREE.LoadingManager;a.onProgress=function(a,b,d){console.log(a,b,d)};(new THREE.FBXLoader(a)).load("models/tennis_stadium.txt",function(a){s_oScenario.parseFile(a);s_oGame.scenarioLoaded();trace("scenario loaded")},function(a){},function(a){})};this.parseFile=
function(a){for(var b=0;b<a.children.length;b++){var d=a.children[b];console.log("oMesh.name: "+d.name);"court"===d.name?s_oScenario._createFieldBody(d):"outfield"===d.name?s_oScenario._createOutField(d):"out"===d.name&&s_oScenario._createBoarder(d)}};this.__extractMeshData=function(a){var b=a.geometry.faces;a=a.geometry.vertices;for(var d=0;d<b.length;d++);var e=[],f=[];for(d=0;d<a.length;d++)e.push(1*a[d].x),e.push(1*a[d].y),e.push(1*a[d].z);for(d=0;d<b.length;d++)f.push(b[d].a),f.push(b[d].b),
f.push(b[d].c);return new CANNON.Trimesh(e,f)};this.oCharacterBody=function(a,d){var e=new CANNON.Box(new CANNON.Vec3(d.width,d.depth,d.height)),g=new CANNON.Body({mass:0});g.addShape(e);g.position.set(a.x,a.y,a.z);b.addBody(f);SHOW_3D_RENDER&&(e=new THREE.MeshPhongMaterial({color:16761473,specular:1118481,shininess:70}),r.addVisual(g,e));return g};this.createNet=function(){var a=new CANNON.Box(new CANNON.Vec3(NET_PROPERTIES.width,NET_PROPERTIES.depth,NET_PROPERTIES.height));f=new CANNON.Body({mass:0});
f.addShape(a);f.position.set(NET_PROPERTIES.x,NET_PROPERTIES.y,NET_PROPERTIES.z);f.addEventListener("collide",function(a){s_oScenario.netCollision(a)});b.addBody(f);SHOW_3D_RENDER&&(a=new THREE.MeshPhongMaterial({color:16711680,specular:1118481,shininess:70}),r.addVisual(f,a))};this._createFieldBody=function(a){var d=BoundingBox(a.geometry.vertices);d=new CANNON.Box(new CANNON.Vec3(.5*(Math.abs(d.xMin)+Math.abs(d.xMax)),.5*(Math.abs(d.yMin)+Math.abs(d.yMax)),FIELD_HEIGHT));q=new CANNON.Body({mass:0,
material:m});q.addShape(d);a=new CANNON.Vec3(a.position.x,a.position.y,a.position.z-FIELD_HEIGHT);q.position.copy(a);OFFSET_BALL_FIELD_Z_IMP=a.z+BALL_RADIUS+.1;q.addEventListener("collide",function(a){s_oScenario.fieldCollision(a)});b.addBody(q);SHOW_3D_RENDER&&(a=new THREE.MeshPhongMaterial({color:65535,specular:1118481,shininess:70}),r.addVisual(q,a))};this._createBallBody=function(){a=new CANNON.Sphere(BALL_RADIUS);e=new CANNON.Body({mass:BALL_MASS,material:g,linearDamping:BALL_LINEAR_DAMPING,
angularDamping:BALL_ANGULAR_DAMPING});var f=new CANNON.Vec3(START_BALL_POSITION[SERVICE_BY][s_iServiceSide].x,START_BALL_POSITION[SERVICE_BY][s_iServiceSide].y,START_BALL_POSITION[SERVICE_BY][s_iServiceSide].z);e.position.copy(f);e.previousPosition.copy(f);e.addShape(a);b.add(e);SHOW_3D_RENDER&&(f=new THREE.MeshPhongMaterial({color:15595586,specular:1118481,shininess:10}),d=r.addVisual(e,f))};this._createOutField=function(a){var d=new CANNON.Vec3(a.position.x,a.position.y,a.position.z);a=this.__extractMeshData(a);
p=new CANNON.Body({mass:0,material:m});p.ID=0;p.addEventListener("collide",function(a){s_oScenario.outFieldCollision(a)});p.addShape(a);p.position.copy(d);b.add(p);SHOW_3D_RENDER&&(d=new THREE.MeshPhongMaterial({color:39168,specular:1118481,shininess:30}),r.addVisual(p,d))};this._createBoarder=function(a){var d=new CANNON.Vec3(a.position.x,a.position.y,a.position.z);a=this.__extractMeshData(a);w=new CANNON.Body({mass:0,material:m});w.ID=0;w.addEventListener("collide",function(a){s_oScenario.borderCollision(a)});
w.addShape(a);w.position.copy(d);b.add(w);SHOW_3D_RENDER&&(d=new THREE.MeshPhongMaterial({color:255,specular:5592405,shininess:30}),r.addVisual(w,d))};this.netCollision=function(a){s_oGame.ballCollideNet()};this.addImpulse=function(a,b){var d=new CANNON.Vec3(0,0,0),e=new CANNON.Vec3(b.x,b.y,b.z);a.applyImpulse(e,d)};this.getBodyVelocity=function(a){return a.velocity};this.ballBody=function(){return e};this.playerBody=function(){return k};this.opponentBody=function(){return u};this.ballMesh=function(){return d};
this.getCamera=function(){return r.camera()};this.setElementLinearDamping=function(a,b){a.linearDamping=b};this.setGravity=function(a){b.gravity.set(0,0,a)};this.update=function(){b.step(l)};this._checkFieldCollision=function(){for(var a=0;a<b.contacts.length;a++){var d=b.contacts[a];if(d.bi===q&&d.bj===e||d.bi===e&&d.bj===q)return s_oGame.ballCollideWithField(!0),!0}s_oGame.ballCollideWithField(!1);return!1};this._checkOutFieldCollision=function(){for(var a=0;a<b.contacts.length;a++){var d=b.contacts[a];
if(d.bi===p&&d.bj===e||d.bi===e&&d.bj===p)return s_oGame.ballCollideWithOutField(!0),!0}s_oGame.ballCollideWithOutField(!1);return!1};this._checkBoarderCollision=function(){for(var a=0;a<b.contacts.length;a++){var d=b.contacts[a];if(d.bi===w&&d.bj===e||d.bi===e&&d.bj===w)return s_oGame.ballCollideWithBoarder(!0),!0}s_oGame.ballCollideWithBoarder(!1);return!1};this._checkNetCollision=function(){for(var a=0;a<b.contacts.length;a++){var d=b.contacts[a];if(d.bi===f&&d.bj===e||d.bi===e&&d.bj===f)return s_oGame.ballCollideWithNet(!0),
!0}s_oGame.ballCollideWithNet(!1);return!1};this.fieldCollision=function(a){playSound("hit_court",Math.abs(a.body.velocity.z)/BALL_MAX_VOL_IMPACT,!1);s_oGame.ballFieldTouch()};this.borderCollision=function(a){s_oGame.ballOut()};this.outFieldCollision=function(a){s_oGame.ballOut()};this.getWorld=function(){return b};this.getNetBody=function(){return f};this.getField=function(){return q};s_oScenario=this;SHOW_3D_RENDER?(r.addScene("Test",this._init),r.start()):this._init()}var s_oScenario;
(function(){var l="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},b="undefined"!==typeof module&&module.exports,g="undefined"!==typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,m=function(){for(var a,b=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),
"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],e=0,g=b.length,m={};e<g;e++)if((a=b[e])&&a[1]in l){for(e=0;e<a.length;e++)m[b[0][e]]=
a[e];return m}return!1}(),a={change:m.fullscreenchange,error:m.fullscreenerror},e={request:function(a){var b=m.requestFullscreen;a=a||l.documentElement;if(/5\.1[.\d]* Safari/.test(navigator.userAgent))a[b]();else a[b](g&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){l[m.exitFullscreen]()},toggle:function(a){this.isFullscreen?this.exit():this.request(a)},onchange:function(a){this.on("change",a)},onerror:function(a){this.on("error",a)},on:function(b,e){var d=a[b];d&&l.addEventListener(d,e,!1)},off:function(b,
e){var d=a[b];d&&l.removeEventListener(d,e,!1)},raw:m};m?(Object.defineProperties(e,{isFullscreen:{get:function(){return!!l[m.fullscreenElement]}},element:{enumerable:!0,get:function(){return l[m.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!l[m.fullscreenEnabled]}}}),b?module.exports=e:window.screenfull=e):b?module.exports=!1:window.screenfull=!1})();var s_iScaleFactor=1,s_iOffsetX,s_iOffsetY,s_bIsIphone=!1,s_fInverseScaling=0;
(function(l){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(l)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(l.substr(0,
4))})(navigator.userAgent||navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(l){console.log(l)}
function getSize(l){var b=l.toLowerCase(),g=window.document,m=g.documentElement;if(void 0===window["inner"+l])l=m["client"+l];else if(window["inner"+l]!=m["client"+l]){var a=g.createElement("body");a.id="vpw-test-b";a.style.cssText="overflow:scroll";var e=g.createElement("div");e.id="vpw-test-d";e.style.cssText="position:absolute;top:-1000px";e.innerHTML="<style>@media("+b+":"+m["client"+l]+"px){body#vpw-test-b div#vpw-test-d{"+b+":7px!important}}</style>";a.appendChild(e);m.insertBefore(a,g.head);
l=7==e["offset"+l]?m["client"+l]:window["inner"+l];m.removeChild(a)}else l=window["inner"+l];return l}window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}
function isIOS(){var l="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");for(-1!==navigator.userAgent.toLowerCase().indexOf("iphone")&&(s_bIsIphone=!0);l.length;)if(navigator.platform===l.pop())return!0;return s_bIsIphone=!1}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var l=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<l?l:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var l=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?getIOSWindowHeight():getSize("Height");var b=getSize("Width");_checkOrientation(b,l);var g=Math.min(l/CANVAS_HEIGHT,b/CANVAS_WIDTH),m=CANVAS_WIDTH*g;g*=CANVAS_HEIGHT;if(g<l){var a=l-g;g+=a;m+=CANVAS_WIDTH/CANVAS_HEIGHT*a}else m<b&&(a=b-m,m+=a,g+=CANVAS_HEIGHT/CANVAS_WIDTH*a);a=l/2-g/2;var e=b/2-m/2,d=CANVAS_WIDTH/m;if(e*d<-EDGEBOARD_X||a*d<-EDGEBOARD_Y)s_iScaleFactor=Math.min(l/(CANVAS_HEIGHT-
2*EDGEBOARD_Y),b/(CANVAS_WIDTH-2*EDGEBOARD_X)),m=CANVAS_WIDTH*s_iScaleFactor,g=CANVAS_HEIGHT*s_iScaleFactor,a=(l-g)/2,e=(b-m)/2,d=CANVAS_WIDTH/m;s_fInverseScaling=d;s_iOffsetX=-1*e*d;s_iOffsetY=-1*a*d;0<=a&&(s_iOffsetY=0);0<=e&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);s_bIsIphone?(canvas=document.getElementById("canvas"),s_oStage.canvas.width=2*m,s_oStage.canvas.height=2*g,canvas.style.width=
m+"px",canvas.style.height=g+"px",s_iScaleFactor=2*Math.min(m/CANVAS_WIDTH,g/CANVAS_HEIGHT),s_oStage.scaleX=s_oStage.scaleY=s_iScaleFactor):s_bMobile||isChrome()?($("#canvas").css("width",m+"px"),$("#canvas").css("height",g+"px")):(s_oStage.canvas.width=m,s_oStage.canvas.height=g,s_iScaleFactor=Math.min(m/CANVAS_WIDTH,g/CANVAS_HEIGHT),s_oStage.scaleX=s_oStage.scaleY=s_iScaleFactor);0>a?($("#canvas").css("top",a+"px"),s_iCanvasOffsetHeight=a):($("#canvas").css("top","0px"),s_iCanvasOffsetHeight=0);
$("#canvas").css("left",e+"px");resizeCanvas3D();s_iCanvasResizeWidth=m;s_iCanvasResizeHeight=g;s_iCanvasOffsetWidth=e;fullscreenHandler()}}
function _checkOrientation(l,b){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(l>b?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),
s_oMain.stopUpdate()))}function resizeCanvas3D(){$("canvas").each(function(){"#canvas"!=$(this).attr("id")&&($(this).css("width",$("#canvas").css("width")),$(this).css("height",$("#canvas").css("height")),$(this).css("position",$("#canvas").css("position")),$(this).css("left",$("#canvas").css("left")),$(this).css("top",$("#canvas").css("top")))})}function playSound(l,b,g){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[l].play(),s_aSounds[l].volume(b),s_aSounds[l].loop(g),l):null}
function stopSound(l){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[l].stop()}function setVolume(l,b){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[l].volume(b)}function setMute(l,b){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[l].mute(b)}function tweenVolume(l,b,g){s_aSounds[l].fade(s_aSounds[l].volume(),b,g)}
function createBitmap(l,b,g){var m=new createjs.Bitmap(l),a=new createjs.Shape;b&&g?a.graphics.beginFill("#fff").drawRect(0,0,b,g):a.graphics.beginFill("#ff0").drawRect(0,0,l.width,l.height);m.hitArea=a;return m}function createSprite(l,b,g,m,a,e){l=null!==b?new createjs.Sprite(l,b):new createjs.Sprite(l);b=new createjs.Shape;b.graphics.beginFill("#000000").drawRect(-g,-m,a,e);l.hitArea=b;return l}function pad(l,b,g){l+="";return l.length>=b?l:Array(b-l.length+1).join(g||"0")+l}
function randomFloatBetween(l,b,g){"undefined"===typeof g&&(g=2);return parseFloat(Math.min(l+Math.random()*(b-l),b).toFixed(g))}function rotateVector2D(l,b){var g=b.getX()*Math.cos(l)+b.getY()*Math.sin(l),m=b.getX()*-Math.sin(l)+b.getY()*Math.cos(l);b.set(g,m)}function tweenVectorsOnX(l,b,g){return l+g*(b-l)}function shuffle(l){for(var b=l.length,g,m;0!==b;)m=Math.floor(Math.random()*b),--b,g=l[b],l[b]=l[m],l[m]=g;return l}
function bubbleSort(l){do{var b=!1;for(var g=0;g<l.length-1;g++)l[g]>l[g+1]&&(b=l[g],l[g]=l[g+1],l[g+1]=b,b=!0)}while(b)}function compare(l,b){return l.index>b.index?-1:l.index<b.index?1:0}function easeLinear(l,b,g,m){return g*l/m+b}function easeInQuad(l,b,g,m){return g*(l/=m)*l+b}function easeInSine(l,b,g,m){return-g*Math.cos(l/m*(Math.PI/2))+g+b}function easeInCubic(l,b,g,m){return g*(l/=m)*l*l+b}
function getTrajectoryPoint(l,b){var g=new createjs.Point,m=(1-l)*(1-l),a=l*l;g.x=m*b.start.x+2*(1-l)*l*b.traj.x+a*b.end.x;g.y=m*b.start.y+2*(1-l)*l*b.traj.y+a*b.end.y;return g}function formatTime(l){l/=1E3;var b=Math.floor(l/60);l=parseFloat(l-60*b).toFixed(1);var g="";g=10>b?g+("0"+b+":"):g+(b+":");return 10>l?g+("0"+l):g+l}function degreesToRadians(l){return l*Math.PI/180}function checkRectCollision(l,b){var g=getBounds(l,.9);var m=getBounds(b,.98);return calculateIntersection(g,m)}
function NoClickDelay(l){this.element=l;window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(l){for(var b=l.length,g,m;0<b;)m=Math.floor(Math.random()*b),b--,g=l[b],l[b]=l[m],l[m]=g;return l}
NoClickDelay.prototype={handleEvent:function(l){switch(l.type){case "touchstart":this.onTouchStart(l);break;case "touchmove":this.onTouchMove(l);break;case "touchend":this.onTouchEnd(l)}},onTouchStart:function(l){l.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(l){this.moved=!0},onTouchEnd:function(l){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){l=document.elementFromPoint(l.changedTouches[0].clientX,l.changedTouches[0].clientY);3==l.nodeType&&(l=l.parentNode);var b=document.createEvent("MouseEvents");b.initEvent("click",!0,!0);l.dispatchEvent(b)}}};
(function(){function l(g){var l={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};g=g||window.event;g.type in l?document.body.className=l[g.type]:(document.body.className=this[b]?"hidden":"visible","hidden"===document.body.className?s_oMain.stopUpdate():s_oMain.startUpdate())}var b="hidden";b in document?document.addEventListener("visibilitychange",l):(b="mozHidden")in document?document.addEventListener("mozvisibilitychange",l):(b="webkitHidden")in
document?document.addEventListener("webkitvisibilitychange",l):(b="msHidden")in document?document.addEventListener("msvisibilitychange",l):"onfocusin"in document?document.onfocusin=document.onfocusout=l:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=l})();function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}
function getParamValue(l){for(var b=window.location.search.substring(1).split("&"),g=0;g<b.length;g++){var m=b[g].split("=");if(m[0]==l)return m[1]}}function createCamera(){var l=new THREE.PerspectiveCamera(FOV,CANVAS_WIDTH/CANVAS_HEIGHT,1,5E3);l.rotation.x=Math.PI/180*60;l.rotation.y=Math.PI/180*-0;l.rotation.z=Math.PI/180*0;l.zoom=1;l.position.set(0,-2455,1205);l.updateProjectionMatrix();l.updateMatrixWorld();return l}
function getRandomColor(){return"rgba("+(Math.floor(127*Math.random()+255)-127)+","+(Math.floor(127*Math.random()+255)-127)+","+(Math.floor(127*Math.random()+255)-127)+",1)"}Math.radians=function(l){return l*Math.PI/180};Math.degrees=function(l){return 180/Math.PI*l};function distanceV2(l,b){var g=l.x-b.x,m=l.y-b.y;return Math.sqrt(g*g+m*m)}function saveItem(l,b){s_bStorageAvailable&&localStorage.setItem(l,b)}function getItem(l){return s_bStorageAvailable?localStorage.getItem(l):null}
function clearAllItem(){s_bStorageAvailable&&localStorage.clear()}function BoundingBox(l){for(var b=l[0].x,g=l[0].y,m=l[0].x,a=l[0].y,e=1;e<l.length;e++)l[e].x<b?b=l[e].x:l[e].x>m&&(m=l[e].x),l[e].y<g?g=l[e].y:l[e].y>a&&(a=l[e].y);return{xMin:b,yMin:g,xMax:m,yMax:a}}function graphicsPoint(l){var b=new createjs.Shape;b.graphics.beginFill(getRandomColor()).drawCircle(5,5,10);b.x=l.x;b.y=l.y;s_oStage.addChild(b)}
function fullscreenHandler(){ENABLE_FULLSCREEN&&!1!==screenfull.enabled&&(s_bFullscreen=screen.height<window.innerHeight+3&&screen.height>window.innerHeight-3?!0:!1,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut())}if(screenfull.enabled)screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen;null!==s_oInterface&&s_oInterface.resetFullscreenBut();null!==s_oMenu&&s_oMenu.resetFullscreenBut()});
function CSpriteLibrary(){var l,b,g,m,a,e;this.init=function(d,q,f){g=b=0;m=d;a=q;e=f;l={}};this.addSprite=function(a,e){l.hasOwnProperty(a)||(l[a]={szPath:e,oSprite:new Image},b++)};this.getSprite=function(a){return l.hasOwnProperty(a)?l[a].oSprite:null};this._onSpritesLoaded=function(){a.call(e)};this._onSpriteLoaded=function(){m.call(e);++g==b&&this._onSpritesLoaded()};this.loadSprites=function(){for(var a in l)l[a].oSprite.oSpriteLibrary=this,l[a].oSprite.onload=function(){this.oSpriteLibrary._onSpriteLoaded()},
l[a].oSprite.src=l[a].szPath};this.getNumSprites=function(){return b}}
var CANVAS_WIDTH=1280,CANVAS_HEIGHT=768,CANVAS_WIDTH_HALF=.5*CANVAS_WIDTH,CANVAS_HEIGHT_HALF=.5*CANVAS_HEIGHT,EDGEBOARD_X=90,EDGEBOARD_Y=95,PRIMARY_FONT="Arial",SECONDARY_FONT="digital",FPS=60,FPS_TIME=1E3/FPS,TIME_STEP_WORLD=1/FPS,DISABLE_SOUND_MOBILE=!1,MS_FADE_ANIM=250,STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,ON_BUT_NO_DOWN=6,ON_BUT_YES_DOWN=7,STATE_INIT=0,STATE_PLAY=1,STATE_FINISH=2,STATE_PAUSE=
3,IDLE=0,SERVICE=1,FOREHAND=2,BACKHAND=3,RUN=4,STANCE=5,STRAFE_LEFT=6,STRAFE_RIGHT=7,RUN_REVERSE=8,OPPONENT_SIDE=0,PLAYER_SIDE=1,NAME_TEXT=0,SET_TEXT=1,POINT_TEXT=0,DETECT_FORCE_DIRECTION=.06,KMH=1.609344,POINT=[0,15,30,40,"-"],MAX_SERVICE_ATTEMPT=1,MOVEMENT_SIDE_ANGLE=.5,SERVICE_FRAME_SHOT=24,FOREHAND_FRAME_SHOT=17,BACKHAND_FRAME_SHOT=17,MIN_DISTANCE_FOR_SHOT_BALL=75,MIN_DISTANCE_MOVE_TO_BALL=35,MS_TIME_FADE_VOL=500,ALLOWED_SET_MATCH=[1,3,5],OFFSET_RADIANTS_45=Math.radians(45),OFFSET_RADIANTS_90=
Math.radians(90),RADIANTS_180=Math.radians(180),FPS_ANIMATION_0=.25,FPS_ANIMATION_1=.45,SPRITE_NAME_PLAYER="player_idle player_service player_forehand player_backhand player_run player_stance player_strafe_left player_strafe_right".split(" "),OFFSET_CONTAINER_PLAYER=[{x:4,y:0},{x:4,y:-3},{x:11,y:11},{x:-20,y:15},{x:7,y:6},{x:3,y:1},{x:1,y:1},{x:1,y:1}],SPRITE_NAME_OPPONENT="opponent_idle opponent_service opponent_forehand opponent_backhand opponent_run opponent_stance opponent_strafe_left opponent_strafe_right".split(" "),
OFFSET_CONTAINER_OPPONENT=[{x:4,y:0},{x:4,y:-3},{x:11,y:11},{x:30,y:25},{x:7,y:6},{x:3,y:1},{x:1,y:1},{x:1,y:1}],ANIMATION_SPRITE_SHEET_SECTION=[{w:5,h:3},{w:7,h:6},{w:9,h:6},{w:6,h:5},{w:4,h:3},{w:7,h:3},{w:3,h:3},{w:3,h:3}],CHARACTERS_ANIMATIONS=[{idle:0,start:[0,12,"start",FPS_ANIMATION_0],end:12},{service:1,start:[0,34,"end",FPS_ANIMATION_1],end:34},{forehand:2,start:[10,53,"end",FPS_ANIMATION_1],end:53},{backhand:3,start:[10,29,"end",FPS_ANIMATION_1],end:29},{run:4,start:[0,11,"start",FPS_ANIMATION_1],
end:11},{stance:5,start:[0,20,"start",FPS_ANIMATION_1],end:20},{strafe_left:6,start:[0,8,"start",FPS_ANIMATION_1],end:8},{strafe_right:7,start:[0,8,"start",FPS_ANIMATION_1],end:8},{run_reverse:8,start:{frames:[11,10,9,8,7,6,5,4,3,2,1,0],next:"start",speed:FPS_ANIMATION_1},end:0}],ANIMATION_PLAYER_SET={a:STRAFE_LEFT,b:STRAFE_RIGHT,c:RUN,d:RUN_REVERSE},ANIMATION_OPPONENT_SET={a:STRAFE_RIGHT,b:STRAFE_LEFT,c:RUN_REVERSE,d:RUN},LEFT_SERVICE=0,RIGHT_SERVICE=1,MS_TIME_AFTER_BALL_OUT=750,MIN_DISTANCE_FOR_SHOT_BALL_PLAYER=
180,LEFT=0,RIGHT=1,BALL_DENSITY=2515,DEFAULT_Z_FORCE=20*BALL_DENSITY,ROLL_BALL_RATE=60/FPS,FIELD_WIDTH=850,FIELD_HALF_WIDTH=.5*FIELD_WIDTH,FIELD_OUT_BALL_WIDTH=.5*FIELD_WIDTH+20,FIELD_LENGTH=2400,FIELD_HALF_LENGHT=.5*FIELD_LENGTH,AI_POINT_SHOT_X=FIELD_HALF_WIDTH-60,BALL_MASS=.056*BALL_DENSITY,BALL_RADIUS=8,BALL_LINEAR_DAMPING=.2,BALL_ANGULAR_DAMPING=.5,MIN_BALL_VEL_ROTATION=.1,PLAYER_SCALE_MULTIPLIER=20,OPPONENT_SCALE_MULTIPLIER=20,PLAYER_BUFFER=.5*FPS,OPPONENT_BUFFER=.5*FPS,BALL_MAX_VOL_IMPACT=3500,
AI_RANGE_HIT={x:1*BALL_DENSITY,y:1*BALL_DENSITY,z:1*BALL_DENSITY},START_BALL_POSITION=[[{x:270,y:1199,z:100},{x:-270,y:1199,z:100}],[{x:-250,y:-1199,z:100},{x:250,y:-1199,z:100}]],START_LAUNCH_IMPULSE_BALL_OPPONENT={x:0,y:0,z:33*BALL_DENSITY},START_LAUNCH_IMPULSE_BALL_PLAYER={x:0,y:0,z:37*BALL_DENSITY},SERVICE_IMPULSE_PLAYER_SIDE=[{x:2,y:0,z:.5},{x:-2,y:0,z:.5}],OFFSET_FORCE_Y_PLAYER=30,SERVICE_POWER_RATE=62,SERVICE_POWER_MIN=55,TO_POS_CHAR_DISTANCE_OFFSET_AXIS=40,TO_POS_CHAR_DISTANCE_OFFSET=70,TO_BALL_CHAR_DISTANCE_OFFSET=
30,PROXY_COLLISION_PLAYER={width:10,height:120,depth:10},VOLLEY_SHOOT_Z=2*PROXY_COLLISION_PLAYER.height,PLAYER_POS_3D=[{x:-220,y:-1200,z:PROXY_COLLISION_PLAYER.height},{x:220,y:-1200,z:PROXY_COLLISION_PLAYER.height}],OPPONENT_POS_3D=[{x:220,y:1200,z:PROXY_COLLISION_PLAYER.height},{x:-220,y:1200,z:PROXY_COLLISION_PLAYER.height}],PLAYER_LIMIT_POS_Y=PLAYER_POS_3D[0].y-300,HIT_BALL_MAX_FORCE=130,HIT_BALL_MIN_FORCE=5,FORCE_RATE=.0014,FIELD_HEIGHT=5,OFFSET_BALL_FIELD_Z_IMP,OFFSET_Z_AI_HEIGHT=PROXY_COLLISION_PLAYER.height-
30,MIN_VELOCITY_SPAWN_TRAJECTORY=1,RETURN_POS_CHARACTERS_OPPONENT={x:0,y:1200},RETURN_POS_CHARACTERS_PLAYER={x:0,y:-1200},FORCE_MULTIPLIER_AXIS_PLAYER={x:.2*BALL_DENSITY,y:.1*BALL_DENSITY,z:.35*BALL_DENSITY},FORCE_MULTIPLIER_AXIS_OPPONENT={x:.1*BALL_DENSITY,y:.2*BALL_DENSITY,z:.11*BALL_DENSITY},FORCE_SERVICE_AXIS_OPPONENT={x:.05*BALL_DENSITY,y:.18*BALL_DENSITY,z:.03*BALL_DENSITY},AI_SERVICE_X_RANDOM=.03*BALL_DENSITY,AI_SERVICE_Y_RANDOM=.05*BALL_DENSITY,FORCE_MAX=.5*BALL_DENSITY,MAX_FORCE_Y=1050,MIN_FORCE_Y=
650,AI_Y_POINT=FIELD_HALF_LENGHT+210,AI_SAVE_FORCE_Z_MULT=1.5,TIME_POWER_BAR=1250,NET_PROPERTIES={x:0,y:0,z:63,width:825,height:63,depth:6},SHOW_3D_RENDER=!1,CAMERA_TEST=!1,START_CAMERA_POSITION={x:-240,y:-290,z:280},CAMERA_TEST_LOOK_AT={x:0,y:-500,z:-100},NEAR=1,FAR=1E4,FOV=42,BALL_SCALE_FACTOR=1/FOV,CHARACTERS_SCALE_FACTOR=1/FOV+.8,SHADOWN_FACTOR=1/FOV-.0115,BALL_SHADOW_POS=BALL_RADIUS*BALL_RADIUS*BALL_RADIUS,HEIGHT_SCALE_SHADOWN_FACTOR=1/FOV,CANVAS_3D_OPACITY=.5,POINTS_TO_LOSE,START_SCORE,OPPONENT_SPEED,
AI_RANGE_FORCE_X,AI_RANGE_FORCE_Y,SET_FOR_WIN,AI_MAX_Z,AI_MIN_Z,NUM_LEVEL_FOR_ADS;TEXT_ARE_SURE="ARE YOU SURE?";TEXT_PAUSE="PAUSE";TEXT_RESET="ARE YOU SURE? ALL YOUR PREVIOUS SCORES WILL BE DELETED!";TEXT_POWER="POWER";TEXT_CHARACTERS_NAMES=["OPPONENT","PLAYER"];TEXT_WIN="YOU WON";TEXT_LOSE="YOU LOST";TEXT_SET="SET";TEXT_OUT="OUT";TEXT_FAULT="FAULT";TEXT_SCORE_MATCH="SCORE MATCH";TEXT_TOTAL_SCORE="TOTAL SCORE";TEXT_SELECT_LEVEL="SELECT A LEVEL";TEXT_MATCH="MATCH";TEXT_HELP_DESKTOP_0="CLICK THE MOUSE BUTTON TO STOP THE POWER BAR AND SERVE THE BALL";
TEXT_HELP_MOBILE_0="TOUCH SCREEN TO STOP POWER BAR AND SERVE THE BALL";TEXT_HELP_DESKTOP_1="MOVE THE MOUSE TO SET DIRECTION AND HEIGHT OF THE BALL";TEXT_HELP_MOBILE_1="SWIPE TO SET DIRECTION AND HEIGHT OF THE BALL";TEXT_HELP_DESKTOP_2="HOLD DOWN THE MOUSE BUTTON TO INCREASE THE SHOT'S POWER";TEXT_HELP_MOBILE_2="HOLD DOWN TO INCREASE THE SHOT'S POWER";TEXT_KMH="KMH";TEXT_WRONG="NUMBER OF SET NOT VALID. PLEASE SET ONE OF THIS VALUES FOR SET NUMBER: 1, 3, 5";TEXT_COLOR_0="#fff";TEXT_COLOR_1="#000";
TEXT_COLOR_2="#e49f0c";TEXT_COLOR_3="#ec9706";TEXT_COLOR_4="#4f8ede";TEXT_COLOR_5="#6a727c";TEXT_SHADOWN_ALPHA=.6;var TEXT_ERR_LS="YOUR WEB BROWSER DOES NOT SUPPORT STORING SETTING LOCALLY. IN SAFARI, THE MOST COMMON CAUSE OF THIS IS USING 'PRIVATE BROWSING MODE'. SOME INFO MAY NOT SAVE OR SOME FEATURE MAY NOT WORK PROPERLY.";TEXT_SHARE_IMAGE="200x200.jpg";TEXT_SHARE_TITLE="Congratulations!";TEXT_SHARE_MSG1="You collected <strong>";TEXT_SHARE_MSG2=" points</strong>!<br><br>Share your score with your friends!";
TEXT_SHARE_SHARE1="My score is ";TEXT_SHARE_SHARE2=" points! Can you do better";
function CPreloader(){var l,b,g,m,a,e,d,q;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.loadSprites();q=new createjs.Container;s_oStage.addChild(q)};this.unload=function(){q.removeAllChildren()};this.hide=function(){var a=this;setTimeout(function(){createjs.Tween.get(d).to({alpha:1},500).call(function(){a.unload();
s_oMain.gotoMenu()})},1E3)};this._onImagesLoaded=function(){};this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var f=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));q.addChild(f);f=s_oSpriteLibrary.getSprite("progress_bar");a=createBitmap(f);a.x=CANVAS_WIDTH/2-f.width/2;a.y=CANVAS_HEIGHT-170;q.addChild(a);l=f.width;b=f.height;e=new createjs.Shape;e.graphics.beginFill("rgba(255,255,255,0.01)").drawRect(a.x,a.y,1,b);q.addChild(e);a.mask=
e;m=new createjs.Text("","30px "+SECONDARY_FONT,"#fff");m.x=CANVAS_WIDTH/2;m.y=CANVAS_HEIGHT+125;m.textBaseline="alphabetic";m.textAlign="center";q.addChild(m);g=new createjs.Text("","30px Arial","#fff");g.x=CANVAS_WIDTH/2;g.y=CANVAS_HEIGHT-125;g.shadow=new createjs.Shadow("#000",2,2,2);g.textBaseline="alphabetic";g.textAlign="center";q.addChild(g);d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);d.alpha=0;q.addChild(d)};this.refreshLoader=function(d){g.text=
d+"%";m.text=d+"%";e.graphics.clear();d=Math.floor(d*l/100);e.graphics.beginFill("rgba(255,255,255,0.01)").drawRect(a.x,a.y,d,b)};this._init()}
function CMain(l){var b,g=0,m=0,a=STATE_LOADING,e,d;this.initContainer=function(){s_oCanvas=document.getElementById("canvas");s_oStage=new createjs.Stage(s_oCanvas);s_oStage.preventSelection=!0;createjs.Touch.enable(s_oStage);s_bMobile=jQuery.browser.mobile;!1===s_bMobile&&(s_oStage.enableMouseOver(FPS),$("body").on("contextmenu","#canvas",function(a){return!1}));s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",this._update);createjs.Ticker.setFPS(FPS);createjs.Ticker.timingMode=
createjs.Ticker.RAF;navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=!0);s_oSpriteLibrary=new CSpriteLibrary;e=new CPreloader};this.preloaderReady=function(){this._loadImages();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds();b=!0};this.soundLoaded=function(){g++;e.refreshLoader(Math.floor(g/m*100));g===m&&this._onRemovePreloader()};this._initSounds=function(){var a=[];a.push({path:"./sounds/",filename:"hit_ball",loop:!1,volume:1,ingamename:"hit_ball"});a.push({path:"./sounds/",
filename:"click",loop:!1,volume:1,ingamename:"click"});a.push({path:"./sounds/",filename:"game_over",loop:!1,volume:1,ingamename:"game_over"});a.push({path:"./sounds/",filename:"hit_court",loop:!1,volume:1,ingamename:"hit_court"});a.push({path:"./sounds/",filename:"lose_match",loop:!1,volume:1,ingamename:"lose_match"});a.push({path:"./sounds/",filename:"crowd_applauses",loop:!1,volume:1,ingamename:"crowd_applauses"});a.push({path:"./sounds/",filename:"crowd_disappoint",loop:!1,volume:1,ingamename:"crowd_disappoint"});
a.push({path:"./sounds/",filename:"crowd_disappoint",loop:!1,volume:1,ingamename:"crowd_disappoint"});a.push({path:"./sounds/",filename:"win_match",loop:!1,volume:1,ingamename:"win_match"});a.push({path:"./sounds/",filename:"out",loop:!1,volume:1,ingamename:"out"});a.push({path:"./sounds/",filename:"soundtrack",loop:!0,volume:1,ingamename:"soundtrack"});m+=a.length;s_aSounds=[];for(var b=0;b<a.length;b++)s_aSounds[a[b].ingamename]=new Howl({src:[a[b].path+a[b].filename+".mp3",a[b].path+a[b].filename+
".ogg"],autoplay:!1,preload:!0,loop:a[b].loop,volume:a[b].volume,onload:s_oMain.soundLoaded()})};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png");s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("ctl_logo","./sprites/ctl_logo.png");s_oSpriteLibrary.addSprite("but_info","./sprites/but_info.png");s_oSpriteLibrary.addSprite("but_yes_big","./sprites/but_yes_big.png");
s_oSpriteLibrary.addSprite("but_exit_big","./sprites/but_exit_big.png");s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png");s_oSpriteLibrary.addSprite("but_continue","./sprites/but_continue.png");s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png");s_oSpriteLibrary.addSprite("but_level","./sprites/but_level.png");s_oSpriteLibrary.addSprite("but_pause","./sprites/but_pause.png");s_oSpriteLibrary.addSprite("but_continue_big","./sprites/but_continue_big.png");s_oSpriteLibrary.addSprite("but_fullscreen",
"./sprites/but_fullscreen.png");s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg");s_oSpriteLibrary.addSprite("bg_level_menu","./sprites/bg_level_menu.jpg");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("score_board","./sprites/score_board.png");s_oSpriteLibrary.addSprite("ball","./sprites/ball.png");s_oSpriteLibrary.addSprite("ball_shadow",
"./sprites/ball_shadow.png");s_oSpriteLibrary.addSprite("power_bar_bg","./sprites/power_bar_bg.png");s_oSpriteLibrary.addSprite("power_bar_fill","./sprites/power_bar_fill.png");s_oSpriteLibrary.addSprite("power_bar_frame","./sprites/power_bar_frame.png");s_oSpriteLibrary.addSprite("arrow_left","./sprites/arrow_left.png");s_oSpriteLibrary.addSprite("arrow_right","./sprites/arrow_right.png");s_oSpriteLibrary.addSprite("ball_trajectory","./sprites/ball_trajectory.png");s_oSpriteLibrary.addSprite("cursor",
"./sprites/cursor.png");s_oSpriteLibrary.addSprite("hand_touch","./sprites/hand_touch.png");s_oSpriteLibrary.addSprite("net","./sprites/net.png");s_oSpriteLibrary.addSprite("msg_box_big","./sprites/msg_box_big.png");s_oSpriteLibrary.addSprite("placeholder","./sprites/placeholder.png");s_oSpriteLibrary.addSprite("pattern_screen","./sprites/pattern_screen.png");for(var a=0;a<SPRITE_NAME_PLAYER.length;a++)s_oSpriteLibrary.addSprite(SPRITE_NAME_PLAYER[a],"./sprites/player/"+SPRITE_NAME_PLAYER[a]+".png");
for(a=0;a<SPRITE_NAME_OPPONENT.length;a++)s_oSpriteLibrary.addSprite(SPRITE_NAME_OPPONENT[a],"./sprites/opponent/"+SPRITE_NAME_OPPONENT[a]+".png");m+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){g++;e.refreshLoader(Math.floor(g/m*100));g===m&&this._onRemovePreloader()};this._onAllImagesLoaded=function(){};this._onRemovePreloader=function(){try{saveItem("ls_available","ok")}catch(f){s_bStorageAvailable=!1}e.unload();isIOS()||(s_oSoundTrack=playSound("soundtrack",
1,!0));this.gotoMenu()};this.gotoMenu=function(){new CMenu;a=STATE_MENU};this.gotoLevelMenu=function(){new CLevelMenu(OPPONENT_SPEED.length);a=STATE_MENU};this.gotoGame=function(b){d=new CGame(q,b);a=STATE_GAME};this.gotoHelp=function(){new CHelp;a=STATE_HELP};this.stopUpdate=function(){b=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||Howler.mute(!0)};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();b=!0;createjs.Ticker.paused=
!1;$("#block_game").css("display","none");(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)&&s_bAudioActive&&Howler.mute(!1)};this._update=function(e){if(!1!==b){var f=(new Date).getTime();s_iTimeElaps=f-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=f;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);a===STATE_GAME&&d.update();s_oStage.update(e)}};s_oMain=this;var q=l;OPPONENT_SPEED=l.opponent_speed;ENABLE_FULLSCREEN=l.fullscreen;ENABLE_CHECK_ORIENTATION=l.check_orientation;
this.initContainer()}var s_bMobile,s_bAudioActive=!0,s_bFullscreen=!1,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_iAdsLevel=1,s_iLevelReached=1,s_aScores,s_iBestScore,s_oDrawLayer,s_oStage,s_oMain,s_oSpriteLibrary,s_oSoundTrack=null,s_oCanvas,s_aSounds,s_bStorageAvailable=!0;
function CTextButton(l,b,g,m,a,e,d){var q,f,p,w,u;this._init=function(a,b,d,e,g,l,m){q=[];f=[];var k=createBitmap(d),n=Math.ceil(m/20);u=new createjs.Text(e," "+m+"px "+g,"#000000");u.textAlign="center";u.textBaseline="alphabetic";var r=u.getBounds();u.x=d.width/2+n;u.y=Math.floor(d.height/2)+r.height/3+n;w=new createjs.Text(e," "+m+"px "+g,l);w.textAlign="center";w.textBaseline="alphabetic";r=w.getBounds();w.x=d.width/2;w.y=Math.floor(d.height/2)+r.height/3;p=new createjs.Container;p.x=a;p.y=b;p.regX=
d.width/2;p.regY=d.height/2;p.addChild(k,u,w);s_oStage.addChild(p);this._initListener()};this.unload=function(){p.off("mousedown");p.off("pressup");s_oStage.removeChild(p)};this.setVisible=function(a){p.visible=a};this._initListener=function(){oParent=this;p.on("mousedown",this.buttonDown);p.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,d){q[a]=b;f[a]=d};this.buttonRelease=function(){p.scaleX=1;p.scaleY=1;q[ON_MOUSE_UP]&&q[ON_MOUSE_UP].call(f[ON_MOUSE_UP])};this.buttonDown=
function(){p.scaleX=.9;p.scaleY=.9;q[ON_MOUSE_DOWN]&&q[ON_MOUSE_DOWN].call(f[ON_MOUSE_DOWN])};this.setTextPosition=function(a){w.y=a;u.y=a+2};this.setPosition=function(a,b){p.x=a;p.y=b};this.setX=function(a){p.x=a};this.setY=function(a){p.y=a};this.getButtonImage=function(){return p};this.getX=function(){return p.x};this.getY=function(){return p.y};this._init(l,b,g,m,a,e,d);return this}
function CToggle(l,b,g,m,a){var e,d,q,f,p;this._init=function(a,b,g,l,m){p=void 0!==m?m:s_oStage;d=[];q=[];m=new createjs.SpriteSheet({images:[g],frames:{width:g.width/2,height:g.height,regX:g.width/2/2,regY:g.height/2},animations:{state_true:[0],state_false:[1]}});e=l;f=createSprite(m,"state_"+e,g.width/2/2,g.height/2,g.width/2,g.height);f.x=a;f.y=b;f.stop();s_bMobile||(f.cursor="pointer");p.addChild(f);this._initListener()};this.unload=function(){f.off("mousedown",this.buttonDown);f.off("pressup",
this.buttonRelease);p.removeChild(f)};this._initListener=function(){f.on("mousedown",this.buttonDown);f.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,e){d[a]=b;q[a]=e};this.setCursorType=function(a){f.cursor=a};this.setActive=function(a){e=a;f.gotoAndStop("state_"+e)};this.buttonRelease=function(){f.scaleX=1;f.scaleY=1;playSound("click",1,!1);e=!e;f.gotoAndStop("state_"+e);d[ON_MOUSE_UP]&&d[ON_MOUSE_UP].call(q[ON_MOUSE_UP],e)};this.buttonDown=function(){f.scaleX=.9;f.scaleY=
.9;d[ON_MOUSE_DOWN]&&d[ON_MOUSE_DOWN].call(q[ON_MOUSE_DOWN])};this.setPosition=function(a,b){f.x=a;f.y=b};this._init(l,b,g,m,a)}
function CGfxButton(l,b,g,m){var a,e=!0,d,q,f,p;this._init=function(b,e,g,l){a=!1;d=1;q=[];f=[];p=createBitmap(g);p.x=b;p.y=e;p.scaleX=p.scaleY=d;p.regX=g.width/2;p.regY=g.height/2;p.cache(0,0,2*p.regX,2*p.regY);l.addChild(p);this._initListener()};this.unload=function(){s_bMobile?p.off("mousedown",this.buttonDown):(p.off("mousedown",this.buttonDown),p.off("mouseover",this.buttonOver));p.off("pressup",this.buttonRelease);m.removeChild(p)};this.setVisible=function(a){p.visible=a};this.setClickable=
function(b){a=!b};this._initListener=function(){if(s_bMobile)p.on("mousedown",this.buttonDown);else p.on("mousedown",this.buttonDown),p.on("mouseover",this.buttonOver);p.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,d){q[a]=b;f[a]=d};this.buttonRelease=function(){a||(p.scaleX=d,p.scaleY=d,e&&p.updateCache(),q[ON_MOUSE_UP]&&q[ON_MOUSE_UP].call(f[ON_MOUSE_UP]))};this.buttonDown=function(){a||(p.scaleX=.9*d,p.scaleY=.9*d,e&&p.updateCache(),playSound("click",1,!1),q[ON_MOUSE_DOWN]&&
q[ON_MOUSE_DOWN].call(f[ON_MOUSE_DOWN]))};this.buttonOver=function(b){s_bMobile||a||(b.target.cursor="pointer")};this.pulseAnimation=function(){createjs.Tween.get(p).to({scaleX:1.1*d,scaleY:1.1*d},850,createjs.Ease.quadOut).to({scaleX:d,scaleY:d},650,createjs.Ease.quadIn).call(function(){w.pulseAnimation()});this.uncache()};this.trembleAnimation=function(){createjs.Tween.get(p).to({rotation:5},75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){w.trebleAnimation()});
this.uncache()};this.uncache=function(){p.uncache();e=!1};this.setPosition=function(a,b){p.x=a;p.y=b};this.setX=function(a){p.x=a};this.setY=function(a){p.y=a};this.getButtonImage=function(){return p};this.getX=function(){return p.x};this.getY=function(){return p.y};var w=this;this._init(l,b,g,m);return this}
function CMenu(){var l,b,g,m,a,e,d,q,f,p,w,u,k=null,r,n,v,x=null,z,A,D=null,E=null;this._init=function(){w=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(w);var x=s_oSpriteLibrary.getSprite("but_play");a=CANVAS_WIDTH/2;e=CANVAS_HEIGHT-200;u=new CGfxButton(a,e,x,s_oStage);u.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this);null!==getItem("tennis_levelreached")?(s_iLevelReached=getItem("tennis_levelreached"),s_aScores=JSON.parse(getItem("tennis_scores")),s_iBestScore=
getItem("tennis_best_score"),a=CANVAS_WIDTH/2-200,e=CANVAS_HEIGHT-200,u.setPosition(a,e),g=CANVAS_WIDTH/2+200,m=CANVAS_HEIGHT-200,x=s_oSpriteLibrary.getSprite("but_continue_big"),k=new CGfxButton(g,m,x,s_oStage),k.addEventListener(ON_MOUSE_UP,this._onButContinueRelease,this),k.pulseAnimation()):(u.pulseAnimation(),this.resetArrays(),s_iBestScore=0);x=s_oSpriteLibrary.getSprite("but_info");f=x.height/2+10;p=x.height/2+10;v=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT-240,x,s_oStage);v.addEventListener(ON_MOUSE_UP,
this._onCreditsBut,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)x=s_oSpriteLibrary.getSprite("audio_icon"),d=CANVAS_WIDTH-x.height/2-10,q=x.height/2+10,n=new CToggle(d,q,x,s_bAudioActive,s_oStage),n.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);x=window.document;var G=x.documentElement;D=G.requestFullscreen||G.mozRequestFullScreen||G.webkitRequestFullScreen||G.msRequestFullscreen;E=x.exitFullscreen||x.mozCancelFullScreen||x.webkitExitFullscreen||x.msExitFullscreen;!1===ENABLE_FULLSCREEN&&
(D=!1);D&&screenfull.enabled&&(x=s_oSpriteLibrary.getSprite("but_fullscreen"),l=f+x.width/2+10,b=p,A=new CToggle(l,b,x,s_bFullscreen,s_oStage),A.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));r=new createjs.Shape;r.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(r);z=new createjs.Container;s_oStage.addChild(z);createjs.Tween.get(r).to({alpha:0},2*MS_FADE_ANIM).call(function(){r.visible=!1});s_bStorageAvailable||new CMsgBox(TEXT_ERR_LS,s_oStage);
this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){u.unload();u=null;null!==k&&(k.unload(),k=null);r.visible=!1;v.unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)n.unload(),n=null;D&&screenfull.enabled&&A.unload();s_oStage.removeChild(w);s_oMenu=w=null};this.refreshButtonPos=function(a,e){v.setPosition(f+a,e+p);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||n.setPosition(d-a,e+q);D&&screenfull.enabled&&A.setPosition(l+s_iOffsetX,b+s_iOffsetY)};this._onButPlayRelease=function(){isIOS()&&
null===s_oSoundTrack&&(s_oSoundTrack=playSound("soundtrack",1,!0));null===getItem("tennis_levelreached")?this.fadeAnim():null===x&&(x=new CConfirmPanel(TEXT_RESET,z),x.addEventListener(ON_BUT_NO_DOWN,this._onButNo,this),x.addEventListener(ON_BUT_YES_DOWN,this._onButYes,this))};this._onButNo=function(){x.unload();x=null};this._onButYes=function(){x.unload();x=null;clearAllItem();s_iLevelReached=1;this.resetArrays();this.fadeAnim()};this._onButContinueRelease=function(){isIOS()&&null===s_oSoundTrack&&
(s_oSoundTrack=playSound("soundtrack",1,!0));this.fadeAnim()};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onCreditsBut=function(){new CCreditsPanel};this._onFullscreenRelease=function(){s_bFullscreen?E.call(window.document):D.call(window.document.documentElement);sizeHandler()};this.resetArrays=function(){s_aScores=[];for(var a=0;a<OPPONENT_SPEED.length;a++)s_aScores[a]=0};this.resetFullscreenBut=function(){D&&screenfull.enabled&&A.setActive(s_bFullscreen)};
this.fadeAnim=function(){r.visible=!0;createjs.Tween.get(r,{override:!0}).to({alpha:1},MS_FADE_ANIM,createjs.Ease.cubicIn).call(function(){this.unload();s_oMain.gotoLevelMenu()},null,this)};s_oMenu=this;this._init()}var s_oMenu=null,CHARACTERS,BALL,SERVICE_BY=PLAYER_SIDE;
function CGame(l,b){var g=!1,m=!1,a=!1,e=!1,d=!1,q=!0,f,p,w=-1,u=0,k,r,n=0,v=0,x=0,z=0,A=0,D,E,F,G,K,I,B,Q=null,O,L,H,W,ba,X,R,J=null,T,S;this._init=function(){$(s_oMain).trigger("start_session");T=[];CHARACTERS=[];for(var a=f=p=f=0;a<s_iLevel;a++)f+=s_aScores[a];K=new createjs.Container;s_oStage.addChild(K);a=createBitmap(s_oSpriteLibrary.getSprite("bg_game"));a.cache(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);K.addChild(a);E=new CScenario;CAMERA_TEST||(camera=createCamera());F=camera;this.createBall();G.getPhysics().mass=
0;T.push(G);resizeCanvas3D();I={x:0,y:0};B={x:0,y:0};L=new CCharacter(0,0,OPPONENT_SCALE_MULTIPLIER,IDLE,OFFSET_CONTAINER_OPPONENT,SPRITE_NAME_OPPONENT,CHARACTERS_ANIMATIONS,ANIMATION_SPRITE_SHEET_SECTION,E.opponentBody(),OPPONENT_SIDE,K);L.runAnim(IDLE);L.setMaxSpeed(OPPONENT_SPEED[s_iLevel]);L.setAcceleration(OPPONENT_ACCELERATION[s_iLevel]);T.push(L);CHARACTERS.push(L);O=new CCharacter(0,0,PLAYER_SCALE_MULTIPLIER,IDLE,OFFSET_CONTAINER_PLAYER,SPRITE_NAME_PLAYER,CHARACTERS_ANIMATIONS,ANIMATION_SPRITE_SHEET_SECTION,
E.playerBody(),PLAYER_SIDE,K);O.runAnim(IDLE);O.setMaxSpeed(PLAYER_SPEED);O.setAcceleration(PLAYER_ACCELERATION);CHARACTERS.push(O);T.push(O);ba=new CNet(315,255,s_oSpriteLibrary.getSprite("net"),K);T.push(ba);H=new CPowerBar(CANVAS_WIDTH_HALF-550,CANVAS_HEIGHT_HALF-100,s_oStage,!0);H.setVisible(!1);H.setAlpha(0);W=new CControllerMovement;X=new CAI(L);D=new CInterface;D.refreshMatchBoard(s_iLevel+1);D.refreshVelocityScreen(0);this.refreshScoreBoard();tweenVolume("soundtrack",.3,MS_TIME_FADE_VOL);
R=new createjs.Shape;R.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(R);createjs.Tween.get(R).to({alpha:0},MS_FADE_ANIM,createjs.Ease.cubicOut).call(function(){R.visible=!1});S=new CANNON.Vec3(0,0,0);1===SET_FOR_WIN||3===SET_FOR_WIN||5===SET_FOR_WIN?0!==s_iLevel||SHOW_3D_RENDER?(q=!1,this._onExitHelp()):D.createHelpPanel():new CSetAllowed(s_oStage)};this.scenarioLoaded=function(){w=STATE_INIT};this.changeState=function(a){w=a};this.serviceBy=function(){H.mask(0);
SERVICE_BY===PLAYER_SIDE?(this.activeStateLaunchPower(),L.runAnim(STANCE),O.runAnim(SERVICE),O.pauseAnim(!0)):(createjs.Tween.get(this).wait(500).call(function(){this.startAnimPlayerService(L,X.serve)}),O.runAnim(STANCE),L.runAnim(SERVICE),L.pauseAnim(!0),H.setVisible(!1))};this.activeStateLaunchPower=function(){q&&D.createHelpText();H.setVisible(!0);H.animFade(1,null);H.animateMask(TIME_POWER_BAR)};this.startAnimPlayerService=function(a,b){a.runAnim(SERVICE);a.setActionFunc(b);s_oGame.playerService()};
this.playerService=function(){D.unloadHelpText();q=!1;G.getPhysics().mass=BALL_MASS;k===OPPONENT_SIDE?this.addImpulseToBall(START_LAUNCH_IMPULSE_BALL_OPPONENT):this.addImpulseToBall(START_LAUNCH_IMPULSE_BALL_PLAYER);g=!0};this.playerServeBall=function(){var a=H.getMaskValue()/H.getMaskHeight()*SERVICE_POWER_RATE+OFFSET_FORCE_Y_PLAYER;a<SERVICE_POWER_MIN&&(a=SERVICE_POWER_MIN);a*=BALL_DENSITY;a={x:.1*SERVICE_IMPULSE_PLAYER_SIDE[s_iServiceSide].x*a,y:a,z:.1*SERVICE_IMPULSE_PLAYER_SIDE[s_iServiceSide].z*
a};s_oGame.addImpulseToBall(a);H.mask(0);H.animFade(0,H.setVisible,!1);s_oGame.calculateVelocityService(a);playSound("hit_ball",1,!1)};this.calculateVelocityService=function(a){D.refreshVelocityScreen(Math.floor(Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z)/BALL_DENSITY*KMH))};this.refreshPos=function(a,b){H.setPosition(H.getStartPos().x+a,H.getStartPos().y-b)};this.createControl=function(){SHOW_3D_RENDER?(window.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onPressMove),
window.addEventListener("mouseup",this.onPressUp)):(Q=new createjs.Shape,Q.graphics.beginFill("rgba(255,0,0,0.01)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),K.addChild(Q),Q.on("mousedown",this.onMouseDown),Q.on("pressmove",this.onPressMove),Q.on("pressup",this.onPressUp))};this.createBall=function(){var a=s_oSpriteLibrary.getSprite("ball");BALL=G=new CBall(0,0,a,E.ballBody(),K);T.push(G)};this.onMouseDown=function(){I={x:s_oStage.mouseX,y:s_oStage.mouseY};g||SERVICE_BY!==PLAYER_SIDE?r!==PLAYER_SIDE&&
g?(H.mask(0),H.setVisible(!0),H.animFade(1,null),e=!0):(H.mask(0),H.animFade(0,H.setVisible,!1)):(H.removeTweensMask(),s_oGame.ballShotBy(PLAYER_SIDE),s_oGame.startAnimPlayerService(O,s_oGame.playerServeBall))};this.pause=function(a){!0===a?(createjs.Ticker.paused=!0,w=STATE_PAUSE):(createjs.Ticker.paused=!1,w=STATE_PLAY);for(var b=0;b<CHARACTERS.length;b++)(CHARACTERS[b].getAnimType()!==SERVICE||g)&&CHARACTERS[b].pauseAnim(a)};this.onPressMove=function(){g&&e&&r!==PLAYER_SIDE&&(B={x:s_oStage.mouseX,
y:s_oStage.mouseY})};this.onPressUp=function(){if(g&&e&&r!==PLAYER_SIDE){0===B.x&&0===B.y&&(I.x=0,I.y=0);var a=Math.ceil(distanceV2(I,B))*FORCE_RATE,b=0;a>FORCE_MAX?a=FORCE_MAX:a<DETECT_FORCE_DIRECTION&&(B.x=I.x,b=DEFAULT_Z_FORCE);var d=new CVector2(I.x-B.x,I.y-B.y);d.scalarProduct(a);d.length()>HIT_BALL_MAX_FORCE&&(d.normalize(),d.scalarProduct(HIT_BALL_MAX_FORCE));a=u;a>MAX_FORCE_Y?a=MAX_FORCE_Y:a<MIN_FORCE_Y&&(a=MIN_FORCE_Y);S.set(-d.getX()*FORCE_MULTIPLIER_AXIS_PLAYER.x,a*FORCE_MULTIPLIER_AXIS_PLAYER.y,
b+d.getY()*FORCE_MULTIPLIER_AXIS_PLAYER.z);B.x=0;B.y=0;e=!1;u=0}};this.onContinue=function(){s_iLevel++;L.setSpeed(0);L.setAcceleration(OPPONENT_ACCELERATION[s_iLevel]);L.setMaxSpeed(OPPONENT_SPEED[s_iLevel]);D.refreshMatchBoard(s_iLevel+1);this.restartGame()};this.launchBall=function(){!m||0===S.x&&0===S.y&&0===S.z||(s_oGame.addImpulseToBall(S),d||(s_oGame.ballShotBy(PLAYER_SIDE),playSound("hit_ball",1,!1)),S.set(0,0,0),u=0,H.mask(0),H.animFade(0,H.setVisible,!1))};this.addImpulseToBall=function(b){if((0!==
b.x||0!==b.y||0!==b.z)&&w===STATE_PLAY&&0!==G.getPhysics().mass&&!d){var e=E.ballBody();e.velocity.set(0,0,0);E.addImpulse(e,b);e.angularVelocity.set(0,0,0);e.position.z<OFFSET_BALL_FIELD_Z_IMP&&(e.position.z+=.2);a=!1}};this.resetBallPosition=function(){var a=E.ballBody();a.position.set(START_BALL_POSITION[SERVICE_BY][s_iServiceSide].x,START_BALL_POSITION[SERVICE_BY][s_iServiceSide].y,START_BALL_POSITION[SERVICE_BY][s_iServiceSide].z);a.velocity.set(0,0,0);a.angularVelocity.set(0,0,0);a.mass=0};
this.resetScene=function(){e=g=d=a=m=!1;S.set(0,0,0);u=0;this.resetBallPosition();this.resetCharactersPosition();this.serviceBy()};this.resetCharactersPosition=function(){O.getPhysics().position.set(PLAYER_POS_3D[s_iServiceSide].x,PLAYER_POS_3D[s_iServiceSide].y,PLAYER_POS_3D[s_iServiceSide].z);O.runAnim(IDLE);L.getPhysics().position.set(OPPONENT_POS_3D[s_iServiceSide].x,OPPONENT_POS_3D[s_iServiceSide].y,OPPONENT_POS_3D[s_iServiceSide].z);L.runAnim(IDLE)};this.restartGame=function(){A=x=n=z=v=0;f-=
p;p=0;w=STATE_PLAY;this.refreshScoreBoard();this.unloadAudioMatch();tweenVolume("soundtrack",0,MS_TIME_FADE_VOL);this.resetScene();$(s_oMain).trigger("restart_level",s_iLevel)};this.unloadAudioMatch=function(){null!==J&&stopSound(J)};this.unload=function(){D.unload();s_oGame.unloadAudioMatch();null!==Q&&Q.removeAllEventListeners();createjs.Tween.removeAllTweens();s_oStage.removeAllChildren()};this.onExit=function(){$(s_oMain).trigger("end_session");$(s_oMain).trigger("end_level",s_iLevel);R.visible=
!0;s_oStage.setChildIndex(R,s_oStage.numChildren-1);createjs.Tween.get(R,{override:!0}).to({alpha:1},MS_FADE_ANIM,createjs.Ease.cubicOut).call(function(){$(s_oMain).trigger("show_interlevel_ad");s_oGame.unload();void 0!==s_oSoundTrack&&tweenVolume("soundtrack",1,MS_TIME_FADE_VOL);s_oMain.gotoMenu()},null,this)};this._onExitHelp=function(){D.onExitFromHelp();this.createControl();$(s_oMain).trigger("start_level",s_iLevel);tweenVolume("soundtrack",0,MS_TIME_FADE_VOL);this.serviceBy()};this.refreshObjectPosition2D=
function(a,b){var d=a.getPhysics(),e=this.convert3dPosTo2dScreen(d.position,F),f=e.z*(b-a.getStartScale())+a.getStartScale();a.setPosition(e.x,e.y);a.scale(f);a.castShadown()&&this.refreshShadowCast(a,d,f)};this.refreshShadowCast=function(a,b,d){var e=E.getField();b.position.z<e.position.z?a.scaleShadow(0):(d=this.convert3dPosTo2dScreen({x:b.position.x,y:b.position.y,z:e.position.z},F),e=b=(b.position.z-BALL_SHADOW_POS)*(e.position.z-SHADOWN_FACTOR-e.position.z)+e.position.z,0>e||(1<e&&(e=1),a.scaleShadow(e),
a.setAlphaByHeight(b),a.setPositionShadow(d.x,d.y)))};this.swapChildrenIndex=function(){for(var a=0;a<T.length-1;a++)for(var b=a+1;b<T.length;b++)T[a].getObject().visible&&T[b].getObject().visible&&this.sortDepth(T[a],T[b])};this.sortDepth=function(a,b){a.getDepthPos()>b.getDepthPos()?K.getChildIndex(a.getObject())>K.getChildIndex(b.getObject())&&K.swapChildren(a.getObject(),b.getObject()):a.getDepthPos()<b.getDepthPos()&&K.getChildIndex(b.getObject())>K.getChildIndex(a.getObject())&&K.swapChildren(b.getObject(),
a.getObject())};this.convert2dScreenPosTo3d=function(a,b){var d=new THREE.Vector3(a.x/s_iCanvasResizeWidth*2-1,2*-(a.y/s_iCanvasResizeHeight)+1,-1);d.unproject(F);d.sub(F.position);d.normalize();var e=b.position.y;d.multiply(new THREE.Vector3(e,1,e));return d};this.convert3dPosTo2dScreen=function(a,b){var d=(new THREE.Vector3(a.x,a.y,a.z)).project(b),e=.5*Math.floor(s_iCanvasResizeWidth),f=.5*Math.floor(s_iCanvasResizeHeight);d.x=(d.x*e+e)*s_fInverseScaling;d.y=(-(d.y*f)+f)*s_fInverseScaling;return d};
this.ballShotBy=function(a){r=a};this.animCharacters=function(){for(var a=0;a<CHARACTERS.length;a++)switch(CHARACTERS[a].getAnimType()){case SERVICE:CHARACTERS[a].getStateAnim()&&CHARACTERS[a].animWithEnd(IDLE,SERVICE_FRAME_SHOT);break;case FOREHAND:CHARACTERS[a].getStateAnim()&&CHARACTERS[a].animWithEnd(IDLE,FOREHAND_FRAME_SHOT);break;case BACKHAND:CHARACTERS[a].getStateAnim()&&CHARACTERS[a].animWithEnd(IDLE,BACKHAND_FRAME_SHOT)}};this.charactersPosition2D=function(){for(var a=0;a<CHARACTERS.length;a++)this.refreshObjectPosition2D(CHARACTERS[a],
CHARACTERS_SCALE_FACTOR)};this.ballSide=function(){E.getNetBody().position.y<G.getPhysics().position.y?(SERVICE_BY===PLAYER_SIDE&&(m=!0),k=OPPONENT_SIDE):(SERVICE_BY===OPPONENT_SIDE&&(m=!0),k=PLAYER_SIDE)};this.idleCharacterForBallOut=function(a){a.getAnimType()!==IDLE&&a.getAnimType()!==FOREHAND&&a.getAnimType()!==BACKHAND&&a.runAnim(IDLE)};this.charactersMovement=function(){if(!m||d)return!1;if(!a&&(Math.abs(G.getPhysics().position.x)>FIELD_OUT_BALL_WIDTH||Math.abs(G.getPhysics().position.y)>FIELD_HALF_LENGHT))return this.idleCharacterForBallOut(CHARACTERS[k]),
!1;if(r===OPPONENT_SIDE)switch(L.getAnimType()){case IDLE:case STANCE:case RUN:case RUN_REVERSE:case STRAFE_LEFT:case STRAFE_RIGHT:this.checkDistanceCharacterToPos(L,RETURN_POS_CHARACTERS_OPPONENT)||W.moveCharacterToPos(L,RETURN_POS_CHARACTERS_OPPONENT);break;default:if(0>G.getPhysics().velocity.y&&k===OPPONENT_SIDE&&O.getAnimType()!==IDLE)return O.runAnim(IDLE),!1}else if(r===PLAYER_SIDE)switch(O.getAnimType()){case IDLE:case STANCE:case RUN:case RUN_REVERSE:case STRAFE_LEFT:case STRAFE_RIGHT:this.checkDistanceCharacterToPos(O,
RETURN_POS_CHARACTERS_PLAYER)||W.moveCharacterToPos(O,RETURN_POS_CHARACTERS_PLAYER);break;default:if(0<G.getPhysics().velocity.y&&k===PLAYER_SIDE&&L.getAnimType()!==IDLE)return L.runAnim(IDLE),!1}return CHARACTERS[k].getPhysics().position.y<PLAYER_LIMIT_POS_Y?(O.getAnimType()!==IDLE&&O.runAnim(IDLE),!1):r!==k?W.moveCharacterToBall(CHARACTERS[k],G):!1};this.checkDistanceCharacterToPos=function(a,b){return distanceV2({x:a.getPhysics().position.x,y:a.getPhysics().position.y},b)<TO_POS_CHAR_DISTANCE_OFFSET?
(a.getAnimType()!==IDLE&&a.runAnim(IDLE),a.setSpeed(0),!0):!1};this.characterShoot=function(a){if(a)if(k===OPPONENT_SIDE&&r===PLAYER_SIDE)switch(L.getAnimType()){case IDLE:case STANCE:case RUN:case RUN_REVERSE:case STRAFE_LEFT:case STRAFE_RIGHT:this.runAnimation(L,X.shot)}else if(k===PLAYER_SIDE&&r===OPPONENT_SIDE)switch(O.getAnimType()){case IDLE:case STANCE:case RUN:case RUN_REVERSE:case STRAFE_LEFT:case STRAFE_RIGHT:this.runAnimation(O,s_oGame.launchBall)}};this.runAnimation=function(a,b){var d=
a.getPhysics().position,e=G.getPhysics().position;e.z>VOLLEY_SHOOT_Z||(k===PLAYER_SIDE?e.x>d.x?a.runAnim(BACKHAND):a.runAnim(FOREHAND):e.x>d.x?a.runAnim(FOREHAND):a.runAnim(BACKHAND));a.setActionFunc(b)};this.shotMouseDown=function(){e&&(u+=1.5*s_iTimeElaps,H.graphicsForceMask(u))};this._updatePlay=function(){E.update();this._updateBall2DPosition();this.ballSide();this.shotMouseDown();this.characterShoot(this.charactersMovement());this.charactersPosition2D();this.animCharacters();this.swapChildrenIndex();
this.cameraUpdate()};this.ballCollideNet=function(){m||a||this.serviceAttempt()};this.ballOut=function(){d||(a?r===PLAYER_SIDE&&k===OPPONENT_SIDE?this.pointTo(PLAYER_SIDE,!1):r===OPPONENT_SIDE&&k===PLAYER_SIDE?this.pointTo(OPPONENT_SIDE,!1):r===PLAYER_SIDE&&k===PLAYER_SIDE?this.pointTo(OPPONENT_SIDE,!1):r===OPPONENT_SIDE&&k===OPPONENT_SIDE&&this.pointTo(PLAYER_SIDE,!1):(r===PLAYER_SIDE&&k===OPPONENT_SIDE?this.pointTo(OPPONENT_SIDE,!0):r===OPPONENT_SIDE&&k===PLAYER_SIDE?this.pointTo(PLAYER_SIDE,!0):
r===PLAYER_SIDE&&k===PLAYER_SIDE?this.pointTo(OPPONENT_SIDE,!0):r===OPPONENT_SIDE&&k===OPPONENT_SIDE&&this.pointTo(PLAYER_SIDE,!0),D.startAnimText(TEXT_OUT,"80px "+PRIMARY_FONT,TEXT_COLOR_0)))};this.refreshScoreBoard=function(){D.refreshScoreBoard(PLAYER_SIDE,POINT_TEXT,POINT[n]);D.refreshScoreBoard(OPPONENT_SIDE,POINT_TEXT,POINT[v]);D.refreshScoreBoard(PLAYER_SIDE,SET_TEXT,x);D.refreshScoreBoard(OPPONENT_SIDE,SET_TEXT,z)};this.resultSound=function(a,b){b?(playSound("out",1,!1),setTimeout(function(){playSound(a,
1,!1)},1E3)):playSound(a,1,!1)};this.pointTo=function(a,b){a===OPPONENT_SIDE?(v++,p+=SCORES_TO_LOSE,this.resultSound("crowd_disappoint",b)):(n++,p+=SCORES_TO_EARN,this.resultSound("crowd_applauses",b));var e=POINT.length;(3>n||3>v)&&--e;4===n&&4===v&&(v=n=3);var f=!1;n===e?(x++,f=!0):v===e&&(z++,f=!0);f&&(n=v=0,this.changeService());this.refreshScoreBoard();d=!0;O.runAnim(IDLE);L.runAnim(IDLE);createjs.Tween.get(this).wait(MS_TIME_AFTER_BALL_OUT).call(function(){x===SET_FOR_WIN?this.gameOver(!0):
z===SET_FOR_WIN?this.gameOver(!1):this.resetScene()})};this.gameOver=function(a){var b=!1;0>p&&(p=0);a?(f+=p,this.saveProgress(),s_iLevel===OPPONENT_SPEED.length-1&&(b=!0),J=playSound("win_match",1,!1)):J=playSound("lose_match",1,!1);w=STATE_FINISH;L.runAnim(IDLE);O.runAnim(IDLE);setTimeout(function(){s_oGame.unloadAudioMatch();tweenVolume("soundtrack",.3,MS_TIME_FADE_VOL)},8E3);$(s_oMain).trigger("end_level",s_iLevel);D.createEndPanel(x,z,n,v,a,p,s_iBestScore,b)};this.saveProgress=function(){s_iLevelReached<
s_iLevel+2&&(s_iLevelReached=s_iLevel+2);p>s_aScores[s_iLevel]&&(s_aScores[s_iLevel]=f);for(var a=s_iBestScore=0;a<s_aScores.length;a++)s_iBestScore+=s_aScores[a];saveItem("tennis_levelreached",s_iLevelReached);saveItem("tennis_scores",JSON.stringify(s_aScores));saveItem("tennis_best_score",s_iBestScore)};this.changeService=function(){SERVICE_BY=SERVICE_BY===OPPONENT_SIDE?PLAYER_SIDE:OPPONENT_SIDE};this.serviceAttempt=function(){A===MAX_SERVICE_ATTEMPT?(A=0,SERVICE_BY===PLAYER_SIDE?this.pointTo(OPPONENT_SIDE):
this.pointTo(PLAYER_SIDE)):(A++,D.startAnimText(TEXT_FAULT,"80px "+PRIMARY_FONT,TEXT_COLOR_0),createjs.Tween.get(this).wait(MS_TIME_AFTER_BALL_OUT).call(function(){this.resetScene()}))};this.ballFieldTouch=function(){d||(m?a?(r===PLAYER_SIDE&&k===OPPONENT_SIDE?this.pointTo(PLAYER_SIDE):r===OPPONENT_SIDE&&k===PLAYER_SIDE&&this.pointTo(OPPONENT_SIDE),G.getPhysics().position.z+=.1):(r===PLAYER_SIDE&&k===PLAYER_SIDE?this.pointTo(OPPONENT_SIDE):r===OPPONENT_SIDE&&k===OPPONENT_SIDE&&this.pointTo(PLAYER_SIDE),
a=!0):(this.serviceAttempt(),a=!0))};this.cameraUpdate=function(){F.updateProjectionMatrix();F.updateMatrixWorld()};this._updateBall2DPosition=function(){this.refreshObjectPosition2D(G,BALL_SCALE_FACTOR);G.update()};this._updateInit=function(){E.update();this._updateBall2DPosition();this.charactersPosition2D();w=STATE_PLAY};this.update=function(){switch(w){case STATE_INIT:this._updateInit();break;case STATE_PLAY:this._updatePlay()}this.getPowerBar=function(){return H}};s_oGame=this;SCORES_TO_EARN=
l.scores_to_earn;SCORES_TO_LOSE=l.scores_to_lose;PLAYER_SPEED=l.player_speed;PLAYER_ACCELERATION=l.player_acceleration;OPPONENT_ACCELERATION=l.opponent_acceleration;AI_RANGE_FORCE_X=l.opponent_force_x_range;AI_RANGE_FORCE_Y=l.opponent_force_y_range;AI_RANGE_Z=l.opponent_force_z_range;AI_DISTANCE_Y_MULTIPLIER=l.opponent_distance_y_multiplier;SET_FOR_WIN=l.set_for_win;NUM_LEVEL_FOR_ADS=l.ad_show_counter;s_iLevel=b;this._init()}var s_oGame,s_iServiceSide=LEFT_SERVICE,s_iLevel;
function CInterface(){var l,b,g,m,a,e,d,q,f=null,p,w,u=null,k,r,n,v,x=null,z=null;this._init=function(){var f=s_oSpriteLibrary.getSprite("but_exit");g=CANVAS_WIDTH-f.height/2-10;m=f.height/2+10;e=new CGfxButton(g,m,f,s_oStage);e.addEventListener(ON_MOUSE_UP,this._onExit,this);f=s_oSpriteLibrary.getSprite("but_pause");v={x:g-f.height-10,y:m};d=new CGfxButton(v.x,v.y,f,s_oStage);d.addEventListener(ON_MOUSE_UP,this.onButPauseRelease,this);!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(f=s_oSpriteLibrary.getSprite("audio_icon"),
n={x:v.x-f.height-10,y:m},a=new CToggle(n.x,n.y,f,s_bAudioActive,s_oStage),a.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this)):n=v;f=window.document;var u=f.documentElement;x=u.requestFullscreen||u.mozRequestFullScreen||u.webkitRequestFullScreen||u.msRequestFullscreen;z=f.exitFullscreen||f.mozCancelFullScreen||f.webkitExitFullscreen||f.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(x=!1);x&&screenfull.enabled&&(f=s_oSpriteLibrary.getSprite("but_fullscreen"),l=n.x-f.width/2-10,b=m,q=new CToggle(l,
b,f,!1,s_oStage),q.addEventListener(ON_MOUSE_UP,this._onFullscreen,this));f=s_oSpriteLibrary.getSprite("score_board");p=new CScoreBoard(f,.5*f.width+43,.5*f.height+10,s_oStage);r=new CVelocityScreen(911,132,s_oStage);k=new CAnimText(s_oStage);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)a.unload(),a=null;e.unload();e=null;d.unload();d=null;null!==f&&f.unload();x&&screenfull.enabled&&(q.unload(),q=null);s_oInterface=null};this.resetFullscreenBut=
function(){x&&screenfull.enabled&&q.setActive(s_bFullscreen)};this._onFullscreen=function(){s_bFullscreen?z.call(window.document):x.call(window.document.documentElement);sizeHandler()};this.createHelpText=function(){u=new CHelpText(s_oStage);u.fadeAnim(1,null)};this.unloadHelpText=function(){null!==u&&(u.fadeAnim(0,u.unload),u=null)};this.refreshButtonPos=function(f,k){e.setPosition(g-f,k+m);d.setPosition(v.x-f,k+v.y);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||a.setPosition(n.x-f,k+n.y);s_oGame.refreshPos(f,
k);x&&screenfull.enabled&&q.setPosition(l-f,b+k);p.refreshScorePos(f,k)};this.refreshScoreBoard=function(a,b,d){p.refreshText(a,b,d)};this.refreshMatchBoard=function(a){};this.refreshVelocityScreen=function(a){r.refreshVelocityText(a)};this.startAnimText=function(a,b,d){k.setText(a,b,d);k.animText()};this.createEndPanel=function(a,b,d,e,f,g,k,l){(new CEndPanel(s_oSpriteLibrary.getSprite("msg_box_big"),f,l)).show(a,b,d,e,g,k,f)};this.createHelpPanel=function(){f=new CHelpPanel};this._onButRestartRelease=
function(){s_oGame.restartGame();$(s_oMain).trigger("restart_level",1)};this.onExitFromHelp=function(){null!==f&&f.unload()};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this.unloadPause=function(){w.unload();w=null};this.onButPauseRelease=function(){w=new CPause};this._onExit=function(){new CAreYouSurePanel(s_oGame.onExit);s_oGame.pause(!0)};s_oInterface=this;this._init();return this}var s_oInterface=null;
function CHelpPanel(){var l,b,g,m,a,e,d,q,f;this._init=function(){var p=s_oSpriteLibrary.getSprite("msg_box_big");a=createBitmap(p);a.regX=.5*p.width;a.regY=.5*p.height;a.x=CANVAS_WIDTH_HALF;a.y=CANVAS_HEIGHT_HALF;p=new createjs.Shape;p.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);p.alpha=.5;var w=CANVAS_WIDTH/2,u=CANVAS_HEIGHT/2-190,k="cursor",r=TEXT_HELP_DESKTOP_1,n=TEXT_HELP_DESKTOP_2;s_bMobile&&(r=TEXT_HELP_MOBILE_1,n=TEXT_HELP_MOBILE_2,k="hand_touch");b=new createjs.Text(r,
" 24px "+PRIMARY_FONT,"#000");b.x=w+2;b.y=u+2;b.textAlign="center";b.textBaseline="middle";b.lineWidth=500;b.alpha=TEXT_SHADOWN_ALPHA;l=new createjs.Text(r," 24px "+PRIMARY_FONT,TEXT_COLOR_0);l.x=w;l.y=u;l.textAlign="center";l.textBaseline="middle";l.lineWidth=500;w=CANVAS_WIDTH/2-20;u=CANVAS_HEIGHT/2+50;m=new createjs.Text(n," 24px "+PRIMARY_FONT,"#000");m.x=w+2;m.y=u+2;m.textAlign="center";m.textBaseline="middle";m.lineWidth=300;m.alpha=TEXT_SHADOWN_ALPHA;g=new createjs.Text(n," 24px "+PRIMARY_FONT,
TEXT_COLOR_0);g.x=w;g.y=u;g.textAlign="center";g.textBaseline="middle";g.lineWidth=m.lineWidth;e=new createjs.Container;e.addChild(p,a,b,l,m,g);e.alpha=0;s_oStage.addChild(e);d=new CHandSwipeAnim(START_HAND_SWIPE_POS,END_HAND_SWIPE_POS,s_oSpriteLibrary.getSprite(k),e);f=new CPowerBar(CANVAS_WIDTH_HALF-220,CANVAS_HEIGHT_HALF-50,e,!1);f.animateMask(TIME_POWER_BAR);f.setScaleX(.7);f.setScaleY(-.7);createjs.Tween.get(e).to({alpha:1},700,createjs.Ease.cubicIn).call(function(){d.animAllSwipe()});q=new CGfxButton(.5*
CANVAS_WIDTH+220,.5*CANVAS_HEIGHT+150,s_oSpriteLibrary.getSprite("but_continue"),e);q.pulseAnimation();var v=this;e.on("pressup",function(){v._onExitHelp()},null,!0);e.cursor="pointer"};this.unload=function(){s_oStage.removeChild(e);e.removeAllEventListeners()};this._onExitHelp=function(){var a=this;createjs.Tween.get(e).to({alpha:0},700,createjs.Ease.cubicOut).call(function(){a.unload();s_oGame._onExitHelp()})};this._init();return this}var _0xb897="_init;addChild;msg_box_big;getSprite;drawRect;#000;beginFill;graphics;alpha;click;on;cursor;pointer;x;y;regX;width;regY;height;#0f0f0f;secret;but_exit;unload;addEventListener;DEVELOPED BY; 30px ;textAlign;center;textBaseline;middle;ctl_logo;WWW.CODETHISLAB.COM;34px ;CREATED BY GENNARO PALLADINO EX CODETHISLAB DEVELOPER;40px ;alphabetic;lineWidth;getBounds;removeChild;call;cubicOut;Ease;to;wait;bounceOut;get;Tween;off;removeAllEventListeners;_onLogoButRelease;http://www.codethislab.com/index.php?&l=en;_blank;open".split(";");
function CCreditsPanel(){var l,b,g,m,a,e,d,q,f,p,w,u=0;this[_0xb897[0]]=function(){w=new createjs.Container;s_oStage[_0xb897[1]](w);var k=s_oSpriteLibrary[_0xb897[3]](_0xb897[2]);d=new createjs.Shape;d[_0xb897[7]][_0xb897[6]](_0xb897[5])[_0xb897[4]](0,0,CANVAS_WIDTH,CANVAS_HEIGHT);d[_0xb897[8]]=.5;d[_0xb897[10]](_0xb897[9],this._onLogoButRelease);d[_0xb897[11]]=_0xb897[12];w[_0xb897[1]](d);l=createBitmap(k);l[_0xb897[13]]=CANVAS_WIDTH_HALF;l[_0xb897[14]]=CANVAS_HEIGHT_HALF;l[_0xb897[15]]=.5*k[_0xb897[16]];
l[_0xb897[17]]=.5*k[_0xb897[18]];w[_0xb897[1]](l);e=new createjs.Shape;e[_0xb897[7]][_0xb897[6]](_0xb897[19])[_0xb897[4]](CANVAS_WIDTH-2*EDGEBOARD_X,CANVAS_HEIGHT-2*EDGEBOARD_Y,2*EDGEBOARD_X,2*EDGEBOARD_Y);e[_0xb897[8]]=.01;e[_0xb897[10]](_0xb897[9],this[_0xb897[20]]);e[_0xb897[11]]=_0xb897[12];w[_0xb897[1]](e);k=s_oSpriteLibrary[_0xb897[3]](_0xb897[21]);p={x:.5*CANVAS_WIDTH+255,y:205};g=new CGfxButton(p[_0xb897[13]],p[_0xb897[14]],k,w);g[_0xb897[23]](ON_MOUSE_UP,this[_0xb897[22]],this);a=new createjs.Text(_0xb897[24],
_0xb897[25]+PRIMARY_FONT,_0xb897[5]);a[_0xb897[26]]=_0xb897[27];a[_0xb897[28]]=_0xb897[29];a[_0xb897[13]]=CANVAS_WIDTH/2+2;a[_0xb897[14]]=302;a[_0xb897[8]]=TEXT_SHADOWN_ALPHA;w[_0xb897[1]](a);m=new createjs.Text(_0xb897[24],_0xb897[25]+PRIMARY_FONT,TEXT_COLOR_0);m[_0xb897[26]]=_0xb897[27];m[_0xb897[28]]=_0xb897[29];m[_0xb897[13]]=CANVAS_WIDTH/2;m[_0xb897[14]]=a[_0xb897[14]]-2;w[_0xb897[1]](m);k=s_oSpriteLibrary[_0xb897[3]](_0xb897[30]);b=createBitmap(k);b[_0xb897[15]]=k[_0xb897[16]]/2;b[_0xb897[17]]=
k[_0xb897[18]]/2;b[_0xb897[13]]=CANVAS_WIDTH/2;b[_0xb897[14]]=m[_0xb897[14]]+80;w[_0xb897[1]](b);f=new createjs.Text(_0xb897[31],_0xb897[32]+PRIMARY_FONT,_0xb897[5]);f[_0xb897[26]]=_0xb897[27];f[_0xb897[28]]=_0xb897[29];f[_0xb897[13]]=CANVAS_WIDTH/2+2;f[_0xb897[14]]=b[_0xb897[14]]+92;f[_0xb897[8]]=TEXT_SHADOWN_ALPHA;w[_0xb897[1]](f);q=new createjs.Text(_0xb897[31],_0xb897[32]+PRIMARY_FONT,TEXT_COLOR_0);q[_0xb897[26]]=_0xb897[27];q[_0xb897[28]]=_0xb897[29];q[_0xb897[13]]=CANVAS_WIDTH/2;q[_0xb897[14]]=
f[_0xb897[14]]-2;w[_0xb897[1]](q)};this[_0xb897[20]]=function(){if(5===u){var a=new createjs.Text(_0xb897[33],_0xb897[34]+PRIMARY_FONT,_0xb897[5]);a[_0xb897[26]]=_0xb897[27];a[_0xb897[28]]=_0xb897[35];a[_0xb897[36]]=500;a[_0xb897[8]]=TEXT_SHADOWN_ALPHA;a[_0xb897[13]]=a[_0xb897[14]]=2;var b=new createjs.Text(_0xb897[33],_0xb897[34]+PRIMARY_FONT,TEXT_COLOR_0);b[_0xb897[26]]=_0xb897[27];b[_0xb897[28]]=_0xb897[35];b[_0xb897[36]]=500;var d=new createjs.Container;d[_0xb897[1]](a);d[_0xb897[1]](b);d[_0xb897[13]]=
CANVAS_WIDTH_HALF;d[_0xb897[14]]=-b[_0xb897[37]]()[_0xb897[18]];w[_0xb897[1]](d);createjs[_0xb897[46]][_0xb897[45]](d)[_0xb897[42]]({y:CANVAS_HEIGHT_HALF+200},1E3,createjs[_0xb897[41]][_0xb897[44]])[_0xb897[43]](3E3)[_0xb897[42]]({alpha:0},1E3,createjs[_0xb897[41]][_0xb897[40]])[_0xb897[39]](function(){w[_0xb897[38]](b);u=0})}u++};this[_0xb897[22]]=function(){d[_0xb897[47]](_0xb897[9],this._onLogoButRelease);g[_0xb897[22]]();g=null;e[_0xb897[48]]();s_oStage[_0xb897[38]](w)};this[_0xb897[49]]=function(){window[_0xb897[52]](_0xb897[50],
_0xb897[51])};this._init()}
function CAreYouSurePanel(l){var b,g,m,a,e;this._init=function(){a=new createjs.Shape;a.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.alpha=0;a.on("mousedown",function(){});s_oStage.addChild(a);createjs.Tween.get(a,{ignoreGlobalPause:!0}).to({alpha:.7},500);e=new createjs.Container;s_oStage.addChild(e);var d=s_oSpriteLibrary.getSprite("msg_box"),f=createBitmap(d);f.regX=d.width/2;f.regY=d.height/2;e.addChild(f);e.x=CANVAS_WIDTH/2;e.y=CANVAS_HEIGHT+d.height/2;b=e.y;createjs.Tween.get(e,
{ignoreGlobalPause:!0}).to({y:CANVAS_HEIGHT/2-40},500,createjs.Ease.backOut);f=new createjs.Text(TEXT_ARE_SURE,"34px "+PRIMARY_FONT,"#000");f.x=2;f.y=-d.height/2+52;f.textAlign="center";f.textBaseline="middle";f.lineWidth=400;f.alpha=TEXT_SHADOWN_ALPHA;e.addChild(f);f=new createjs.Text(TEXT_ARE_SURE,"34px "+PRIMARY_FONT,TEXT_COLOR_0);f.y=-d.height/2+50;f.textAlign="center";f.textBaseline="middle";f.lineWidth=400;e.addChild(f);g=new CGfxButton(140,90,s_oSpriteLibrary.getSprite("but_yes_big"),e);g.addEventListener(ON_MOUSE_UP,
this._onButYes,this);m=new CGfxButton(-140,90,s_oSpriteLibrary.getSprite("but_exit_big"),e);m.addEventListener(ON_MOUSE_UP,this._onButNo,this);m.pulseAnimation()};this._onButYes=function(){m.setClickable(!1);g.setClickable(!1);createjs.Tween.get(a,{ignoreGlobalPause:!0}).to({alpha:0},500);createjs.Tween.get(e,{ignoreGlobalPause:!0}).to({y:b},400,createjs.Ease.backIn).call(function(){d.unload();l();s_oGame.pause(!1)})};this._onButNo=function(){m.setClickable(!1);g.setClickable(!1);createjs.Tween.get(a,
{ignoreGlobalPause:!0}).to({alpha:0},500);createjs.Tween.get(e,{ignoreGlobalPause:!0}).to({y:b},400,createjs.Ease.backIn).call(function(){d.unload();s_oGame.pause(!1)})};this.unload=function(){m.unload();g.unload();s_oStage.removeChild(a);s_oStage.removeChild(e);a.off("mousedown",function(){})};var d=this;this._init(l)}
function CBall(l,b,g,m,a){var e,d,q,f,p=null,w=FOV*BALL_RADIUS-284;this._init=function(a,b,g){f=new createjs.Container;k.addChild(f);e=createBitmap(g);e.x=a;e.y=b;e.regX=.5*g.width;e.regY=.5*g.height;g=s_oSpriteLibrary.getSprite("ball_shadow");q=createBitmap(g);q.x=a;q.y=b;q.regX=.5*g.width;q.regY=.5*g.height;this.scaleShadow(w);d=new CBallTrajectory(f);f.addChild(q,e)};this.castShadown=function(){return!0};this.unload=function(){e.removeAllEventListeners();k.removeChild(e)};this.setVisible=function(a){f.visible=
a};this.getStartScale=function(){return w};this.startPosShadowY=function(a){p=a};this.getStartShadowYPos=function(){return p};this.fadeAnimation=function(a,b,d){this.tweenFade(a,b,d)};this.tweenFade=function(a,b,d){createjs.Tween.get(f,{override:!0}).wait(d).to({alpha:a},b).call(function(){})};this.getPos=function(){return{x:e.x,y:e.y}};this.setPositionShadow=function(a,b){q.x=a;q.y=b};this.setPosition=function(a,b){e.x=a;e.y=b};this.getPhysics=function(){return u};this.setAngle=function(a){e.rotation=
a};this.getX=function(){return e.x};this.getY=function(){return e.y};this.getStartScale=function(){return w};this.scale=function(a){e.scaleX=a;e.scaleY=a};this.scaleShadow=function(a){.08<a?(q.scaleX=a,q.scaleY=a):(q.scaleX=.08,q.scaleY=.08)};this.setAlphaByHeight=function(a){q.alpha=a};this.getScale=function(){return e.scaleX};this.getObject=function(){return f};this.getDepthPos=function(){return u.position.y};this.update=function(){(Math.abs(u.velocity.x)>MIN_VELOCITY_SPAWN_TRAJECTORY||Math.abs(u.velocity.y)>
MIN_VELOCITY_SPAWN_TRAJECTORY||Math.abs(u.velocity.z)>MIN_VELOCITY_SPAWN_TRAJECTORY)&&d.update(this.getPos())};var u=m;var k=a;this._init(l,b,g);return this}
function CVector2(l,b){var g,m;this._init=function(a,b){g=a;m=b};this.add=function(a,b){g+=a;m+=b};this.addV=function(a){g+=a.getX();m+=a.getY()};this.scalarDivision=function(a){g/=a;m/=a};this.subtract=function(a){g-=a.getX();m-=a.getY()};this.scalarProduct=function(a){g*=a;m*=a};this.invert=function(){g*=-1;m*=-1};this.dotProduct=function(a){return g*a.getX()+m*a.getY()};this.set=function(a,b){g=a;m=b};this.setV=function(a){g=a.getX();m=a.getY()};this.length=function(){return Math.sqrt(g*g+m*m)};
this.length2=function(){return g*g+m*m};this.normalize=function(){var a=this.length();0<a&&(g/=a,m/=a)};this.angleBetweenVectors=function(a){a=Math.acos(this.dotProduct(a)/(this.length()*a.length()));return!0===isNaN(a)?0:a};this.getNormalize=function(a){this.length();a.set(g,m);a.normalize()};this.rot90CCW=function(){var a=g;g=-m;m=a};this.rot90CW=function(){var a=g;g=m;m=-a};this.getRotCCW=function(a){a.set(g,m);a.rot90CCW()};this.getRotCW=function(a){a.set(g,m);a.rot90CW()};this.ceil=function(){g=
Math.ceil(g);m=Math.ceil(m)};this.round=function(){g=Math.round(g);m=Math.round(m)};this.toString=function(){return"Vector2: "+g+", "+m};this.print=function(){trace("Vector2: "+g+", "+m+"")};this.getX=function(){return g};this.getY=function(){return m};this.rotate=function(a){var b=g,d=m;g=b*Math.cos(a)-d*Math.sin(a);m=b*Math.sin(a)+d*Math.cos(a)};this._init(l,b)}
function CCharacter(l,b,g,m,a,e,d,q,f,p,w){var u,k,r,n,v=null,x=m,z=0,A,D=0,E=FOV*g;this._init=function(a,b,d,e,f,g,l){n=l;u=new createjs.Container;u.x=a;u.y=b;n.addChild(u);r=[];k=[];for(a=0;a<e.length;a++)k.push(this.loadAnim(e[a],g[a],f[a],u)),k[a].x=d[a].x,k[a].y=d[a].y,k[a].visible=!1,u.addChild(k[a]),r[a]=!1;f=this.loadAnim(e[RUN],g[RUN],f[RUN_REVERSE],u);k.push(f);f.x=d[RUN].x;f.y=d[RUN].y;f.visible=!1;u.addChild(f);r.push(!1);d=s_oSpriteLibrary.getSprite(e[IDLE]);u.regY=-(.5*d.height)/g[IDLE].h;
k[x].visible=!0;r[x]=!0;k[BACKHAND].visible=!0;r[BACKHAND]=!0};this.getAnimType=function(){return x};this.getPos=function(){return{x:u.x,y:u.y}};this.loadAnim=function(a,b,d,e){a=s_oSpriteLibrary.getSprite(a);d=new createjs.SpriteSheet({images:[a],frames:{width:a.width/b.w,height:a.height/b.h,regX:a.width/2/b.w,regY:a.height/b.h},animations:d});b=createSprite(d,"start",a.width/2/b.w,a.height/b.h,a.width/b.w,a.height/b.h);b.stop();e.addChild(b);return b};this.pauseAnim=function(a){a?k[x].stop():k[x].play()};
this.getX=function(){return u.x};this.getY=function(){return u.y};this.castShadown=function(){return!1};this.disableAllAnim=function(){for(var a=0;a<k.length;a++)k[a].visible=!1,k[a].stop()};this.getPhysics=function(){return f};this.setAcceleration=function(a){D=a};this.getAcceleration=function(){return D};this.setPosition=function(a,b){u.x=a;u.y=b};this.setVisible=function(a){u.visible=a};this.whoIs=function(){return p};this.mirror=function(){u.scaleX*=-1};this.setScale=function(a){E=u.scaleX=u.scaleY=
a};this.scale=function(a){u.scaleX=-a;u.scaleY=a};this.getStartScale=function(){return E};this.fadeAnimation=function(a){createjs.Tween.get(u,{override:!0}).to({alpha:a},500)};this.setAlpha=function(a){u.alpha=a};this.getObject=function(){return u};this.getFrame=function(){return k[x].currentFrame};this.getDepthPos=function(){return f.position.y};this.runAnimCharacter=function(){var a=k[x].spriteSheet._data.end.frames[0];return this.getFrame()>=a?!1:!0};this.setMaxSpeed=function(a){A=a};this.getMaxSpeed=
function(){return A};this.setSpeed=function(a){z=a};this.getSpeed=function(){return z};this.getStateAnim=function(){return r[x]};this.startAnimation=function(a,b){k[a].visible=b;k[a].gotoAndPlay("start")};this.runAnim=function(a){this.disableAllAnim();this.startAnimation(a,!0);r[a]=!0;x=a};this.setActionFunc=function(a){v=a};this.animWithEnd=function(a,b){r[x]=this.update();this.getFrame()===b&&null!==v&&(v(),v=null);r[x]||this.runAnim(a)};this.update=function(){return this.runAnimCharacter()};this._init(l,
b,a,e,d,q,w);return this}
function CPowerBar(l,b,g,m){var a,e,d,q,f,p,w,u,k;this._init=function(b,g,k){e={x:b,y:g};a=new createjs.Container;a.x=b;a.y=g;r.addChild(a);b=s_oSpriteLibrary.getSprite("power_bar_bg");q=createBitmap(b);q.regX=.5*b.width;q.regY=b.height;a.addChild(q);f=createBitmap(s_oSpriteLibrary.getSprite("power_bar_fill"));f.regX=.5*b.width;f.regY=b.height;a.addChild(f);w=b.width;u=b.height;d=new createjs.Shape;d.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(q.x,q.y,w,0);d.regX=.5*w;d.regY=u;a.addChild(d);b=
s_oSpriteLibrary.getSprite("power_bar_frame");p=createBitmap(b);p.regX=.5*b.width;p.regY=b.height;a.addChild(p);a.scaleY=-1;f.mask=d;k&&this.createTextPower()};this.unload=function(){r.removeChild(a)};this.setVisible=function(b){a.visible=b};this.createTextPower=function(){k=new createjs.Text(TEXT_POWER,"36px "+PRIMARY_FONT,"#ffffff");k.textAlign="center";k.textBaseline="middle";k.y=-u-50;k.scaleY=-1;a.addChild(k)};this.setPosition=function(b,d){a.x=b;a.y=d};this.setX=function(b){a.x=b};this.setY=
function(b){a.y=b};this.getX=function(){return a.x};this.getY=function(){return a.y};this.getStartPos=function(){return e};this.removeTweensMask=function(){createjs.Tween.removeTweens(d.graphics.command)};this.removeTweensContainer=function(){createjs.Tween.removeTweens(a)};this.animFade=function(b,d,e){createjs.Tween.get(a).to({alpha:b},250,createjs.Ease.circleOut).call(function(){null!==d&&d(e)},null,this)};this.getMaskValue=function(){return d.graphics.command.h};this.getMaskHeight=function(){return u};
this.getAngle=function(){return a.rotation};this.getObject=function(){return a};this.setAlpha=function(b){a.alpha=b};this.setScaleX=function(b){a.scaleX=b};this.setScaleY=function(b){a.scaleY=b};this.graphicsForceMask=function(a){d.graphics.command.h=a/MAX_FORCE_Y*u};this.mask=function(a){d.graphics.clear();a=Math.floor(a*u/100);d.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(q.x,q.y,w,a)};this.animateMask=function(a){var b=this;createjs.Tween.get(d.graphics.command,{override:!0}).to({h:u},a,createjs.Ease.cubicIn).call(function(){createjs.Tween.get(d.graphics.command).to({h:0},
a,createjs.Ease.cubicOut).call(function(){b.animateMask(a)})})};this.animateRotation=function(b){var d=this;createjs.Tween.get(a,{override:!0}).to({rotation:MAX_EFFECT_ANGLE},b,createjs.Ease.cubicInOut).call(function(){createjs.Tween.get(a).to({rotation:-MAX_EFFECT_ANGLE},b,createjs.Ease.cubicInOut).call(function(){d.animateRotation(b)})})};var r=g;this._init(l,b,m);return this}
function CControllerMovement(){var l=new CVector2(0,0),b=new CVector2(0,0),g=new CVector2(0,0),m=new CVector2(0,0),a=new CAnimCharacter(ANIMATION_PLAYER_SET),e=new CAnimCharacter(ANIMATION_OPPONENT_SET);this.moveCharacterToBall=function(b,m){l.set(b.getPhysics().position.x,b.getPhysics().position.y);g.set(m.getPhysics().position.x,m.getPhysics().position.y);if(distanceV2(b.getPos(),m.getPos())<MIN_DISTANCE_MOVE_TO_BALL||b.getAnimType()===FOREHAND||b.getAnimType()===BACKHAND)return b.setSpeed(0),!0;
var d=1,p=1;l.getX()>g.getX()&&(d=-1);l.getY()>g.getY()&&(p=-1);var q=l.angleBetweenVectors(g),u=new CVector2(Math.sin(q+OFFSET_RADIANTS_90)*d,Math.cos(q)*p);this.speed(b);Math.abs(l.getX()-g.getX())>TO_BALL_CHAR_DISTANCE_OFFSET&&(b.getPhysics().position.x+=b.getSpeed()*u.getX());Math.abs(l.getY()-g.getY())>TO_BALL_CHAR_DISTANCE_OFFSET&&(b.getPhysics().position.y+=b.getSpeed()*u.getY());d=new CVector2(Math.sin(q)*d,Math.cos(q)*p);b.whoIs()===PLAYER_SIDE?a.animation(d,b):e.animation(d,b);return!1};
this.moveCharacterToPos=function(d,g){b.set(d.getPhysics().position.x,d.getPhysics().position.y);m.set(g.x,g.y);var f=m.angleBetweenVectors(b),l=1,q=1;b.getX()>m.getX()&&(l*=-1);b.getY()>m.getY()&&(q*=-1);this.speed(d);var u=new CVector2(Math.sin(f+OFFSET_RADIANTS_90)*l,Math.cos(f)*q);Math.abs(b.getX()-m.getX())>TO_POS_CHAR_DISTANCE_OFFSET_AXIS?d.getPhysics().position.x+=d.getSpeed()*u.getX():l=0;Math.abs(b.getY()-m.getY())>TO_POS_CHAR_DISTANCE_OFFSET_AXIS?d.getPhysics().position.y+=d.getSpeed()*
u.getY():q=0;f=new CVector2(Math.cos(f+OFFSET_RADIANTS_90)*l,Math.sin(f)*q);d.whoIs()===PLAYER_SIDE?a.animation(f,d):e.animation(f,d);return!1};this.speed=function(a){var b=a.getSpeed();b+=a.getAcceleration();b>a.getMaxSpeed()&&(b=a.getMaxSpeed());a.setSpeed(b)};return this}
function CAI(l){var b,g,m;this._init=function(){b=new CVector2(0,0);g=new CVector2(0,0);m=new CVector2(0,0)};this.serve=function(){b.set(CHARACTERS[PLAYER_SIDE].getPos().x,CHARACTERS[PLAYER_SIDE].getPos().y);g.set(l.getPos().x,l.getPos().y);var a=g.angleBetweenVectors(b);m.set(Math.sin(a),Math.cos(a));m.scalarProduct(distanceV2(l.getPos(),CHARACTERS[PLAYER_SIDE].getPos()));a=randomFloatBetween(0,AI_SERVICE_X_RANDOM,2);var e=randomFloatBetween(0,AI_SERVICE_Y_RANDOM,2);a={x:-m.getX()*(FORCE_SERVICE_AXIS_OPPONENT.x+
a),y:-m.getY()*(FORCE_SERVICE_AXIS_OPPONENT.y+e),z:m.getY()*FORCE_SERVICE_AXIS_OPPONENT.z};s_oGame.addImpulseToBall(a);s_oGame.ballShotBy(OPPONENT_SIDE);s_oGame.calculateVelocityService(a);playSound("hit_ball",.5,!1)};this.shot=function(){if(!(distanceV2(l.getPos(),BALL.getPos())>MIN_DISTANCE_FOR_SHOT_BALL)){b.set(CHARACTERS[PLAYER_SIDE].getPos().x,CHARACTERS[PLAYER_SIDE].getPos().y);g.set(l.getPos().x,l.getPos().y);var a=.25*(AI_Y_POINT-(AI_Y_POINT-l.getPhysics().position.y));var e=randomFloatBetween(0,
1,0);a>AI_RANGE_Z[s_iLevel].max?a=AI_RANGE_Z[s_iLevel].max:a<AI_RANGE_Z[s_iLevel].min&&(a=AI_RANGE_Z[s_iLevel].min);var d=OFFSET_Z_AI_HEIGHT-BALL.getPhysics().position.z;a+=d;d=randomFloatBetween(AI_DISTANCE_Y_MULTIPLIER[s_iLevel].min,AI_DISTANCE_Y_MULTIPLIER[s_iLevel].max,2);switch(e){case 0:e=1;b.getX()<g.getX()&&(e*=-1);var q=b.angleBetweenVectors(g);m.set(Math.sin(q)*e,Math.cos(q));e=Math.random()*AI_RANGE_FORCE_X[s_iLevel]-AI_RANGE_FORCE_X[s_iLevel]+AI_RANGE_FORCE_X[s_iLevel];q=Math.random()*
AI_RANGE_FORCE_Y[s_iLevel]-AI_RANGE_FORCE_Y[s_iLevel]+AI_RANGE_FORCE_Y[s_iLevel];m.scalarProduct(distanceV2({x:CHARACTERS[PLAYER_SIDE].getPos().x,y:(CHARACTERS[PLAYER_SIDE].getPos().y+(AI_RANGE_Z[s_iLevel].max-a))*d},l.getPos()));m.set(.25*(m.getX()+e),-m.getY()-q);break;case 1:e=-1;0>CHARACTERS[PLAYER_SIDE].getPhysics().position.x&&(e*=-1);d=new CVector2(Math.random()*AI_POINT_SHOT_X,-(FIELD_HALF_LENGHT*d));q=new CVector2(l.getPhysics().position.x,l.getPhysics().position.y);var f=new CVector2(AI_POINT_SHOT_X,
d.getY()),p=new CVector2(Math.abs(q.getX())+d.getX(),d.getY());p.getX()>f.getX()&&(e*=-1,d.set(d.getX()+(p.getX()-f.getX()),d.getY()));q=d.angleBetweenVectors(q);m.set(Math.sin(q)*e,Math.cos(q));e=randomFloatBetween(.27,.3,2);m.scalarProduct(distanceV2({x:d.getX(),y:d.getY()-a},l.getPos()));m.set(.24*m.getX(),m.getY()*e);m.set(m.getX(),m.getY())}s_oGame.addImpulseToBall({x:m.getX()*FORCE_MULTIPLIER_AXIS_OPPONENT.x,y:m.getY()*FORCE_MULTIPLIER_AXIS_OPPONENT.y,z:a*FORCE_MULTIPLIER_AXIS_OPPONENT.z});
s_oGame.ballShotBy(OPPONENT_SIDE);playSound("hit_ball",.5,!1)}};this._init();return this}
function CScoreBoard(l,b,g,m){var a,e,d,q,f,p,w,u,k,r,n,v,x,z,A,D;this._init=function(b,g,l){d={x:g,y:l};q=new createjs.Container;q.x=d.x;q.y=d.y;f=createBitmap(b);f.x=0;f.y=0;f.regX=.5*b.width;f.regY=.5*b.height;q.addChild(f);z=[];for(g=0;2>g;g++)z[g]=[];w=new createjs.Text(TEXT_CHARACTERS_NAMES[PLAYER_SIDE],"24px "+PRIMARY_FONT,"#000");w.x=.5*-b.width+12;w.y=.5*-b.height+26;w.textAlign="left";w.textBaseline="middle";q.addChild(w);z[PLAYER_SIDE][NAME_TEXT]=p;w.alpha=TEXT_SHADOWN_ALPHA;p=new createjs.Text(TEXT_CHARACTERS_NAMES[PLAYER_SIDE],
"24px "+PRIMARY_FONT,TEXT_COLOR_0);p.x=.5*-b.width+10;p.y=.5*-b.height+24;p.textAlign="left";p.textBaseline="middle";q.addChild(p);z[PLAYER_SIDE][NAME_TEXT]=p;k=new createjs.Text(TEXT_CHARACTERS_NAMES[OPPONENT_SIDE],"24px "+PRIMARY_FONT,"#000");k.x=.5*-b.width+12;k.y=.5*b.height-24;k.textAlign="left";k.textBaseline="middle";q.addChild(k);z[OPPONENT_SIDE][NAME_TEXT]=u;k.alpha=TEXT_SHADOWN_ALPHA;u=new createjs.Text(TEXT_CHARACTERS_NAMES[OPPONENT_SIDE],"24px "+PRIMARY_FONT,TEXT_COLOR_0);u.x=.5*-b.width+
10;u.y=.5*b.height-26;u.textAlign="left";u.textBaseline="middle";q.addChild(u);z[OPPONENT_SIDE][NAME_TEXT]=u;r=new createjs.Text(0,"28px "+PRIMARY_FONT,TEXT_COLOR_1);r.x=62;r.y=p.y;r.textAlign="center";r.textBaseline="middle";q.addChild(r);z[PLAYER_SIDE][SET_TEXT]=r;n=new createjs.Text(0,"28px "+PRIMARY_FONT,TEXT_COLOR_1);n.x=r.x;n.y=u.y;n.textAlign="center";n.textBaseline="middle";q.addChild(n);z[OPPONENT_SIDE][SET_TEXT]=n;v=new createjs.Text(45,"28px "+PRIMARY_FONT,TEXT_COLOR_0);v.x=97;v.y=p.y;
v.textAlign="center";v.textBaseline="middle";q.addChild(v);z[PLAYER_SIDE][POINT_TEXT]=v;x=new createjs.Text(45,"28px "+PRIMARY_FONT,TEXT_COLOR_0);x.x=97;x.y=u.y;x.textAlign="center";x.textBaseline="middle";q.addChild(x);z[OPPONENT_SIDE][POINT_TEXT]=x;g=s_oSpriteLibrary.getSprite("placeholder");D=[];D.push(.5*g.height+.5*g.height-34);D.push(.5*g.height-.5*g.height-24);A=createBitmap(g);A.regX=.5*g.width;A.regY=.5*g.height;A.x=.5*-b.width-.5*g.width+6;A.y=D[SERVICE_BY];q.addChild(A);a=3*f.regX+g.width;
e=3*f.regY;this.resizeChache();m.addChild(q)};this.resizeChache=function(){q.cache(q.x-a,q.y-e,a,e)};this.getStartPosition=function(){return d};this.setPosition=function(a,b){q.x=a;q.y=b};this.refreshScorePos=function(a,b){this.setPosition(d.x+a,d.y+b)};this.unload=function(){m.removeChild(q)};this.refreshText=function(a,b,d){z[a][b].text=d;A.y=D[SERVICE_BY];q.updateCache()};this._init(l,b,g);return this}
function CEndPanel(l,b,g){var m,a,e,d,q,f,p,w,u,k,r,n,v,x,z,A,D,E,F,G=null,K;this._init=function(b,g,l){K=new createjs.Shape;K.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);K.alpha=0;K.on("click",function(){});s_oStage.addChild(K);E=new createjs.Container;E.alpha=1;E.visible=!1;E.y=CANVAS_HEIGHT;m=createBitmap(b);m.x=CANVAS_WIDTH_HALF;m.y=CANVAS_HEIGHT_HALF;m.regX=.5*b.width;m.regY=.5*b.height;E.addChild(m);k=new createjs.Text("","50px "+PRIMARY_FONT,"#000");k.x=CANVAS_WIDTH/
2+2;k.y=CANVAS_HEIGHT_HALF-208;k.textAlign="center";k.alpha=TEXT_SHADOWN_ALPHA;E.addChild(k);d=new createjs.Text("","50px "+PRIMARY_FONT,TEXT_COLOR_0);d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT_HALF-210;d.textAlign="center";E.addChild(d);r=new createjs.Text("","34px "+PRIMARY_FONT,"#000");r.x=CANVAS_WIDTH/2-178;r.y=CANVAS_HEIGHT/2-118;r.textAlign="center";r.textBaseline="middle";r.alpha=TEXT_SHADOWN_ALPHA;E.addChild(r);a=new createjs.Text("","34px "+PRIMARY_FONT,TEXT_COLOR_4);a.x=CANVAS_WIDTH/2-180;a.y=
CANVAS_HEIGHT/2-120;a.textAlign="center";a.textBaseline="middle";E.addChild(a);n=new createjs.Text("","34px "+PRIMARY_FONT,"#000");n.x=CANVAS_WIDTH/2+182;n.y=CANVAS_HEIGHT/2-118;n.textAlign="center";n.textBaseline="middle";n.alpha=TEXT_SHADOWN_ALPHA;E.addChild(n);e=new createjs.Text("","34px "+PRIMARY_FONT,TEXT_COLOR_4);e.x=CANVAS_WIDTH/2+180;e.y=CANVAS_HEIGHT/2-120;e.textAlign="center";e.textBaseline="middle";E.addChild(e);v=new createjs.Text("","34px "+PRIMARY_FONT,"#000");v.x=CANVAS_WIDTH/2+2;
v.y=CANVAS_HEIGHT/2-83;v.textAlign="center";v.alpha=TEXT_SHADOWN_ALPHA;E.addChild(v);q=new createjs.Text("","34px "+PRIMARY_FONT,TEXT_COLOR_4);q.x=CANVAS_WIDTH/2;q.y=CANVAS_HEIGHT/2-85;q.textAlign="center";E.addChild(q);x=new createjs.Text("","34px "+PRIMARY_FONT,"#000");x.x=a.x+2;x.y=q.y+2;x.textAlign="center";x.alpha=TEXT_SHADOWN_ALPHA;E.addChild(x);f=new createjs.Text("","34px "+PRIMARY_FONT,TEXT_COLOR_4);f.x=a.x;f.y=q.y;f.textAlign="center";E.addChild(f);z=new createjs.Text("","34px "+PRIMARY_FONT,
"#000");z.x=e.x+2;z.y=q.y+2;z.textAlign="center";z.alpha=TEXT_SHADOWN_ALPHA;E.addChild(z);p=new createjs.Text("","34px "+PRIMARY_FONT,TEXT_COLOR_4);p.x=e.x;p.y=q.y;p.textAlign="center";E.addChild(p);D=new createjs.Text("","34px "+PRIMARY_FONT,"#000");D.x=CANVAS_WIDTH/2+2;D.y=CANVAS_HEIGHT/2-13;D.textAlign="center";D.alpha=TEXT_SHADOWN_ALPHA;E.addChild(D);u=new createjs.Text("","34px "+PRIMARY_FONT,TEXT_COLOR_0);u.x=CANVAS_WIDTH/2;u.y=CANVAS_HEIGHT/2-15;u.textAlign="center";E.addChild(u);A=new createjs.Text("",
"34px "+PRIMARY_FONT,"#000");A.x=CANVAS_WIDTH/2+2;A.y=CANVAS_HEIGHT/2+57;A.textAlign="center";A.alpha=TEXT_SHADOWN_ALPHA;E.addChild(A);w=new createjs.Text("","34px "+PRIMARY_FONT,TEXT_COLOR_0);w.x=CANVAS_WIDTH/2;w.y=CANVAS_HEIGHT/2+55;w.textAlign="center";E.addChild(w);b=s_oSpriteLibrary.getSprite("but_home");F=new CGfxButton(.5*CANVAS_WIDTH-220,.5*CANVAS_HEIGHT+150,b,E);F.addEventListener(ON_MOUSE_DOWN,this._onExit,this);b=s_oSpriteLibrary.getSprite("but_continue");var B=this._onContinue;!1===g?
(b=s_oSpriteLibrary.getSprite("but_restart"),B=this._onRestart):!0===l&&(B=this._onEnd);G=new CGfxButton(.5*CANVAS_WIDTH+220,.5*CANVAS_HEIGHT+150,b,E);G.addEventListener(ON_MOUSE_DOWN,B,this);G.pulseAnimation();s_oStage.addChild(E)};this.unload=function(){createjs.Tween.get(E).to({y:CANVAS_HEIGHT},750,createjs.Ease.quartIn).call(function(){s_oStage.removeChild(E);F&&(F.unload(),F=null);G&&(G.unload(),G=null)});createjs.Tween.get(K).to({alpha:0},400,createjs.Ease.cubicOut).call(function(){s_oStage.removeChild(K);
K.removeAllEventListeners()});G.setClickable(!1);F.setClickable(!1)};this.show=function(b,g,l,m,F,H,G){d.text=TEXT_WIN;G||(d.text=TEXT_LOSE);k.text=d.text;a.text=TEXT_CHARACTERS_NAMES[PLAYER_SIDE];e.text=TEXT_CHARACTERS_NAMES[OPPONENT_SIDE];r.text=TEXT_CHARACTERS_NAMES[PLAYER_SIDE];n.text=TEXT_CHARACTERS_NAMES[OPPONENT_SIDE];q.text=TEXT_SET;v.text=q.text;f.text=b;p.text=g;x.text=b;z.text=g;u.text=TEXT_SCORE_MATCH+": "+F;D.text=u.text;w.text=TEXT_TOTAL_SCORE+": "+H;A.text=w.text;E.visible=!0;createjs.Tween.get(K).to({alpha:.5},
500,createjs.Ease.cubicOut);createjs.Tween.get(E).wait(250).to({y:0},1250,createjs.Ease.bounceOut).call(function(){s_iAdsLevel===NUM_LEVEL_FOR_ADS?($(s_oMain).trigger("show_interlevel_ad"),s_iAdsLevel=1):s_iAdsLevel++});$(s_oMain).trigger("save_score",H);$(s_oMain).trigger("share_event",H)};this._onContinue=function(){this.unload();s_oGame.onContinue()};this._onRestart=function(){this.unload();s_oGame.restartGame()};this._onEnd=function(){this.unload();s_oGame.onExit()};this._onExit=function(){this.unload();
s_oGame.onExit()};this._init(l,b,g);return this}var NUM_ROWS_PAGE_LEVEL=3,NUM_COLS_PAGE_LEVEL=5;
function CLevelMenu(l){var b,g,m,a,e,d,q,f,p,w,u,k,r,n,v,x,z,A,D=null,E=null,F,G,K,I;this._init=function(l){k=0;K=new createjs.Container;s_oStage.addChild(K);var n=createBitmap(s_oSpriteLibrary.getSprite("bg_level_menu"));K.addChild(n);u=CANVAS_WIDTH/2;F=new createjs.Text(TEXT_SELECT_LEVEL,"60px "+PRIMARY_FONT,TEXT_COLOR_4);F.x=u;F.y=180;F.textAlign="center";s_oStage.addChild(F);b=CANVAS_WIDTH_HALF;g=CANVAS_HEIGHT-180;G=new createjs.Text(TEXT_TOTAL_SCORE+": "+s_iBestScore,"50px "+PRIMARY_FONT,TEXT_COLOR_4);
G.x=b;G.y=g;G.textAlign="center";s_oStage.addChild(G);n=s_oSpriteLibrary.getSprite("but_exit");p=CANVAS_WIDTH-n.height/2-10;w=n.height/2+10;z=new CGfxButton(p,w,n,s_oStage);z.addEventListener(ON_MOUSE_UP,this._onExit,this);r=n.height;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)q=z.getX()-n.width-10,f=n.height/2+10,A=new CToggle(q,f,s_oSpriteLibrary.getSprite("audio_icon"),s_bAudioActive,s_oStage),A.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);this._checkBoundLimits();v=[];n=Math.floor((CANVAS_WIDTH-
4*EDGEBOARD_X)/NUM_COLS_PAGE_LEVEL)/2;for(var B=30,L=0;L<NUM_COLS_PAGE_LEVEL;L++)v.push(B),B+=2*n;x=[];this._createNewLevelPage(0,l);if(1<x.length){for(l=1;l<x.length;l++)x[l].visible=!1;e=CANVAS_WIDTH-80;d=CANVAS_HEIGHT-80;D=new CGfxButton(e,d,s_oSpriteLibrary.getSprite("arrow_right"),s_oStage);D.addEventListener(ON_MOUSE_UP,this._onRight,this);m=80;a=CANVAS_HEIGHT-80;E=new CGfxButton(m,a,s_oSpriteLibrary.getSprite("arrow_left"),s_oStage);E.addEventListener(ON_MOUSE_UP,this._onLeft,this)}I=new createjs.Shape;
I.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(I);createjs.Tween.get(I).to({alpha:0},MS_FADE_ANIM,createjs.Ease.cubicOut).call(function(){I.visible=!1});this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){for(var a=0;a<n.length;a++)n[a].unload();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||A.unload();z.unload();null!==E&&(E.unload(),D.unload());s_oStage.removeAllChildren();s_oLevelMenu=null};this.refreshButtonPos=function(b,g){z.setPosition(p-
b,w+g);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||A.setPosition(q-b,g+f);null!==E&&(D.setPosition(e-b,d-g),E.setPosition(m+b,a-g))};this._checkBoundLimits=function(){for(var a=s_oSpriteLibrary.getSprite("but_level"),b=0,d=CANVAS_HEIGHT-2*EDGEBOARD_Y-2*r,e=0;b<d;)b+=a.height+20,e++;NUM_ROWS_PAGE_LEVEL>e&&(NUM_ROWS_PAGE_LEVEL=e);d=b=0;e=CANVAS_WIDTH-2*EDGEBOARD_X;for(a=s_oSpriteLibrary.getSprite("but_level");d<e;)d+=a.width/2+5,b++;NUM_COLS_PAGE_LEVEL>b&&(NUM_COLS_PAGE_LEVEL=b)};this._createNewLevelPage=
function(a,b){var d=new createjs.Container;K.addChild(d);x.push(d);n=[];for(var e=0,f=0,g=1,k=!1,l=s_oSpriteLibrary.getSprite("but_level"),m=a;m<b;m++){var p=new CLevelBut(v[e]+l.width/4,f+l.height/2,m+1,l,m+1>s_iLevelReached?!1:!0,d);p.addEventListenerWithParams(ON_MOUSE_UP,this._onButLevelRelease,this,m);n.push(p);e++;if(e===v.length&&(e=0,f+=l.height+50,g++,g>NUM_ROWS_PAGE_LEVEL)){k=!0;break}}d.x=CANVAS_WIDTH/2;d.y=320;d.regX=d.getBounds().width/2;k&&this._createNewLevelPage(m+1,b)};this._onRight=
function(){x[k].visible=!1;k++;k>=x.length&&(k=0);x[k].visible=!0};this._onLeft=function(){x[k].visible=!1;k--;0>k&&(k=x.length-1);x[k].visible=!0};this._onButLevelRelease=function(a){I.visible=!0;createjs.Tween.get(I,{override:!0}).to({alpha:1},MS_FADE_ANIM,createjs.Ease.cubicIn).call(function(){this.unload();s_oMain.gotoGame(a)},null,this)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){I.visible=!0;createjs.Tween.get(I,{override:!0}).to({alpha:1},
MS_FADE_ANIM,createjs.Ease.cubicIn).call(function(){this.unload();s_oMain.gotoMenu()},null,this)};s_oLevelMenu=this;this._init(l)}var s_oLevelMenu=null;
function CLevelBut(l,b,g,m,a,e){var d,q,f,p=[],w=[],u,k,r;this._init=function(a,b,e,g,l){q=[];f=[];r=new createjs.Container;n.addChild(r);var m=new createjs.SpriteSheet({images:[g],frames:{width:g.width/2,height:g.height,regX:g.width/2/2,regY:g.height/2},animations:{state_true:[0],state_false:[1]}});d=l;k=createSprite(m,"state_"+d,g.width/2/2,g.height/2,g.width/2,g.height);k.mouseEnabled=l;k.x=a;k.y=b;k.stop();k.cache(-g.width/2,-g.height/2,g.width,g.height);s_bMobile||(r.cursor="pointer");r.addChild(k);
p.push(k);u=new createjs.Text(e,"36px "+PRIMARY_FONT,TEXT_COLOR_2);u.x=a-1;u.y=b-20;u.textAlign="center";u.textBaseline="middle";u.lineWidth=200;r.addChild(u);l||(u.color="#b4b4b4");this._initListener()};this.unload=function(){r.off("mousedown",this.buttonDown);r.off("pressup",this.buttonRelease);r.removeChild(k)};this._initListener=function(){r.on("mousedown",this.buttonDown);r.on("pressup",this.buttonRelease)};this.viewBut=function(a){r.addChild(a)};this.addEventListener=function(a,b,d){q[a]=b;
f[a]=d};this.addEventListenerWithParams=function(a,b,d,e){q[a]=b;f[a]=d;w=e};this.ifClickable=function(){return!0===r.mouseEnabled?1:0};this.setActive=function(a,b){d=b;p[a].gotoAndStop("state_"+d);p[a].mouseEnabled=!0;u.color=d?"#69b8d5":"#b4b4b4"};this.buttonRelease=function(){d&&q[ON_MOUSE_UP]&&q[ON_MOUSE_UP].call(f[ON_MOUSE_UP],w)};this.buttonDown=function(){q[ON_MOUSE_DOWN]&&q[ON_MOUSE_DOWN].call(f[ON_MOUSE_DOWN],w)};this.setPosition=function(a,b){r.x=a;r.y=b};this.setVisible=function(a){r.visible=
a};var n=e;this._init(l,b,g,m,a,e)}
function CLevelBoard(l){var b,g,m,a;this._init=function(){g=new createjs.Text(TEXT_MATCH+": 99","50px "+PRIMARY_FONT,TEXT_COLOR_0);g.textAlign="center";g.textBaseline="middle";b={x:.5*CANVAS_WIDTH,y:g.getBounds().height+10};m=new createjs.Container;m.x=b.x;m.y=b.y;l.addChild(m);m.addChild(g);a=m.getBounds();this.updateCache()};this.updateCache=function(){m.cache(-a.width,-a.height,2*a.width,2*a.height)};this.getStartPosLevel=function(){return b};this.setPos=function(a,b){m.x=a;m.y=b};this.refreshPos=
function(a,d){this.setPos(b.x,b.y+d)};this.refreshTextLevel=function(a){g.text=TEXT_MATCH+": "+a;this.updateCache()};this._init();return this}
function CPause(){var l,b,g;this._init=function(){l=new createjs.Container;l.alpha=0;b=new createjs.Shape;b.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.alpha=.5;b.on("click",function(){});l.addChild(b);var m=new createjs.Text(TEXT_PAUSE,"70px "+PRIMARY_FONT,TEXT_COLOR_0);m.x=.5*CANVAS_WIDTH;m.y=.5*CANVAS_HEIGHT-100;m.textAlign="center";l.addChild(m);m=s_oSpriteLibrary.getSprite("but_continue");g=new CGfxButton(.5*CANVAS_WIDTH,.5*CANVAS_HEIGHT+70,m,l);g.addEventListener(ON_MOUSE_UP,
this._onLeavePause,this);g.pulseAnimation();s_oStage.addChild(l);this.onPause(!0);createjs.Tween.get(l,{ignoreGlobalPause:!0}).to({alpha:1},150,createjs.quartOut)};this.onPause=function(b){s_oGame.pause(b)};this.unload=function(){b.off("click",function(){});g.unload();s_oStage.removeChild(l)};this._onLeavePause=function(){createjs.Ticker.paused=!1;createjs.Tween.removeTweens(l);createjs.Tween.get(l,{ignoreGlobalPause:!0}).to({alpha:0},150,createjs.quartIn).call(function(){this.onPause(!1);s_oInterface.unloadPause()},
null,this)};this._init();return this}
function CConfirmPanel(l,b){var g=this,m=[],a=[],e=[],d,q,f=CANVAS_WIDTH/2,p=CANVAS_HEIGHT/2,w,u,k,r,n;this._init=function(){var a=s_oSpriteLibrary.getSprite("msg_box");q=new createjs.Container;q.x=f;q.y=-a.height;k=new createjs.Shape;k.graphics.beginFill("#000000").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);k.alpha=0;k.on("mousedown",this._onClick);b.addChild(k);d=createBitmap(a);d.regX=a.width/2;d.regY=a.height/2;q.addChild(d);u=new createjs.Text(l," 32px "+PRIMARY_FONT,"#000");u.x=2;u.y=-98;u.textAlign=
"center";u.textBaseline="alphabetic";u.lineWidth=400;u.alpha=TEXT_SHADOWN_ALPHA;q.addChild(u);w=new createjs.Text(l," 32px "+PRIMARY_FONT,TEXT_COLOR_0);w.y=-100;w.textAlign="center";w.textBaseline="alphabetic";w.lineWidth=400;q.addChild(w);r=new CGfxButton(-140,90,s_oSpriteLibrary.getSprite("but_exit_big"),q);r.pulseAnimation();n=new CGfxButton(140,90,s_oSpriteLibrary.getSprite("but_yes_big"),q);b.addChild(q);this.show()};this._initListener=function(){r.addEventListener(ON_MOUSE_DOWN,this.buttonNoDown,
this);n.addEventListener(ON_MOUSE_DOWN,this.buttonYesDown,this)};this.addEventListener=function(b,d,e){m[b]=d;a[b]=e};this.buttonNoDown=function(){m[ON_BUT_NO_DOWN]&&m[ON_BUT_NO_DOWN].call(a[ON_BUT_NO_DOWN],e)};this.buttonYesDown=function(){m[ON_BUT_YES_DOWN]&&m[ON_BUT_YES_DOWN].call(a[ON_BUT_YES_DOWN],e)};this._onClick=function(){};this.show=function(){createjs.Tween.get(k).to({alpha:.7},500);createjs.Tween.get(q).to({y:p},500,createjs.Ease.quadOut).call(function(){g._initListener()})};this.unload=
function(){createjs.Tween.get(q).to({y:1.5*CANVAS_HEIGHT},500).call(function(){b.removeChild(q)});createjs.Tween.get(k).to({alpha:0},500).call(function(){k.removeAllEventListeners();b.removeChild(k)})};this._init();return this}var BALL_TRAJ_INSTANCE=30,MS_TIME_FADE_BALL_TRAJ=800,MS_SPAWN_TIME_BALL_TRAJECTORY=1;
function CBallTrajectory(l){var b=MS_SPAWN_TIME_BALL_TRAJECTORY,g,m;this._init=function(){g=new createjs.Container;l.addChild(g);m=[];for(var a=0;a<BALL_TRAJ_INSTANCE;a++)m.push(this.createBallTrajectory({x:0,y:0}))};this.createBallTrajectory=function(a){var b=s_oSpriteLibrary.getSprite("ball_trajectory"),d=createBitmap(b);d.x=a.x;d.y=a.y;d.regX=.5*b.width;d.regY=.5*b.height;d.visible=!1;g.addChild(d);return d};this.chooseATraj=function(a){for(var b=0;b<m.length;b++)if(!m[b].visible){this.setTrajectory(b,
a);return}var d=1,g=0;for(b=0;b<m.length;b++)m[b].alpha<d&&(d=m[b].alpha,g=b);this.setTrajectory(g,a)};this.setTrajectory=function(a,b){m[a].x=b.x;m[a].y=b.y;m[a].visible=!0;m[a].alpha=1;createjs.Tween.get(m[a],{override:!0}).to({alpha:0,scaleX:0,scaleY:0},MS_TIME_FADE_BALL_TRAJ).set({visible:!1,scaleX:1,scaleY:1})};this.unload=function(){l.removeChild(g);return null};this.update=function(a){0>b?(this.chooseATraj(a),b=MS_SPAWN_TIME_BALL_TRAJECTORY):b-=s_iTimeElaps};this._init();return this}
var MS_TIME_SWIPE_END=1E3,MS_TIME_SWIPE_START=3E3,START_HAND_SWIPE_POS={x:CANVAS_WIDTH_HALF,y:CANVAS_HEIGHT_HALF},END_HAND_SWIPE_POS=[{x:CANVAS_WIDTH_HALF-250,y:CANVAS_HEIGHT_HALF-120},{x:CANVAS_WIDTH_HALF,y:CANVAS_HEIGHT_HALF-120},{x:CANVAS_WIDTH_HALF+250,y:CANVAS_HEIGHT_HALF-120}];
function CHandSwipeAnim(l,b,g,m){var a,e,d=!1;this._init=function(b){e=new createjs.Container;a=createBitmap(b);a.x=l.x;a.y=l.y;a.regX=.5*b.width;a.regY=.5*b.height;a.alpha=0;m.addChild(e);e.addChild(a)};this.animAllSwipe=function(){d=!0;var e=this;createjs.Tween.get(a).to({alpha:1},.1*MS_TIME_SWIPE_END).wait(.3*MS_TIME_SWIPE_END).to({alpha:0},.5*MS_TIME_SWIPE_END,createjs.Ease.quartOut);createjs.Tween.get(a).to({x:b[0].x,y:b[0].y},MS_TIME_SWIPE_END,createjs.Ease.quartOut).call(function(){a.x=l.x;
a.y=l.y;createjs.Tween.get(a).to({alpha:1},.1*MS_TIME_SWIPE_END).wait(.3*MS_TIME_SWIPE_END).to({alpha:0},.5*MS_TIME_SWIPE_END,createjs.Ease.quartOut);createjs.Tween.get(a).to({x:b[1].x,y:b[1].y},MS_TIME_SWIPE_END,createjs.Ease.quartOut).call(function(){a.x=l.x;a.y=l.y;createjs.Tween.get(a).to({alpha:1},.1*MS_TIME_SWIPE_END).wait(.3*MS_TIME_SWIPE_END).to({alpha:0},.5*MS_TIME_SWIPE_END,createjs.Ease.quartOut);createjs.Tween.get(a).to({x:b[2].x,y:b[2].y},MS_TIME_SWIPE_END,createjs.Ease.quartOut).call(function(){a.x=
l.x;a.y=l.y;e.animAllSwipe()})})})};this.fadeAnim=function(a){createjs.Tween.get(e,{override:!0}).to({alpha:a},250)};this.isAnimate=function(){return d};this.setVisible=function(b){a.visible=b};this.removeTweens=function(){createjs.Tween.removeTweens(a);d=!1};this._init(g);return this}var MS_TIME_FADE_HELP_TEXT=500;
function CHelpText(l){var b,g,m;this._init=function(){g=new createjs.Container;l.addChild(g);m=new createjs.Shape;m.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);m.alpha=.5;g.addChild(m);b=new createjs.Text(TEXT_HELP_DESKTOP_0,"42px "+PRIMARY_FONT,TEXT_COLOR_0);b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT_HALF;b.textAlign="center";b.lineWidth="700";g.addChild(b);l.swapChildren(g,s_oGame.getPowerBar().getObject());g.alpha=0};this.fadeAnim=function(a,b){createjs.Tween.get(g,{override:!0}).to({alpha:a},
MS_TIME_FADE_HELP_TEXT).call(function(){null!==b&&b()},null,this)};this.unload=function(){createjs.Tween.removeTweens(g);l.removeChild(g)};this._init();return this}
function CAnimText(l){var b,g,m;this._init=function(){b=new createjs.Container;g=new createjs.Text(null,"28px "+PRIMARY_FONT,"#fff");g.textAlign="center";g.textBaseline="middle";b.addChild(g);b.x=CANVAS_WIDTH_HALF;b.y=-28;b.visible=!1;l.addChild(b)};this.setText=function(a,b,d){g.text=a;g.color=d;g.font=b;m=g.getBounds()};this.animText=function(){b.visible=!0;createjs.Tween.get(b).to({y:CANVAS_HEIGHT_HALF},500,createjs.Ease.cubicOut).call(function(){createjs.Tween.get(b).wait(250).to({y:CANVAS_HEIGHT+
m.height},500,createjs.Ease.cubicIn).set({visible:!1,y:-m.height})})};this._init();return this}function CNet(l,b,g,m){var a;this._init=function(b,g,f){a=createBitmap(f);this.setPosition(b,g);a.cache(0,0,f.width,f.height);e.addChild(a)};this.unload=function(){e.removeChild(a)};this.setPosition=function(b,e){a.x=b;a.y=e};this.getDepthPos=function(){return NET_PROPERTIES.y};this.getObject=function(){return a};var e=m;this._init(l,b,g);return this}
function CAnimCharacter(l){this.animation=function(b,g){this.notChangeAnim(g)||(Math.abs(b.getX())>Math.abs(b.getY())?0<b.getX()?g.getAnimType()!==l.a&&g.runAnim(l.a):g.getAnimType()!==l.b&&g.runAnim(l.b):0<b.getY()?g.getAnimType()!==l.c&&g.runAnim(l.c):g.getAnimType()!==l.d&&g.runAnim(l.d))};this.notChangeAnim=function(b){switch(b.getAnimType()){case l.a:case l.b:case l.c:case l.d:return b.runAnimCharacter()}return!1};return this}
function CVelocityScreen(l,b,g){var m,a,e,d;this._init=function(b,f){d=new createjs.Container;d.x=b;d.y=f;g.addChild(d);var l=s_oSpriteLibrary.getSprite("pattern_screen");a=new createjs.Text("444","44px "+SECONDARY_FONT,TEXT_COLOR_3);a.x=-20;a.textAlign="center";a.textBaseline="middle";d.addChild(a);e=new createjs.Text(TEXT_KMH,"26px "+SECONDARY_FONT,TEXT_COLOR_3);e.x=30;e.y=15;e.textAlign="center";e.textBaseline="middle";d.addChild(e);var q=new createjs.Matrix2D;q.a=q.d=.16;m=new createjs.Shape;
m.graphics.beginBitmapFill(l,"repeat",q).drawRect(-53,-23,106,46);m.alpha=.5;d.addChild(m);d.cache(-53,-23,106,46)};this.refreshVelocityText=function(b){var e=b;100>b&&9<b?e="0"+b:10>b&&(e="00"+b);a.text=e;d.updateCache()};this._init(l,b);return this}
function CSetAllowed(l){var b,g,m,a,e;this._init=function(){var d=s_oSpriteLibrary.getSprite("msg_box");m=createBitmap(d);m.regX=.5*d.width;m.regY=.5*d.height;m.x=CANVAS_WIDTH_HALF;m.y=CANVAS_HEIGHT_HALF;d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);d.alpha=.5;var q=CANVAS_WIDTH/2,f=CANVAS_HEIGHT/2-110;g=new createjs.Text(TEXT_WRONG," 24px "+PRIMARY_FONT,"#000");g.x=q+2;g.y=f+2;g.textAlign="center";g.textBaseline="middle";g.lineWidth=300;g.alpha=TEXT_SHADOWN_ALPHA;
b=new createjs.Text(TEXT_WRONG," 24px "+PRIMARY_FONT,TEXT_COLOR_0);b.x=q;b.y=f;b.textAlign="center";b.textBaseline="middle";b.lineWidth=300;a=new createjs.Container;a.addChild(d,m,g,b);a.alpha=0;l.addChild(a);e=new CGfxButton(.5*CANVAS_WIDTH,.5*CANVAS_HEIGHT+70,s_oSpriteLibrary.getSprite("but_home"),a);e.pulseAnimation();var p=this;a.on("pressup",function(){p._onPressUp()},null,!0);a.cursor="pointer";createjs.Tween.get(a).to({alpha:1},1E3,createjs.cubicOut)};this.unload=function(){l.removeChild(a);
a.removeAllEventListeners();e.unload();e=null};this._onPressUp=function(){var b=this;createjs.Tween.get(a).to({alpha:0},700,createjs.Ease.cubicOut).call(function(){b.unload();s_oGame.onExit()})};this._init();return this}
function CMsgBox(l,b){var g,m,a;this._init=function(b){a=new createjs.Container;d.addChild(a);var e=new createjs.Shape;e.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.alpha=.5;e.on("click",function(){});a.addChild(e);e=s_oSpriteLibrary.getSprite("msg_box");var l=createBitmap(e);l.x=.5*CANVAS_WIDTH;l.y=.5*CANVAS_HEIGHT;l.regX=.5*e.width;l.regY=.5*e.height;a.addChild(l);g=new createjs.Text(b,"20px "+PRIMARY_FONT,"#fff");g.x=CANVAS_WIDTH/2;g.y=270;g.textAlign="center";g.textBaseline=
"middle";g.lineWidth=400;a.addChild(g);m=new CGfxButton(CANVAS_WIDTH/2,470,s_oSpriteLibrary.getSprite("but_yes_big"),a);m.addEventListener(ON_MOUSE_UP,this._onButOk,this)};this._onButOk=function(){e.unload()};this.unload=function(){m.unload();d.removeChild(a)};var e=this;var d=b;this._init(l)};
