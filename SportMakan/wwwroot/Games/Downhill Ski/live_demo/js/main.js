/*
 Platform.js
 Copyright 2014-2020 Benjamin Tan
 Copyright 2011-2013 John-David Dalton
 Available under MIT license
*/
(function(){var a="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},h="undefined"!==typeof module&&module.exports,e=function(){for(var g,k=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),
"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],d=0,t=k.length,b={};d<t;d++)if((g=k[d])&&g[1]in a){for(d=0;d<g.length;d++)b[k[0][d]]=g[d];return b}return!1}(),f={change:e.fullscreenchange,error:e.fullscreenerror},n={request:function(g){return new Promise(function(k,d){var t=function(){this.off("change",
t);k()}.bind(this);this.on("change",t);g=g||a.documentElement;Promise.resolve(g[e.requestFullscreen]())["catch"](d)}.bind(this))},exit:function(){return new Promise(function(g,k){if(this.isFullscreen){var d=function(){this.off("change",d);g()}.bind(this);this.on("change",d);Promise.resolve(a[e.exitFullscreen]())["catch"](k)}else g()}.bind(this))},toggle:function(g){return this.isFullscreen?this.exit():this.request(g)},onchange:function(g){this.on("change",g)},onerror:function(g){this.on("error",g)},
on:function(g,k){var d=f[g];d&&a.addEventListener(d,k,!1)},off:function(g,k){var d=f[g];d&&a.removeEventListener(d,k,!1)},raw:e};e?(Object.defineProperties(n,{isFullscreen:{get:function(){return!!a[e.fullscreenElement]}},element:{enumerable:!0,get:function(){return a[e.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return!!a[e.fullscreenEnabled]}}}),h?module.exports=n:window.screenfull=n):h?module.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}})();
(function(){function a(c){c=String(c);return c.charAt(0).toUpperCase()+c.slice(1)}function h(c,A){var C=-1,w=c?c.length:0;if("number"==typeof w&&-1<w&&w<=v)for(;++C<w;)A(c[C],C,c);else f(c,A)}function e(c){c=t(c);return/^(?:webOS|i(?:OS|P))/.test(c)?c:a(c)}function f(c,A){for(var C in c)u.call(c,C)&&A(c[C],C,c)}function n(c){return null==c?a(c):y.call(c).slice(8,-1)}function g(c,A){var C=null!=c?typeof c[A]:"number";return!/^(?:boolean|number|string|undefined)$/.test(C)&&("object"==C?!!c[A]:!0)}function k(c){return String(c).replace(/([ -])(?!$)/g,
"$1?")}function d(c,A){var C=null;h(c,function(w,B){C=A(C,w,B,c)});return C}function t(c){return String(c).replace(/^ +| +$/g,"")}function b(c){function A(T){return d(T,function(P,M){var V=M.pattern||k(M);!P&&(P=RegExp("\\b"+V+" *\\d+[.\\w_]*","i").exec(c)||RegExp("\\b"+V+" *\\w+-[\\w]*","i").exec(c)||RegExp("\\b"+V+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(c))&&((P=String(M.label&&!RegExp(V,"i").test(M.label)?M.label:P).split("/"))[1]&&!/[\d.]+/.test(P[0])&&(P[0]+=" "+P[1]),M=M.label||
M,P=e(P[0].replace(RegExp(V,"i"),M).replace(RegExp("; *(?:"+M+"[_-])?","i")," ").replace(RegExp("("+M+")[-_.]?(\\w)","i"),"$1 $2")));return P})}function C(T){return d(T,function(P,M){return P||(RegExp(M+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(c)||0)[1]||null})}var w=r,B=c&&"object"==typeof c&&"String"!=n(c);B&&(w=c,c=null);var D=w.navigator||{},z=D.userAgent||"";c||(c=z);var I=B?!!D.likeChrome:/\bChrome\b/.test(c)&&!/internal|\n/i.test(y.toString()),Q=B?"Object":"ScriptBridgingProxyObject",
H=B?"Object":"Environment",N=B&&w.java?"JavaPackage":n(w.java),O=B?"Object":"RuntimeObject";H=(N=/\bJava/.test(N)&&w.java)&&n(w.environment)==H;var U=N?"a":"\u03b1",R=N?"b":"\u03b2",X=w.document||{},J=w.operamini||w.opera,W=x.test(W=B&&J?J["[[Class]]"]:n(J))?W:J=null,l,aa=c;B=[];var ba=null,Z=c==z;z=Z&&J&&"function"==typeof J.version&&J.version();var L=function(T){return d(T,function(P,M){return P||RegExp("\\b"+(M.pattern||k(M))+"\\b","i").exec(c)&&(M.label||M)})}([{label:"EdgeHTML",pattern:"Edge"},
"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),E=function(T){return d(T,function(P,M){return P||RegExp("\\b"+(M.pattern||k(M))+"\\b","i").exec(c)&&(M.label||M)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS",
"Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},
{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),K=A([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",
pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),S=function(T){return d(T,function(P,M,V){return P||(M[K]||M[/^[a-z]+(?: +[a-z]+\b)*/i.exec(K)]||RegExp("\\b"+k(V)+
"(?:\\b|\\w*\\d)","i").exec(c))&&V})}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),
G=function(T){return d(T,function(P,M){var V=M.pattern||k(M);if(!P&&(P=RegExp("\\b"+V+"(?:/[\\d.]+|[ \\w.]*)","i").exec(c))){var Y=P,ca=M.label||M,da={"10.0":"10","6.4":"10 Technical Preview","6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};V&&ca&&/^Win/i.test(Y)&&!/^Windows Phone /i.test(Y)&&(da=da[/[\d.]+$/.exec(Y)])&&(Y="Windows "+da);Y=String(Y);V&&ca&&(Y=Y.replace(RegExp(V,
"i"),ca));P=Y=e(Y.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}return P})}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},
"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);L&&(L=[L]);/\bAndroid\b/.test(G)&&!K&&(l=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(c))&&(K=t(l[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null);S&&!K?K=A([S]):S&&K&&(K=K.replace(RegExp("^("+k(S)+")[-_.\\s]",
"i"),S+" ").replace(RegExp("^("+k(S)+")[-_.]?(\\w)","i"),S+" $2"));if(l=/\bGoogle TV\b/.exec(K))K=l[0];/\bSimulator\b/i.test(c)&&(K=(K?K+" ":"")+"Simulator");"Opera Mini"==E&&/\bOPiOS\b/.test(c)&&B.push("running in Turbo/Uncompressed mode");"IE"==E&&/\blike iPhone OS\b/.test(c)?(l=b(c.replace(/like iPhone OS/,"")),S=l.manufacturer,K=l.product):/^iP/.test(K)?(E||(E="Safari"),G="iOS"+((l=/ OS ([\d_]+)/i.exec(c))?" "+l[1].replace(/_/g,"."):"")):"Konqueror"==E&&/^Linux\b/i.test(G)?G="Kubuntu":S&&"Google"!=
S&&(/Chrome/.test(E)&&!/\bMobile Safari\b/i.test(c)||/\bVita\b/.test(K))||/\bAndroid\b/.test(G)&&/^Chrome/.test(E)&&/\bVersion\//i.test(c)?(E="Android Browser",G=/\bAndroid\b/.test(G)?G:"Android"):"Silk"==E?(/\bMobi/i.test(c)||(G="Android",B.unshift("desktop mode")),/Accelerated *= *true/i.test(c)&&B.unshift("accelerated")):"UC Browser"==E&&/\bUCWEB\b/.test(c)?B.push("speed mode"):"PaleMoon"==E&&(l=/\bFirefox\/([\d.]+)\b/.exec(c))?B.push("identifying as Firefox "+l[1]):"Firefox"==E&&(l=/\b(Mobile|Tablet|TV)\b/i.exec(c))?
(G||(G="Firefox OS"),K||(K=l[1])):!E||(l=!/\bMinefield\b/i.test(c)&&/\b(?:Firefox|Safari)\b/.exec(E))?(E&&!K&&/[\/,]|^[^(]+?\)/.test(c.slice(c.indexOf(l+"/")+8))&&(E=null),(l=K||S||G)&&(K||S||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(G))&&(E=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(G)?G:l)+" Browser")):"Electron"==E&&(l=(/\bChrome\/([\d.]+)\b/.exec(c)||0)[1])&&B.push("Chromium "+l);z||(z=C(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)",
"Version",k(E),"(?:Firefox|Minefield|NetFront)"]));if(l="iCab"==L&&3<parseFloat(z)&&"WebKit"||/\bOpera\b/.test(E)&&(/\bOPR\b/.test(c)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(c)&&!/^(?:Trident|EdgeHTML)$/.test(L)&&"WebKit"||!L&&/\bMSIE\b/i.test(c)&&("Mac OS"==G?"Tasman":"Trident")||"WebKit"==L&&/\bPlayStation\b(?! Vita\b)/i.test(E)&&"NetFront")L=[l];"IE"==E&&(l=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(c)||0)[1])?(E+=" Mobile",G="Windows Phone "+(/\+$/.test(l)?l:l+".x"),B.unshift("desktop mode")):
/\bWPDesktop\b/i.test(c)?(E="IE Mobile",G="Windows Phone 8.x",B.unshift("desktop mode"),z||(z=(/\brv:([\d.]+)/.exec(c)||0)[1])):"IE"!=E&&"Trident"==L&&(l=/\brv:([\d.]+)/.exec(c))&&(E&&B.push("identifying as "+E+(z?" "+z:"")),E="IE",z=l[1]);if(Z){if(g(w,"global"))if(N&&(l=N.lang.System,aa=l.getProperty("os.arch"),G=G||l.getProperty("os.name")+" "+l.getProperty("os.version")),H){try{z=w.require("ringo/engine").version.join("."),E="RingoJS"}catch(T){(l=w.system)&&l.global.system==w.system&&(E="Narwhal",
G||(G=l[0].os||null))}E||(E="Rhino")}else"object"==typeof w.process&&!w.process.browser&&(l=w.process)&&("object"==typeof l.versions&&("string"==typeof l.versions.electron?(B.push("Node "+l.versions.node),E="Electron",z=l.versions.electron):"string"==typeof l.versions.nw&&(B.push("Chromium "+z,"Node "+l.versions.node),E="NW.js",z=l.versions.nw)),E||(E="Node.js",aa=l.arch,G=l.platform,z=(z=/[\d.]+/.exec(l.version))?z[0]:null));else n(l=w.runtime)==Q?(E="Adobe AIR",G=l.flash.system.Capabilities.os):
n(l=w.phantom)==O?(E="PhantomJS",z=(l=l.version||null)&&l.major+"."+l.minor+"."+l.patch):"number"==typeof X.documentMode&&(l=/\bTrident\/(\d+)/i.exec(c))?(z=[z,X.documentMode],(l=+l[1]+4)!=z[1]&&(B.push("IE "+z[1]+" mode"),L&&(L[1]=""),z[1]=l),z="IE"==E?String(z[1].toFixed(1)):z[0]):"number"==typeof X.documentMode&&/^(?:Chrome|Firefox)\b/.test(E)&&(B.push("masking as "+E+" "+z),E="IE",z="11.0",L=["Trident"],G="Windows");G=G&&e(G)}z&&(l=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(z)||/(?:alpha|beta)(?: ?\d)?/i.exec(c+
";"+(Z&&D.appMinorVersion))||/\bMinefield\b/i.test(c)&&"a")&&(ba=/b/i.test(l)?"beta":"alpha",z=z.replace(RegExp(l+"\\+?$"),"")+("beta"==ba?R:U)+(/\d+\+?/.exec(l)||""));if("Fennec"==E||"Firefox"==E&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(G))E="Firefox Mobile";else if("Maxthon"==E&&z)z=z.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(K))"Xbox 360"==K&&(G=null),"Xbox 360"==K&&/\bIEMobile\b/.test(c)&&B.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(E)&&(!E||K||/Browser|Mobi/.test(E))||
"Windows CE"!=G&&!/Mobi/i.test(c))if("IE"==E&&Z)try{null===w.external&&B.unshift("platform preview")}catch(T){B.unshift("embedded")}else(/\bBlackBerry\b/.test(K)||/\bBB10\b/.test(c))&&(l=(RegExp(K.replace(/ +/g," *")+"/([.\\d]+)","i").exec(c)||0)[1]||z)?(l=[l,/BB10/.test(c)],G=(l[1]?(K=null,S="BlackBerry"):"Device Software")+" "+l[0],z=null):this!=f&&"Wii"!=K&&(Z&&J||/Opera/.test(E)&&/\b(?:MSIE|Firefox)\b/i.test(c)||"Firefox"==E&&/\bOS X (?:\d+\.){2,}/.test(G)||"IE"==E&&(G&&!/^Win/.test(G)&&5.5<z||
/\bWindows XP\b/.test(G)&&8<z||8==z&&!/\bTrident\b/.test(c)))&&!x.test(l=b.call(f,c.replace(x,"")+";"))&&l.name&&(l="ing as "+l.name+((l=l.version)?" "+l:""),x.test(E)?(/\bIE\b/.test(l)&&"Mac OS"==G&&(G=null),l="identify"+l):(l="mask"+l,E=W?e(W.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(l)&&(G=null),Z||(z=null)),L=["Presto"],B.push(l));else E+=" Mobile";if(l=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(c)||0)[1]){l=[parseFloat(l.replace(/\.(\d)$/,".0$1")),l];if("Safari"==E&&"+"==l[1].slice(-1))E=
"WebKit Nightly",ba="alpha",z=l[1].slice(0,-1);else if(z==l[1]||z==(l[2]=(/\bSafari\/([\d.]+\+?)/i.exec(c)||0)[1]))z=null;l[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(c)||0)[1];537.36==l[0]&&537.36==l[2]&&28<=parseFloat(l[1])&&"WebKit"==L&&(L=["Blink"]);Z&&(I||l[1])?(L&&(L[1]="like Chrome"),l=l[1]||(l=l[0],530>l?1:532>l?2:532.05>l?3:533>l?4:534.03>l?5:534.07>l?6:534.1>l?7:534.13>l?8:534.16>l?9:534.24>l?10:534.3>l?11:535.01>l?12:535.02>l?"13+":535.07>l?15:535.11>l?16:535.19>l?17:536.05>l?18:536.1>
l?19:537.01>l?20:537.11>l?"21+":537.13>l?23:537.18>l?24:537.24>l?25:537.36>l?26:"Blink"!=L?"27":"28")):(L&&(L[1]="like Safari"),l=(l=l[0],400>l?1:500>l?2:526>l?3:533>l?4:534>l?"4+":535>l?5:537>l?6:538>l?7:601>l?8:602>l?9:604>l?10:606>l?11:608>l?12:"12"));L&&(L[1]+=" "+(l+="number"==typeof l?".x":/[.+]/.test(l)?"":"+"));"Safari"==E&&(!z||45<parseInt(z))?z=l:"Chrome"==E&&/\bHeadlessChrome/i.test(c)&&B.unshift("headless")}"Opera"==E&&(l=/\bzbov|zvav$/.exec(G))?(E+=" ",B.unshift("desktop mode"),"zvav"==
l?(E+="Mini",z=null):E+="Mobile",G=G.replace(RegExp(" *"+l+"$"),"")):"Safari"==E&&/\bChrome\b/.exec(L&&L[1])?(B.unshift("desktop mode"),E="Chrome Mobile",z=null,/\bOS X\b/.test(G)?(S="Apple",G="iOS 4.3+"):G=null):/\bSRWare Iron\b/.test(E)&&!z&&(z=C("Chrome"));z&&0==z.indexOf(l=/[\d.]+$/.exec(G))&&-1<c.indexOf("/"+l+"-")&&(G=t(G.replace(l,"")));G&&-1!=G.indexOf(E)&&!RegExp(E+" OS").test(G)&&(G=G.replace(RegExp(" *"+k(E)+" *"),""));L&&!/\b(?:Avant|Nook)\b/.test(E)&&(/Browser|Lunascape|Maxthon/.test(E)||
"Safari"!=E&&/^iOS/.test(G)&&/\bSafari\b/.test(L[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(E)&&L[1])&&(l=L[L.length-1])&&B.push(l);B.length&&(B=["("+B.join("; ")+")"]);S&&K&&0>K.indexOf(S)&&B.push("on "+S);K&&B.push((/^on /.test(B[B.length-1])?"":"on ")+K);if(G){var ea=(l=/ ([\d.+]+)$/.exec(G))&&"/"==G.charAt(G.length-l[0].length-1);G={architecture:32,family:l&&!ea?G.replace(l[0],""):G,version:l?l[1]:null,toString:function(){var T=
this.version;return this.family+(T&&!ea?" "+T:"")+(64==this.architecture?" 64-bit":"")}}}(l=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(aa))&&!/\bi686\b/i.test(aa)?(G&&(G.architecture=64,G.family=G.family.replace(RegExp(" *"+l),"")),E&&(/\bWOW64\b/i.test(c)||Z&&/\w(?:86|32)$/.test(D.cpuClass||D.platform)&&!/\bWin64; x64\b/i.test(c))&&B.unshift("32-bit")):G&&/^OS X/.test(G.family)&&"Chrome"==E&&39<=parseFloat(z)&&(G.architecture=64);c||(c=null);w={};w.description=c;w.layout=L&&L[0];w.manufacturer=S;w.name=
E;w.prerelease=ba;w.product=K;w.ua=c;w.version=E&&z;w.os=G||{architecture:null,family:null,version:null,toString:function(){return"null"}};w.parse=b;w.toString=function(){return this.description||""};w.version&&B.unshift(z);w.name&&B.unshift(E);G&&E&&(G!=String(G).split(" ")[0]||G!=E.split(" ")[0]&&!K)&&B.push(K?"("+G+")":"on "+G);B.length&&(w.description=B.join(" "));return w}var p={"function":!0,object:!0},r=p[typeof window]&&window||this,m=p[typeof exports]&&exports;p=p[typeof module]&&module&&
!module.nodeType&&module;var q=m&&p&&"object"==typeof global&&global;!q||q.global!==q&&q.window!==q&&q.self!==q||(r=q);var v=Math.pow(2,53)-1,x=/\bOpera/;q=Object.prototype;var u=q.hasOwnProperty,y=q.toString,F=b();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(r.platform=F,define(function(){return F})):m&&p?f(F,function(c,A){m[A]=c}):r.platform=F}).call(this);
function buildIOSMeta(){for(var a=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],h=0;h<a.length;h++){var e=document.createElement("meta");e.name=a[h].name;e.content=a[h].content;var f=window.document.head.querySelector('meta[name="'+e.name+'"]');f&&f.parentNode.removeChild(f);window.document.head.appendChild(e)}}
function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none");jQuery(".xxx-ios-fullscreen-scroll").css("display","none");jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}
function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block");jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}
function __iosResize(){window.scrollTo(0,0);console.log(window.devicePixelRatio);console.log(window.innerWidth);console.log(window.innerHeight);if("iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();
break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 724:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize();setTimeout(function(){__iosResize()},500)}
function iosInIframe(){try{return window.self!==window.top}catch(a){return!0}}$(document).ready(function(){platform&&"iPhone"===platform.product&&"safari"!==platform.name.toLowerCase()&&!iosInIframe()&&(buildIOSFullscreenPanel(),buildIOSMeta())});jQuery(window).resize(function(){platform&&"iPhone"===platform.product&&"safari"!==platform.name.toLowerCase()&&!iosInIframe()&&iosResize()});var s_iScaleFactor=1,s_oCanvasLeft,s_oCanvasTop,s_bIsIphone,s_bFocus=!0;
(function(a){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(a.substr(0,
4))})(navigator.userAgent||navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(a){console.log(a)}function isIpad(){var a=-1!==navigator.userAgent.toLowerCase().indexOf("ipad");return!a&&navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints?!0:a}function isMobile(){return isIpad()?!0:jQuery.browser.mobile}
function isIOS(){for(var a="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");a.length;)if(navigator.platform===a.pop())return s_bIsIphone=!0;return s_bIsIphone=!1}
function getSize(a){var h=a.toLowerCase(),e=window.document,f=e.documentElement;if(void 0===window["inner"+a])a=f["client"+a];else if(window["inner"+a]!=f["client"+a]){var n=e.createElement("body");n.id="vpw-test-b";n.style.cssText="overflow:scroll";var g=e.createElement("div");g.id="vpw-test-d";g.style.cssText="position:absolute;top:-1000px";g.innerHTML="<style>@media("+h+":"+f["client"+a]+"px){body#vpw-test-b div#vpw-test-d{"+h+":7px!important}}</style>";n.appendChild(g);f.insertBefore(n,e.head);
a=7==g["offset"+a]?f["client"+a]:window["inner"+a];f.removeChild(n)}else a=window["inner"+a];return a}window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}
function getHeightOfIOSToolbars(){var a=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<a?a:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var a=null!==platform.name&&"safari"===platform.name.toLowerCase()?getIOSWindowHeight():getSize("Height");var h=getSize("Width");s_bFocus&&_checkOrientation(h,a);var e=Math.min(a/CANVAS_HEIGHT,h/CANVAS_WIDTH),f=Math.round(CANVAS_WIDTH*e);e=Math.round(CANVAS_HEIGHT*e);if(e<a){var n=a-e;e+=n;f+=CANVAS_WIDTH/CANVAS_HEIGHT*n}else f<h&&(n=h-f,f+=n,e+=CANVAS_HEIGHT/CANVAS_WIDTH*n);n=a/2-e/2;var g=h/2-f/2,k=CANVAS_WIDTH/f;if(g*k<-EDGEBOARD_X||
n*k<-EDGEBOARD_Y)e=Math.min(a/(CANVAS_HEIGHT-2*EDGEBOARD_Y),h/(CANVAS_WIDTH-2*EDGEBOARD_X)),f=Math.round(CANVAS_WIDTH*e),e=Math.round(CANVAS_HEIGHT*e),n=(a-e)/2,g=(h-f)/2,k=CANVAS_WIDTH/f;s_iOffsetX=-1*g*k;s_iOffsetY=-1*n*k;0<=n&&(s_iOffsetY=0);0<=g&&(s_iOffsetX=0);null!==s_oGame&&s_oGame.refreshButtonPos();null!==s_oMenu&&s_oMenu.refreshButtonPos();null!==s_oLevelMenu&&s_oLevelMenu.refreshButtonPos();s_bMobile?($("#canvas").css("width",f+"px"),$("#canvas").css("height",e+"px")):void 0!==s_oStage&&
(s_oStage.canvas.width=f,s_oStage.canvas.height=e,s_iScaleFactor=Math.min(f/CANVAS_WIDTH,e/CANVAS_HEIGHT),s_oStage.scaleX=s_oStage.scaleY=s_iScaleFactor);0>n||(n=(a-e)/2);$("#canvas").css("top",n+"px");$("#canvas").css("left",g+"px");fullscreenHandler()}}
function _checkOrientation(a,h){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(a>h?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),
s_oMain.stopUpdate()))}function createBitmap(a,h,e){var f=new createjs.Bitmap(a),n=new createjs.Shape;h&&e?n.graphics.beginFill("#fff").drawRect(0,0,h,e):n.graphics.beginFill("#ff0").drawRect(0,0,a.width,a.height);f.hitArea=n;return f}function createSprite(a,h,e,f,n,g){a=null!==h?new createjs.Sprite(a,h):new createjs.Sprite(a);h=new createjs.Shape;h.graphics.beginFill("#000000").drawRect(-e,-f,n,g);a.hitArea=h;return a}
function randomFloatBetween(a,h,e){"undefined"===typeof e&&(e=2);return parseFloat(Math.min(a+Math.random()*(h-a),h).toFixed(e))}function shuffle(a){for(var h=a.length,e,f;0!==h;)f=Math.floor(Math.random()*h),--h,e=a[h],a[h]=a[f],a[f]=e;return a}function formatTime(a){a/=1E3;var h=Math.floor(a/60);a=parseFloat(a-60*h).toFixed(1);var e="";e=10>h?e+("0"+h+":"):e+(h+":");return 10>a?e+("0"+a):e+a}
function NoClickDelay(a){this.element=a;window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(a){for(var h=a.length,e,f;0<h;)f=Math.floor(Math.random()*h),h--,e=a[h],a[h]=a[f],a[f]=e;return a}
NoClickDelay.prototype={handleEvent:function(a){switch(a.type){case "touchstart":this.onTouchStart(a);break;case "touchmove":this.onTouchMove(a);break;case "touchend":this.onTouchEnd(a)}},onTouchStart:function(a){a.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(a){this.moved=!0},onTouchEnd:function(a){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){a=document.elementFromPoint(a.changedTouches[0].clientX,a.changedTouches[0].clientY);3==a.nodeType&&(a=a.parentNode);var h=document.createEvent("MouseEvents");h.initEvent("click",!0,!0);a.dispatchEvent(h)}}};
(function(){function a(e){var f={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};e=e||window.event;e.type in f?document.body.className=f[e.type]:(document.body.className=this[h]?"hidden":"visible","hidden"===document.body.className?(s_oMain.stopUpdate(),s_bFocus=!1):(s_oMain.startUpdate(),s_bFocus=!0))}var h="hidden";h in document?document.addEventListener("visibilitychange",a):(h="mozHidden")in document?document.addEventListener("mozvisibilitychange",
a):(h="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",a):(h="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?document.onfocusin=document.onfocusout=a:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=a})();function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}
function getParamValue(a){for(var h=window.location.search.substring(1).split("&"),e=0;e<h.length;e++){var f=h[e].split("=");if(f[0]==a)return f[1]}}function playSound(a,h,e){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[a].play(),s_aSounds[a].volume(h),s_aSounds[a].loop(e),s_aSounds[a]):null}function stopSound(a){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[a].stop()}function setVolume(a,h){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[a].volume(h)}
function setMute(a,h){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||s_aSounds[a].mute(h)}function isSoundPlaying(a){return s_aSounds[a].playing()}function saveItem(a,h){s_bStorageAvailable&&localStorage.setItem(a,h)}function getItem(a){return s_bStorageAvailable?localStorage.getItem(a):null}
function fullscreenHandler(){ENABLE_FULLSCREEN&&!1!==screenfull.isEnabled&&(s_bFullscreen=screenfull.isFullscreen,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut(),null!==s_oLevelMenu&&s_oLevelMenu.resetFullscreenBut())}if(screenfull.isEnabled)screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen;null!==s_oInterface&&s_oInterface.resetFullscreenBut();null!==s_oMenu&&s_oMenu.resetFullscreenBut();null!==s_oLevelMenu&&s_oLevelMenu.resetFullscreenBut()});
function CSpriteLibrary(){var a={},h,e,f,n,g,k;this.init=function(d,t,b){h={};f=e=0;n=d;g=t;k=b};this.addSprite=function(d,t){if(!a.hasOwnProperty(d)){var b=new Image;a[d]=h[d]={szPath:t,oSprite:b,bLoaded:!1};e++}};this.getSprite=function(d){return a.hasOwnProperty(d)?a[d].oSprite:null};this._onSpritesLoaded=function(){e=0;g.call(k)};this._onSpriteLoaded=function(){n.call(k);++f===e&&this._onSpritesLoaded()};this.loadSprites=function(){for(var d in h)h[d].oSprite.oSpriteLibrary=this,h[d].oSprite.szKey=
d,h[d].oSprite.onload=function(){this.oSpriteLibrary.setLoaded(this.szKey);this.oSpriteLibrary._onSpriteLoaded(this.szKey)},h[d].oSprite.onerror=function(t){var b=t.currentTarget;setTimeout(function(){h[b.szKey].oSprite.src=h[b.szKey].szPath},500)},h[d].oSprite.src=h[d].szPath};this.setLoaded=function(d){a[d].bLoaded=!0};this.isLoaded=function(d){return a[d].bLoaded};this.getNumSprites=function(){return e}}
var CANVAS_WIDTH=1500,CANVAS_HEIGHT=768,EDGEBOARD_X=180,EDGEBOARD_Y=20,FPS=30,FPS_TIME=1E3/FPS,DISABLE_SOUND_MOBILE=!1,FONT_GAME="TradeGothic",STATE_LOADING=0,STATE_MENU=1,STATE_MENU_LEVEL=2,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,ON_BUT_YES_DOWN=6,ON_PLAYER_ARRIVAL=7,ON_PLAYER_FALL=8,ON_OPPONENT_HIDE=9,ON_OPPONENT_CHECK_COLLISION=10,ON_READY_FOR_PLAYER_ARRIVAL=11,ON_BACK_MENU=12,ON_RESTART=13,ON_NEXT_LEVEL=14,ON_BUT_END_TWEEN_X=15,ON_END_COUNTDOWN=
16,PLAYER_ANIM_RUN=0,PLAYER_ANIM_FALL=1,PLAYER_ANIM_ARRIVAL=2,PLAYER_ANIM_LEFT=3,PLAYER_ANIM_LEFT_OUT=4,PLAYER_ANIM_RIGHT=5,PLAYER_ANIM_RIGHT_OUT=6,STARTING_STANDS_SCALE_BONUS=.74,NUM_LEVELS,OPPONENT_FINAL_Y=1200,TIME_OPPONENT_RUN_0=2600,TIME_OPPONENT_RUN_1=800,TIME_OPPONENT_RUN=3E3,HERO_ACCELERATION,HERO_FRICTION,MAX_HERO_SPEED,MIN_START_X=CANVAS_WIDTH/2-50,MAX_START_X=CANVAS_WIDTH/2+50,MIN_ARRIVAL_X=-300,START_X_INTERVAL=MAX_START_X-MIN_START_X,MAX_ARRIVAL_X=CANVAS_WIDTH+300,ARRIVAL_X_INTERVAL=
MAX_ARRIVAL_X-MIN_ARRIVAL_X,MIN_PLAYER_X=180,MAX_PLAYER_X=CANVAS_WIDTH-180,NUM_COLS_PAGE_LEVEL=6,NUM_ROWS_PAGE_LEVEL=2,GAME_NAME="downhill_ski",SOUNDTRACK_VOLUME_IN_GAME=.4,ENABLE_FULLSCREEN,ENABLE_CHECK_ORIENTATION;
function CPreloader(){var a,h,e,f,n,g,k,d,t,b;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.addSprite("200x200","./sprites/200x200.jpg");s_oSpriteLibrary.addSprite("but_start","./sprites/but_start.png");s_oSpriteLibrary.loadSprites();b=new createjs.Container;s_oStage.addChild(b)};this.unload=function(){t.unload();b.removeAllChildren()};this._onImagesLoaded=function(){};
this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var p=new createjs.Shape;p.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.addChild(p);p=s_oSpriteLibrary.getSprite("200x200");k=createBitmap(p);k.regX=.5*p.width;k.regY=.5*p.height;k.x=CANVAS_WIDTH/2;k.y=CANVAS_HEIGHT/2-80;b.addChild(k);d=new createjs.Shape;d.graphics.beginFill("rgba(0,0,0,0.01)").drawRoundRect(k.x-100,k.y-100,200,200,10);b.addChild(d);k.mask=d;p=
s_oSpriteLibrary.getSprite("progress_bar");f=createBitmap(p);f.x=CANVAS_WIDTH/2-p.width/2;f.y=CANVAS_HEIGHT/2+70;b.addChild(f);a=p.width;h=p.height;n=new createjs.Shape;n.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(f.x,f.y,1,h);b.addChild(n);f.mask=n;e=new createjs.Text("","30px "+FONT_GAME,"#fff");e.x=CANVAS_WIDTH/2;e.y=CANVAS_HEIGHT/2+120;e.textBaseline="alphabetic";e.textAlign="center";b.addChild(e);p=s_oSpriteLibrary.getSprite("but_start");t=new CTextButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2+
100,p,TEXT_PRELOADER_CONTINUE,"Arial","#000",36,b);t.addEventListener(ON_MOUSE_UP,this._onButStartRelease,this);t.setVisible(!1);g=new createjs.Shape;g.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);b.addChild(g);createjs.Tween.get(g).to({alpha:0},500).call(function(){createjs.Tween.removeTweens(g);b.removeChild(g)})};this._onButStartRelease=function(){s_oMain._allResourcesLoaded()};this.refreshLoader=function(p){e.text=p+"%";100===p&&(s_oMain._allResourcesLoaded(),e.visible=
!1,f.visible=!1);n.graphics.clear();p=Math.floor(p*a/100);n.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(f.x,f.y,p,h)};this._init()}
function CMain(a){var h,e,f=0,n=0,g=STATE_LOADING,k,d,t;this.initContainer=function(){var b=document.getElementById("canvas");s_oStage=new createjs.Stage(b);s_oStage.preventSelection=!1;createjs.Touch.enable(s_oStage,!0);s_bMobile=isMobile();!1===s_bMobile&&s_oStage.enableMouseOver(20);s_iPrevTime=(new Date).getTime();createjs.Ticker.framerate=FPS;createjs.Ticker.on("tick",this._update);navigator.userAgent.match(/Windows Phone/i)&&(DISABLE_SOUND_MOBILE=!0);s_oSpriteLibrary=new CSpriteLibrary;s_oLevelSettings=
new CLevelSettings;k=new CPreloader};this.setLocalStorageLevel=function(b){var p=getItem(GAME_NAME+"_level");if(null===p||p<b)s_iLastLevel=b,saveItem(GAME_NAME+"_level",s_iLastLevel)};this.setLocalStorageScore=function(b,p){saveItem(GAME_NAME+"_score_level_"+p,b)};this.clearLocalStorage=function(){s_iLastLevel=1;if(s_bStorageAvailable)for(var b=0;b<localStorage.length;){var p=localStorage.key(b);-1!==p.indexOf(GAME_NAME)?localStorage.removeItem(p):b++}};this.getScoreTillLevel=function(b){if(!s_bStorageAvailable)return 0;
for(var p=0,r=0;r<b-1;r++)p+=parseInt(getItem(GAME_NAME+"_score_level_"+(r+1)));return p};this.getScoreLevel=function(b){return getItem(GAME_NAME+"_score_level_"+(b+1))};this.getSavedLevel=function(){if(!s_bStorageAvailable)return 1;var b=getItem(GAME_NAME+"_level");return null===b?1:b};this.preloaderReady=function(){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds();this._loadImages();h=e=!0};this.soundLoaded=function(){f++;k.refreshLoader(Math.floor(f/n*100))};this._initSounds=function(){Howler.mute(!s_bAudioActive);
s_aSoundsInfo=[];s_aSoundsInfo.push({path:"./sounds/",filename:"click",loop:!1,volume:1,ingamename:"click"});s_aSoundsInfo.push({path:"./sounds/",filename:"level_win",loop:!1,volume:1,ingamename:"level_win"});s_aSoundsInfo.push({path:"./sounds/",filename:"game_over",loop:!1,volume:1,ingamename:"game_over"});s_aSoundsInfo.push({path:"./sounds/",filename:"crowd_idle",loop:!1,volume:1,ingamename:"crowd_idle"});s_aSoundsInfo.push({path:"./sounds/",filename:"skiing_direction",loop:!1,volume:1,ingamename:"skiing_direction"});
s_aSoundsInfo.push({path:"./sounds/",filename:"falling",loop:!1,volume:1,ingamename:"falling"});s_aSoundsInfo.push({path:"./sounds/",filename:"countdown",loop:!1,volume:1,ingamename:"countdown"});s_aSoundsInfo.push({path:"./sounds/",filename:"go",loop:!1,volume:1,ingamename:"go"});s_aSoundsInfo.push({path:"./sounds/",filename:"arrival",loop:!1,volume:1,ingamename:"arrival"});s_aSoundsInfo.push({path:"./sounds/",filename:"soundtrack",loop:!0,volume:1,ingamename:"soundtrack"});n+=s_aSoundsInfo.length;
s_aSounds=[];for(var b=0;b<s_aSoundsInfo.length;b++)this.tryToLoadSound(s_aSoundsInfo[b],!1)};this.tryToLoadSound=function(b,p){setTimeout(function(){s_aSounds[b.ingamename]=new Howl({src:[b.path+b.filename+".mp3"],autoplay:!1,preload:!0,loop:b.loop,volume:b.volume,onload:s_oMain.soundLoaded,onloaderror:function(r,m){for(var q=0;q<s_aSoundsInfo.length;q++)if(r===s_aSounds[s_aSoundsInfo[q].ingamename]._sounds[0]._id){s_oMain.tryToLoadSound(s_aSoundsInfo[q],!0);break}},onplayerror:function(r){for(var m=
0;m<s_aSoundsInfo.length;m++)if(r===s_aSounds[s_aSoundsInfo[m].ingamename]._sounds[0]._id){s_aSounds[s_aSoundsInfo[m].ingamename].once("unlock",function(){s_aSounds[s_aSoundsInfo[m].ingamename].play();"soundtrack"===s_aSoundsInfo[m].ingamename&&null!==s_oGame&&setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME)});break}}})},p?200:0)};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png");s_oSpriteLibrary.addSprite("but_next",
"./sprites/but_next.png");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("msg_box_wide","./sprites/msg_box_wide.png");s_oSpriteLibrary.addSprite("msg_box_small","./sprites/msg_box_small.png");s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg");s_oSpriteLibrary.addSprite("logo_ctl","./sprites/logo_ctl.png");s_oSpriteLibrary.addSprite("but_credits",
"./sprites/but_credits.png");s_oSpriteLibrary.addSprite("but_yes","./sprites/but_yes.png");s_oSpriteLibrary.addSprite("but_no","./sprites/but_no.png");s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png");s_oSpriteLibrary.addSprite("but_settings","./sprites/but_settings.png");s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png");s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png");s_oSpriteLibrary.addSprite("but_pause","./sprites/but_pause.png");s_oSpriteLibrary.addSprite("key_0",
"./sprites/key_0.png");s_oSpriteLibrary.addSprite("key_1","./sprites/key_1.png");s_oSpriteLibrary.addSprite("but_left","./sprites/but_left.png");s_oSpriteLibrary.addSprite("but_right","./sprites/but_right.png");s_oSpriteLibrary.addSprite("but_level","./sprites/but_level.png");s_oSpriteLibrary.addSprite("logo_menu","./sprites/logo_menu.png");s_oSpriteLibrary.addSprite("item_0","./sprites/item_0.png");s_oSpriteLibrary.addSprite("item_1","./sprites/item_1.png");s_oSpriteLibrary.addSprite("item_2","./sprites/item_2.png");
s_oSpriteLibrary.addSprite("score_panel","./sprites/score_panel.png");s_oSpriteLibrary.addSprite("sponsor","./sprites/sponsor.png");s_oSpriteLibrary.addSprite("countdown_0","./sprites/countdown_0.png");s_oSpriteLibrary.addSprite("countdown_1","./sprites/countdown_1.png");s_oSpriteLibrary.addSprite("countdown_2","./sprites/countdown_2.png");s_oSpriteLibrary.addSprite("countdown_3","./sprites/countdown_3.png");s_oSpriteLibrary.addSprite("icon_score","./sprites/icon_score.png");s_oSpriteLibrary.addSprite("but_clear_save",
"./sprites/but_clear_save.png");for(var b=0;87>b;b++)s_oSpriteLibrary.addSprite("field_loop_"+b,"./sprites/field_loop/field_loop_"+b+".png");for(b=0;42>b;b++)s_oSpriteLibrary.addSprite("arrive_"+b,"./sprites/arrive/arrive_"+b+".png");for(b=0;30>b;b++)s_oSpriteLibrary.addSprite("player_falling_"+b,"./sprites/player/falling/player_falling_"+b+".png");for(b=0;70>b;b++)s_oSpriteLibrary.addSprite("player_arrival_"+b,"./sprites/player/arrival/player_arrival_"+b+".png");for(b=0;19>b;b++)s_oSpriteLibrary.addSprite("player_running_"+
b,"./sprites/player/running/player_running_"+b+".png");for(b=0;8>b;b++)s_oSpriteLibrary.addSprite("player_left_"+b,"./sprites/player/turn_left/player_left_"+b+".png"),s_oSpriteLibrary.addSprite("player_right_"+b,"./sprites/player/turn_right/player_right_"+b+".png");for(b=0;7>b;b++)s_oSpriteLibrary.addSprite("player_left_out_"+b,"./sprites/player/turn_left_out/player_left_out_"+b+".png"),s_oSpriteLibrary.addSprite("player_right_out_"+b,"./sprites/player/turn_right_out/player_right_out_"+b+".png");
for(b=0;45>b;b++)s_oSpriteLibrary.addSprite("tutorial_"+b,"./sprites/help/tutorial_"+b+".jpg");n+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){f++;k.refreshLoader(Math.floor(f/n*100))};this._onAllImagesLoaded=function(){};this._allResourcesLoaded=function(){k.unload();try{saveItem("ls_available","ok"),s_iLastLevel=this.getSavedLevel()}catch(b){s_bStorageAvailable=!1}s_oSoundTrack=playSound("soundtrack",1,!0);s_oMain.gotoMenu()};this.gotoMenu=function(){new CMenu;
g=STATE_MENU};this.gotoLevelMenu=function(){d=new CLevelMenu;g=STATE_MENU_LEVEL};this.gotoSelectCar=function(){new CMenuSelectCar;g=STATE_MENU_SELECT_CAR};this.gotoGame=function(){t=new CGame;g=STATE_GAME};this.levelSelected=function(b){s_iLevelSelected=b;d.unload();b>=s_iLastLevel&&(s_iLastLevel=b);s_oMain.gotoGame()};this.stopUpdateNoBlockAndTick=function(){e=!1};this.startUpdateNoBlockAndTick=function(){e=!0};this.stopUpdateNoBlock=function(){h=!1;createjs.Ticker.paused=!0};this.startUpdateNoBlock=
function(){s_iPrevTime=(new Date).getTime();h=!0;createjs.Ticker.paused=!1};this.stopUpdate=function(){h=!1;createjs.Ticker.paused=!0;$("#block_game").css("display","block");!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||Howler.mute(!0)};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();h=!0;createjs.Ticker.paused=!1;$("#block_game").css("display","none");(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)&&s_bAudioActive&&Howler.mute(!1)};this.isUpdating=function(){return h};this._update=function(b){if(!1!==
h){var p=(new Date).getTime();s_iTimeElaps=p-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=p;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);g===STATE_GAME&&e&&t.update();void 0!==s_oStage&&s_oStage.update(b)}};s_oMain=this;HERO_ACCELERATION=a.hero_acceleration;HERO_FRICTION=a.hero_friction;MAX_HERO_SPEED=a.max_hero_speed;ENABLE_FULLSCREEN=a.fullscreen;ENABLE_CHECK_ORIENTATION=a.check_orientation;this.initContainer()}
var s_bMobile,s_bAudioActive=!1,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=0,s_oSoundTrack=null,s_oDrawLayer,s_oStage,s_oMain=null,s_oSpriteLibrary,s_oLevelSettings,s_iLastLevel,s_iLevelSelected=1,s_bFullscreen=!1,s_bStorageAvailable=!0,s_aSoundsInfo;
function CTextButton(a,h,e,f,n,g,k,d){var t,b,p,r,m,q,v,x,u,y,F;this._init=function(c,A,C,w,B,D,z,I){t=!1;r=[];m=[];F=createBitmap(C);b=C.width;p=C.height;y=new createjs.Text(w,z+"px "+B,D);y.textAlign="center";y.textBaseline="alphabetic";y.lineWidth=.9*b;y.x=C.width/2;y.y=Math.floor(C.height/2)+15;u=new createjs.Container;u.x=c;u.y=A;u.regX=C.width/2;u.regY=C.height/2;s_bMobile||(u.cursor="pointer");u.addChild(F,y);!1!==I&&s_oStage.addChild(u);this._initListener()};this.unload=function(){u.off("mousedown",
q);u.off("pressup",v);s_oStage.removeChild(u)};this.setVisible=function(c){u.visible=c};this.setAlign=function(c){y.textAlign=c};this.enable=function(){t=!1;F.filters=[];F.cache(0,0,b,p)};this.disable=function(){t=!0;var c=(new createjs.ColorMatrix).adjustSaturation(-100).adjustBrightness(40);F.filters=[new createjs.ColorMatrixFilter(c)];F.cache(0,0,b,p)};this._initListener=function(){q=u.on("mousedown",this.buttonDown);v=u.on("pressup",this.buttonRelease)};this.addEventListener=function(c,A,C){r[c]=
A;m[c]=C};this.addEventListenerWithParams=function(c,A,C,w){r[c]=A;m[c]=C;x=w};this.buttonRelease=function(){t||(playSound("click",1,!1),u.scaleX=1,u.scaleY=1,r[ON_MOUSE_UP]&&r[ON_MOUSE_UP].call(m[ON_MOUSE_UP],x))};this.buttonDown=function(){t||(u.scaleX=.9,u.scaleY=.9,r[ON_MOUSE_DOWN]&&r[ON_MOUSE_DOWN].call(m[ON_MOUSE_DOWN]))};this.setPosition=function(c,A){u.x=c;u.y=A};this.changeText=function(c){y.text=c};this.setX=function(c){u.x=c};this.setY=function(c){u.y=c};this.getButtonImage=function(){return u};
this.getX=function(){return u.x};this.getY=function(){return u.y};this.getSprite=function(){return u};this._init(a,h,e,f,n,g,k,d);return this}
function CGfxButton(a,h,e,f){var n,g,k,d,t=[],b,p,r;this._init=function(m,q,v){n=!1;g=1;k=[];d=[];r=createBitmap(v);r.x=m;r.y=q;r.regX=v.width/2;r.regY=v.height/2;r.cursor="pointer";f.addChild(r);this._initListener()};this.unload=function(){r.off("mousedown",b);r.off("pressup",p);f.removeChild(r)};this.setVisible=function(m){r.visible=m};this._initListener=function(){b=r.on("mousedown",this.buttonDown);p=r.on("pressup",this.buttonRelease)};this.addEventListener=function(m,q,v){k[m]=q;d[m]=v};this.addEventListenerWithParams=
function(m,q,v,x){k[m]=q;d[m]=v;t=x};this.enable=function(){n=!1};this.disable=function(){n=!0};this.buttonRelease=function(){n||(playSound("click",1,!1),r.scaleX=g,r.scaleY=g,k[ON_MOUSE_UP]&&k[ON_MOUSE_UP].call(d[ON_MOUSE_UP],t))};this.buttonDown=function(){n||(r.scaleX=.9*g,r.scaleY=.9*g,k[ON_MOUSE_DOWN]&&k[ON_MOUSE_DOWN].call(d[ON_MOUSE_DOWN],t))};this.setPosition=function(m,q){r.x=m;r.y=q};this.setX=function(m){r.x=m};this.setY=function(m){r.y=m};this.setScale=function(m){g=m;r.scaleX=r.scaleY=
m};this.getButtonImage=function(){return r};this.getX=function(){return r.x};this.getY=function(){return r.y};this._init(a,h,e)}
function CSideGfxButton(a,h,e,f,n){var g,k=h,d,t,b,p,r=[],m,q,v;this._init=function(x,u,y,F){g=!1;b=[];p=[];v=createBitmap(F);v.y=y;t=F.width;x?(v.x=-F.width,v.regX=0):(v.x=CANVAS_WIDTH+F.width,v.regX=F.width);d=v.x;v.regY=F.height/2;v.cursor="pointer";n.addChild(v);this._initListener()};this.unload=function(){v.off("mousedown",m);v.off("pressup",q);n.removeChild(v)};this.setVisible=function(x){v.visible=x};this._initListener=function(){m=v.on("mousedown",this.buttonDown);q=v.on("pressup",this.buttonRelease)};
this.addEventListener=function(x,u,y){b[x]=u;p[x]=y};this.addEventListenerWithParams=function(x,u,y,F){b[x]=u;p[x]=y;r=F};this.enable=function(){g=!1};this.disable=function(){g=!0};this.buttonRelease=function(){g||(playSound("click",1,!1),v.scaleX=1,v.scaleY=1,b[ON_MOUSE_UP]&&b[ON_MOUSE_UP].call(p[ON_MOUSE_UP],r))};this.buttonDown=function(){g||(v.scaleX=.9,v.scaleY=.9,b[ON_MOUSE_DOWN]&&b[ON_MOUSE_DOWN].call(p[ON_MOUSE_DOWN],r))};this.setPosition=function(x,u){v.x=x;v.y=u};this.setX=function(x){v.x=
x};this.setY=function(x){v.y=x};this.resetX=function(){v.x=a?-t:CANVAS_WIDTH+t};this.setFinalX=function(x){k=x;d=a?k-t:k+t};this.tweenFinalX=function(){createjs.Tween.get(v).to({x:k},300,createjs.Ease.quartOut).call(function(){b[ON_BUT_END_TWEEN_X]&&b[ON_BUT_END_TWEEN_X].call(p[ON_BUT_END_TWEEN_X])})};this.tweenStartX=function(x){createjs.Tween.get(v).wait(x).to({x:d},300,createjs.Ease.quartOut)};this.getButtonImage=function(){return v};this.getX=function(){return v.x};this.getY=function(){return v.y};
this._init(a,h,e,f);return this}
function CSideToggle(a,h,e,f,n,g,k){var d,t=e,b,p,r,m;this._init=function(q,v,x,u,y){p=[];r=[];v=0;!1===q&&(v=u.width/2);var F=new createjs.SpriteSheet({images:[u],frames:{width:u.width/2,height:u.height,regX:v,regY:u.height/2},animations:{state_true:[0],state_false:[1]}});d=y;m=createSprite(F,"state_"+d,v,u.height/2,u.width/2,u.height);m.x=q?-u.width/2:CANVAS_WIDTH+u.width/2;b=m.x;m.y=x;m.stop();m.cursor="pointer";k.addChild(m);this._initListener()};this.unload=function(){m.off("mousedown",this.buttonDown);
m.off("pressup",this.buttonRelease);k.removeChild(m)};this._initListener=function(){m.on("mousedown",this.buttonDown);m.on("pressup",this.buttonRelease)};this.addEventListener=function(q,v,x){p[q]=v;r[q]=x};this.setActive=function(q){d=q;m.gotoAndStop("state_"+d)};this.buttonRelease=function(){m.scaleX=1;m.scaleY=1;playSound("click",1,!1);d=!d;m.gotoAndStop("state_"+d);p[ON_MOUSE_UP]&&p[ON_MOUSE_UP].call(r[ON_MOUSE_UP],d)};this.buttonDown=function(){m.scaleX=.9;m.scaleY=.9;p[ON_MOUSE_DOWN]&&p[ON_MOUSE_DOWN].call(r[ON_MOUSE_DOWN])};
this.setPosition=function(q,v){m.x=q;m.y=v};this.setY=function(q){m.y=q};this.setFinalX=function(q){t=q};this.tweenFinalX=function(){createjs.Tween.get(m).wait(h).to({x:t},300,createjs.Ease.quartOut).call(function(){p[ON_BUT_END_TWEEN_X]&&p[ON_BUT_END_TWEEN_X].call(r[ON_BUT_END_TWEEN_X])})};this.tweenStartX=function(q){createjs.Tween.get(m).wait(q).to({x:b},300,createjs.Ease.quartOut)};this.getButtonImage=function(){return m};this._init(a,e,f,n,g)}
function CMenu(){var a,h,e,f,n,g,k,d,t,b,p,r,m,q,v,x,u,y=null,F=null;this._init=function(){t=!0;b=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(b);p=new CGfxButton(CANVAS_WIDTH/2+250,CANVAS_HEIGHT/2+90,s_oSpriteLibrary.getSprite("but_play"),s_oStage);p.addEventListener(ON_MOUSE_UP,this._onButPlaySingle,this);if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile){var c=s_oSpriteLibrary.getSprite("audio_icon");k=CANVAS_WIDTH;d=c.height/2+10;r=new CSideToggle(!1,0,k-s_iOffsetX,d+s_iOffsetY,
c,s_bAudioActive,s_oStage);r.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);e=CANVAS_WIDTH;f=d+c.height+10;r.tweenFinalX()}else e=CANVAS_WIDTH,f=c.height/2+10;c=s_oSpriteLibrary.getSprite("but_credits");n=0;g=c.height/2+10;m=new CSideGfxButton(!0,n+s_iOffsetX,g+s_iOffsetY,c,s_oStage);m.addEventListener(ON_MOUSE_UP,this._onButCreditsRelease,this);m.addEventListener(ON_BUT_END_TWEEN_X,this._onButEndTween,this);a=0;h=CANVAS_HEIGHT-c.height/2-10;q=new CSideGfxButton(!0,a+s_iOffsetX,h-s_iOffsetY,
s_oSpriteLibrary.getSprite("but_clear_save"),s_oStage);q.addEventListener(ON_MOUSE_UP,this._onButClearRelease,this);c=window.document;var A=c.documentElement;y=A.requestFullscreen||A.mozRequestFullScreen||A.webkitRequestFullScreen||A.msRequestFullscreen;F=c.exitFullscreen||c.mozCancelFullScreen||c.webkitExitFullscreen||c.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(y=!1);y&&screenfull.isEnabled&&(c=s_oSpriteLibrary.getSprite("but_fullscreen"),x=new CSideToggle(!1,200,e-s_iOffsetX,f+s_iOffsetY,c,s_bFullscreen,
s_oStage),x.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this),x.tweenFinalX());c=createBitmap(s_oSpriteLibrary.getSprite("logo_menu"));c.x=450;c.y=60;s_oStage.addChild(c);u=new CAreYouSurePanel;u.addEventListener(ON_BUT_YES_DOWN,this._onConfirmClear,this);s_bStorageAvailable||new CAlertSavingBox(TEXT_ERR_LS,s_oStage);v=new createjs.Shape;v.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(v);createjs.Tween.get(v).to({alpha:0},400).call(function(){v.visible=
!1});m.tweenFinalX();q.tweenFinalX();setVolume("soundtrack",1)};this.unload=function(){p.unload();m.unload();q.unload();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)r.unload(),r=null;y&&screenfull.isEnabled&&x.unload();s_oStage.removeAllChildren();s_oMenu=null};this.refreshButtonPos=function(){t||(!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||r.setPosition(k-s_iOffsetX,s_iOffsetY+d),y&&screenfull.isEnabled&&x.setPosition(e-s_iOffsetX,f+s_iOffsetY),m.setPosition(n+s_iOffsetX,g+s_iOffsetY),q.setPosition(a+
s_iOffsetX,h-s_iOffsetY))};this._onButPlaySingle=function(){s_oMenu.unload();s_oMain.gotoLevelMenu();$(s_oMain).trigger("start_session")};this._onButCreditsRelease=function(){new CCreditsPanel};this._onButClearRelease=function(){u.show(TEXT_CONFIRM_CLEAR_SAVINGS)};this._onButEndTween=function(){t=!1};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this.resetFullscreenBut=function(){y&&screenfull.isEnabled&&x.setActive(s_bFullscreen)};this._onFullscreenRelease=
function(){s_bFullscreen?F.call(window.document):y.call(window.document.documentElement);sizeHandler()};this._onConfirmClear=function(){s_oMain.clearLocalStorage()};s_oMenu=this;this._init()}var s_oMenu=null;
function CGame(){var a=!1,h,e,f,n,g,k,d,t,b,p,r,m,q,v,x,u,y,F,c,A,C,w,B,D,z,I,Q;this._init=function(){t=s_iLevelSelected;k=s_oMain.getScoreTillLevel(t);y=[{x:10,y:0},{x:-20,y:0},{x:10,y:-10},{x:0,y:20},{x:10,y:-10},{x:-10,y:0},{x:10,y:0},{x:-20,y:0},{x:10,y:-10},{x:0,y:20},{x:10,y:-10},{x:-10,y:0}];var H=s_oSpriteLibrary.getSprite("bg_game");C=new createjs.Container;C.x=H.width/2;C.y=CANVAS_HEIGHT/2;C.regX=H.width/2;C.regY=424;s_oStage.addChild(C);F=createBitmap(H);F.x=-50;C.addChild(F);c=new CField(-50,
220,C);c.addEventListener(ON_READY_FOR_PLAYER_ARRIVAL,this.playArrival,this);w=new createjs.Container;C.addChild(w);D=new CPlayer(CANVAS_WIDTH/2,850,w);D.addEventListener(ON_PLAYER_ARRIVAL,this._onWinLevel,this);D.addEventListener(ON_PLAYER_FALL,this._onEndLevel,this);B=new CCountdownController(CANVAS_WIDTH/2,CANVAS_HEIGHT/2-150,s_oStage);B.addEventListener(ON_END_COUNTDOWN,this.startRace,this);A=new CInterface(k);this.reset();z=new CHelpPanel;z.show();I=new CEndPanel;I.addEventListener(ON_RESTART,
this.restart,this);I.addEventListener(ON_BACK_MENU,this.onExit,this);Q=new CNextLevelPanel;Q.addEventListener(ON_RESTART,this.restart,this);Q.addEventListener(ON_BACK_MENU,this.onExit,this);Q.addEventListener(ON_NEXT_LEVEL,this._onNextLevel,this)};this.unload=function(){a=!1;A.unload();s_oStage.removeAllChildren();s_oGame=null};this.reset=function(){h=g=f=e=n=!1;b=d=0;x=[];p=s_oLevelSettings.getEnemiesSpawn(t);r=s_oLevelSettings.getStartingEnemySpawn(t);s_oLevelSettings.getEnemySpawnNumber(t);k=s_oMain.getScoreTillLevel(t);
m=parseFloat((-334/p).toFixed(2));F.y=0;D.reset();A.reset(k,t);B.reset();c.reset();setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME);$(s_oMain).trigger("start_level",t)};this.restart=function(){$(s_oMain).trigger("restart_level",t);for(var H=0;H<x.length;H++)x[H].unload();this.reset();this.startCountdown()};this.refreshButtonPos=function(){A.refreshButtonPos()};this.onKeyDown=function(H){if(!a||g||D.getCurAnim()===PLAYER_ANIM_ARRIVAL)return H.preventDefault(),!1;H||(H=window.event);switch(H.keyCode){case 37:e=
!0;D.moveLeft(!0);break;case 39:f=!0,D.moveRight(!0)}H.preventDefault();return!1};this.onKeyUp=function(H){if(!a||g||D.getCurAnim()===PLAYER_ANIM_ARRIVAL)return H.preventDefault(),!1;H||(H=window.event);f=e=!1;switch(H.keyCode){case 37:D.moveLeft(!1);break;case 39:D.moveRight(!1)}H.preventDefault();return!1};this.moveLeft=function(H){!a||H&&e||g||D.getCurAnim()===PLAYER_ANIM_ARRIVAL||(e=H,D.moveLeft(H))};this.moveRight=function(H){!a||H&&f||g||D.getCurAnim()===PLAYER_ANIM_ARRIVAL||(f=H,D.moveRight(H))};
this.startCountdown=function(){D.show();c.show();B.start();a=!0};this.startRace=function(){this._spawnEnemy()};this._createSpawnArray=function(){u=[];for(var H=ARRIVAL_X_INTERVAL/5,N=MIN_ARRIVAL_X,O=0;6>O;O++)u.push(N),N+=H;u=shuffle(u)};this.onExitFromHelp=function(){this.startCountdown()};this._spawnEnemy=function(){h=!0;if(0!==p){p--;var H=!1;0===p?n=H=!0:2===p&&c.prepareSponsorsForStop();var N=Math.floor(3*Math.random());if(.3<Math.random())var O=D.getX()-CANVAS_WIDTH/2+D.getX();else this._createSpawnArray(),
O=u.pop();H=new COpponent(H,(O-MIN_ARRIVAL_X)/ARRIVAL_X_INTERVAL*START_X_INTERVAL+MIN_START_X,500,O,N,w);H.addEventListener(ON_OPPONENT_HIDE,this.checkArrival,this);H.addEventListener(ON_OPPONENT_CHECK_COLLISION,this.checkCollision,this);x.push(H);H=F.y+m;(new createjs.Tween.get(F)).to({y:H},r)}};this.checkArrival=function(H){H&&!g&&(c.readyForArrival(),playSound("crowd_idle",1,!1))};this.checkCollision=function(H,N){if(!g){var O=D.getRect(),U=Math.abs(H.x-O.x);if(O.intersects(H)){g=!0;q=0;var R=
this;v=setInterval(function(){R.tremble()},20);D.changeAnim(PLAYER_ANIM_FALL)}else this.refreshScore(Math.floor(U/200));w.swapChildren(N,D.getContainer())}};this.tremble=function(){var H=y[q];C.x+=H.x;C.y+=H.y;q++;q===y.length&&(q=0,clearInterval(v))};this.refreshScore=function(H){d+=H;k+=H;A.refreshScore(k)};this.playArrival=function(){f=e=!1;D.changeAnim(PLAYER_ANIM_ARRIVAL)};this._manageOpponentDepth=function(){w.sortChildren(function(H,N,O){return H.y>N.y?1:H.y<N.y?-1:0})};this._onEndLevel=function(){$(s_oMain).trigger("end_level",
t);c.stopAnim();for(var H=0;H<x.length;H++)x[H].stopUpdate();setTimeout(function(){I.show(0,TEXT_GAME_OVER)},500)};this._onWinLevel=function(){$(s_oMain).trigger("end_level",t);$(s_oMain).trigger("save_score",k);t===NUM_LEVELS?setTimeout(function(){I.show(k,TEXT_CONGRATS)},500):(s_oMain.setLocalStorageLevel(t+1),setTimeout(function(){Q.show(d,k,t)},500));s_oMain.setLocalStorageScore(d,t)};this._onNextLevel=function(){t++;this.reset();this.startCountdown()};this.onExit=function(){this.unload();s_oMain.gotoMenu();
$(s_oMain).trigger("show_interlevel_ad");$(s_oMain).trigger("end_session");$(s_oMain).trigger("share_event",k)};this.getPlayerX=function(){return D.getX()};this.update=function(){z.isVisible()&&z.update();if(!1!==a){e&&-4<C.rotation?C.rotation-=.5:f&&4>C.rotation?C.rotation+=.5:!1===e&&!1===f&&(0<C.rotation?C.rotation-=.5:0>C.rotation&&(C.rotation+=.5));D.update();c.update();this._manageOpponentDepth();for(var H=0;H<x.length;H++)x[H].update();!g&&h&&(b+=s_iTimeElaps,!n&&b>r&&(b=0,this._spawnEnemy()))}};
s_oGame=this;this._init()}var s_oGame=null;
function CInterface(a){var h,e,f,n,g,k,d,t,b,p,r,m,q,v,x,u,y,F,c,A,C,w,B,D,z,I,Q=null,H=null,N,O,U,R;this._init=function(X){if(s_bMobile){var J=s_oSpriteLibrary.getSprite("but_left");g=J.width/2+150;k=CANVAS_HEIGHT-J.height/2-50;z=new CGfxButton(g,k,J,s_oStage);z.addEventListener(ON_MOUSE_DOWN,this._onLeftDown,this);z.addEventListener(ON_MOUSE_UP,this._onLeftUp,this);J=s_oSpriteLibrary.getSprite("but_right");f=CANVAS_WIDTH-J.width/2-150;n=CANVAS_HEIGHT-J.height/2-50;I=new CGfxButton(f,n,J,s_oStage);
I.addEventListener(ON_MOUSE_DOWN,this._onRightDown,this);I.addEventListener(ON_MOUSE_UP,this._onRightUp,this)}else document.onkeydown=s_oGame.onKeyDown,document.onkeyup=s_oGame.onKeyUp;J=s_oSpriteLibrary.getSprite("but_settings");var W=CANVAS_WIDTH,l=J.height/2+10;N=new CGUIExpandible(W,l,J,s_oStage);J=s_oSpriteLibrary.getSprite("but_exit");q=W;v=l+J.height+10;C=new CSideGfxButton(!1,q-s_iOffsetX,v,J,s_oStage);C.addEventListener(ON_MOUSE_UP,this._onExit,this);J=s_oSpriteLibrary.getSprite("but_pause");
h=CANVAS_WIDTH;e=v+J.height+10;D=new CSideGfxButton(!1,h-s_iOffsetX,e,J,s_oStage);D.addEventListener(ON_MOUSE_UP,this._onPause,this);W=100;!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(J=s_oSpriteLibrary.getSprite("audio_icon"),x=CANVAS_WIDTH,u=e+J.height+10,w=new CSideToggle(!1,W,x-s_iOffsetX,u,J,s_bAudioActive,s_oStage),w.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this),d=CANVAS_WIDTH,t=u+J.height+10,W+=100):(d=CANVAS_WIDTH,t=e+J.height+10);J=window.document;l=J.documentElement;Q=l.requestFullscreen||
l.mozRequestFullScreen||l.webkitRequestFullScreen||l.msRequestFullscreen;H=J.exitFullscreen||J.mozCancelFullScreen||J.webkitExitFullscreen||J.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(Q=!1);Q&&screenfull.isEnabled&&(J=s_oSpriteLibrary.getSprite("but_fullscreen"),B=new CSideToggle(!1,W,d-s_iOffsetX,t+s_iOffsetY,J,s_bFullscreen,s_oStage),B.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));N.addButton(C);N.addButton(D);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||N.addButton(w);Q&&screenfull.isEnabled&&
N.addButton(B);J=s_oSpriteLibrary.getSprite("score_panel");r=0;m=10;U=new createjs.Container;U.x=r;U.y=m;s_oStage.addChild(U);W=createBitmap(J);U.addChild(W);c=new CTLText(U,10,0,J.width-10,J.height,40,"left","#ffffff",FONT_GAME,1.1,0,0,TEXT_SCORE,!0,!0,!0,!1);F=new CTLText(U,c.getX()+c.getBounds().width+20,c.getY(),140,J.height,40,"left","#ffffff",FONT_GAME,1.1,0,0,X,!0,!0,!0,!1);b=0;p=CANVAS_HEIGHT-J.height-10;R=new createjs.Container;R.x=b;R.y=p;s_oStage.addChild(R);X=createBitmap(J);R.addChild(X);
A=new CTLText(R,10,0,J.width-10,J.height,40,"left","#ffffff",FONT_GAME,1.1,0,0,TEXT_LEVEL+" "+s_iLevelSelected,!0,!0,!0,!1);O=new CAreYouSurePanel;O.addEventListener(ON_BUT_YES_DOWN,this._onExitYes,this);y=new CRollingScore;this.refreshButtonPos()};this.unload=function(){C.unload();C=null;N.unload();O.unload();!1===DISABLE_SOUND_MOBILE&&(w.unload(),w=null);Q&&screenfull.isEnabled&&B.unload();s_bMobile?(z.unload(),I.unload()):(document.onkeydown=null,document.onkeyup=null);s_oStage.removeAllChildren();
s_oInterface=null};this.reset=function(X,J){F.refreshText(X);A.refreshText(TEXT_LEVEL+" "+J)};this.refreshButtonPos=function(){U.x=r+s_iOffsetX;U.y=m+s_iOffsetY;R.x=b+s_iOffsetX;R.y=p-s_iOffsetY;N.refreshPos();N.isExpanded()?(!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||w.setPosition(x-s_iOffsetX,s_iOffsetY+u),Q&&screenfull.isEnabled&&B.setPosition(d-s_iOffsetX,t+s_iOffsetY),C.setPosition(q-s_iOffsetX,v+s_iOffsetY),D.setPosition(h-s_iOffsetX,e+s_iOffsetY)):(!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||
w.setY(s_iOffsetY+u),Q&&screenfull.isEnabled&&B.setY(t+s_iOffsetY),C.setY(v+s_iOffsetY),D.setY(e+s_iOffsetY),C.resetX(),D.resetX());s_bMobile&&(z.setPosition(g+s_iOffsetX,k-s_iOffsetY),I.setPosition(f-s_iOffsetX,n-s_iOffsetY))};this.refreshScore=function(X){y.rolling(F,null,X)};this._onLeftDown=function(){s_oGame.moveLeft(!0)};this._onRightDown=function(){s_oGame.moveRight(!0)};this._onLeftUp=function(){s_oGame.moveLeft(!1)};this._onRightUp=function(){s_oGame.moveRight(!1)};this._onExit=function(){O.show(TEXT_ARE_SURE)};
this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onPause=function(){s_oMain.isUpdating()?s_oMain.stopUpdateNoBlock():s_oMain.startUpdateNoBlock()};this.resetFullscreenBut=function(){Q&&screenfull.isEnabled&&B.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){!1===s_oMain.isUpdating()&&s_oMain.startUpdateNoBlock();s_bFullscreen?H.call(window.document):Q.call(window.document.documentElement);sizeHandler()};this._onExitYes=function(){s_oGame.onExit()};
s_oInterface=this;this._init(a);return this}var s_oInterface=null;
function CHelpPanel(){var a,h,e,f,n,g,k,d,t,b=this;this._init=function(){t=new createjs.Container;t.visible=!1;s_oStage.addChild(t);f=new createjs.Shape;f.graphics.beginFill("rgba(0,0,0,0.7)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e=f.on("click",function(){});t.addChild(f);var p=s_oSpriteLibrary.getSprite("msg_box_wide"),r=createBitmap(p);r.regX=p.width/2;r.regY=p.height/2;r.x=CANVAS_WIDTH/2;r.y=CANVAS_HEIGHT/2;t.addChild(r);p=[];for(r=0;45>r;r++)p.push(s_oSpriteLibrary.getSprite("tutorial_"+r));
r=p[0].width;var m=p[0].height;p=new createjs.SpriteSheet({images:p,framerate:15,frames:{width:r,height:m,regX:r/2},animations:{start:0,anim:[0,p.length-1]}});k=createSprite(p,"start",r/2,0,r,m);k.x=CANVAS_WIDTH/2;k.y=130;t.addChild(k);h=[];s_bMobile?(p=s_oSpriteLibrary.getSprite("but_left"),r=s_oSpriteLibrary.getSprite("but_right")):(p=s_oSpriteLibrary.getSprite("key_0"),r=s_oSpriteLibrary.getSprite("key_1"));n=createBitmap(p);n.regX=p.width/2;n.regY=p.height/2;n.x=CANVAS_WIDTH/2-240;n.y=CANVAS_HEIGHT/
2+40;t.addChild(n);h.push(n);g=createBitmap(r);g.regX=r.width/2;g.regY=r.height/2;g.x=CANVAS_WIDTH/2+240;g.y=CANVAS_HEIGHT/2+40;t.addChild(g);h.push(g);d=new CGfxButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/2+180,s_oSpriteLibrary.getSprite("but_next"),t);d.addEventListener(ON_MOUSE_UP,this._onStart,this)};this.unload=function(){f.off("click",e)};this.show=function(){a=0;g.scaleX=g.scaleY=.9;k.gotoAndPlay("anim");t.alpha=0;t.visible=!0;createjs.Tween.get(t).to({alpha:1},500)};this.hide=function(){createjs.Tween.get(t).to({alpha:0},
500,createjs.Ease.cubicOut).call(function(){t.visible=!1})};this._attachPlayer=function(p,r,m,q){m=[];for(var v=0;18>v;v++)m.push(s_oSpriteLibrary.getSprite("player_running_"+v));v=m[0].width;var x=m[0].height;m=new createjs.SpriteSheet({images:m,frames:{width:v,height:x,regX:v/2,regY:x},animations:{start:0,anim:[0,m.length-1,q]}});m=createSprite(m,"start",v/2,x,v,x);m.scaleX=m.scaleY=.7;m.x=p;m.y=r;t.addChild(m);return m};this._toggleKeyAnims=function(){.9===g.scaleX?(g.scaleX=g.scaleY=1,n.scaleX=
n.scaleY=.9):(n.scaleX=n.scaleY=1,g.scaleX=g.scaleY=.9)};this._onStart=function(){d.disable();b.hide();s_oGame.onExitFromHelp()};this.isVisible=function(){return t.visible};this.update=function(){a+=s_iTimeElaps;1500<a&&(a=0,this._toggleKeyAnims())};this._init()}
function CLevelSettings(){var a,h,e;this._init=function(){a=[20,30,40,50,60,70,80,80,90,90,100,100];h=[1300,1100,900,800,800,700,700,600,600,500,500,400];e=[1,1,1,2,2,2,2,3,3,2,2,2];NUM_LEVELS=a.length};this.getEnemiesSpawn=function(f){return a[f-1]};this.getStartingEnemySpawn=function(f){return h[f-1]};this.getEnemySpawnNumber=function(f){return e[f-1]};this._init()}
function CLevelMenu(){var a,h,e,f,n,g,k,d,t,b,p,r,m,q,v,x,u,y,F,c,A=null,C=null;this._init=function(){k=!0;d=0;F=new createjs.Container;s_oStage.addChild(F);var w=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));F.addChild(w);v=new createjs.Shape;v.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);v.alpha=.5;F.addChild(v);x=new createjs.Container;x.x=CANVAS_WIDTH/2;F.addChild(x);q=s_oSpriteLibrary.getSprite("msg_box_wide");w=createBitmap(q);x.addChild(w);new CTLText(x,0,40,q.width,
90,80,"center","#ffffff",FONT_GAME,1,20,5,TEXT_SELECT_LEVEL,!0,!0,!0,!1);var B=s_oSpriteLibrary.getSprite("but_exit");n=CANVAS_WIDTH;g=B.height/2+10;u=new CSideGfxButton(!1,n-s_iOffsetX,g+s_iOffsetY,B,s_oStage);u.addEventListener(ON_MOUSE_UP,this._onExit,this);u.addEventListener(ON_BUT_END_TWEEN_X,this._onButEndTween,this);x.regX=q.width/2;x.regY=q.height/2;t=-q.height/2;b=B.height;w=100;!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(B=s_oSpriteLibrary.getSprite("audio_icon"),e=CANVAS_WIDTH,f=g+B.height+
10,y=new CSideToggle(!1,w,e-s_iOffsetX,f+s_iOffsetY,B,s_bAudioActive,s_oStage),y.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this),a=CANVAS_WIDTH,h=f+B.height+10,w+=100,y.tweenFinalX()):(a=CANVAS_WIDTH,h=g+B.height+10);B=window.document;var D=B.documentElement;A=D.requestFullscreen||D.mozRequestFullScreen||D.webkitRequestFullScreen||D.msRequestFullscreen;C=B.exitFullscreen||B.mozCancelFullScreen||B.webkitExitFullscreen||B.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(A=!1);A&&screenfull.isEnabled&&
(B=s_oSpriteLibrary.getSprite("but_fullscreen"),c=new CSideToggle(!1,w,a-s_iOffsetX,h+s_iOffsetY,B,s_bFullscreen,s_oStage),c.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this),c.tweenFinalX());this._checkBoundLimits();r=[];w=Math.floor((q.width-100)/NUM_COLS_PAGE_LEVEL)/2;for(D=B=0;D<NUM_COLS_PAGE_LEVEL;D++)r.push(B),B+=2*w;m=[];this._createNewLevelPage(0,NUM_LEVELS);this.refreshButtonPos();v.alpha=0;x.y=t;F.visible=!0;u.tweenFinalX();createjs.Tween.get(v).to({alpha:.7},500);createjs.Tween.get(x).to({y:CANVAS_HEIGHT/
2},500,createjs.Ease.quartOut)};this.unload=function(){for(var w=0;w<p.length;w++)p[w].unload();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||y.unload();A&&screenfull.isEnabled&&c.unload();u.unload();s_oStage.removeAllChildren();s_oLevelMenu=null};this.refreshButtonPos=function(){k||(u.setPosition(n-s_iOffsetX,g+s_iOffsetY),!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||y.setPosition(e-s_iOffsetX,s_iOffsetY+f),A&&screenfull.isEnabled&&c.setPosition(a-s_iOffsetX,h+s_iOffsetY))};this._checkBoundLimits=function(){for(var w=
s_oSpriteLibrary.getSprite("but_level"),B=0,D=CANVAS_HEIGHT-2*EDGEBOARD_Y-2*b,z=0;B<D;)B+=w.height+20,z++;NUM_ROWS_PAGE_LEVEL>z&&(NUM_ROWS_PAGE_LEVEL=z);D=B=0;z=CANVAS_WIDTH-2*EDGEBOARD_X;for(w=s_oSpriteLibrary.getSprite("but_level");D<z;)D+=w.width/2+5,B++;NUM_COLS_PAGE_LEVEL>B&&(NUM_COLS_PAGE_LEVEL=B)};this._createNewLevelPage=function(w,B){var D=new createjs.Container;x.addChild(D);m.push(D);p=[];for(var z=0,I=0,Q=1,H=!1,N=s_oSpriteLibrary.getSprite("but_level"),O=w;O<B;O++){var U=null;if(O+1>
s_iLastLevel)var R=!1;else R=!0,U=s_oMain.getScoreLevel(O);R=new CLevelBut(r[z]+N.width/4,I+N.height/2,O+1,U,N,R,D);R.addEventListenerWithParams(ON_MOUSE_UP,this._onButLevelRelease,this,O);p.push(R);z++;if(z===r.length&&(z=0,I+=N.height+70,Q++,Q>NUM_ROWS_PAGE_LEVEL&&O!==B-1)){H=!0;break}}D.x=q.width/2;D.y=q.height/2;D.regX=D.getBounds().width/2;D.regY=D.getBounds().height/2;H&&this._createNewLevelPage(O+1,B)};this._onRight=function(){m[d].visible=!1;d++;d>=m.length&&(d=0);m[d].visible=!0};this._onLeft=
function(){m[d].visible=!1;d--;0>d&&(d=m.length-1);m[d].visible=!0};this._onButLevelRelease=function(w){s_oLevelMenu.unload();s_oMain.levelSelected(w+1)};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this.resetFullscreenBut=function(){A&&screenfull.isEnabled&&c.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?C.call(window.document):A.call(window.document.documentElement);sizeHandler()};this._onButEndTween=function(){k=!1};this._onExit=
function(){s_oLevelMenu.unload();s_oMain.gotoMenu()};s_oLevelMenu=this;this._init()}var s_oLevelMenu=null;
function CLevelBut(a,h,e,f,n,g,k){var d,t,b,p=[],r=[],m,q,v,x;this._init=function(y,F,c,A,C,w){t=[];b=[];x=new createjs.Container;u.addChild(x);var B=new createjs.SpriteSheet({images:[C],frames:{width:C.width/2,height:C.height,regX:C.width/2/2,regY:C.height/2},animations:{state_true:[0],state_false:[1]}});d=w;v=createSprite(B,"state_"+d,C.width/2/2,C.height/2,C.width/2,C.height);v.mouseEnabled=w;v.x=y;v.y=F;v.stop();s_bMobile||(x.cursor="pointer");x.addChild(v);p.push(v);m=new createjs.Text(c,"50px "+
FONT_GAME,"#fff");m.x=y;m.y=F+2;m.textAlign="center";m.textBaseline="alphabetic";x.addChild(m);c=s_oSpriteLibrary.getSprite("icon_score");c=createBitmap(c);c.x=y-40;c.y=F+22;x.addChild(c);null===A&&(A=0);q=new createjs.Text(A,"20px "+FONT_GAME,"#fff");q.x=y+40;q.y=F+37;q.textAlign="right";q.textBaseline="alphabetic";x.addChild(q);w||(m.color="#b4b4b4");this._initListener()};this.unload=function(){x.off("mousedown",this.buttonDown);x.off("pressup",this.buttonRelease);x.removeChild(v)};this._initListener=
function(){x.on("mousedown",this.buttonDown);x.on("pressup",this.buttonRelease)};this.viewBut=function(y){x.addChild(y)};this.addEventListener=function(y,F,c){t[y]=F;b[y]=c};this.addEventListenerWithParams=function(y,F,c,A){t[y]=F;b[y]=c;r=A};this.ifClickable=function(){return!0===x.mouseEnabled?1:0};this.setActive=function(y,F){d=F;p[y].gotoAndStop("state_"+d);p[y].mouseEnabled=!0;m.color=d?"#00397a":"#b4b4b4"};this.buttonRelease=function(){d&&(playSound("click",1,!1),t[ON_MOUSE_UP]&&t[ON_MOUSE_UP].call(b[ON_MOUSE_UP],
r))};this.buttonDown=function(){t[ON_MOUSE_DOWN]&&t[ON_MOUSE_DOWN].call(b[ON_MOUSE_DOWN],r)};this.setPosition=function(y,F){x.x=y;x.y=F};this.setVisible=function(y){x.visible=y};var u=k;this._init(a,h,e,f,n,g,k)}
function CCreditsPanel(){var a,h,e,f,n,g,k;this._init=function(){k=new createjs.Container;s_oStage.addChild(k);var d=new createjs.Shape;d.graphics.beginFill("rgba(0,0,0,0.7)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);k.addChild(d);d=s_oSpriteLibrary.getSprite("msg_box_small");a=createBitmap(d);a.regX=d.width/2;a.regY=d.height/2;a.x=CANVAS_WIDTH/2;a.y=CANVAS_HEIGHT/2;k.addChild(a);n=new createjs.Shape;n.graphics.beginFill("#0f0f0f").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);n.alpha=.01;n.on("click",
this._onLogoButRelease);k.addChild(n);d=s_oSpriteLibrary.getSprite("but_no");e=new CGfxButton(980,246,d,k);e.setScale(.6);e.addEventListener(ON_MOUSE_UP,this.unload,this);f=new createjs.Text(TEXT_CREDITS_DEVELOPED,"26px "+FONT_GAME,"#fff");f.textAlign="center";f.textBaseline="alphabetic";f.x=CANVAS_WIDTH/2;f.y=330;k.addChild(f);d=s_oSpriteLibrary.getSprite("logo_ctl");h=createBitmap(d);h.regX=d.width/2;h.regY=d.height/2;h.x=CANVAS_WIDTH/2;h.y=CANVAS_HEIGHT/2;k.addChild(h);g=new createjs.Text("www.codethislab.com",
"26px "+FONT_GAME,"#fff");g.textAlign="center";g.textBaseline="alphabetic";g.x=CANVAS_WIDTH/2;g.y=450;k.addChild(g)};this.unload=function(){n.off("click",this._onLogoButRelease);e.unload();e=null;s_oStage.removeChild(k)};this._onLogoButRelease=function(){window.open("http://www.codethislab.com/index.php?&l=en","_blank")};this._init()}
function CAlertSavingBox(a,h){var e,f;this._init=function(k){f=new createjs.Container;g.addChild(f);var d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);d.alpha=.5;d.on("click",function(){});f.addChild(d);d=s_oSpriteLibrary.getSprite("msg_box_small");var t=createBitmap(d);t.x=.5*CANVAS_WIDTH;t.y=.5*CANVAS_HEIGHT;t.regX=.5*d.width;t.regY=.5*d.height;f.addChild(t);new CTLText(f,CANVAS_WIDTH/2-d.width/2,CANVAS_HEIGHT/2-90,d.width,200,40,"center","#ffffff",FONT_GAME,
1,20,10,k,!0,!0,!0,!1);e=new CSideGfxButton(!1,1024,250,s_oSpriteLibrary.getSprite("but_exit"),f);e.addEventListener(ON_MOUSE_UP,this._onButOk,this);e.setX(1024)};this._onButOk=function(){n.unload()};this.unload=function(){e.unload();g.removeChild(f)};var n=this;var g=h;this._init(a)}
function CAreYouSurePanel(){var a,h,e,f,n,g,k,d,t=this;this._init=function(){a=[];h=[];k=new createjs.Container;k.visible=!1;s_oStage.addChild(k);d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);d.alpha=.5;d.on("click",function(){});k.addChild(d);var b=s_oSpriteLibrary.getSprite("msg_box_small");e=createBitmap(b);e.x=CANVAS_WIDTH/2;e.y=CANVAS_HEIGHT/2;e.regX=.5*b.width;e.regY=.5*b.height;k.addChild(e);f=new CTLText(k,CANVAS_WIDTH/2-b.width/2,CANVAS_HEIGHT/
2-b.height/2,b.width,200,70,"center","#ffffff",FONT_GAME,1,40,10,TEXT_ARE_SURE,!0,!0,!0,!1);n=new CGfxButton(CANVAS_WIDTH/2+150,.5*CANVAS_HEIGHT+70,s_oSpriteLibrary.getSprite("but_yes"),k);n.addEventListener(ON_MOUSE_UP,this._onButYes,this);g=new CGfxButton(CANVAS_WIDTH/2-150,.5*CANVAS_HEIGHT+70,s_oSpriteLibrary.getSprite("but_no"),k);g.addEventListener(ON_MOUSE_UP,this._onButNo,this)};this.addEventListener=function(b,p,r){a[b]=p;h[b]=r};this.show=function(b){f.refreshText(b);k.alpha=0;k.visible=
!0;createjs.Tween.get(k).to({alpha:1},300,createjs.Ease.quartOut).call(function(){s_oMain.stopUpdateNoBlock()})};this.hide=function(){s_oMain.startUpdateNoBlock();createjs.Tween.get(k).to({alpha:0},500,createjs.Ease.quartOut).call(function(){k.visible=!1})};this.unload=function(){g.unload();n.unload()};this._onButYes=function(){t.hide();a[ON_BUT_YES_DOWN]&&a[ON_BUT_YES_DOWN].call(h[ON_BUT_YES_DOWN])};this._onButNo=function(){t.hide()};this._init()}
function CGUIExpandible(a,h,e,f){var n,g,k,d,t;this._init=function(p,r,m,q){g=[];d=new createjs.Container;d.x=p;d.y=r;q.addChild(d);t=new createjs.Container;d.addChild(t);n=!1;k=new CSideGfxButton(!1,0,0,m,t);k.addEventListener(ON_MOUSE_UP,this._onMenu,this);k.tweenFinalX()};this.unload=function(){k.unload();f.removeChild(d)};this.refreshPos=function(){d.x=a-s_iOffsetX;d.y=h+s_iOffsetY;for(var p=0;p<g.length;p++)g[p].setFinalX(d.x)};this.addButton=function(p){g.push(p)};this._onMenu=function(){(n=
!n)?b._expand():b._collapse()};this._expand=function(){for(var p=0;p<g.length;p++)g[p].tweenFinalX()};this._collapse=function(){for(var p=100*g.length,r=0;r<g.length;r++)g[r].tweenStartX(p),p-=100};this.isExpanded=function(){return n};var b=this;this._init(a,h,e,f)}
function CField(a,h,e){var f,n,g,k,d,t,b,p,r,m,q,v,x=this;this._init=function(y,F){p=[];r=[];m=new createjs.Container;m.x=y;m.y=F;u.addChild(m);for(var c=[],A=0;87>A;A++){var C=s_oSpriteLibrary.getSprite("field_loop_"+A);c.push(C)}C={images:c,framerate:20,frames:{width:1600,height:631},animations:{start:0,anim:[0,29,"anim"],arrival:[30,86,"end"],end:86}};C=new createjs.SpriteSheet(C);v=createSprite(C,"start",0,0,1600,631);v.on("animationend",this._onAnimEnd,this);v.on("change",this._onAnimChange,
this);m.addChild(v);c=[];for(A=0;42>A;A++)C=s_oSpriteLibrary.getSprite("arrive_"+A),c.push(C);t=[];b=[];for(A=0;2>A;A++)C=new CSponsor(510,256,!0,m),t.push(C),C=new CSponsor(1070,256,!1,m),b.push(C);C={images:c,framerate:15,frames:{width:1600,height:539},animations:{start:0,anim:[0,41,"end"],end:42}};C=new createjs.SpriteSheet(C);q=createSprite(C,"start",0,0,1600,539);q.visible=!1;q.y=-F-18;m.addChild(q)};this.reset=function(){n=!1;for(var y=0;y<t.length;y++)t[y].reset(),b[y].reset();g=q.visible=
!1;d=k=0};this.show=function(){f=!1;v.gotoAndPlay("anim");g=!0};this.hide=function(){v.gotoAndStop("start");m.visible=!1};this.addEventListener=function(y,F,c){p[y]=F;r[y]=c};this.readyForArrival=function(){f=!0};this._playArrival=function(){v.framerate=15;v.gotoAndPlay("arrival")};this.stopAnim=function(){v.stop();this.stopSponsors()};this.prepareSponsorsForStop=function(){for(var y=0;y<t.length;y++)t[y].readyForRemoval(),b[y].readyForRemoval()};this.stopSponsors=function(){for(var y=0;y<t.length;y++)t[y].stopTween(),
b[y].stopTween()};this._onAnimEnd=function(y){"anim"===y.currentTarget.currentAnimation&&f&&(f=!1,x._playArrival())};this._onAnimChange=function(y){"arrival"===y.currentTarget.currentAnimation&&(75<=y.currentTarget.currentFrame&&!n?(n=!0,p[ON_READY_FOR_PLAYER_ARRIVAL]&&p[ON_READY_FOR_PLAYER_ARRIVAL].call(r[ON_READY_FOR_PLAYER_ARRIVAL])):31<=y.currentTarget.currentFrame&&!1===q.visible&&(q.gotoAndPlay("anim"),q.visible=!0))};this.update=function(){g&&(k+=s_iTimeElaps,2E3<k&&(k=0,t[d].startAnim(),b[d].startAnim(),
d++,d===t.length&&(g=!1)))};var u=e;this._init(a,h)}
function CPlayer(a,h,e){var f=!1,n=!1,g=!1,k,d,t,b,p,r,m,q,v,x,u,y,F,c,A;this._init=function(w,B){b=w;p=B;q=0;r=HERO_ACCELERATION;m=MAX_HERO_SPEED;F=[];c=[];A=new createjs.Container;A.x=w;A.y=B;C.addChild(A);y=[];y[PLAYER_ANIM_RUN]=19;y[PLAYER_ANIM_FALL]=30;y[PLAYER_ANIM_ARRIVAL]=70;y[PLAYER_ANIM_LEFT]=8;y[PLAYER_ANIM_RIGHT]=8;y[PLAYER_ANIM_LEFT_OUT]=7;y[PLAYER_ANIM_RIGHT_OUT]=7;u=[];u[PLAYER_ANIM_RUN]=[];for(var D=0;D<y[PLAYER_ANIM_RUN];D++){var z=s_oSpriteLibrary.getSprite("player_running_"+D),
I=createBitmap(z);I.visible=!1;I.regX=z.width/2;I.regY=z.height;A.addChild(I);u[PLAYER_ANIM_RUN].push(I)}u[PLAYER_ANIM_FALL]=[];for(D=0;D<y[PLAYER_ANIM_FALL];D++)z=s_oSpriteLibrary.getSprite("player_falling_"+D),I=createBitmap(z),I.visible=!1,I.regX=z.width/2,I.regY=z.height,A.addChild(I),u[PLAYER_ANIM_FALL].push(I);u[PLAYER_ANIM_ARRIVAL]=[];for(D=0;D<y[PLAYER_ANIM_ARRIVAL];D++)z=s_oSpriteLibrary.getSprite("player_arrival_"+D),I=createBitmap(z),I.visible=!1,I.regX=z.width/2,I.regY=z.height,A.addChild(I),
u[PLAYER_ANIM_ARRIVAL].push(I);u[PLAYER_ANIM_LEFT]=[];for(D=0;D<y[PLAYER_ANIM_LEFT];D++)z=s_oSpriteLibrary.getSprite("player_left_"+D),I=createBitmap(z),I.visible=!1,I.regX=z.width/2,I.regY=z.height,A.addChild(I),u[PLAYER_ANIM_LEFT].push(I);u[PLAYER_ANIM_RIGHT]=[];for(D=0;D<y[PLAYER_ANIM_RIGHT];D++)z=s_oSpriteLibrary.getSprite("player_right_"+D),I=createBitmap(z),I.visible=!1,I.regX=z.width/2,I.regY=z.height,A.addChild(I),u[PLAYER_ANIM_RIGHT].push(I);u[PLAYER_ANIM_LEFT_OUT]=[];for(D=0;D<y[PLAYER_ANIM_LEFT_OUT];D++)z=
s_oSpriteLibrary.getSprite("player_left_out_"+D),I=createBitmap(z),I.visible=!1,I.regX=z.width/2,I.regY=z.height,A.addChild(I),u[PLAYER_ANIM_LEFT_OUT].push(I);u[PLAYER_ANIM_RIGHT_OUT]=[];for(D=0;D<y[PLAYER_ANIM_RIGHT_OUT];D++)z=s_oSpriteLibrary.getSprite("player_right_out_"+D),I=createBitmap(z),I.visible=!1,I.regX=z.width/2,I.regY=z.height,A.addChild(I),u[PLAYER_ANIM_RIGHT_OUT].push(I);k=PLAYER_ANIM_RUN};this.addEventListener=function(w,B,D){F[w]=B;c[w]=D};this.show=function(){d=y[k];u[k][0].visible=
!0;t=0;A.visible=!0;v=A.getBounds().width-400;x=A.getBounds().height-200;f=!0};this.hide=function(){f=!1;A.visible=!1};this.reset=function(){g=n=f=!1;q=0;r=HERO_ACCELERATION;m=MAX_HERO_SPEED;A.alpha=1;A.x=b;A.y=p;for(var w=0;w<y[PLAYER_ANIM_RUN];w++)u[PLAYER_ANIM_RUN][w].visible=!1;for(w=0;w<y[PLAYER_ANIM_FALL];w++)u[PLAYER_ANIM_FALL][w].visible=!1;for(w=0;w<y[PLAYER_ANIM_ARRIVAL];w++)u[PLAYER_ANIM_ARRIVAL][w].visible=!1;for(w=0;w<y[PLAYER_ANIM_LEFT];w++)u[PLAYER_ANIM_LEFT][w].visible=!1;for(w=0;w<
y[PLAYER_ANIM_RIGHT];w++)u[PLAYER_ANIM_RIGHT][w].visible=!1;k=PLAYER_ANIM_RUN};this.changeAnim=function(w){w!==k&&(f=!1,u[k][t].visible=!1,k=w,u[k][0].visible=!0,t=0,d=y[k],f=!0,w===PLAYER_ANIM_LEFT||w===PLAYER_ANIM_RIGHT?playSound("skiing_direction",1,!1):w===PLAYER_ANIM_FALL?playSound("falling",1,!1):w===PLAYER_ANIM_ARRIVAL&&playSound("arrival",1,!1))};this.playToFrame=function(w){u[k][t].visible=!1;t=w;u[k][t].visible=!0};this.nextFrame=function(){u[k][t].visible=!1;t++;u[k][t].visible=!0};this.moveLeft=
function(w){A.x===MIN_PLAYER_X?(n=!1,q=0):(w?this.changeAnim(PLAYER_ANIM_LEFT):this.changeAnim(PLAYER_ANIM_LEFT_OUT),n=w)};this.moveRight=function(w){A.x===MAX_PLAYER_X?(g=!1,q=0):(w?this.changeAnim(PLAYER_ANIM_RIGHT):this.changeAnim(PLAYER_ANIM_RIGHT_OUT),g=w)};this.setAcceleration=function(w,B){r=w;m=B};this.setY=function(w){A.y=w};this.getRect=function(){return new createjs.Rectangle(A.x-v/2,A.y-x,v,x)};this.getCurAnim=function(){return k};this.getX=function(){return A.x};this.getContainer=function(){return A};
this._updateMove=function(){k!==PLAYER_ANIM_FALL&&k!==PLAYER_ANIM_ARRIVAL&&(n&&(q-=r),g&&(q+=r),A.x+=q,q*=HERO_FRICTION,q>m&&(q=m),q<-m&&(q=-m),.1>Math.abs(q)&&(q=0),A.x+q>=MAX_PLAYER_X?(A.x=MAX_PLAYER_X,k===PLAYER_ANIM_RIGHT&&this.changeAnim(PLAYER_ANIM_RIGHT_OUT)):A.x-q<=MIN_PLAYER_X&&(A.x=MIN_PLAYER_X,k===PLAYER_ANIM_LEFT&&this.changeAnim(PLAYER_ANIM_LEFT_OUT)),A.y=p-Math.abs((A.x-CANVAS_WIDTH/2)/10),A.setTransform(A.x,A.y,1,1,0,-(A.x-CANVAS_WIDTH/2)/50))};this.update=function(){if(!1!==f)if(this._updateMove(),
t===d-1)switch(k){case PLAYER_ANIM_RUN:this.playToFrame(0);break;case PLAYER_ANIM_FALL:this.hide();F[ON_PLAYER_FALL]&&F[ON_PLAYER_FALL].call(c[ON_PLAYER_FALL]);break;case PLAYER_ANIM_ARRIVAL:f=!1;F[ON_PLAYER_ARRIVAL]&&F[ON_PLAYER_ARRIVAL].call(c[ON_PLAYER_ARRIVAL]);break;case PLAYER_ANIM_LEFT_OUT:case PLAYER_ANIM_RIGHT_OUT:this.changeAnim(PLAYER_ANIM_RUN)}else this.nextFrame()};var C=e;this._init(a,h)}
function COpponent(a,h,e,f,n,g){var k,d,t=!1,b,p,r,m,q,v,x=this,u;x=this;this._init=function(F,c,A){r=[];m=[];k=F;d=c;u=new createjs.Container;u.x=F;u.y=c;u.scaleX=u.scaleY=.05;y.addChild(u);F=s_oSpriteLibrary.getSprite("item_"+A);b=F.width;p=F.height;v=createBitmap(F);u.addChild(v);u.regX=b/2;u.regY=p;this.show()};this.addEventListener=function(F,c,A){r[F]=c;m[F]=A};this.reset=function(){u.x=k;u.y=d;u.scaleX=u.scaleY=.05;v.visible=!1};this.unload=function(){y.removeChild(u)};this.show=function(){t=
!1;this.reset();x._startRun()};this._startRun=function(){v.visible=!0;u.alpha=0;u.visible=!0;(new createjs.Tween.get(u)).to({alpha:1},1200);q=(new createjs.Tween.get(u)).to({x:f},TIME_OPPONENT_RUN,createjs.Ease.quintIn);(new createjs.Tween.get(u)).to({y:OPPONENT_FINAL_Y},TIME_OPPONENT_RUN,createjs.Ease.quintIn);(new createjs.Tween.get(u)).to({scaleX:1.2,scaleY:1.2},TIME_OPPONENT_RUN,createjs.Ease.quartIn).call(function(){x.hide()});t=!0};this.hide=function(){t=!1;u.visible=!1;r[ON_OPPONENT_HIDE]&&
r[ON_OPPONENT_HIDE].call(m[ON_OPPONENT_HIDE],a)};this.stopUpdate=function(){createjs.Tween.removeTweens(u);t=!1};this.update=function(){if(t&&q.position>.8*TIME_OPPONENT_RUN&&(t=!1,r[ON_OPPONENT_CHECK_COLLISION])){var F=new createjs.Rectangle(u.x-b*u.scaleX/2,u.y-p*u.scaleY,b*u.scaleX,p*u.scaleY);r[ON_OPPONENT_CHECK_COLLISION].call(m[ON_OPPONENT_CHECK_COLLISION],F,u)}};var y=g;this._init(h,e,n)}
function CEndPanel(){var a,h,e,f,n,g,k,d,t,b,p,r,m=this;this._init=function(){e=[];f=[];p=new createjs.Container;p.visible=!1;s_oStage.addChild(p);g=new createjs.Shape;g.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);g.alpha=0;n=g.on("click",function(){});p.addChild(g);r=new createjs.Container;r.x=CANVAS_WIDTH/2;p.addChild(r);var q=s_oSpriteLibrary.getSprite("msg_box_small"),v=createBitmap(q);r.addChild(v);k=new CTLText(r,0,0,q.width,120,80,"center","#ffffff",FONT_GAME,1,40,
10,"",!0,!0,!0,!1);d=new CTLText(r,0,q.height/2-60,q.width,80,80,"center","#ffffff",FONT_GAME,1,40,10,"",!0,!0,!0,!1);t=new CGfxButton(q.width/2-200,q.height/2+110,s_oSpriteLibrary.getSprite("but_home"),r);t.addEventListener(ON_MOUSE_UP,this._onHome,this);b=new CGfxButton(q.width/2+200,q.height/2+110,s_oSpriteLibrary.getSprite("but_restart"),r);b.addEventListener(ON_MOUSE_UP,this._onRestart,this);a=-q.height/2;r.regX=q.width/2;r.regY=q.height/2};this.unload=function(){t.unload();b.unload();g.off("click",
n)};this.addEventListener=function(q,v,x){e[q]=v;f[q]=x};this.show=function(q,v){setVolume("soundtrack",0);(v===TEXT_CONGRATS?playSound("level_win",1,!1):playSound("game_over",1,!1)).on("end",function(){setVolume("soundtrack",1)});k.refreshText(v);0<q?d.refreshText(TEXT_SCORE+": "+q):d.refreshText("");g.alpha=0;r.y=a;p.visible=!0;createjs.Tween.get(g).to({alpha:.7},500);createjs.Tween.get(r).wait(400).to({y:CANVAS_HEIGHT/2},500,createjs.Ease.quartOut).call(function(){m.enableButtons()})};this.hide=
function(){createjs.Tween.get(r).to({y:a},500,createjs.Ease.quartOut).call(function(){p.visible=!1;e[h]&&e[h].call(f[h])})};this.enableButtons=function(){t.enable();b.enable()};this.disableButtons=function(){t.disable();b.disable()};this._onHome=function(){m.disableButtons();h=ON_BACK_MENU;m.hide()};this._onRestart=function(){m.disableButtons();$(s_oMain).trigger("show_interlevel_ad");h=ON_RESTART;m.hide()};this._init()}
function CNextLevelPanel(){var a,h,e,f,n,g,k,d,t,b,p,r,m,q,v=this;this._init=function(){e=[];f=[];m=new createjs.Container;m.visible=!1;s_oStage.addChild(m);g=new createjs.Shape;g.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);g.alpha=0;n=g.on("click",function(){});m.addChild(g);q=new createjs.Container;q.x=CANVAS_WIDTH/2;m.addChild(q);var x=s_oSpriteLibrary.getSprite("msg_box_small"),u=createBitmap(x);q.addChild(u);d=new CTLText(q,0,0,x.width,120,80,"center","#ffffff",FONT_GAME,
1,40,10,"",!0,!0,!0,!1);k=new CTLText(q,0,x.height/2-70,x.width,60,80,"center","#ffffff",FONT_GAME,1,40,10,"",!0,!0,!0,!1);t=new CTLText(q,0,x.height/2,x.width,60,80,"center","#ffffff",FONT_GAME,1,40,10,"",!0,!0,!0,!1);b=new CGfxButton(x.width/2-200,x.height/2+110,s_oSpriteLibrary.getSprite("but_home"),q);b.addEventListener(ON_MOUSE_UP,this._onHome,this);p=new CGfxButton(x.width/2,x.height/2+110,s_oSpriteLibrary.getSprite("but_restart"),q);p.addEventListener(ON_MOUSE_UP,this._onRestart,this);r=new CGfxButton(x.width/
2+200,x.height/2+110,s_oSpriteLibrary.getSprite("but_next"),q);r.addEventListener(ON_MOUSE_UP,this._onNext,this);a=-x.height/2;q.regX=x.width/2;q.regY=x.height/2};this.unload=function(){b.unload();p.unload();g.off("click",n)};this.addEventListener=function(x,u,y){e[x]=u;f[x]=y};this.show=function(x,u,y){setVolume("soundtrack",0);playSound("level_win",1,!1).on("end",function(){setVolume("soundtrack",1)});d.refreshText(TEXT_LEVEL+" "+y+" "+TEXT_CLEARED);k.refreshText(TEXT_LEVEL_SCORE+": "+x);t.refreshText(TEXT_SCORE+
": "+u);g.alpha=0;q.y=a;m.visible=!0;createjs.Tween.get(g).to({alpha:.7},500);createjs.Tween.get(q).wait(400).to({y:CANVAS_HEIGHT/2},500,createjs.Ease.quartOut).call(function(){v.enableButtons()})};this.hide=function(){createjs.Tween.get(q).to({y:a},500,createjs.Ease.quartOut).call(function(){m.visible=!1;e[h]&&e[h].call(f[h])})};this.enableButtons=function(){b.enable();r.enable();p.enable()};this.disableButtons=function(){b.disable();r.disable();p.disable()};this._onHome=function(){v.disableButtons();
h=ON_BACK_MENU;v.hide()};this._onRestart=function(){v.disableButtons();$(s_oMain).trigger("show_interlevel_ad");h=ON_RESTART;v.hide()};this._onNext=function(){v.disableButtons();$(s_oMain).trigger("show_interlevel_ad");h=ON_NEXT_LEVEL;v.hide()};this._init()}var MS_ROLLING_SCORE=400;
function CRollingScore(){var a=null,h=null;this.rolling=function(e,f,n){a=createjs.Tween.get(e.getText()).to({text:n},MS_ROLLING_SCORE,createjs.Ease.cubicOut).call(function(){createjs.Tween.removeTweens(a);e.setColor("#fff")}).addEventListener("change",function(){e.refreshText(Math.floor(e.getString()))});null!==f&&(h=createjs.Tween.get(f.getText()).to({text:n},MS_ROLLING_SCORE,createjs.Ease.cubicOut).call(function(){createjs.Tween.removeTweens(h)}).addEventListener("change",function(){f.refreshText(Math.floor(f.getString()))}))};
return this}
function CScoreText(a,h,e,f){var n;this._init=function(g,k,d){n=new createjs.Text("+"+g," 80px "+FONT_GAME,"#fff");n.textAlign="center";n.x=k;n.y=d;n.alpha=0;n.shadow=new createjs.Shadow("#000",1,1,1);f.addChild(n);var t=this;createjs.Tween.get(n).to({alpha:1},200,createjs.Ease.quadIn).call(function(){t.moveUp()})};this.moveUp=function(){var g=n.y-400,k=this;createjs.Tween.get(n).to({y:g},1500,createjs.Ease.sineIn).call(function(){k.unload()});createjs.Tween.get(n).wait(800).to({alpha:0},500)};this.unload=
function(){f.removeChild(n)};this._init(a,h,e)}
function CCountdownController(a,h,e){var f,n,g,k,d,t=this;this._init=function(b,p){g=[];k=[];d=new createjs.Container;d.x=b;d.y=p;e.addChild(d);n=[];for(var r=0;4>r;r++){var m=s_oSpriteLibrary.getSprite("countdown_"+(4-r-1)),q=createBitmap(m);q.regX=m.width/2;q.regY=m.height/2;d.addChild(q);n.push(q)}};this.addEventListener=function(b,p,r){g[b]=p;k[b]=r};this.reset=function(){for(var b=0;b<n.length;b++)n[b].scaleX=n[b].scaleY=.1,n[b].alpha=0};this.start=function(){f=0;this._playAnim()};this._playAnim=
function(){0<f&&createjs.Tween.get(n[f-1]).to({alpha:0},300,createjs.Ease.cubicOut);f===n.length?g[ON_END_COUNTDOWN]&&g[ON_END_COUNTDOWN].call(k[ON_END_COUNTDOWN]):(createjs.Tween.get(n[f]).to({alpha:1},300,createjs.Ease.cubicOut).call(function(){f===n.length-1?playSound("go",1,!1):playSound("countdown",1,!1)}),createjs.Tween.get(n[f]).to({scaleX:1,scaleY:1},1E3,createjs.Ease.quartOut).call(function(){f++;t._playAnim()}))};this._init(a,h)}
function CSponsor(a,h,e,f){var n,g,k,d,t,b,p=this;this._init=function(r,m){n=!1;g=r;k=m;b=new createjs.Container;b.visible=!1;b.x=r;b.y=m;b.scaleX=b.scaleY=.1;f.addChild(b);var q=s_oSpriteLibrary.getSprite("sponsor"),v=createBitmap(q);v.regX=q.width/2;v.regY=q.height/2;b.addChild(v);e?(v.rotation=5,d=-q.width/2):(v.rotation=-5,d=CANVAS_WIDTH+q.width/2);t=m-40};this.reset=function(){b.visible=!1;this._resetAnim()};this.startAnim=function(){b.visible=!0;b.alpha=0;(new createjs.Tween.get(b)).to({alpha:1},
1E3);(new createjs.Tween.get(b)).to({x:d,y:t},TIME_OPPONENT_RUN,createjs.Ease.quintIn).call(function(){n?b.visible=!1:(p._resetAnim(),p.startAnim())});(new createjs.Tween.get(b)).to({scaleX:1,scaleY:1},TIME_OPPONENT_RUN,createjs.Ease.quartIn)};this._resetAnim=function(){n=!1;b.x=g;b.y=k;b.scaleX=b.scaleY=.1};this.readyForRemoval=function(){n=!0};this.stopTween=function(){createjs.Tween.removeTweens(b)};this._init(a,h)}
CTLText.prototype={constructor:CTLText,__autofit:function(){if(this._bFitText){for(var a=this._iFontSize;(this._oText.getBounds().height>this._iHeight-2*this._iPaddingV||this._oText.getBounds().width>this._iWidth-2*this._iPaddingH)&&!(a--,this._oText.font=a+"px "+this._szFont,this._oText.lineHeight=Math.round(a*this._fLineHeightFactor),this.__updateY(),this.__verticalAlign(),8>a););this._iFontSize=a}},__verticalAlign:function(){if(this._bVerticalAlign){var a=this._oText.getBounds().height;this._oText.y-=
(a-this._iHeight)/2+this._iPaddingV}},__updateY:function(){this._oText.y=this._y+this._iPaddingV;switch(this._oText.textBaseline){case "middle":this._oText.y+=this._oText.lineHeight/2+(this._iFontSize*this._fLineHeightFactor-this._iFontSize)}},__createText:function(a){this._bDebug&&(this._oDebugShape=new createjs.Shape,this._oDebugShape.graphics.beginFill("rgba(255,0,0,0.5)").drawRect(this._x,this._y,this._iWidth,this._iHeight),this._oContainer.addChild(this._oDebugShape));this._oText=new createjs.Text(a,
this._iFontSize+"px "+this._szFont,this._szColor);this._oText.textBaseline="middle";this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this._oText.textAlign=this._szAlign;this._oText.lineWidth=this._bMultiline?this._iWidth-2*this._iPaddingH:null;switch(this._szAlign){case "center":this._oText.x=this._x+this._iWidth/2;break;case "left":this._oText.x=this._x+this._iPaddingH;break;case "right":this._oText.x=this._x+this._iWidth-this._iPaddingH}this._oContainer.addChild(this._oText);
this.refreshText(a)},setVerticalAlign:function(a){this._bVerticalAlign=a},setOutline:function(a){null!==this._oText&&(this._oText.outline=a)},setShadow:function(a,h,e,f){null!==this._oText&&(this._oText.shadow=new createjs.Shadow(a,h,e,f))},setColor:function(a){this._oText.color=a},setAlpha:function(a){this._oText.alpha=a},removeTweens:function(){createjs.Tween.removeTweens(this._oText)},getText:function(){return this._oText},getString:function(){return this._oText.text},getX:function(){return this._x},
getY:function(){return this._y},getBounds:function(){return this._oText.getBounds()},getFontSize:function(){return this._iFontSize},refreshText:function(a){""===a&&(a=" ");null===this._oText&&this.__createText(a);this._oText.text=a;this._oText.font=this._iFontSize+"px "+this._szFont;this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this.__autofit();this.__updateY();this.__verticalAlign()}};
function CTLText(a,h,e,f,n,g,k,d,t,b,p,r,m,q,v,x,u){this._oContainer=a;this._x=h;this._y=e;this._iWidth=f;this._iHeight=n;this._bMultiline=x;this._iFontSize=g;this._szAlign=k;this._szColor=d;this._szFont=t;this._iPaddingH=p;this._iPaddingV=r;this._bVerticalAlign=v;this._bFitText=q;this._bDebug=u;this._oDebugShape=null;this._fLineHeightFactor=b;this._oText=null;m&&this.__createText(m)};