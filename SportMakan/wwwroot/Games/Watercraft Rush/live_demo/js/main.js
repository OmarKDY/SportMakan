/*
 Platform.js <https://mths.be/platform>
 Copyright 2014-2018 Benjamin Tan <https://bnjmnt4n.now.sh/>
 Copyright 2011-2013 John-David Dalton
 Available under MIT license <https://mths.be/mit>
*/
(function(){var a="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},c="undefined"!==typeof module&&module.exports,b=function(){for(var b,c=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),
"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")],m=0,h=c.length,e={};m<h;m++)if((b=c[m])&&b[1]in a){for(m=0;m<b.length;m++)e[c[0][m]]=b[m];return e}return!1}(),g={change:b.fullscreenchange,error:b.fullscreenerror},e={request:function(c){return new Promise(function(d,m){var h=function(){this.off("change",
h);d()}.bind(this);this.on("change",h);c=c||a.documentElement;Promise.resolve(c[b.requestFullscreen]())["catch"](m)}.bind(this))},exit:function(){return new Promise(function(c,e){if(this.isFullscreen){var d=function(){this.off("change",d);c()}.bind(this);this.on("change",d);Promise.resolve(a[b.exitFullscreen]())["catch"](e)}else c()}.bind(this))},toggle:function(a){return this.isFullscreen?this.exit():this.request(a)},onchange:function(a){this.on("change",a)},onerror:function(a){this.on("error",a)},
on:function(b,c){var d=g[b];d&&a.addEventListener(d,c,!1)},off:function(b,c){var d=g[b];d&&a.removeEventListener(d,c,!1)},raw:b};b?(Object.defineProperties(e,{isFullscreen:{get:function(){return!!a[b.fullscreenElement]}},element:{enumerable:!0,get:function(){return a[b.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return!!a[b.fullscreenEnabled]}}}),c?module.exports=e:window.screenfull=e):c?module.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}})();
(function(){function a(a){a=String(a);return a.charAt(0).toUpperCase()+a.slice(1)}function c(a,b){var c=-1,l=a?a.length:0;if("number"==typeof l&&-1<l&&l<=q)for(;++c<l;)b(a[c],c,a);else g(a,b)}function b(b){b=String(b).replace(/^ +| +$/g,"");return/^(?:webOS|i(?:OS|P))/.test(b)?b:a(b)}function g(a,b){for(var c in a)A.call(a,c)&&b(a[c],c,a)}function e(b){return null==b?a(b):x.call(b).slice(8,-1)}function d(a,b){var c=null!=a?typeof a[b]:"number";return!/^(?:boolean|number|string|undefined)$/.test(c)&&
("object"==c?!!a[b]:!0)}function k(a){return String(a).replace(/([ -])(?!$)/g,"$1?")}function m(a,b){var l=null;c(a,function(c,d){l=b(l,c,d,a)});return l}function h(a){function c(c){return m(c,function(c,l){var d=l.pattern||k(l);!c&&(c=RegExp("\\b"+d+" *\\d+[.\\w_]*","i").exec(a)||RegExp("\\b"+d+" *\\w+-[\\w]*","i").exec(a)||RegExp("\\b"+d+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(a))&&((c=String(l.label&&!RegExp(d,"i").test(l.label)?l.label:c).split("/"))[1]&&!/[\d.]+/.test(c[0])&&(c[0]+=
" "+c[1]),l=l.label||l,c=b(c[0].replace(RegExp(d,"i"),l).replace(RegExp("; *(?:"+l+"[_-])?","i")," ").replace(RegExp("("+l+")[-_.]?(\\w)","i"),"$1 $2")));return c})}function l(b){return m(b,function(b,c){return b||(RegExp(c+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(a)||0)[1]||null})}var f=t,r=a&&"object"==typeof a&&"String"!=e(a);r&&(f=a,a=null);var p=f.navigator||{},q=p.userAgent||"";a||(a=q);var u=r?!!p.likeChrome:/\bChrome\b/.test(a)&&!/internal|\n/i.test(x.toString()),
A=r?"Object":"ScriptBridgingProxyObject",K=r?"Object":"Environment",M=r&&f.java?"JavaPackage":e(f.java),V=r?"Object":"RuntimeObject";K=(M=/\bJava/.test(M)&&f.java)&&e(f.environment)==K;var Q=M?"a":"\u03b1",R=M?"b":"\u03b2",P=f.document||{},J=f.operamini||f.opera,U=z.test(U=r&&J?J["[[Class]]"]:e(J))?U:J=null,n,N=a;r=[];var C=null,S=a==q;q=S&&J&&"function"==typeof J.version&&J.version();var E=function(b){return m(b,function(b,c){return b||RegExp("\\b"+(c.pattern||k(c))+"\\b","i").exec(a)&&(c.label||
c)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),v=function(b){return m(b,function(b,c){return b||RegExp("\\b"+(c.pattern||k(c))+"\\b","i").exec(a)&&(c.label||c)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser",
"PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},
{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),F=c([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad",
"iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),T=function(b){return m(b,function(b,c,l){return b||(c[F]||c[/^[a-z]+(?: +[a-z]+\b)*/i.exec(F)]||RegExp("\\b"+k(l)+"(?:\\b|\\w*\\d)","i").exec(a))&&l})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},
"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),y=function(c){return m(c,function(c,l){var d=l.pattern||k(l);if(!c&&(c=RegExp("\\b"+d+"(?:/[\\d.]+|[ \\w.]*)","i").exec(a))){var h=c,m=l.label||l,f={"10.0":"10","6.4":"10 Technical Preview",
"6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};d&&m&&/^Win/i.test(h)&&!/^Windows Phone /i.test(h)&&(f=f[/[\d.]+$/.exec(h)])&&(h="Windows "+f);h=String(h);d&&m&&(h=h.replace(RegExp(d,"i"),m));c=h=b(h.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/,
" $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}return c})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac",
"Windows 98;","Windows "]);E&&(E=[E]);T&&!F&&(F=c([T]));if(n=/\bGoogle TV\b/.exec(F))F=n[0];/\bSimulator\b/i.test(a)&&(F=(F?F+" ":"")+"Simulator");"Opera Mini"==v&&/\bOPiOS\b/.test(a)&&r.push("running in Turbo/Uncompressed mode");"IE"==v&&/\blike iPhone OS\b/.test(a)?(n=h(a.replace(/like iPhone OS/,"")),T=n.manufacturer,F=n.product):/^iP/.test(F)?(v||(v="Safari"),y="iOS"+((n=/ OS ([\d_]+)/i.exec(a))?" "+n[1].replace(/_/g,"."):"")):"Konqueror"!=v||/buntu/i.test(y)?T&&"Google"!=T&&(/Chrome/.test(v)&&
!/\bMobile Safari\b/i.test(a)||/\bVita\b/.test(F))||/\bAndroid\b/.test(y)&&/^Chrome/.test(v)&&/\bVersion\//i.test(a)?(v="Android Browser",y=/\bAndroid\b/.test(y)?y:"Android"):"Silk"==v?(/\bMobi/i.test(a)||(y="Android",r.unshift("desktop mode")),/Accelerated *= *true/i.test(a)&&r.unshift("accelerated")):"PaleMoon"==v&&(n=/\bFirefox\/([\d.]+)\b/.exec(a))?r.push("identifying as Firefox "+n[1]):"Firefox"==v&&(n=/\b(Mobile|Tablet|TV)\b/i.exec(a))?(y||(y="Firefox OS"),F||(F=n[1])):!v||(n=!/\bMinefield\b/i.test(a)&&
/\b(?:Firefox|Safari)\b/.exec(v))?(v&&!F&&/[\/,]|^[^(]+?\)/.test(a.slice(a.indexOf(n+"/")+8))&&(v=null),(n=F||T||y)&&(F||T||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(y))&&(v=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(y)?y:n)+" Browser")):"Electron"==v&&(n=(/\bChrome\/([\d.]+)\b/.exec(a)||0)[1])&&r.push("Chromium "+n):y="Kubuntu";q||(q=l(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",k(v),"(?:Firefox|Minefield|NetFront)"]));
if(n="iCab"==E&&3<parseFloat(q)&&"WebKit"||/\bOpera\b/.test(v)&&(/\bOPR\b/.test(a)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(a)&&!/^(?:Trident|EdgeHTML)$/.test(E)&&"WebKit"||!E&&/\bMSIE\b/i.test(a)&&("Mac OS"==y?"Tasman":"Trident")||"WebKit"==E&&/\bPlayStation\b(?! Vita\b)/i.test(v)&&"NetFront")E=[n];"IE"==v&&(n=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(a)||0)[1])?(v+=" Mobile",y="Windows Phone "+(/\+$/.test(n)?n:n+".x"),r.unshift("desktop mode")):/\bWPDesktop\b/i.test(a)?(v="IE Mobile",y="Windows Phone 8.x",
r.unshift("desktop mode"),q||(q=(/\brv:([\d.]+)/.exec(a)||0)[1])):"IE"!=v&&"Trident"==E&&(n=/\brv:([\d.]+)/.exec(a))&&(v&&r.push("identifying as "+v+(q?" "+q:"")),v="IE",q=n[1]);if(S){if(d(f,"global"))if(M&&(n=M.lang.System,N=n.getProperty("os.arch"),y=y||n.getProperty("os.name")+" "+n.getProperty("os.version")),K){try{q=f.require("ringo/engine").version.join("."),v="RingoJS"}catch(X){(n=f.system)&&n.global.system==f.system&&(v="Narwhal",y||(y=n[0].os||null))}v||(v="Rhino")}else"object"==typeof f.process&&
!f.process.browser&&(n=f.process)&&("object"==typeof n.versions&&("string"==typeof n.versions.electron?(r.push("Node "+n.versions.node),v="Electron",q=n.versions.electron):"string"==typeof n.versions.nw&&(r.push("Chromium "+q,"Node "+n.versions.node),v="NW.js",q=n.versions.nw)),v||(v="Node.js",N=n.arch,y=n.platform,q=(q=/[\d.]+/.exec(n.version))?q[0]:null));else e(n=f.runtime)==A?(v="Adobe AIR",y=n.flash.system.Capabilities.os):e(n=f.phantom)==V?(v="PhantomJS",q=(n=n.version||null)&&n.major+"."+n.minor+
"."+n.patch):"number"==typeof P.documentMode&&(n=/\bTrident\/(\d+)/i.exec(a))?(q=[q,P.documentMode],(n=+n[1]+4)!=q[1]&&(r.push("IE "+q[1]+" mode"),E&&(E[1]=""),q[1]=n),q="IE"==v?String(q[1].toFixed(1)):q[0]):"number"==typeof P.documentMode&&/^(?:Chrome|Firefox)\b/.test(v)&&(r.push("masking as "+v+" "+q),v="IE",q="11.0",E=["Trident"],y="Windows");y=y&&b(y)}q&&(n=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(q)||/(?:alpha|beta)(?: ?\d)?/i.exec(a+";"+(S&&p.appMinorVersion))||/\bMinefield\b/i.test(a)&&
"a")&&(C=/b/i.test(n)?"beta":"alpha",q=q.replace(RegExp(n+"\\+?$"),"")+("beta"==C?R:Q)+(/\d+\+?/.exec(n)||""));if("Fennec"==v||"Firefox"==v&&/\b(?:Android|Firefox OS)\b/.test(y))v="Firefox Mobile";else if("Maxthon"==v&&q)q=q.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(F))"Xbox 360"==F&&(y=null),"Xbox 360"==F&&/\bIEMobile\b/.test(a)&&r.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(v)&&(!v||F||/Browser|Mobi/.test(v))||"Windows CE"!=y&&!/Mobi/i.test(a))if("IE"==v&&S)try{null===f.external&&
r.unshift("platform preview")}catch(X){r.unshift("embedded")}else(/\bBlackBerry\b/.test(F)||/\bBB10\b/.test(a))&&(n=(RegExp(F.replace(/ +/g," *")+"/([.\\d]+)","i").exec(a)||0)[1]||q)?(n=[n,/BB10/.test(a)],y=(n[1]?(F=null,T="BlackBerry"):"Device Software")+" "+n[0],q=null):this!=g&&"Wii"!=F&&(S&&J||/Opera/.test(v)&&/\b(?:MSIE|Firefox)\b/i.test(a)||"Firefox"==v&&/\bOS X (?:\d+\.){2,}/.test(y)||"IE"==v&&(y&&!/^Win/.test(y)&&5.5<q||/\bWindows XP\b/.test(y)&&8<q||8==q&&!/\bTrident\b/.test(a)))&&!z.test(n=
h.call(g,a.replace(z,"")+";"))&&n.name&&(n="ing as "+n.name+((n=n.version)?" "+n:""),z.test(v)?(/\bIE\b/.test(n)&&"Mac OS"==y&&(y=null),n="identify"+n):(n="mask"+n,v=U?b(U.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(n)&&(y=null),S||(q=null)),E=["Presto"],r.push(n));else v+=" Mobile";if(n=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(a)||0)[1]){n=[parseFloat(n.replace(/\.(\d)$/,".0$1")),n];if("Safari"==v&&"+"==n[1].slice(-1))v="WebKit Nightly",C="alpha",q=n[1].slice(0,-1);else if(q==n[1]||q==(n[2]=
(/\bSafari\/([\d.]+\+?)/i.exec(a)||0)[1]))q=null;n[1]=(/\bChrome\/([\d.]+)/i.exec(a)||0)[1];537.36==n[0]&&537.36==n[2]&&28<=parseFloat(n[1])&&"WebKit"==E&&(E=["Blink"]);S&&(u||n[1])?(E&&(E[1]="like Chrome"),n=n[1]||(n=n[0],530>n?1:532>n?2:532.05>n?3:533>n?4:534.03>n?5:534.07>n?6:534.1>n?7:534.13>n?8:534.16>n?9:534.24>n?10:534.3>n?11:535.01>n?12:535.02>n?"13+":535.07>n?15:535.11>n?16:535.19>n?17:536.05>n?18:536.1>n?19:537.01>n?20:537.11>n?"21+":537.13>n?23:537.18>n?24:537.24>n?25:537.36>n?26:"Blink"!=
E?"27":"28")):(E&&(E[1]="like Safari"),n=(n=n[0],400>n?1:500>n?2:526>n?3:533>n?4:534>n?"4+":535>n?5:537>n?6:538>n?7:601>n?8:"8"));E&&(E[1]+=" "+(n+="number"==typeof n?".x":/[.+]/.test(n)?"":"+"));"Safari"==v&&(!q||45<parseInt(q))&&(q=n)}"Opera"==v&&(n=/\bzbov|zvav$/.exec(y))?(v+=" ",r.unshift("desktop mode"),"zvav"==n?(v+="Mini",q=null):v+="Mobile",y=y.replace(RegExp(" *"+n+"$"),"")):"Safari"==v&&/\bChrome\b/.exec(E&&E[1])&&(r.unshift("desktop mode"),v="Chrome Mobile",q=null,/\bOS X\b/.test(y)?(T=
"Apple",y="iOS 4.3+"):y=null);q&&0==q.indexOf(n=/[\d.]+$/.exec(y))&&-1<a.indexOf("/"+n+"-")&&(y=String(y.replace(n,"")).replace(/^ +| +$/g,""));E&&!/\b(?:Avant|Nook)\b/.test(v)&&(/Browser|Lunascape|Maxthon/.test(v)||"Safari"!=v&&/^iOS/.test(y)&&/\bSafari\b/.test(E[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(v)&&E[1])&&(n=E[E.length-1])&&r.push(n);r.length&&(r=["("+r.join("; ")+")"]);T&&F&&0>F.indexOf(T)&&r.push("on "+T);F&&r.push((/^on /.test(r[r.length-
1])?"":"on ")+F);if(y){var W=(n=/ ([\d.+]+)$/.exec(y))&&"/"==y.charAt(y.length-n[0].length-1);y={architecture:32,family:n&&!W?y.replace(n[0],""):y,version:n?n[1]:null,toString:function(){var a=this.version;return this.family+(a&&!W?" "+a:"")+(64==this.architecture?" 64-bit":"")}}}(n=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(N))&&!/\bi686\b/i.test(N)?(y&&(y.architecture=64,y.family=y.family.replace(RegExp(" *"+n),"")),v&&(/\bWOW64\b/i.test(a)||S&&/\w(?:86|32)$/.test(p.cpuClass||p.platform)&&!/\bWin64; x64\b/i.test(a))&&
r.unshift("32-bit")):y&&/^OS X/.test(y.family)&&"Chrome"==v&&39<=parseFloat(q)&&(y.architecture=64);a||(a=null);f={};f.description=a;f.layout=E&&E[0];f.manufacturer=T;f.name=v;f.prerelease=C;f.product=F;f.ua=a;f.version=v&&q;f.os=y||{architecture:null,family:null,version:null,toString:function(){return"null"}};f.parse=h;f.toString=function(){return this.description||""};f.version&&r.unshift(q);f.name&&r.unshift(v);y&&v&&(y!=String(y).split(" ")[0]||y!=v.split(" ")[0]&&!F)&&r.push(F?"("+y+")":"on "+
y);r.length&&(f.description=r.join(" "));return f}var f={"function":!0,object:!0},t=f[typeof window]&&window||this,l=f[typeof exports]&&exports;f=f[typeof module]&&module&&!module.nodeType&&module;var r=l&&f&&"object"==typeof global&&global;!r||r.global!==r&&r.window!==r&&r.self!==r||(t=r);var q=Math.pow(2,53)-1,z=/\bOpera/;r=Object.prototype;var A=r.hasOwnProperty,x=r.toString,p=h();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t.platform=p,define(function(){return p})):l&&
f?g(p,function(a,b){l[b]=a}):t.platform=p}).call(this);
function buildIOSMeta(){for(var a=[{name:"viewport",content:"width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"black"}],c=0;c<a.length;c++){var b=document.createElement("meta");b.name=a[c].name;b.content=a[c].content;var g=window.document.head.querySelector('meta[name="'+b.name+'"]');g&&g.parentNode.removeChild(g);window.document.head.appendChild(b)}}
function hideIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","none");jQuery(".xxx-ios-fullscreen-scroll").css("display","none");jQuery(".xxx-game-iframe-full").removeClass("xxx-game-iframe-iphone-se")}function buildIOSFullscreenPanel(){jQuery("body").append('<div class="xxx-ios-fullscreen-message"><div class="xxx-ios-fullscreen-swipe"></div></div><div class="xxx-ios-fullscreen-scroll"></div>')}
function showIOSFullscreenPanel(){jQuery(".xxx-ios-fullscreen-message").css("display","block");jQuery(".xxx-ios-fullscreen-scroll").css("display","block")}
function __iosResize(){window.scrollTo(0,0);console.log(window.devicePixelRatio);console.log(window.innerWidth);console.log(window.innerHeight);if("iPhone"===platform.product)switch(window.devicePixelRatio){case 2:switch(window.innerWidth){case 568:320!==window.innerHeight&&jQuery(".xxx-game-iframe-full").addClass("xxx-game-iframe-iphone-se");break;case 667:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();
break;default:hideIOSFullscreenPanel()}break;case 3:switch(window.innerWidth){case 736:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 724:375===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;case 808:414===window.innerHeight?hideIOSFullscreenPanel():showIOSFullscreenPanel();break;default:hideIOSFullscreenPanel()}break;default:hideIOSFullscreenPanel()}}function iosResize(){__iosResize();setTimeout(function(){__iosResize()},500)}
function iosInIframe(){try{return window.self!==window.top}catch(a){return!0}}function isIOSLessThen13(){var a=platform.os,c=a.family.toLowerCase();a=parseFloat(a.version);return"ios"===c&&13>a?!0:!1}$(document).ready(function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&(buildIOSFullscreenPanel(),buildIOSMeta())});
jQuery(window).resize(function(){platform&&"iPhone"===platform.product&&"safari"===platform.name.toLowerCase()&&isIOSLessThen13()&&!iosInIframe()&&iosResize()});var s_iScaleFactor=1,s_iOffsetX,s_iOffsetY,s_bIsIphone=!1;
(function(a){(jQuery.browser=jQuery.browser||{}).mobile=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(a.substr(0,
4))})(navigator.userAgent||navigator.vendor||window.opera);$(window).resize(function(){sizeHandler()});function trace(a){console.log(a)}
function getSize(a){var c=a.toLowerCase(),b=window.document,g=b.documentElement;if(void 0===window["inner"+a])a=g["client"+a];else if(window["inner"+a]!=g["client"+a]){var e=b.createElement("body");e.id="vpw-test-b";e.style.cssText="overflow:scroll";var d=b.createElement("div");d.id="vpw-test-d";d.style.cssText="position:absolute;top:-1000px";d.innerHTML="<style>@media("+c+":"+g["client"+a]+"px){body#vpw-test-b div#vpw-test-d{"+c+":7px!important}}</style>";e.appendChild(d);g.insertBefore(e,b.head);
a=7==d["offset"+a]?g["client"+a]:window["inner"+a];g.removeChild(e)}else a=window["inner"+a];return a}window.addEventListener("orientationchange",onOrientationChange);function onOrientationChange(){window.matchMedia("(orientation: portrait)").matches&&sizeHandler();window.matchMedia("(orientation: landscape)").matches&&sizeHandler()}function isEdge(){return-1<window.navigator.userAgent.indexOf("Edge")}function isExplorer(){return"undefined"!==typeof document&&!!document.documentMode&&!isEdge()}
function isSafari(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function isFirefox(){return"undefined"!==typeof window.InstallTrigger}function isChrome(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function isMobile(){return isIpad()?!0:jQuery.browser.mobile}function isIpad(){var a=-1!==navigator.userAgent.toLowerCase().indexOf("ipad");return!a&&navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&2<navigator.maxTouchPoints?!0:a}
function isIOS(){var a="iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";");for(-1!==navigator.userAgent.toLowerCase().indexOf("iphone")&&(s_bIsIphone=!0);a.length;)if(navigator.platform===a.pop())return!0;return s_bIsIphone=!1}function getIOSWindowHeight(){return document.documentElement.clientWidth/window.innerWidth*window.innerHeight}function getHeightOfIOSToolbars(){var a=(0===window.orientation?screen.height:screen.width)-getIOSWindowHeight();return 1<a?a:0}
function sizeHandler(){window.scrollTo(0,1);if($("#canvas")){var a="safari"===platform.name.toLowerCase()?getIOSWindowHeight():getSize("Height");var c=getSize("Width");_checkOrientation(c,a);var b=Math.min(a/CANVAS_HEIGHT,c/CANVAS_WIDTH),g=Math.round(CANVAS_WIDTH*b);b=Math.round(CANVAS_HEIGHT*b);if(b<a){var e=a-b;b+=e;g+=CANVAS_WIDTH/CANVAS_HEIGHT*e}else g<c&&(e=c-g,g+=e,b+=CANVAS_HEIGHT/CANVAS_WIDTH*e);e=a/2-b/2;var d=c/2-g/2,k=CANVAS_WIDTH/g;if(d*k<-EDGEBOARD_X||e*k<-EDGEBOARD_Y)b=Math.min(a/(CANVAS_HEIGHT-
2*EDGEBOARD_Y),c/(CANVAS_WIDTH-2*EDGEBOARD_X)),g=Math.round(CANVAS_WIDTH*b),b=Math.round(CANVAS_HEIGHT*b),e=(a-b)/2,d=(c-g)/2,k=CANVAS_WIDTH/g;s_iOffsetX=-1*d*k;s_iOffsetY=-1*e*k;0<=e&&(s_iOffsetY=0);0<=d&&(s_iOffsetX=0);null!==s_oInterface&&s_oInterface.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oWorldMenu&&s_oWorldMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);null!==s_oMenu&&s_oMenu.refreshButtonPos(s_iOffsetX,s_iOffsetY);s_bIsIphone?(canvas=document.getElementById("canvas"),s_oStage.canvas.width=
2*g,s_oStage.canvas.height=2*b,canvas.style.width=g+"px",canvas.style.height=b+"px",s_iScaleFactor=2*Math.min(g/CANVAS_WIDTH,b/CANVAS_HEIGHT),s_oStage.scaleX=s_oStage.scaleY=s_iScaleFactor):s_bMobile||isChrome()?($("#canvas").css("width",g+"px"),$("#canvas").css("height",b+"px")):(s_oStage.canvas.width=g,s_oStage.canvas.height=b,s_iScaleFactor=Math.min(g/CANVAS_WIDTH,b/CANVAS_HEIGHT),s_oStage.scaleX=s_oStage.scaleY=s_iScaleFactor);0>e||(e=(a-b)/2);$("#canvas").css("top",e+"px");$("#canvas").css("left",
d+"px");fullscreenHandler()}}
function _checkOrientation(a,c){s_bMobile&&ENABLE_CHECK_ORIENTATION&&(a>c?"landscape"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),s_oMain.stopUpdate()):"portrait"===$(".orientation-msg-container").attr("data-orientation")?($(".orientation-msg-container").css("display","none"),s_oMain.startUpdate()):($(".orientation-msg-container").css("display","block"),
s_oMain.stopUpdate()))}function playSound(a,c,b){return!1===DISABLE_SOUND_MOBILE||!1===s_bMobile?(s_aSounds[a].play(),s_aSounds[a].volume(c),s_aSounds[a].loop(b),s_aSounds[a]):null}function stopSound(a){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||a.stop()}function setVolume(a,c){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||a.volume(c)}function setMute(a,c){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||a.mute(c)}function fadeSound(a,c,b,g){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||a.fade(c,b,g)}
function soundPlaying(a){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)return a.playing()}function soundSeek(a,c){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)return a.seek(c)}function soundDuration(a){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)return a.duration()}function createBitmap(a,c,b){var g=new createjs.Bitmap(a),e=new createjs.Shape;c&&b?e.graphics.beginFill("#fff").drawRect(0,0,c,b):e.graphics.beginFill("#ff0").drawRect(0,0,a.width,a.height);g.hitArea=e;return g}
function createSprite(a,c,b,g,e,d){a=null!==c?new createjs.Sprite(a,c):new createjs.Sprite(a);c=new createjs.Shape;c.graphics.beginFill("#000000").drawRect(-b,-g,e,d);a.hitArea=c;return a}
function shadeBlend(a,c,b){var g=0>a?-1*a:a,e=Math.round,d=parseInt;if(7<c.length){c=c.split(",");a=(b?b:0>a?"rgb(0,0,0)":"rgb(255,255,255)").split(",");b=d(c[0].slice(4));var k=d(c[1]);c=d(c[2]);return"rgb("+(e((d(a[0].slice(4))-b)*g)+b)+","+(e((d(a[1])-k)*g)+k)+","+(e((d(a[2])-c)*g)+c)+")"}c=d(c.slice(1),16);a=d((b?b:0>a?"#000000":"#FFFFFF").slice(1),16);d=c>>16;b=c>>8&255;c&=255;return"#"+(16777216+65536*(e(((a>>16)-d)*g)+d)+256*(e(((a>>8&255)-b)*g)+b)+(e(((a&255)-c)*g)+c)).toString(16).slice(1)}
function pad(a,c,b){a+="";return a.length>=c?a:Array(c-a.length+1).join(b||"0")+a}function randomFloatBetween(a,c,b){"undefined"===typeof b&&(b=2);return parseFloat(Math.min(a+Math.random()*(c-a),c).toFixed(b))}function rotateVector2D(a,c){var b=c.getX()*Math.cos(a)+c.getY()*Math.sin(a),g=c.getX()*-Math.sin(a)+c.getY()*Math.cos(a);c.set(b,g)}function tweenVectorsOnX(a,c,b){return a+b*(c-a)}function linearFunction(a,c,b,g,e){return(a-c)*(e-g)/(b-c)+g}
function shuffle(a){for(var c=a.length,b,g;0!==c;)g=Math.floor(Math.random()*c),--c,b=a[c],a[c]=a[g],a[g]=b;return a}function bubbleSort(a){do{var c=!1;for(var b=0;b<a.length-1;b++)a[b]>a[b+1]&&(c=a[b],a[b]=a[b+1],a[b+1]=c,c=!0)}while(c)}function compare(a,c){return a.index>c.index?-1:a.index<c.index?1:0}function easeLinear(a,c,b,g){return b*a/g+c}function easeInQuad(a,c,b,g){return b*(a/=g)*a+c}function easeInSine(a,c,b,g){return-b*Math.cos(a/g*(Math.PI/2))+b+c}
function easeInCubic(a,c,b,g){return b*(a/=g)*a*a+c}function easeInBack(a,c,b,g){return b*(a/=g)*a*(2.70158*a-1.70158)+c}function easeOutBack(a,c,b,g){return b*((a=a/g-1)*a*(2.70158*a+1.70158)+1)+c}function easeOutElastic(a,c,b,g){if(0===a)return c;if(1===(a/=g))return c+b;var e=.3*g;return b*Math.pow(2,-10*a)*Math.sin(2*(a*g-e/4)*Math.PI/e)+b+c}function easeBackInQuart(a,c,b,g){g=(a/=g)*a;return c+b*(2*g*g+2*g*a+-3*g)}
function getTrajectoryPoint(a,c){var b=new createjs.Point,g=(1-a)*(1-a),e=a*a;b.x=g*c.start.x+2*(1-a)*a*c.traj.x+e*c.end.x;b.y=g*c.start.y+2*(1-a)*a*c.traj.y+e*c.end.y;return b}function formatTime(a){a/=1E3;var c=Math.floor(a/60);a=parseFloat(a-60*c).toFixed(1);var b="";b=10>c?b+("0"+c+":"):b+(c+":");return 10>a?b+("0"+a):b+a}function degreesToRadians(a){return a*Math.PI/180}function checkRectCollision(a,c){var b=getBounds(a,.9);var g=getBounds(c,.98);return calculateIntersection(b,g)}
function calculateIntersection(a,c){var b,g,e,d;var k=a.x+(b=a.width/2);var m=a.y+(g=a.height/2);var h=c.x+(e=c.width/2);var f=c.y+(d=c.height/2);k=Math.abs(k-h)-(b+e);m=Math.abs(m-f)-(g+d);return 0>k&&0>m?(k=Math.min(Math.min(a.width,c.width),-k),m=Math.min(Math.min(a.height,c.height),-m),{x:Math.max(a.x,c.x),y:Math.max(a.y,c.y),width:k,height:m,rect1:a,rect2:c}):null}
function getBounds(a,c){var b={x:Infinity,y:Infinity,width:0,height:0};if(a instanceof createjs.Container){b.x2=-Infinity;b.y2=-Infinity;var g=a.children,e=g.length,d;for(d=0;d<e;d++){var k=getBounds(g[d],1);k.x<b.x&&(b.x=k.x);k.y<b.y&&(b.y=k.y);k.x+k.width>b.x2&&(b.x2=k.x+k.width);k.y+k.height>b.y2&&(b.y2=k.y+k.height)}Infinity==b.x&&(b.x=0);Infinity==b.y&&(b.y=0);Infinity==b.x2&&(b.x2=0);Infinity==b.y2&&(b.y2=0);b.width=b.x2-b.x;b.height=b.y2-b.y;delete b.x2;delete b.y2}else{if(a instanceof createjs.Bitmap){e=
a.sourceRect||a.image;d=e.width*c;var m=e.height*c}else if(a instanceof createjs.Sprite)if(a.spriteSheet._frames&&a.spriteSheet._frames[a.currentFrame]&&a.spriteSheet._frames[a.currentFrame].image){e=a.spriteSheet.getFrame(a.currentFrame);d=e.rect.width;m=e.rect.height;g=e.regX;var h=e.regY}else b.x=a.x||0,b.y=a.y||0;else b.x=a.x||0,b.y=a.y||0;g=g||0;d=d||0;h=h||0;m=m||0;b.regX=g;b.regY=h;e=a.localToGlobal(0-g,0-h);k=a.localToGlobal(d-g,m-h);d=a.localToGlobal(d-g,0-h);g=a.localToGlobal(0-g,m-h);b.x=
Math.min(Math.min(Math.min(e.x,k.x),d.x),g.x);b.y=Math.min(Math.min(Math.min(e.y,k.y),d.y),g.y);b.width=Math.max(Math.max(Math.max(e.x,k.x),d.x),g.x)-b.x;b.height=Math.max(Math.max(Math.max(e.y,k.y),d.y),g.y)-b.y}return b}function NoClickDelay(a){this.element=a;window.Touch&&this.element.addEventListener("touchstart",this,!1)}function shuffle(a){for(var c=a.length,b,g;0<c;)g=Math.floor(Math.random()*c),c--,b=a[c],a[c]=a[g],a[g]=b;return a}
NoClickDelay.prototype={handleEvent:function(a){switch(a.type){case "touchstart":this.onTouchStart(a);break;case "touchmove":this.onTouchMove(a);break;case "touchend":this.onTouchEnd(a)}},onTouchStart:function(a){a.preventDefault();this.moved=!1;this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1)},onTouchMove:function(a){this.moved=!0},onTouchEnd:function(a){this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",
this,!1);if(!this.moved){a=document.elementFromPoint(a.changedTouches[0].clientX,a.changedTouches[0].clientY);3==a.nodeType&&(a=a.parentNode);var c=document.createEvent("MouseEvents");c.initEvent("click",!0,!0);a.dispatchEvent(c)}}};
(function(){function a(a){var b={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};a=a||window.event;a.type in b?document.body.className=b[a.type]:(document.body.className=this[c]?"hidden":"visible","hidden"===document.body.className?s_oMain.stopUpdate():s_oMain.startUpdate())}var c="hidden";c in document?document.addEventListener("visibilitychange",a):(c="mozHidden")in document?document.addEventListener("mozvisibilitychange",a):(c="webkitHidden")in
document?document.addEventListener("webkitvisibilitychange",a):(c="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?document.onfocusin=document.onfocusout=a:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=a})();function ctlArcadeResume(){null!==s_oMain&&s_oMain.startUpdate()}function ctlArcadePause(){null!==s_oMain&&s_oMain.stopUpdate()}
function getParamValue(a){for(var c=window.location.search.substring(1).split("&"),b=0;b<c.length;b++){var g=c[b].split("=");if(g[0]==a)return g[1]}}
var Util={timestamp:function(){return(new Date).getTime()},toInt:function(a,c){if(null!==a){var b=parseInt(a,10);if(!isNaN(b))return b}return Util.toInt(c,0)},toFloat:function(a,c){if(null!==a){var b=parseFloat(a);if(!isNaN(b))return b}return Util.toFloat(c,0)},limit:function(a,c,b){return Math.max(c,Math.min(a,b))},randomInt:function(a,c){return Math.round(Util.interpolate(a,c,Math.random()))},randomChoice:function(a){return a[Util.randomInt(0,a.length-1)]},percentRemaining:function(a,c){return a%
c/c},accelerate:function(a,c,b){return a+c*b},interpolate:function(a,c,b){return a+(c-a)*b},easeIn:function(a,c,b){return a+(c-a)*Math.pow(b,2)},easeOut:function(a,c,b){return a+(c-a)*(1-Math.pow(1-b,2))},easeInOut:function(a,c,b){return a+(c-a)*(-Math.cos(b*Math.PI)/2+.5)},exponentialFog:function(a,c){return 1/Math.pow(Math.E,a*a*c)},increase:function(a,c,b){for(a+=c;a>=b;)a-=b;for(;0>a;)a+=b;return a},project:function(a,c,b,g,e){a.camera.x=-c;a.camera.y=a.world.y-b;a.camera.z=a.world.z-g;a.screen.scale=
e/a.camera.z;a.screen.x=Math.round(HALF_CANVAS_WIDTH+a.screen.scale*a.camera.x*HALF_CANVAS_WIDTH);a.screen.y=Math.round(HALF_CANVAS_HEIGHT-a.screen.scale*a.camera.y*HALF_CANVAS_HEIGHT);a.screen.w=Math.round(a.screen.scale*ROAD_PER_HALF_CANVAS_WIDTH);a.backup.y=Math.round(HALF_CANVAS_HEIGHT-a.screen.scale*-b*HALF_CANVAS_HEIGHT)},overlap:function(a,c,b,g,e){e=.5*(e||1);return!(a+c*e<b-g*e||a-c*e>b+g*e)}};
function fullscreenHandler(){ENABLE_FULLSCREEN&&screenfull.isEnabled&&(s_bFullscreen=screenfull.isFullscreen,null!==s_oInterface&&s_oInterface.resetFullscreenBut(),null!==s_oWorldMenu&&s_oWorldMenu.resetFullscreenBut(),null!==s_oMenu&&s_oMenu.resetFullscreenBut())}if(screenfull.isEnabled)screenfull.on("change",function(){s_bFullscreen=screenfull.isFullscreen;null!==s_oInterface&&s_oInterface.resetFullscreenBut();null!==s_oWorldMenu&&s_oWorldMenu.resetFullscreenBut();null!==s_oMenu&&s_oMenu.resetFullscreenBut()});
function CSpriteLibrary(){var a={},c,b,g,e,d,k;this.init=function(a,h,f){c={};g=b=0;e=a;d=h;k=f};this.addSprite=function(d,h){if(!a.hasOwnProperty(d)){var m=new Image;a[d]=c[d]={szPath:h,oSprite:m,bLoaded:!1};b++}};this.getSprite=function(b){return a.hasOwnProperty(b)?a[b].oSprite:null};this._onSpritesLoaded=function(){b=0;d.call(k)};this._onSpriteLoaded=function(){e.call(k);++g===b&&this._onSpritesLoaded()};this.loadSprites=function(){for(var a in c)c[a].oSprite.oSpriteLibrary=this,c[a].oSprite.szKey=
a,c[a].oSprite.onload=function(){this.oSpriteLibrary.setLoaded(this.szKey);this.oSpriteLibrary._onSpriteLoaded(this.szKey)},c[a].oSprite.onerror=function(a){var b=a.currentTarget;setTimeout(function(){c[b.szKey].oSprite.src=c[b.szKey].szPath},500)},c[a].oSprite.src=c[a].szPath};this.setLoaded=function(b){a[b].bLoaded=!0};this.isLoaded=function(b){return a[b].bLoaded};this.getNumSprites=function(){return b}}
CTLText.prototype={constructor:CTLText,__autofit:function(){if(this._bFitText){for(var a=this._iFontSize;(this._oText.getBounds().height>this._iHeight-2*this._iPaddingV||this._oText.getBounds().width>this._iWidth-2*this._iPaddingH)&&!(a--,this._oText.font=a+"px "+this._szFont,this._oText.lineHeight=Math.round(a*this._fLineHeightFactor),this.__updateY(),this.__verticalAlign(),8>a););this._iFontSize=a}},__verticalAlign:function(){if(this._bVerticalAlign){var a=this._oText.getBounds().height;this._oText.y-=
(a-this._iHeight)/2+this._iPaddingV}},__updateY:function(){this._oText.y=this._y+this._iPaddingV;switch(this._oText.textBaseline){case "middle":this._oText.y+=this._oText.lineHeight/2+(this._iFontSize*this._fLineHeightFactor-this._iFontSize)}},__createText:function(a){this._bDebug&&(this._oDebugShape=new createjs.Shape,this._oDebugShape.graphics.beginFill("rgba(255,0,0,0.5)").drawRect(this._x,this._y,this._iWidth,this._iHeight),this._oContainer.addChild(this._oDebugShape));this._oText=new createjs.Text(a,
this._iFontSize+"px "+this._szFont,this._szColor);this._oText.textBaseline="middle";this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this._oText.textAlign=this._szAlign;this._oText.lineWidth=this._bMultiline?this._iWidth-2*this._iPaddingH:null;switch(this._szAlign){case "center":this._oText.x=this._x+this._iWidth/2;break;case "left":this._oText.x=this._x+this._iPaddingH;break;case "right":this._oText.x=this._x+this._iWidth-this._iPaddingH}this._oContainer.addChild(this._oText);
this.refreshText(a)},setVerticalAlign:function(a){this._bVerticalAlign=a},setOutline:function(a){null!==this._oText&&(this._oText.outline=a)},setShadow:function(a,c,b,g){null!==this._oText&&(this._oText.shadow=new createjs.Shadow(a,c,b,g))},setColor:function(a){this._oText.color=a},setAlpha:function(a){this._oText.alpha=a},removeTweens:function(){createjs.Tween.removeTweens(this._oText)},getText:function(){return this._oText},getString:function(){return this._oText.text},getY:function(){return this._y},
getFontSize:function(){return this._iFontSize},refreshText:function(a){""===a&&(a=" ");null===this._oText&&this.__createText(a);this._oText.text=a;this._oText.font=this._iFontSize+"px "+this._szFont;this._oText.lineHeight=Math.round(this._iFontSize*this._fLineHeightFactor);this.__autofit();this.__updateY();this.__verticalAlign()}};
function CTLText(a,c,b,g,e,d,k,m,h,f,t,l,r,q,z,A,x){this._oContainer=a;this._x=c;this._y=b;this._iWidth=g;this._iHeight=e;this._bMultiline=A;this._iFontSize=d;this._szAlign=k;this._szColor=m;this._szFont=h;this._iPaddingH=t;this._iPaddingV=l;this._bVerticalAlign=z;this._bFitText=q;this._bDebug=x;this._oDebugShape=null;this._fLineHeightFactor=f;this._oText=null;r&&this.__createText(r)}
var SCALE_FACTOR=1,CANVAS_WIDTH=1600*SCALE_FACTOR,CANVAS_HEIGHT=960*SCALE_FACTOR,EDGEBOARD_X=256*SCALE_FACTOR,EDGEBOARD_Y=100*SCALE_FACTOR,FPS=60,FPS_DT=1/FPS,FPS_TIME=1E3/FPS,DISABLE_SOUND_MOBILE=!1,GAME_NAME="watercraft_rush",PRIMARY_FONT="ArialBold",SECONDARY_FONT="Digital",PRIMARY_FONT_COLOUR="#f14e00",STATE_LOADING=0,STATE_MENU=1,STATE_HELP=1,STATE_GAME=3,ON_MOUSE_DOWN=0,ON_MOUSE_UP=1,ON_MOUSE_OVER=2,ON_MOUSE_OUT=3,ON_DRAG_START=4,ON_DRAG_END=5,STATE_GAME_START=0,STATE_GAME_RACE=1,STATE_GAME_END=
2,KEY_UP=38,KEY_DOWN=40,KEY_RIGHT=39,KEY_LEFT=37,KEY_SPACE=32,ROTATE_LEFT=0,ROTATE_RIGHT=1,ROTATE_CENTER=2,NUM_WORLDS=3,NUM_TRACKS_PER_WORLD=3,START_COUNTDOWN=3E3,FOV=100,CAMERA_HEIGHT=1E3,CAMERA_DEPTH=1/Math.tan(FOV/2*Math.PI/180),PLAYER_Z_FROMCAMERA=CAMERA_HEIGHT*CAMERA_DEPTH,CAR_SIDEVIEW_OFFSET=.2,CAR_FARVIEW_OFFSET=2600,CAR_CURVEVIEW_OFFSET=.4,FRAMESPEED_ROTATION=100,MAX_ROTATION=5,PARALLAX_RATIO_X=2,PARALLAX_RATIO_Y_0=.004,PARALLAX_RATIO_Y_1=.005,PLAYER_MAX_SPEED,PLAYER_ACCELERATION,PLAYER_DECELERATION,
PLAYER_REAL_MAX_SPEED,CENTRIFUGAL_FORCE=.3,PLAYER_COLLIDER_WIDTH=.15,PLAYER_MIN_SPEED_DAMAGE,TERRAIN_MAX_INERTIA=.03,TERRAIN_INCREASE_INERTIA=.005,TERRAIN_DECREASE_INERTIA=.002,TERRAIN_ADHERENCE=1,TIDE_SPEED=100,MAX_TIDE_HEIGHT=1E3,TIDE_RAISE_HEIGHT_SPEED=10,TIDE_BASE_FREQUENCY=2500,TIDE_VARIABLE_FREQUENCY,TIDE_VARIABLE_HEIGHT,DRAW_DISTANCE=300,ROAD_WIDTH=2E3,NUM_LANES=4,SEGMENT_LENGTH=400,RUMBLE_LENGTH=1,TRACK_LENGTH,ROAD_BOUNDS=2,FOG_DENSITY=5,ROAD={TYPE:{STANDARD:0,CURVE_S:1,BUMPS:2,FINAL:3},LENGTH:{NONE:0,
SHORT:25,MEDIUM:50,LONG:100,EXTRALONG:200},HILL:{NONE:0,LOW:20,MEDIUM:40,HIGH:60,VERYHIGH:80},CURVE:{NONE:0,EASY:2,MEDIUM:4,HARD:6,VERYHARD:8}},AMBIENT={DISPOSITION:{PRECISE:0,DENSITY:1},SIDE:{LEFT:-1,RIGHT:1,BOTH:2}},COLORS={LIGHT:{road:"#5bbbff",grass:"#96a54b",rumble:"#555555",lane:"#CCCCCC"},DARK:{road:"#5bbbff",grass:"#7e8b3e",rumble:"#BBBBBB"},START:{road:"#5bbbff",grass:"#5bbbff",rumble:"#5bbbff"},FINISH:{road:"#5bbbff",grass:"#5bbbff",rumble:"#5bbbff"}},SPRITES={BUOY0:{name:"buoy_0",collision:{width:50}},
BUOY1:{name:"buoy_1",collision:{width:50}},BUOY2:{name:"buoy_2",collision:{width:50}},BUOY3:{name:"buoy_3",collision:{width:50}},BOAT0:{name:"boat_0",collision:{width:50}},BOAT1:{name:"boat_1",collision:{width:50}},BOAT2:{name:"boat_2"},BOAT3:{name:"boat_3",collision:{width:50}},BOAT4:{name:"boat_4",collision:{width:50}},BOAT5:{name:"boat_5"},TREE1:{name:"tree1",collision:{width:50}},TREE2:{name:"tree2",collision:{center:170,width:140}},BUSH1:{name:"bush1",collision:{width:50}},PALM_TREE:{name:"palm_tree",
collision:{center:156,width:6}},BILLBOARD01:{name:"billboard01"},BILLBOARD02:{name:"billboard02"},BILLBOARD03:{name:"billboard03"},BILLBOARD04:{name:"billboard04"},BILLBOARD05:{name:"billboard05"},ENEMY01:{name:"enemy01"},ENEMY02:{name:"enemy02"},ENEMY03:{name:"enemy03"},SCALE:6.8E-4};SPRITES.BILLBOARDS=[SPRITES.BILLBOARD01.name,SPRITES.BILLBOARD02.name,SPRITES.BILLBOARD03.name,SPRITES.BILLBOARD04.name,SPRITES.BILLBOARD05.name];
SPRITES.BOATS=[SPRITES.BOAT0.name,SPRITES.BOAT1.name,SPRITES.BOAT2.name,SPRITES.BOAT3.name,SPRITES.BOAT4.name,SPRITES.BOAT5.name];SPRITES.ENEMIES=[SPRITES.ENEMY01.name,SPRITES.ENEMY02.name,SPRITES.ENEMY03.name];
var HALF_CANVAS_WIDTH=CANVAS_WIDTH/2,HALF_CANVAS_HEIGHT=CANVAS_HEIGHT/2,ROAD_PER_HALF_CANVAS_WIDTH=HALF_CANVAS_WIDTH*ROAD_WIDTH,ROAD_PER_SCALE_PER_HALF_CANVAS_WIDTH=SPRITES.SCALE*ROAD_PER_HALF_CANVAS_WIDTH,PLAYER_SPEED_CONVERSION_RATIO=PLAYER_REAL_MAX_SPEED/PLAYER_MAX_SPEED,ENABLE_FULLSCREEN,ENABLE_CHECK_ORIENTATION,POINTS_PER_SECONDS,AD_SHOW_COUNTER;TEXT_PRELOADER_CONTINUE="START";TEXT_GAMEOVER="CONGRATULATION! YOU COMPLETED ALL TRACKS!";TEXT_TIME_IS_UP="TIME IS UP!";TEXT_SCORE="SCORE";TEXT_GO="GO!";
TEXT_SPEED_INDICATOR="Km/h";TEXT_SAVE_REMOVE="THIS WILL REMOVE ALL YOUR ACHIEVEMENTS! DO YOU WANT TO PROCEED?";TEXT_ARE_SURE="ARE YOU SURE?";TEXT_TRACK_COMPLETED="TRACK COMPLETED";TEXT_SELECT_WORLD="SELECT THE WORLD YOU WANT TO PLAY";TEXT_SELECT_TRACK="SELECT TRACK";TEXT_HELP1="USE ARROW KEY TO MOVE THE WATERCRAFT: UP FOR ACCELERATION AND DOWN FOR BRAKE";TEXT_HELP1_MOBILE="USE BUTTONS TO MOVE THE WATERCRAFT";TEXT_HELP2="REACH THE END, BEFORE TIME GOES UP";TEXT_IOS_PRIVATE='Your web browser does not support storing settings locally. In Safari, the most common cause of this is using "Private Browsing Mode". Some info may not save or some features may not work properly';
TEXT_SHARE_IMAGE="200x200.jpg";TEXT_SHARE_TITLE="Congratulations!";TEXT_SHARE_MSG1="You collected <strong>";TEXT_SHARE_MSG2=" points</strong>!<br><br>Share your score with your friends!";TEXT_SHARE_SHARE1="My score is ";TEXT_SHARE_SHARE2=" points! Can you do better";
function CPreloader(){var a,c,b,g,e,d,k,m,h,f;this._init=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("progress_bar","./sprites/progress_bar.png");s_oSpriteLibrary.addSprite("200x200","./sprites/200x200.jpg");s_oSpriteLibrary.addSprite("but_start","./sprites/but_start.png");s_oSpriteLibrary.loadSprites();f=new createjs.Container;s_oStage.addChild(f)};this.unload=function(){f.removeAllChildren();h.unload()};this._onImagesLoaded=function(){};
this._onAllImagesLoaded=function(){this.attachSprites();s_oMain.preloaderReady()};this.attachSprites=function(){var t=new createjs.Shape;t.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);f.addChild(t);t=s_oSpriteLibrary.getSprite("200x200");k=createBitmap(t);k.regX=.5*t.width;k.regY=.5*t.height;k.x=CANVAS_WIDTH/2;k.y=CANVAS_HEIGHT/2-180;f.addChild(k);m=new createjs.Shape;m.graphics.beginFill("rgba(0,0,0,0.01)").drawRoundRect(k.x-100,k.y-100,200,200,10);f.addChild(m);k.mask=m;
t=s_oSpriteLibrary.getSprite("progress_bar");g=createBitmap(t);g.x=CANVAS_WIDTH/2-t.width/2;g.y=CANVAS_HEIGHT/2+50;f.addChild(g);a=t.width;c=t.height;e=new createjs.Shape;e.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(g.x,g.y,1,c);f.addChild(e);g.mask=e;b=new createjs.Text("","30px "+PRIMARY_FONT,"#FFFFFF");b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT/2+100;b.textBaseline="alphabetic";b.textAlign="center";f.addChild(b);t=s_oSpriteLibrary.getSprite("but_start");h=new CTextButton(CANVAS_WIDTH/2,CANVAS_HEIGHT/
2,t,TEXT_PRELOADER_CONTINUE,"Arial","#000","bold 50",f);h.addEventListener(ON_MOUSE_UP,this._onButStartRelease,this);h.setVisible(!1);d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);f.addChild(d);createjs.Tween.get(d).to({alpha:0},500).call(function(){createjs.Tween.removeTweens(d);f.removeChild(d)})};this._onButStartRelease=function(){s_oMain._onRemovePreloader()};this.refreshLoader=function(d){b.text=d+"%";100===d&&(b.visible=!1,g.visible=!1,s_oMain._onRemovePreloader());
e.graphics.clear();d=Math.floor(d*a/100);e.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(g.x,g.y,d,c)};this._init()}
function CMain(a){var c,b=0,g=0,e=STATE_LOADING,d,k;this.initContainer=function(){s_oCanvas=document.getElementById("canvas");s_oStage=new createjs.Stage(s_oCanvas);s_oStage.preventSelection=!1;createjs.Touch.enable(s_oStage);s_bMobile=isMobile();!1===s_bMobile&&(s_oStage.enableMouseOver(20),$("body").on("contextmenu","#canvas",function(a){return!1}));s_iPrevTime=(new Date).getTime();createjs.Ticker.addEventListener("tick",this._update);createjs.Ticker.framerate=FPS;navigator.userAgent.match(/Windows Phone/i)&&
(DISABLE_SOUND_MOBILE=!0);s_oSpriteLibrary=new CSpriteLibrary;d=new CPreloader;s_oLocalStorage=new CLocalStorage(GAME_NAME)};this.preloaderReady=function(){this._loadImages();!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||this._initSounds();c=!0};this.soundLoaded=function(){b++;d.refreshLoader(Math.floor(b/g*100))};this._initSounds=function(){Howler.mute(!s_bAudioActive);s_aSoundsInfo=[];s_aSoundsInfo.push({path:"./sounds/",filename:"menu_soundtrack",loop:!0,volume:1,ingamename:"menu_soundtrack"});s_aSoundsInfo.push({path:"./sounds/",
filename:"game_soundtrack",loop:!0,volume:1,ingamename:"game_soundtrack"});s_aSoundsInfo.push({path:"./sounds/",filename:"press_button",loop:!1,volume:1,ingamename:"click"});s_aSoundsInfo.push({path:"./sounds/",filename:"1",loop:!1,volume:1,ingamename:"1"});s_aSoundsInfo.push({path:"./sounds/",filename:"2",loop:!1,volume:1,ingamename:"2"});s_aSoundsInfo.push({path:"./sounds/",filename:"3",loop:!1,volume:1,ingamename:"3"});s_aSoundsInfo.push({path:"./sounds/",filename:"go",loop:!1,volume:1,ingamename:"go"});
s_aSoundsInfo.push({path:"./sounds/",filename:"arrive_lose",loop:!1,volume:1,ingamename:"arrive_lose"});s_aSoundsInfo.push({path:"./sounds/",filename:"arrive_win",loop:!1,volume:1,ingamename:"arrive_win"});s_aSoundsInfo.push({path:"./sounds/",filename:"crash",loop:!1,volume:1,ingamename:"crash"});s_aSoundsInfo.push({path:"./sounds/",filename:"brake",loop:!1,volume:1,ingamename:"brake"});s_aSoundsInfo.push({path:"./sounds/",filename:"engine",loop:!0,volume:1,ingamename:"engine"});s_aSoundsInfo.push({path:"./sounds/",
filename:"engine_stall",loop:!0,volume:1,ingamename:"engine_stall"});s_aSoundsInfo.push({path:"./sounds/",filename:"engine_reverse",loop:!0,volume:1,ingamename:"engine_reverse"});s_aSoundsInfo.push({path:"./sounds/",filename:"landing",loop:!0,volume:1,ingamename:"landing"});g+=s_aSoundsInfo.length;s_aSounds=[];for(var a=0;a<s_aSoundsInfo.length;a++)this.tryToLoadSound(s_aSoundsInfo[a],!1)};this.tryToLoadSound=function(a,b){setTimeout(function(){s_aSounds[a.ingamename]=new Howl({src:[a.path+a.filename+
".mp3"],autoplay:!1,preload:!0,loop:a.loop,volume:a.volume,onload:s_oMain.soundLoaded,onloaderror:function(a,b){for(var c=0;c<s_aSoundsInfo.length;c++)if(a===s_aSounds[s_aSoundsInfo[c].ingamename]._sounds[0]._id){s_oMain.tryToLoadSound(s_aSoundsInfo[c],!0);break}},onplayerror:function(a){for(var b=0;b<s_aSoundsInfo.length;b++)if(a===s_aSounds[s_aSoundsInfo[b].ingamename]._sounds[0]._id){s_aSounds[s_aSoundsInfo[b].ingamename].once("unlock",function(){s_aSounds[s_aSoundsInfo[b].ingamename].play();"soundtrack"===
s_aSoundsInfo[b].ingamename&&null!==s_oGame&&setVolume("soundtrack",SOUNDTRACK_VOLUME_IN_GAME)});break}}})},b?200:0)};this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this);s_oSpriteLibrary.addSprite("but_play","./sprites/but_play.png");s_oSpriteLibrary.addSprite("msg_box","./sprites/msg_box.png");s_oSpriteLibrary.addSprite("keys","./sprites/keys.png");s_oSpriteLibrary.addSprite("star","./sprites/star.png");s_oSpriteLibrary.addSprite("best_time","./sprites/best_time.png");
s_oSpriteLibrary.addSprite("timer","./sprites/timer.png");s_oSpriteLibrary.addSprite("but_home","./sprites/but_home.png");s_oSpriteLibrary.addSprite("logo_menu","./sprites/logo_menu.png");s_oSpriteLibrary.addSprite("bg_select","./sprites/bg_select.jpg");s_oSpriteLibrary.addSprite("but_credits","./sprites/but_credits.png");s_oSpriteLibrary.addSprite("ctl_logo","./sprites/ctl_logo.png");s_oSpriteLibrary.addSprite("but_fullscreen","./sprites/but_fullscreen.png");s_oSpriteLibrary.addSprite("but_yes",
"./sprites/but_yes.png");s_oSpriteLibrary.addSprite("but_delete_saving","./sprites/but_delete_saving.png");s_oSpriteLibrary.addSprite("bg_menu","./sprites/bg_menu.jpg");s_oSpriteLibrary.addSprite("but_level","./sprites/but_level.png");s_oSpriteLibrary.addSprite("but_world0","./sprites/but_world0.png");s_oSpriteLibrary.addSprite("but_world1","./sprites/but_world1.png");s_oSpriteLibrary.addSprite("but_world2","./sprites/but_world2.png");s_oSpriteLibrary.addSprite("w0_bg0","./sprites/backgrounds/world_0/bg0.png");
s_oSpriteLibrary.addSprite("w0_bg1","./sprites/backgrounds/world_0/bg1.png");s_oSpriteLibrary.addSprite("w1_bg0","./sprites/backgrounds/world_1/bg0.png");s_oSpriteLibrary.addSprite("w1_bg1","./sprites/backgrounds/world_1/bg1.png");s_oSpriteLibrary.addSprite("w2_bg0","./sprites/backgrounds/world_2/bg0.png");s_oSpriteLibrary.addSprite("w2_bg1","./sprites/backgrounds/world_2/bg1.png");s_oSpriteLibrary.addSprite("key_up","./sprites/key_up.png");s_oSpriteLibrary.addSprite("key_down","./sprites/key_down.png");
s_oSpriteLibrary.addSprite("key_left","./sprites/key_left.png");s_oSpriteLibrary.addSprite("key_right","./sprites/key_right.png");s_oSpriteLibrary.addSprite("but_exit","./sprites/but_exit.png");s_oSpriteLibrary.addSprite("audio_icon","./sprites/audio_icon.png");s_oSpriteLibrary.addSprite("but_restart","./sprites/but_restart.png");s_oSpriteLibrary.addSprite("but_next","./sprites/but_next.png");s_oSpriteLibrary.addSprite("time_panel","./sprites/time_panel.png");s_oSpriteLibrary.addSprite("tachometer",
"./sprites/tachometer.png");s_oSpriteLibrary.addSprite("baloon_mc","./sprites/baloon_mc.png");for(var a=1;5>=a;a++)s_oSpriteLibrary.addSprite("billboard0"+a,"./sprites/elements/billboard0"+a+".png");for(a=0;6>a;a++)s_oSpriteLibrary.addSprite("boat_"+a,"./sprites/elements/boat_"+a+".png");s_oSpriteLibrary.addSprite("finish","./sprites/elements/finish.png");s_oSpriteLibrary.addSprite("buoy_0","./sprites/elements/buoy_0.png");s_oSpriteLibrary.addSprite("buoy_1","./sprites/elements/buoy_1.png");s_oSpriteLibrary.addSprite("buoy_2",
"./sprites/elements/buoy_2.png");s_oSpriteLibrary.addSprite("buoy_3","./sprites/elements/buoy_3.png");s_oSpriteLibrary.addSprite("bush1","./sprites/elements/plants/bush1.png");s_oSpriteLibrary.addSprite("tree1","./sprites/elements/plants/tree1.png");s_oSpriteLibrary.addSprite("tree2","./sprites/elements/plants/tree2.png");s_oSpriteLibrary.addSprite("palm_tree","./sprites/elements/plants/palm_tree.png");for(a=1;3>=a;a++)s_oSpriteLibrary.addSprite("enemy0"+a+"_center","./sprites/enemies/enemy0"+a+"/enemy0"+
a+"_center.png"),s_oSpriteLibrary.addSprite("enemy0"+a+"_left","./sprites/enemies/enemy0"+a+"/enemy0"+a+"_left.png"),s_oSpriteLibrary.addSprite("enemy0"+a+"_right","./sprites/enemies/enemy0"+a+"/enemy0"+a+"_right.png");s_oSpriteLibrary.addSprite("player","./sprites/player.png");for(a=0;10>a;a++)s_oSpriteLibrary.addSprite("caustics_lod0_"+a,"./sprites/caustics_alpha/lod0/caustics_"+a+".png");s_oSpriteLibrary.addSprite("fog_0","./sprites/backgrounds/world_0/fog_0.png");s_oSpriteLibrary.addSprite("fog_1",
"./sprites/backgrounds/world_1/fog_1.png");s_oSpriteLibrary.addSprite("fog_2","./sprites/backgrounds/world_2/fog_2.png");s_oSpriteLibrary.addSprite("foam_bottom_0","./sprites/fx/foam_bottom_0.png");s_oSpriteLibrary.addSprite("foam_bottom_1","./sprites/fx/foam_bottom_1.png");for(a=0;29>a;a++)s_oSpriteLibrary.addSprite("foam_back_"+a,"./sprites/fx/foam_back/foam_back_"+a+".png");g+=s_oSpriteLibrary.getNumSprites();s_oSpriteLibrary.loadSprites()};this._onImagesLoaded=function(){b++;d.refreshLoader(Math.floor(b/
g*100))};this._onRemovePreloader=function(){d.unload();playSound("menu_soundtrack",1,!0);this.gotoMenu()};this._onAllImagesLoaded=function(){};this.onAllPreloaderImagesLoaded=function(){this._loadImages()};this.gotoMenu=function(){new CMenu;e=STATE_MENU};this.gotoWorldMenu=function(){new CWorldMenu;e=STATE_MENU};this.gotoGame=function(a){k=new CGame(m,a);e=STATE_GAME};this.gotoHelp=function(){new CHelp;e=STATE_HELP};this.stopUpdate=function(){c=!1;createjs.Ticker.paused=!0;$("#block_game").css("display",
"block");Howler.mute(!0)};this.startUpdate=function(){s_iPrevTime=(new Date).getTime();c=!0;createjs.Ticker.paused=!1;$("#block_game").css("display","none");s_bAudioActive&&Howler.mute(!1)};this._update=function(a){if(!1!==c){var b=(new Date).getTime();s_iTimeElaps=b-s_iPrevTime;s_iCntTime+=s_iTimeElaps;s_iCntFps++;s_iPrevTime=b;1E3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1E3,s_iCntFps=0);s_oStage.update(a);e===STATE_GAME&&k.update()}};s_oMain=this;var m=a;ENABLE_FULLSCREEN=a.fullscreen;ENABLE_CHECK_ORIENTATION=
a.check_orientation;s_bAudioActive=a.audio_enable_on_startup;this.initContainer()}var s_bMobile,s_bAudioActive=!1,s_iCntTime=0,s_iTimeElaps=0,s_iPrevTime=0,s_iCntFps=0,s_iCurFps=1/FPS_DT,s_bFullscreen=!1,s_oDrawLayer,s_oStage,s_oMain,s_oSpriteLibrary,s_oSoundTrack,s_oCanvas,s_oLocalStorage,s_aSounds=[],s_aSoundsInfo=[];
function CCreditsPanel(){var a,c,b,g,e;this._init=function(){c=new createjs.Shape;c.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);c.alpha=0;c.on("click",function(){});s_oStage.addChild(c);(new createjs.Tween.get(c)).to({alpha:.7},500);b=new createjs.Container;s_oStage.addChild(b);var d=s_oSpriteLibrary.getSprite("msg_box"),k=createBitmap(d);k.regX=d.width/2;k.regY=d.height/2;b.addChild(k);b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT+d.height/2+50;a=b.y;(new createjs.Tween.get(b)).to({y:CANVAS_HEIGHT/
2-40},500,createjs.Ease.quartIn);k=new createjs.Text("DEVELOPED BY"," 40px "+PRIMARY_FONT,"#ffffff");k.y=-d.height/2+110;k.textAlign="center";k.textBaseline="middle";k.lineWidth=400;b.addChild(k);d=new createjs.Text("www.codethislab.com"," 40px "+PRIMARY_FONT,"#ffffff");d.y=90;d.textAlign="center";d.textBaseline="middle";d.lineWidth=400;b.addChild(d);d=s_oSpriteLibrary.getSprite("ctl_logo");e=createBitmap(d);e.on("click",this._onLogoButRelease);e.regX=d.width/2;e.regY=d.height/2;b.addChild(e);d=s_oSpriteLibrary.getSprite("but_exit");
g=new CGfxButton(326,-200,d,b);g.addEventListener(ON_MOUSE_UP,this.unload,this)};this.unload=function(){g.setClickable(!1);(new createjs.Tween.get(c)).to({alpha:0},500);(new createjs.Tween.get(b)).to({y:a},400,createjs.Ease.backIn).call(function(){s_oStage.removeChild(c);s_oStage.removeChild(b);g.unload()});c.off("click",function(){});e.off("click",this._onLogoButRelease)};this._onLogoButRelease=function(){window.open("http://www.codethislab.com/index.php?&l=en")};this._onMoreGamesReleased=function(){window.open("http://codecanyon.net/collections/5409142-games")};
this._init()}
function CTextButton(a,c,b,g,e,d,k){var m,h,f,t,l,r,q;this._init=function(a,b,c,d,e,f,k){m=[];h=[];var g=createBitmap(c),p=Math.ceil(k/20);q=new createjs.Text(d,k+"px "+e,"#000000");q.textAlign="center";q.textBaseline="alphabetic";var t=q.getBounds();q.x=c.width/2+p;q.y=Math.floor(c.height/2)+t.height/3+p;r=new createjs.Text(d,k+"px "+e,f);r.textAlign="center";r.textBaseline="alphabetic";t=r.getBounds();r.x=c.width/2;r.y=Math.floor(c.height/2)+t.height/3;l=new createjs.Container;l.x=a;l.y=b;l.regX=
c.width/2;l.regY=c.height/2;l.addChild(g,q,r);s_oStage.addChild(l);this._initListener()};this.unload=function(){l.off("mousedown",f);l.off("pressup",t);s_oStage.removeChild(l)};this.setVisible=function(a){l.visible=a};this._initListener=function(){f=l.on("mousedown",this.buttonDown);t=l.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,c){m[a]=b;h[a]=c};this.buttonRelease=function(){l.scaleX=1;l.scaleY=1;m[ON_MOUSE_UP]&&m[ON_MOUSE_UP].call(h[ON_MOUSE_UP])};this.buttonDown=function(){l.scaleX=
.9;l.scaleY=.9;m[ON_MOUSE_DOWN]&&m[ON_MOUSE_DOWN].call(h[ON_MOUSE_DOWN])};this.setTextPosition=function(a){r.y=a;q.y=a+2};this.setPosition=function(a,b){l.x=a;l.y=b};this.setX=function(a){l.x=a};this.setY=function(a){l.y=a};this.getButtonImage=function(){return l};this.getX=function(){return l.x};this.getY=function(){return l.y};this._init(a,c,b,g,e,d,k);return this}
function CToggle(a,c,b,g){var e,d,k,m,h,f;this._init=function(a,b,c,m){d=[];k=[];var l=new createjs.SpriteSheet({images:[c],frames:{width:c.width/2,height:c.height,regX:c.width/2/2,regY:c.height/2},animations:{state_true:[0],state_false:[1]}});e=m;f=createSprite(l,"state_"+e,c.width/2/2,c.height/2,c.width/2,c.height);f.x=a;f.y=b;f.stop();s_oStage.addChild(f);this._initListener()};this.unload=function(){f.off("mousedown",m);f.off("pressup",h);s_oStage.removeChild(f)};this._initListener=function(){m=
f.on("mousedown",this.buttonDown);h=f.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,c){d[a]=b;k[a]=c};this.setActive=function(a){e=a;f.gotoAndStop("state_"+e)};this.buttonRelease=function(){f.scaleX=1;f.scaleY=1;playSound("click",1,!1);e=!e;f.gotoAndStop("state_"+e);d[ON_MOUSE_UP]&&d[ON_MOUSE_UP].call(k[ON_MOUSE_UP],e)};this.buttonDown=function(){f.scaleX=.9;f.scaleY=.9;d[ON_MOUSE_DOWN]&&d[ON_MOUSE_DOWN].call(k[ON_MOUSE_DOWN])};this.setPosition=function(a,b){f.x=a;f.y=b};this._init(a,
c,b,g)}
function CGfxButton(a,c,b,g){var e,d,k,m,h,f,t,l=[],r,q;this._init=function(a,b,c,l){e=!1;d=1;f=[];t=[];r=createBitmap(c);r.x=a;r.y=b;r.scaleX=r.scaleY=d;r.regX=c.width/2;r.regY=c.height/2;l.addChild(r);this._initListener()};this.unload=function(){r.off("mousedown",k);r.off("pressup",m);s_bMobile||r.off("mouseover",h);g.removeChild(r)};this.setVisible=function(a){r.visible=a};this.setClickable=function(a){e=!a};this._initListener=function(){k=r.on("mousedown",this.buttonDown);m=r.on("pressup",this.buttonRelease);
s_bMobile||(h=r.on("mouseover",this.buttonOver))};this.addEventListener=function(a,b,c){f[a]=b;t[a]=c};this.addEventListenerWithParams=function(a,b,c,d){f[a]=b;t[a]=c;l=d};this.buttonRelease=function(){e||(q||(r.scaleX=d,r.scaleY=d),f[ON_MOUSE_UP]&&f[ON_MOUSE_UP].call(t[ON_MOUSE_UP],l))};this.buttonDown=function(){e||(q||(r.scaleX=.9*d,r.scaleY=.9*d),playSound("click",1,!1),f[ON_MOUSE_DOWN]&&f[ON_MOUSE_DOWN].call(t[ON_MOUSE_DOWN],l))};this.buttonOver=function(a){s_bMobile||e||(a.target.cursor="pointer")};
this.pulseAnimation=function(){q=createjs.Tween.get(r).to({scaleX:1.1*d,scaleY:1.1*d},850,createjs.Ease.quadOut).to({scaleX:d,scaleY:d},650,createjs.Ease.quadIn).call(function(){z.pulseAnimation()})};this.trembleAnimation=function(){q=createjs.Tween.get(r).to({rotation:5},75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){z.trebleAnimation()})};this.setPosition=function(a,b){r.x=a;r.y=b};this.setX=function(a){r.x=
a};this.setY=function(a){r.y=a};this.getButtonImage=function(){return r};this.getX=function(){return r.x};this.getY=function(){return r.y};var z=this;this._init(a,c,b,g);return this}
function CMenu(){var a,c,b,g,e,d,k,m,h,f,t,l,r,q,z,A=null,x=null;this._init=function(){h=createBitmap(s_oSpriteLibrary.getSprite("bg_menu"));s_oStage.addChild(h);var p=s_oSpriteLibrary.getSprite("but_play");f=new CGfxButton(CANVAS_WIDTH/2+350,CANVAS_HEIGHT-300,p,s_oStage);f.addEventListener(ON_MOUSE_UP,this._onButPlayRelease,this);f.pulseAnimation();p=s_oSpriteLibrary.getSprite("logo_menu");var u=createBitmap(p);u.regX=p.width/2;u.regY=p.height/2;u.x=CANVAS_WIDTH/2;u.y=CANVAS_HEIGHT/2-150;s_oStage.addChild(u);
p=s_oSpriteLibrary.getSprite("but_credits");e=p.width/2+12;d=p.height/2+16;r=new CGfxButton(e,d,p,s_oStage);r.addEventListener(ON_MOUSE_UP,this._onCreditsBut,this);u=CANVAS_WIDTH;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)p=s_oSpriteLibrary.getSprite("audio_icon"),k=CANVAS_WIDTH-p.width/4-12,m=p.height/2+16,l=new CToggle(k,m,p,s_bAudioActive),l.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this),u=k-p.width/4;s_oLocalStorage.isDirty()&&(p=s_oSpriteLibrary.getSprite("but_delete_saving"),a=u-p.width/
2-12,c=p.height/2+16,z=new CGfxButton(a,c,p,s_oStage),z.addEventListener(ON_MOUSE_UP,this._onDeleteBut,this));p=window.document;u=p.documentElement;A=u.requestFullscreen||u.mozRequestFullScreen||u.webkitRequestFullScreen||u.msRequestFullscreen;x=p.exitFullscreen||p.mozCancelFullScreen||p.webkitExitFullscreen||p.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(A=!1);A&&screenfull.isEnabled&&(p=s_oSpriteLibrary.getSprite("but_fullscreen"),b=e+p.width/2+12,g=p.height/2+16,q=new CToggle(b,g,p,s_bFullscreen,
s_oStage),q.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));t=new createjs.Shape;t.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);s_oStage.addChild(t);createjs.Tween.get(t).to({alpha:0},1E3).call(function(){t.visible=!1});this.refreshButtonPos(s_iOffsetX,s_iOffsetY);s_oLocalStorage.isUsed()||new CMsgBox(TEXT_IOS_PRIVATE)};this.unload=function(){f.unload();f=null;t.visible=!1;r.unload();z&&s_oLocalStorage.isDirty()&&z.unload();if(!1===DISABLE_SOUND_MOBILE||!1===
s_bMobile)l.unload(),l=null;A&&screenfull.isEnabled&&q.unload();s_oStage.removeChild(h);s_oMenu=h=null};this.refreshButtonPos=function(f,h){!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||l.setPosition(k-f,h+m);r.setPosition(e+f,h+d);A&&screenfull.isEnabled&&q.setPosition(b+f,g+h);z&&s_oLocalStorage.isDirty()&&z.setPosition(a-f,c+h)};this.resetFullscreenBut=function(){A&&screenfull.isEnabled&&q.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?x.call(window.document):A.call(window.document.documentElement);
sizeHandler()};this._onCreditsBut=function(){new CCreditsPanel};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onDeleteBut=function(){(new CAreYouSurePanel(s_oMenu.deleteSavings)).changeMessage(TEXT_SAVE_REMOVE,24)};this.deleteSavings=function(){s_oLocalStorage.deleteData();s_oLocalStorage.resetData();z.unload()};this._onButPlayRelease=function(){this.unload();$(s_oMain).trigger("start_session");isIOS()&&!soundPlaying(s_aSounds.menu_soundtrack)&&playSound("menu_soundtrack",
1,!0);s_oMain.gotoWorldMenu()};s_oMenu=this;this._init()}var s_oMenu=null;
function CGame(a,c){function b(a){a.preventDefault();s_oGame.onKeyUp(a.keyCode)}function g(a){a||(a=window.event);a.preventDefault();s_oGame.onKeyDown(a.keyCode)}var e,d,k,m,h,f,t,l,r,q,z,A,x,p,u,L=null,w,B,D,H,O,I,G,K;this._init=function(a){f=a;x=[];p=new createjs.Container;p.x=CANVAS_WIDTH/2;p.y=CANVAS_HEIGHT/2;p.regX=CANVAS_WIDTH/2;p.regY=CANVAS_HEIGHT/2;s_oStage.addChild(p);G=new CHorizon(f,p);H=new createjs.Shape;p.addChild(H);O=new createjs.Shape;O.alpha=.75;p.addChild(O);var b=s_oSpriteLibrary.getSprite("fog_"+
Math.floor(f/NUM_WORLDS));b=createBitmap(b);b.x=0;b.y=CANVAS_HEIGHT/2;p.addChild(b);D=new createjs.Container;p.addChild(D);I=new createjs.Container;p.addChild(I);B=new CRoad(O,I,f,H);w=new CPlayer(CANVAS_WIDTH/2,900,p,D);x=B.getSegments();TRACK_LENGTH=B.getTrackLength();u=new CInterface;K=[];new CLevelBuilder(w,K,I,a);this.resetParams()};this.getWorldCameraPos=function(){var a=w.getPosition().z;a=this.findSegment(a);return x[a.index].p1.world};this.onKeyUp=function(a){if(e)switch(a){case KEY_LEFT:w.stopLeft();
break;case KEY_UP:w.stopAccelerate();break;case KEY_RIGHT:w.stopRight();break;case KEY_DOWN:w.stopBrake()}};this.onKeyDown=function(a){if(e)switch(a){case KEY_LEFT:w.moveLeft();break;case KEY_UP:w.moveAccelerate();break;case KEY_RIGHT:w.moveRight();break;case KEY_DOWN:w.moveBrake()}};this.resetParams=function(){e=!1;stopSound(s_aSounds.game_soundtrack);if(0===f)new CHelpPanel;else{e=!0;stopSound(s_aSounds.menu_soundtrack);playSound("game_soundtrack",.8,!0);$(s_oMain).trigger("start_level",f);var a=
new createjs.Shape;a.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.alpha=1;s_oStage.addChild(a);(new createjs.Tween.get(a)).to({alpha:0},750).call(function(){s_oStage.removeChild(a)})}l=STATE_GAME_START;t=0;h=LEVEL_INFO[f].time;m=START_COUNTDOWN;A=z=q=0;G.restart();u.refreshTimer(h);u.refreshCurTime(0);var c=f%NUM_TRACKS_PER_WORLD;u.setLevelInfo(s_oSpriteLibrary.getSprite("but_world"+Math.floor(f/NUM_WORLDS)),c+1);s_aTimeScore[f]<LEVEL_INFO[f].time&&0!==s_aTimeScore[f]?u.setBestTime(s_aTimeScore[f]):
u.setBestTime(LEVEL_INFO[f].time);s_bMobile||(document.onkeydown=g,document.onkeyup=b);B.clearVisual(w.getPosition());r=w.getPlayerSegment();w.reset()};this.restartGame=function(){$(s_oMain).trigger("show_interlevel_ad");$(s_oMain).trigger("restart_level",f);this.resetParams()};this.unload=function(){u.unload();null!==L&&L.unload();stopSound(s_aSounds.menu_soundtrack);stopSound(s_aSounds.game_soundtrack);stopSound(s_aSounds.engine);stopSound(s_aSounds.brake);createjs.Tween.removeAllTweens();s_oStage.removeAllChildren()};
this.rotateScreen=function(a){l===STATE_GAME_END&&(a=ROTATE_CENTER);switch(a){case ROTATE_LEFT:q!==ROTATE_LEFT&&(z=0,A=p.rotation);q=ROTATE_LEFT;p.rotation=Util.easeOut(A,MAX_ROTATION,z/FRAMESPEED_ROTATION);p.rotation>MAX_ROTATION&&(p.rotation=MAX_ROTATION,A=p.rotation);break;case ROTATE_RIGHT:q!==ROTATE_RIGHT&&(z=0,A=p.rotation);q=ROTATE_RIGHT;p.rotation=Util.easeOut(A,-MAX_ROTATION,z/FRAMESPEED_ROTATION);p.rotation<-MAX_ROTATION&&(p.rotation=-MAX_ROTATION,A=p.rotation);break;case ROTATE_CENTER:q!==
ROTATE_CENTER&&(z=0,A=p.rotation),q=ROTATE_CENTER,p.rotation=Util.easeOut(A,0,z/FRAMESPEED_ROTATION),0<A&&0>p.rotation&&(p.rotation=0,A=p.rotation),0>A&&0<p.rotation&&(p.rotation=0,A=p.rotation)}z<FRAMESPEED_ROTATION&&z++};this.checkDamage=function(){w.getCurSpeed()>PLAYER_MIN_SPEED_DAMAGE&&!d&&(d=!0,w.damageAnim(),new CTremble(s_oStage,250,20,5))};this.endDamageTime=function(){d=!1};this.trackCompleted=function(){G.resetPos();l!==STATE_GAME_END&&($(s_oMain).trigger("end_level",f),$(s_oMain).trigger("show_interlevel_ad"),
l=STATE_GAME_END,s_oGame.stopPlayer(),t=Math.floor(h/1E3*POINTS_PER_SECONDS),new CNextLevelPanel(h,t,f))};this._countDown=function(){m-=s_iTimeElaps;u.refreshCountdown(m);0>=m&&(m=0,l=STATE_GAME_RACE,u.countDownGo())};this.nextLevel=function(){f++;f<NUM_TRACKS_PER_WORLD*NUM_WORLDS?(this.unload(),this._init(f)):this.gameOver()};this.trackLose=function(){l=STATE_GAME_END;s_oGame.stopPlayer();$(s_oMain).trigger("end_level",f);$(s_oMain).trigger("show_interlevel_ad");(new CLosePanel(s_oSpriteLibrary.getSprite("msg_box"))).show(t)};
this.stopPlayer=function(){w.stopAll();s_bMobile||(document.onkeydown=null,document.onkeyup=null)};this.onExit=function(){s_oGame.unload();$(s_oMain).trigger("end_session");playSound("menu_soundtrack",1,!0);s_oMain.gotoMenu()};this._onExitHelp=function(){e=!0;stopSound(s_aSounds.menu_soundtrack);playSound("game_soundtrack",.8,!0);$(s_oMain).trigger("start_level",1)};this.gameOver=function(){L=new CEndPanel(s_oSpriteLibrary.getSprite("msg_box"));L.show(t)};this.setPause=function(){e=!1;w.stopAll()};
this.setResume=function(){e=!0};this.update=function(){var a=1/s_iCurFps;switch(l){case STATE_GAME_START:e&&this._countDown();break;case STATE_GAME_RACE:if(!e)return;h-=s_iTimeElaps;0>h&&(h=0,this.trackLose());u.refreshTimer(h);u.refreshCurTime(LEVEL_INFO[f].time-h);w.update(a);break;case STATE_GAME_END:w.update(a),w.autoPilot()}u.refreshSpeed(w.getCurSpeed()*PLAYER_SPEED_CONVERSION_RATIO);B.update(w.getPosition());G.move(this.getWorldCameraPos());for(var b=0;b<K.length;b++)K[b].update(a,w);k=!1;
w.isJumping()||(this._ambientCollision(),this._carsCollision());r=w.getPlayerSegment()};this._ambientCollision=function(){if(w.isOutOfRoad())for(var a=w.getPlayerSegment().index,b=r.index;b<=a;b++)for(var c=x[b],l=0;l<c.sprites.length;l++){var d=c.sprites[l];if(Util.overlap(w.getPosition().x,w.getPlayerWidth(),d.collision.center,d.collision.width)){this.checkDamage();w.setCurSpeed(PLAYER_ACCELERATION);w.setPosition(Util.increase(c.p1.world.z,-PLAYER_Z_FROMCAMERA,TRACK_LENGTH));k=!0;w.stopEngineSound();
break}}};this._carsCollision=function(){for(var a,b,c=w.getPlayerSegment().index,l=r.index;l<=c;l++)for(var d=x[l],e=0;e<d.cars.length;e++)if(a=d.cars[e],b=a.getSprite().width*SPRITES.SCALE,w.getCurSpeed()>a.getSpeed()&&Util.overlap(w.getPosition().x,w.getPlayerWidth(),a.getOffset(),b,.8)){this.checkDamage();w.setCurSpeed(a.getSpeed()*(a.getSpeed()/w.getCurSpeed()));w.setPosition(Util.increase(a.getZ(),-PLAYER_Z_FROMCAMERA,TRACK_LENGTH));k=!0;w.stopEngineSound();break}};this.playerCollide=function(){return k};
this.findSegment=function(a){return B.findSegment(a)};this.getSegments=function(){return x};this.getPlayer=function(){return w};this.getState=function(){return l};s_oGame=this;PLAYER_MAX_SPEED=a.player_max_speed;PLAYER_ACCELERATION=PLAYER_MAX_SPEED/5;PLAYER_DECELERATION=PLAYER_MAX_SPEED/8;PLAYER_MIN_SPEED_DAMAGE=PLAYER_MAX_SPEED/3;PLAYER_REAL_MAX_SPEED=a.player_maxspeed_indicator;PLAYER_SPEED_CONVERSION_RATIO=PLAYER_REAL_MAX_SPEED/PLAYER_MAX_SPEED;CENTRIFUGAL_FORCE=a.player_centrifugal_force;POINTS_PER_SECONDS=
a.points_per_seconds_remaining;this._init(c)}var s_oGame;
function CInterface(){var a,c,b,g,e,d,k,m,h,f,t,l,r,q,z,A,x,p,u,L,w,B,D,H,O,I,G,K,M,V,Q,R,P,J,U=null,n=null;this._init=function(){var N,C=s_oSpriteLibrary.getSprite("but_exit");x=CANVAS_WIDTH-C.width/2-12;p=C.height/2+16;L=new CGfxButton(x,p,C,s_oStage);L.addEventListener(ON_MOUSE_UP,this._onExit,this);z=N=x-C.width-12;A=C.height/2+16;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)C=s_oSpriteLibrary.getSprite("audio_icon"),u=new CToggle(z,A,C,s_bAudioActive),u.addEventListener(ON_MOUSE_UP,this._onAudioToggle,
this),N=z-C.width/2-12;C=window.document;var S=C.documentElement;U=S.requestFullscreen||S.mozRequestFullScreen||S.webkitRequestFullScreen||S.msRequestFullscreen;n=C.exitFullscreen||C.mozCancelFullScreen||C.webkitExitFullscreen||C.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(U=!1);U&&screenfull.isEnabled&&(C=s_oSpriteLibrary.getSprite("but_fullscreen"),e=N,d=C.height/2+16,R=new CToggle(e,d,C,s_bFullscreen,s_oStage),R.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));b=12;g=16;w=new createjs.Container;
s_oStage.addChild(w);C=s_oSpriteLibrary.getSprite("time_panel");N=createBitmap(C);w.addChild(N);D=new CTimer(110,50,w,50,"#ffffff","best_time","#000000");H=new CTimer(110,120,w,50,"#ffffff","timer","#000000");a=CANVAS_WIDTH/2;c=60;B=new CTimer(a,c,s_oStage,100,"#f14e00",null,"#000000");B.resetTextRelativePos();B.setAlign("center","middle");O=new CTachometer(152,CANVAS_HEIGHT-12);I=new createjs.Text(""," 300px "+PRIMARY_FONT,"#3e240b");I.x=CANVAS_WIDTH/2;I.y=CANVAS_HEIGHT/2;I.textAlign="center";I.textBaseline=
"middle";I.lineWidth=200;I.outline=20;s_oStage.addChild(I);G=new createjs.Text(""," 300px "+PRIMARY_FONT,"#f14e00");G.x=CANVAS_WIDTH/2;G.y=CANVAS_HEIGHT/2;G.textAlign="center";G.textBaseline="middle";G.lineWidth=200;s_oStage.addChild(G);s_bMobile&&(N=CANVAS_HEIGHT-270,C=s_oSpriteLibrary.getSprite("key_up"),r=CANVAS_WIDTH-180+C.width/2,q=N,K=new CGfxButton(r,q,C,s_oStage),K.addEventListenerWithParams(ON_MOUSE_UP,s_oGame.onKeyUp,this,KEY_UP),K.addEventListenerWithParams(ON_MOUSE_DOWN,s_oGame.onKeyDown,
this,KEY_UP),C=s_oSpriteLibrary.getSprite("key_down"),t=CANVAS_WIDTH-180-C.width/2,l=N,M=new CGfxButton(t,l,C,s_oStage),M.addEventListenerWithParams(ON_MOUSE_UP,s_oGame.onKeyUp,this,KEY_DOWN),M.addEventListenerWithParams(ON_MOUSE_DOWN,s_oGame.onKeyDown,this,KEY_DOWN),C=s_oSpriteLibrary.getSprite("key_left"),h=180-C.width/2,f=N,V=new CGfxButton(h,f,C,s_oStage),V.addEventListenerWithParams(ON_MOUSE_UP,s_oGame.onKeyUp,this,KEY_LEFT),V.addEventListenerWithParams(ON_MOUSE_DOWN,s_oGame.onKeyDown,this,KEY_LEFT),
C=s_oSpriteLibrary.getSprite("key_right"),k=180+C.width/2,m=N,Q=new CGfxButton(k,m,C,s_oStage),Q.addEventListenerWithParams(ON_MOUSE_UP,s_oGame.onKeyUp,this,KEY_RIGHT),Q.addEventListenerWithParams(ON_MOUSE_DOWN,s_oGame.onKeyDown,this,KEY_RIGHT));J=[];for(N=0;3>=N;N++)J[N]=!1;this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.unload=function(){if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)u.unload(),u=null;U&&screenfull.isEnabled&&R.unload();L.unload();s_oInterface=null;s_bMobile&&(K.unload(),M.unload(),
V.unload(),Q.unload())};this.refreshButtonPos=function(n,C){L.setPosition(x-n,C+p);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||u.setPosition(z-n,C+A);U&&screenfull.isEnabled&&R.setPosition(e-n,d+C);w.x=b+n;w.y=g+C;s_bMobile&&(K.setPosition(r-n,q-C),M.setPosition(t-n,l-C),V.setPosition(h+n,f-C),Q.setPosition(k+n,m-C));B.setPos(a,c+C);O.updateOffset(n,C)};this.resetFullscreenBut=function(){U&&screenfull.isEnabled&&R.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?n.call(window.document):
U.call(window.document.documentElement);sizeHandler()};this.refreshTimer=function(a){B.setIntTime(a)};this.setBestTime=function(a){D.setDecimalTime(a)};this.refreshCurTime=function(a){H.setDecimalTime(a)};this.refreshCountdown=function(a){var b=Math.ceil(a/1E3),c=(1E3*b-a)/1E3;G.alpha=1-c;G.scaleX=G.scaleY=c;G.text=Math.ceil(a/1E3);I.alpha=G.alpha;I.scaleX=I.scaleY=c;I.text=G.text;if(3===b&&!J[3])J[3]=!0,playSound("3",1,!1);else if(2===b&&!J[2])J[2]=!0,playSound("2",1,!1);else if(1===b&&!J[1])J[1]=
!0,playSound("1",1,!1);else if(0===b)for(J[0]=!0,playSound("go",1,!1),a=0;a<J.length;a++)J[a]=!1};this.refreshSpeed=function(a){O.setSpeedIndicator(a)};this.countDownGo=function(){G.scaleX=G.scaleY=1;I.scaleX=I.scaleY=G.scaleY;G.text=TEXT_GO;I.text=TEXT_GO;createjs.Tween.get(G).wait(500).to({alpha:0},1E3,createjs.Ease.cubicIn);createjs.Tween.get(I).wait(500).to({alpha:0},1E3,createjs.Ease.cubicIn)};this.setLevelInfo=function(a,b){P&&P.unload();var c=s_oSpriteLibrary.getSprite("time_panel");P=new CLevelBut(a.width/
4*.6+c.width+12,a.height/2*.6,a,!0,0,w);P.setScale(.6);P.setClickable(!1);P.addLevelText(b)};this._onNitro=function(){_oButNitro.setVisible(!1);s_oGame.setNitro(!0)};this._onButRestartRelease=function(){J=[];for(var a=0;3>=a;a++)J[a]=!1;s_oGame.restartGame()};this.onExitFromHelp=function(){_oHelpPanel.unload()};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){s_oGame.setPause();new CAreYouSurePanel(s_oGame.onExit,s_oGame.setResume)};
s_oInterface=this;this._init();return this}var s_oInterface=null;
function CHelpPanel(){var a,c,b,g,e,d;this._init=function(){e=new createjs.Shape;e.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.alpha=1;e.on("mousedown",function(){k._onExitHelp()});s_oStage.addChild(e);(new createjs.Tween.get(e)).to({alpha:.7},500);d=new createjs.Container;d.on("pressup",function(){k._onExitHelp()});s_oStage.addChild(d);var c=s_oSpriteLibrary.getSprite("msg_box"),h=createBitmap(c);h.regX=c.width/2;h.regY=c.height/2;d.addChild(h);d.x=CANVAS_WIDTH/2;d.y=CANVAS_HEIGHT+
c.height/2;a=d.y;(new createjs.Tween.get(d)).to({y:CANVAS_HEIGHT/2-40},500,createjs.Ease.cubicOut);if(s_bMobile){c=0;h=-150;var f=500,t=50;b=new CTLText(d,c-f/2,h-t/2,f,t,24,"center","#3e240b",PRIMARY_FONT,1,0,0,TEXT_HELP1_MOBILE,!0,!0,!0,!1);b.setOutline(4);new CTLText(d,c-f/2,h-t/2,f,t,24,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_HELP1_MOBILE,!0,!0,!0,!1);c=s_oSpriteLibrary.getSprite("key_left");h=createBitmap(c);h.x=-170;h.y=-60;h.regX=c.width/2;h.regY=c.height/2;h.scaleX=h.scaleY=.7;d.addChild(h);
c=s_oSpriteLibrary.getSprite("key_right");h=createBitmap(c);h.x=-80;h.y=-60;h.regX=c.width/2;h.regY=c.height/2;h.scaleX=h.scaleY=.7;d.addChild(h);c=s_oSpriteLibrary.getSprite("key_down");h=createBitmap(c);h.x=80;h.y=-60;h.regX=c.width/2;h.regY=c.height/2;h.scaleX=h.scaleY=.7;d.addChild(h);c=s_oSpriteLibrary.getSprite("key_up");h=createBitmap(c);h.x=170;h.y=-60;h.regX=c.width/2;h.regY=c.height/2;h.scaleX=h.scaleY=.7}else c=-280,h=-110,f=300,t=150,b=new CTLText(d,c,h-t/2,f,t,24,"left","#3e240b",PRIMARY_FONT,
1,0,0,TEXT_HELP1,!0,!0,!0,!1),b.setOutline(4),new CTLText(d,c,h-t/2,f,t,24,"left","#fff",PRIMARY_FONT,1,0,0,TEXT_HELP1,!0,!0,!0,!1),c=s_oSpriteLibrary.getSprite("keys"),h=createBitmap(c),h.x=130,h.y=-100,h.regX=c.width/2,h.regY=c.height/2;d.addChild(h);c=80;h=74;f=200;t=150;g=new CTLText(d,c,h-t/2,f,t,24,"left","#3e240b",PRIMARY_FONT,1,0,0,TEXT_HELP2,!0,!0,!0,!1);g.setOutline(4);new CTLText(d,c,h-t/2,f,t,24,"left","#fff",PRIMARY_FONT,1,0,0,TEXT_HELP2,!0,!0,!0,!1);h=new createjs.Container;h.x=-130;
h.y=130;h.scaleX=h.scaleY=.3;d.addChild(h);c=s_oSpriteLibrary.getSprite("finish");f=createBitmap(c);f.regX=c.width/2;f.regY=c.height;f.scaleX=f.scaleY=.3;h.addChild(f);new CPlayer(0,0,h,h)};this.unload=function(){s_oStage.removeChild(e);s_oStage.removeChild(d);d.off("pressup",function(){k._onExitHelp()});e.off("pressup",function(){k._onExitHelp()})};this._onExitHelp=function(){c||(c=!0,(new createjs.Tween.get(e)).to({alpha:0},500),(new createjs.Tween.get(d)).to({y:a},400,createjs.Ease.backIn).call(function(){k.unload();
s_oGame._onExitHelp()}))};var k=this;this._init()}
function CEndPanel(){var a,c,b;this._init=function(){setVolume(s_aSounds.game_soundtrack,.5);a=new createjs.Shape;a.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);a.alpha=0;a.on("mousedown",function(){});s_oStage.addChild(a);(new createjs.Tween.get(a)).to({alpha:.7},500);c=new createjs.Container;s_oStage.addChild(c);var g=s_oSpriteLibrary.getSprite("msg_box"),e=createBitmap(g);e.regX=g.width/2;e.regY=g.height/2;c.addChild(e);c.x=CANVAS_WIDTH/2;c.y=CANVAS_HEIGHT+g.height/2;(new createjs.Tween.get(c)).to({y:CANVAS_HEIGHT/
2},500,createjs.Ease.quartIn);g=-g.height/2+120;(new CTLText(c,-250,g-70,500,140,40,"center","#000",PRIMARY_FONT,1,0,0,TEXT_GAMEOVER,!0,!0,!0,!1)).setOutline(5);new CTLText(c,-250,g-70,500,140,40,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_GAMEOVER,!0,!0,!0,!1);g=s_oSpriteLibrary.getSprite("finish");e=createBitmap(g);e.regX=g.width/2;e.regY=g.height;e.y=154;e.scaleX=e.scaleY=.6;c.addChild(e);g=s_oSpriteLibrary.getSprite("but_home");b=new CGfxButton(0,100,g,c);b.addEventListener(ON_MOUSE_UP,this._onHome,
this);b.pulseAnimation()};this.unload=function(){s_oStage.removeChild(c);a.off("mousedown",function(){});b.unload()};this.show=function(){playSound("arrive_win",1,0);$(s_oMain).trigger("share_event",s_iTotalScore)};this._onHome=function(){a.off("mousedown",function(){});s_oStage.removeChild(c);s_oGame.onExit()};this._init();return this}
function CPlayer(a,c,b,g){var e,d,k,m,h,f,t,l,r,q,z,A,x,p,u,L,w,B,D,H,O,I,G,K,M,V,Q,R,P,J;this._init=function(a,b,c,l){this.reset();z=PLAYER_MAX_SPEED;A=PLAYER_ACCELERATION;x=-z;p=-PLAYER_DECELERATION;u=-z/2;L=z/4;H=new CFoamParticle;H.addBottom(a,b-60,l);H.setBottomAlpha(linearFunction(0,0,1,0,1));O=new createjs.Container;O.x=a;O.y=b;c.addChild(O);c=s_oSpriteLibrary.getSprite("baloon_mc");M=createBitmap(c);M.regX=c.width/2;M.regY=c.height/2;M.y=-260;M.alpha=0;O.addChild(M);I=new createjs.Container;
O.addChild(I);c=s_oSpriteLibrary.getSprite("player");a=c.width/3;b=c.height;c=new createjs.SpriteSheet({images:[c],frames:{width:a,height:b,regX:a/2,regY:b},animations:{left:[0],right:[1],straight:[2]}});G=createSprite(c,"straight",a/2,b,a,b);I.addChild(G);H.addBack(0,-6,I);H.setSpeed(linearFunction(0,0,1,2,FPS));H.setBackAlpha(linearFunction(0,0,.2,0,1));w=PLAYER_COLLIDER_WIDTH;this.oscillatoryAnim()};this.oscillatoryAnim=function(){var a=linearFunction(q/z,0,1,8,4),b=linearFunction(q/z,0,1,2,.2);
b=-b+Math.random()*b;var c=this;V=createjs.Tween.get(I).to({y:a,rotation:b},2E3).to({y:0,rotation:0},2E3).call(function(){c.oscillatoryAnim()})};this.reset=function(){h=Q=f=m=k=d=e=!1;D=P=R=B=q=r=l=t=0;K=s_oGame.findSegment(t+PLAYER_Z_FROMCAMERA)};this.setAcceleration=function(a){A=a};this.setMaxSpeed=function(a){z=a;x=-z;p=-PLAYER_DECELERATION;u=-z/2;L=z/4};this.stopAll=function(){this.stopLeft();this.stopRight();this.stopAccelerate()};this.stopLeft=function(){e&&(e=!1,G.gotoAndStop("straight"),
stopSound(s_aSounds.brake))};this.stopRight=function(){d&&(d=!1,G.gotoAndStop("straight"),stopSound(s_aSounds.brake))};this.stopAccelerate=function(){k=!1;stopSound(s_aSounds.engine);stopSound(s_aSounds.engine_stall)};this.stopBrake=function(){m=!1};this.moveLeft=function(){0!==q&&(soundPlaying(s_aSounds.brake)||playSound("brake",.5,!1),d=!1,e=!0,G.gotoAndStop("left"))};this.moveRight=function(){0!==q&&(soundPlaying(s_aSounds.brake)||playSound("brake",.5,!1),e=!1,d=!0,G.gotoAndStop("right"))};this.moveAccelerate=
function(){m=!1;k=!0};this.moveBrake=function(){k=!1;m=!0};this._increase=function(a,b,c){for(a+=b;a>=c;)a-=c,s_oGame.trackCompleted();for(;0>a;)a+=c;return a};this._accelerate=function(a,b,c){return a+b*c};this._limit=function(a,b,c){return Math.max(b,Math.min(a,c))};this.getPlayerWidth=function(){return w};this.getPosition=function(){return{x:l,z:t,y:r}};this.getSpeedRatio=function(){return D};this.setPosition=function(a){t=a};this.setHeight=function(a){r=a};this.autoPilot=function(){.5<l?(d=!1,
e=!0):-.5>l?(d=!0,e=!1):.1>=l&&-.1<=l&&(d=e=!1)};this.getMaxSpeed=function(){return z};this.getCurSpeed=function(){return q};this.setCurSpeed=function(a){q=a};this.getPlayerSegment=function(){return K};this.getFrontPlayerSegment=function(){return s_oGame.findSegment(t+SEGMENT_LENGTH+PLAYER_Z_FROMCAMERA)};this.stopEngineSound=function(){stopSound(s_aSounds.engine);stopSound(s_aSounds.engine_stall)};this.damageAnim=function(){f||(f=!0,playSound("crash",1,!1),createjs.Tween.get(M,{override:!0}).to({alpha:1},
250,createjs.Ease.cubicOut).to({alpha:0},250,createjs.Ease.cubicIn).call(function(){f=!1}))};this.isOutOfRoad=function(){return h};this.isJumping=function(){return Q};this._landAnimation=function(a){playSound("landing",1,!1);var b=O.y;a=linearFunction(a,0,1,20,50);.5>Math.random()?createjs.Tween.get(O).to({y:b+a},200,createjs.Ease.cubicOut).to({y:b-2*a/3},150,createjs.Ease.sineIn).to({y:b+a/3},150,createjs.Ease.sineOut).to({y:b},300,createjs.Ease.sineIn):createjs.Tween.get(O).to({y:b+a},200,createjs.Ease.cubicOut).to({y:b-
3*a/4},150,createjs.Ease.sineIn).to({y:b+2*a/4},150,createjs.Ease.sineOut).to({y:b-1*a/4},150,createjs.Ease.sineIn).to({y:b},300,createjs.Ease.sineOut)};this._updateXMovement=function(a){var b=a*D*D*K.curve*CENTRIFUGAL_FORCE/TERRAIN_ADHERENCE;e?(B-=TERRAIN_INCREASE_INERTIA*D,B<-TERRAIN_MAX_INERTIA&&(B=-TERRAIN_MAX_INERTIA),H.setBackRotation(-2),l=l-b-a,s_oGame.rotateScreen(ROTATE_LEFT)):d?(B+=TERRAIN_INCREASE_INERTIA*D,B>TERRAIN_MAX_INERTIA&&(B=TERRAIN_MAX_INERTIA),H.setBackRotation(2),l=l-b+a,s_oGame.rotateScreen(ROTATE_RIGHT)):
(H.setBackRotation(0),l=l-b+B,s_oGame.rotateScreen(ROTATE_CENTER));0<B?(B-=TERRAIN_DECREASE_INERTIA,0>B&&(B=0)):0>B&&(B+=TERRAIN_DECREASE_INERTIA,0<B&&(B=0))};this._updateXInAir=function(a){var b=a*D*D*K.curve*CENTRIFUGAL_FORCE/TERRAIN_ADHERENCE;J.left?(B-=TERRAIN_INCREASE_INERTIA*D,B<-TERRAIN_MAX_INERTIA&&(B=-TERRAIN_MAX_INERTIA),l=l-b-a):J.right?(B+=TERRAIN_INCREASE_INERTIA*D,B>TERRAIN_MAX_INERTIA&&(B=TERRAIN_MAX_INERTIA),l=l-b+a):l=l-b+B;0<B?(B-=TERRAIN_DECREASE_INERTIA,0>B&&(B=0)):0>B&&(B+=TERRAIN_DECREASE_INERTIA,
0<B&&(B=0))};this._updateJump=function(){K=s_oGame.findSegment(t+PLAYER_Z_FROMCAMERA);if(K.p1.world.y>K.p2.world.y&&.6<D){if(!Q){P=0;var a=Util.percentRemaining(t+PLAYER_Z_FROMCAMERA,SEGMENT_LENGTH);R=Util.interpolate(K.p1.world.y,K.p2.world.y,a);J={right:d,left:e}}Q=!0}if(Q){H.setBottomVisible(!1);a=linearFunction(R,0,MAX_TIDE_HEIGHT,0,1);a*=D;var b=Math.floor(linearFunction(a,0,1,10,25));r=R-easeInBack(P,0,R,b);P++;P>=b&&(r=P=0,Q=!1,J={right:!1,left:!1},H.setBottomVisible(!0),this._landAnimation(a))}else a=
Util.percentRemaining(t+PLAYER_Z_FROMCAMERA,SEGMENT_LENGTH),r=Util.interpolate(K.p1.world.y,K.p2.world.y,a)};this.update=function(a){D=q/z;t=this._increase(t,a*q,TRACK_LENGTH);var b=2*a*TERRAIN_ADHERENCE*D;H.setSpeed(linearFunction(D,0,1,2,FPS));H.setBottomAlpha(linearFunction(D,0,.2,0,1));H.setBackAlpha(linearFunction(D,0,.2,1,1));var c=linearFunction(D,0,.1,0,1);1.3<c&&(c=1.3);H.setBackScale(c);this._updateJump();Q?(this._updateXInAir(b),V.timeScale=0):(this._updateXMovement(b),V.timeScale=linearFunction(D,
0,1,1,10));k?(q=this._accelerate(q,A,a),1===D?soundPlaying(s_aSounds.engine_stall)||(stopSound(s_aSounds.engine),stopSound(s_aSounds.engine_reverse),playSound("engine_stall",.7,!0)):0<q&&!soundPlaying(s_aSounds.engine)&&!s_oGame.playerCollide()&&(stopSound(s_aSounds.brake),stopSound(s_aSounds.engine_stall),stopSound(s_aSounds.engine_reverse),playSound("engine",.7,!1),b=linearFunction(D,0,1,0,soundDuration(s_aSounds.engine)),soundSeek(s_aSounds.engine,b))):m?(q=this._accelerate(q,x,a),0<q&&(stopSound(s_aSounds.engine),
stopSound(s_aSounds.engine_stall),stopSound(s_aSounds.engine_reverse),soundPlaying(s_aSounds.brake)||playSound("brake",.5,!1))):(q=this._accelerate(q,p,a),0<q&&!soundPlaying(s_aSounds.engine_reverse)&&(stopSound(s_aSounds.brake),stopSound(s_aSounds.engine_stall),stopSound(s_aSounds.engine),playSound("engine_reverse",.7,!1),b=linearFunction(D,0,1,soundDuration(s_aSounds.engine_reverse),0),soundSeek(s_aSounds.engine_reverse,b)));h=!1;if(-1>l||1<l)q>L&&(q=this._accelerate(q,u,a)),h=!0;l=this._limit(l,
-ROAD_BOUNDS,ROAD_BOUNDS);q=this._limit(q,0,z)};this._init(a,c,b,g)}
var Render={polygon:function(a,c,b,g,e,d,k,m,h,f,t){t?isFirefox()||isSafari()||isExplorer()?(a.graphics.beginFill(f),t=200,a.graphics.moveTo(-t,b),a.graphics.lineTo(CANVAS_WIDTH+t,e),a.graphics.lineTo(CANVAS_WIDTH+t,k),a.graphics.lineTo(-t,h)):(d=t.width,c=new createjs.Matrix2D((c-g)/(2*d)/2,0,0,(e-k)/d,c,e),a.graphics.beginBitmapFill(t,"repeat",c),t=200,a.graphics.moveTo(-t,b),a.graphics.lineTo(CANVAS_WIDTH+t,e),a.graphics.lineTo(CANVAS_WIDTH+t,k),a.graphics.lineTo(-t,h),a.graphics.endFill()):(a.graphics.beginFill(f),
t=200,a.graphics.moveTo(-t,b),a.graphics.lineTo(CANVAS_WIDTH+t,e),a.graphics.lineTo(CANVAS_WIDTH+t,k),a.graphics.lineTo(-t,h),a.graphics.endFill())},segment:function(a,c,b,g,e,d,k,m,h,f,t){Render.rumbleWidth(d,b);Render.rumbleWidth(h,b);Render.laneMarkerWidth(d,b);Render.laneMarkerWidth(h,b);Render.polygon(a,g-d,e,g+d,e,k+h,m,k-h,m,f.road,t)},background:function(a,c,b,g,e,d,k){var m=e.w/2;d=e.x+Math.floor(e.w*(d||0));var h=e.y,f=Math.min(m,e.x+e.w-d),t=e.h;k=k||0;var l=Math.floor(f/m*b);a.drawImage(c,
d,h,f,t,0,k,l,g);f<m&&a.drawImage(c,e.x,h,m-f,t,l-1,k,b-l,g)},sprite:function(a,c,b,g,e,d,k,m){var h=b*ROAD_PER_SCALE_PER_HALF_CANVAS_WIDTH;b=a.width*h;h*=a.height;var f=h/a.height;e+=h*(k||0);k=m?Math.max(0,e+h-m):0;k<h?(c.x=g+b*(d||0),c.y=e,c.scaleX=c.scaleY=f,a=new createjs.Rectangle(0,0,a.width,a.height-a.height*k/h),c.sourceRect=a):c.visible=!1},rumbleWidth:function(a,c){return a/Math.max(6,2*c)},laneMarkerWidth:function(a,c){return a/Math.max(32,8*c)}};
function CRoad(a,c,b,g){var e,d,k,m,h,f,t;this._init=function(a,b,c){e=null;d=CAMERA_DEPTH;h=m=k=0;t=new CTideController;f=[];this.resetRoad()};this.findSegment=function(a){return f[Math.floor(a/SEGMENT_LENGTH)%f.length]};this.findRelativeSegment=function(a){return 0>a?f[Math.floor(f.length+a/SEGMENT_LENGTH%f.length)]:f[Math.floor(a/SEGMENT_LENGTH)%f.length]};this.lastX=function(){return 0===f.length?0:f[f.length-1].p2.world.x};this.lastY=function(){return 0===f.length?0:f[f.length-1].p2.world.y};
this.addSegment=function(a,b){var c=f.length;f.push({index:c,p1:{world:{x:this.lastX(),y:this.lastY(),z:c*SEGMENT_LENGTH},camera:{},screen:{},backup:{}},p2:{world:{x:this.lastX()+a,y:b,z:(c+1)*SEGMENT_LENGTH},camera:{},screen:{},backup:{}},curve:a,sprites:[],cars:[],coins:[],color:Math.floor(c/RUMBLE_LENGTH)%2?COLORS.DARK:COLORS.LIGHT})};this.addRoad=function(a,b,c,d,e){var l=this.lastY();e=l+Util.toInt(e,0)*SEGMENT_LENGTH;var f,h=a+b+c;for(f=0;f<a;f++)this.addSegment(Util.easeIn(0,d,f/a),Util.easeInOut(l,
e,f/h));for(f=0;f<b;f++)this.addSegment(d,Util.easeInOut(l,e,(a+f)/h));for(f=0;f<c;f++)this.addSegment(Util.easeInOut(d,0,f/c),Util.easeInOut(l,e,(a+b+f)/h))};this.addStraight=function(a){a=a||ROAD.LENGTH.MEDIUM;this.addRoad(a,a,a,0)};this.addHill=function(a,b){a=a||ROAD.LENGTH.MEDIUM;b=b||ROAD.HILL.MEDIUM;this.addRoad(a,a,a,0,b)};this.addCurve=function(a,b,c){a=a||ROAD.LENGTH.MEDIUM;b=b||ROAD.CURVE.MEDIUM;this.addRoad(a,a,a,b)};this.addStandardRoad=function(a,b,c){a=a||ROAD.LENGTH.MEDIUM;b=b||ROAD.CURVE.NONE;
c=c||ROAD.HILL.NONE;this.addRoad(a,a,a,b,c)};this.addLowRollingHills=function(a,b){a=a||ROAD.LENGTH.SHORT;b=b||ROAD.HILL.LOW;this.addRoad(a,a,a,0,b/2);this.addRoad(a,a,a,0,-b);this.addRoad(a,a,a,ROAD.CURVE.EASY,b);this.addRoad(a,a,a,0,0);this.addRoad(a,a,a,-ROAD.CURVE.EASY,b/2);this.addRoad(a,a,a,0,0)};this.addSCurves=function(a,b,c){a=a||ROAD.LENGTH.MEDIUM;b=b||ROAD.CURVE.MEDIUM;c=c||ROAD.HILL.NONE;var d=0<=b?1:-1;var l=0<=c?1:-1;b=Math.abs(b);c=Math.abs(c);switch(b){case ROAD.CURVE.EASY:var f=ROAD.CURVE.NONE;
var e=ROAD.CURVE.EASY;break;case ROAD.CURVE.MEDIUM:f=ROAD.CURVE.EASY;e=ROAD.CURVE.MEDIUM;break;case ROAD.CURVE.HARD:f=ROAD.CURVE.MEDIUM,e=ROAD.CURVE.HARD}switch(c){case ROAD.HILL.EASY:var h=ROAD.HILL.NONE;var k=ROAD.HILL.LOW;break;case ROAD.HILL.MEDIUM:h=ROAD.HILL.LOW;k=ROAD.HILL.MEDIUM;break;case ROAD.HILL.HIGH:h=ROAD.HILL.MEDIUM,k=ROAD.HILL.HIGH}this.addRoad(a,a,a,d*f,ROAD.HILL.NONE);this.addRoad(a,a,a,d*e,l*k);this.addRoad(a,a,a,d*f,-l*h);this.addRoad(a,a,a,-d*f,l*k);this.addRoad(a,a,a,-d*e,-l*
h)};this.addBumps=function(a,b){a=a||ROAD.LENGTH.SHORT/2;b=b||ROAD.CURVE.NONE;this.addRoad(a,a,a,0,a/2.5);this.addRoad(a,a,a,0,-a/6.25);this.addRoad(a,a,a,b,-a/2.5);this.addRoad(a,a,a,0,a/1,5625);this.addRoad(a,a,a,0,a/2.5);this.addRoad(a,a,a,-b,-a/1.785);this.addRoad(a,a,a,0,a/2.5);this.addRoad(a,a,a,0,-a/6.25)};this.addDownhillToEnd=function(a,b){a=a||200;b=b||ROAD.CURVE.NONE;this.addRoad(a,a,a,b,-Math.round(this.lastY()/SEGMENT_LENGTH))};this.resetRoad=function(){f=[];for(var a=ROAD_INFO[b],c=
0;c<a.length;c++){var d=a[c];switch(d.roadtype){case ROAD.TYPE.STANDARD:this.addStandardRoad(d.length,d.curve,d.hill);break;case ROAD.TYPE.CURVE_S:this.addSCurves(d.length,d.curve,d.hill);break;case ROAD.TYPE.BUMPS:this.addBumps(d.length,d.curve);break;case ROAD.TYPE.FINAL:this.addDownhillToEnd(d.length,d.curve)}}f[this.findSegment(PLAYER_Z_FROMCAMERA).index+2].color=COLORS.START;f[this.findSegment(PLAYER_Z_FROMCAMERA).index+3].color=COLORS.START;for(a=0;a<RUMBLE_LENGTH;a++)f[f.length-1-a].color=
COLORS.FINISH;e=f.length*SEGMENT_LENGTH};this.setCameraDepth=function(a){d=a};this.clearVisual=function(b){a.graphics.clear();b=this.findSegment(b.z);var c;for(c=DRAW_DISTANCE-1;0<c;c--){var d=f[(b.index+c)%f.length];for(var e=0;e<d.cars.length;e++){var h=d.cars[e];h.setVisible(!1)}for(e=0;e<d.sprites.length;e++)h=d.sprites[e],h.source.visible=!1}t.flattenTide()};this.waterAnimationMovement=function(){h++;3<=h&&(h=0,k++,10<=k&&(k=0),0===k%3&&(m++,10<=m&&(m=0)))};this.setTide=function(a,b,c){for(var d=
0;d<b;d++){var e=this.findRelativeSegment(a+d*SEGMENT_LENGTH);e.p1.world.y=Util.easeOut(0,c,d/b*2);e.p2.world.y=Util.easeOut(0,c,(d+1)/b*2)}for(d=b;d<2*b;d++)e=this.findRelativeSegment(a+d*SEGMENT_LENGTH),e.p1.world.y=0,e.p2.world.y=0};this.update=function(b){a.graphics.clear();var h=b.z,g=b.x,l=this.findSegment(h),A=Util.percentRemaining(h,SEGMENT_LENGTH),x=CANVAS_HEIGHT,p=0,u=-(l.curve*A);this.waterAnimationMovement();var L=g*ROAD_WIDTH;A=b.y+CAMERA_HEIGHT;var w;for(w=0;w<DRAW_DISTANCE;w++){b=f[(l.index+
w)%f.length];b.looped=b.index<l.index;b.clip=x;var B=h-(b.looped?e:0);Util.project(b.p1,L-p,A,B,d);Util.project(b.p2,L-p-u,A,B,d);p+=u;u+=b.curve;b.p1.camera.z<=d||b.p2.screen.y>=b.p1.screen.y||b.p2.screen.y>=x||(Render.segment(a,CANVAS_WIDTH,NUM_LANES,b.p1.screen.x,b.p1.screen.y,b.p1.screen.w,b.p2.screen.x,b.p2.screen.y,b.p2.screen.w,b.color,10>w?s_oSpriteLibrary.getSprite("caustics_lod0_"+k):s_oSpriteLibrary.getSprite("caustics_lod0_"+m)),x=b.p2.screen.y)}L=0;for(w=DRAW_DISTANCE-1;0<w;w--){b=f[(l.index+
w)%f.length];for(p=0;p<b.cars.length;p++){x=b.cars[p];u=x.getZ()-h;B=x.getOffset()-g;u>CAR_FARVIEW_OFFSET?b.curve>-CAR_CURVEVIEW_OFFSET&&b.curve<CAR_CURVEVIEW_OFFSET?x.setDirection(CAR_CENTER):b.curve<CAR_CURVEVIEW_OFFSET?x.setDirection(CAR_LEFT):x.setDirection(CAR_RIGHT):B>-CAR_SIDEVIEW_OFFSET&&x.getOffset()-g<CAR_SIDEVIEW_OFFSET?x.setDirection(CAR_CENTER):B<-CAR_SIDEVIEW_OFFSET?x.setDirection(CAR_RIGHT):x.setDirection(CAR_LEFT);u=x.getSprite();B=Util.interpolate(b.p1.screen.scale,b.p2.screen.scale,
x.getPercent());var D=Util.interpolate(b.p1.screen.x,b.p2.screen.x,x.getPercent())+B*x.getOffset()*ROAD_PER_HALF_CANVAS_WIDTH;var H=Util.interpolate(b.p1.screen.y,b.p2.screen.y,x.getPercent());x.setVisible(!0);c.setChildIndex(x.getCar(),L++);Render.sprite(u,x.getCar(),B,D,H,-.5,-1,b.clip);c.setChildIndex(x.getFoam(),L++);Render.sprite(x.getFoamDim(),x.getFoam(),B*x.getFoamProportion(),D,H,-.5,-1,b.clip)}for(p=0;p<b.sprites.length;p++)u=b.sprites[p],B=b.p1.screen.scale,D=b.p1.screen.x+B*u.offset*ROAD_PER_HALF_CANVAS_WIDTH,
H=u.grounded?Math.round(HALF_CANVAS_HEIGHT-b.p1.screen.scale*-A*HALF_CANVAS_HEIGHT):b.p1.screen.y,u.source.visible=!0,c.setChildIndex(u.source,L++),Render.sprite(u.sprite,u.source,B,D,H,0>u.offset?-1:0,-1,b.clip)}for(w=DRAW_DISTANCE+20;w>DRAW_DISTANCE;w--)for(b=f[(l.index+w)%f.length],p=0;p<b.cars.length;p++)x=b.cars[p],x.setVisible(!1);s_oGame.getState()!==STATE_GAME_START&&t.update();h=(l.index-25)%f.length;if(0<h)for(g=0;25>g;g++){b=f[h+g];for(p=0;p<b.sprites.length;p++)u=b.sprites[p],u.source.visible=
!1;for(p=0;p<b.cars.length;p++)x=b.cars[p],x.setVisible(!1)}else for(g=f.length+h-1;g<f.length;g++){b=f[g];for(p=0;p<b.sprites.length;p++)u=b.sprites[p],u.source.visible=!1;for(p=0;p<b.cars.length;p++)x=b.cars[p],x.setVisible(!1)}};this.exponentialFog=function(a,b){return 1/Math.pow(Math.E,a*a*b)};this.getTrackLength=function(){return e};this.getSegments=function(){return f};this._init(a,c,b);s_oRoad=this}var s_oRoad,CAR_CENTER=0,CAR_LEFT=1,CAR_RIGHT=2;
function CCar(a,c,b,g,e){var d,k,m,h,f,t,l,r,q,z;this._init=function(a,b,c,e,h){d=b;k=c;m=e;f=0;l=[];l[CAR_CENTER]=s_oSpriteLibrary.getSprite(a+"_center");l[CAR_LEFT]=s_oSpriteLibrary.getSprite(a+"_left");l[CAR_RIGHT]=s_oSpriteLibrary.getSprite(a+"_right");z=l[CAR_CENTER];q=createBitmap(z);q.x=500;q.visible=!1;h.addChild(q);t=l[CAR_CENTER].width/200;r=[];for(b=0;29>b;b++)a=s_oSpriteLibrary.getSprite("foam_back_"+b),a=createBitmap(a),a.x=500,a.regY=-10,r.push(a),h.addChild(a),a.visible=!1};this.getCar=
function(){return q};this.getSprite=function(){return z};this.getFoam=function(){return r[f]};this.getFoamDim=function(){return new createjs.Rectangle(0,0,128,116)};this.getFoamProportion=function(){return t};this.getOffset=function(){return d};this.getZ=function(){return k};this.getSpeed=function(){return m};this.getPercent=function(){return h};this.setDirection=function(a){z=l[a];q.image=l[a]};this.setVisible=function(a){for(var b=0;b<r.length;b++)r[b].visible=!1;q.visible=a;r[f].visible=a};this.updateCarOffset=
function(a,b){var c,e;var f=A.getSprite().width*SPRITES.SCALE;if(a.index-b.getPlayerSegment().index>DRAW_DISTANCE)return q.visible=!1,0;for(c=2;20>c;c++){var h=s_oGame.getSegments();var g=h[(a.index+c)%h.length];if(g===b.getPlayerSegment()&&m>b.getCurSpeed()&&Util.overlap(b.getPosition().x,b.getPlayerWidth(),d,f,.8))return f=.5<b.getPosition().x?-1:-.5>b.getPosition().x?1:d>b.getPosition().x?1:-1,1*f/c*(m-b.getCurSpeed())/b.getMaxSpeed();for(e=0;e<g.cars.length;e++){h=g.cars[e];var k=h.getSprite().width*
SPRITES.SCALE;if(m>h.getSpeed()&&Util.overlap(d,f,h.getOffset(),k,1.2))return f=.5<h.getOffset()?-1:-.5>h.getOffset()?1:d>h.getOffset()?1:-1,1*f/c*(m-h.getSpeed())/b.getMaxSpeed()}}return-.9>d?.1:.9<d?-.1:0};this.update=function(a,b){f++;f===r.length&&(f=0);var c=s_oGame.findSegment(k);d+=this.updateCarOffset(c,b);k=Util.increase(k,a*m,TRACK_LENGTH);h=Util.percentRemaining(k,SEGMENT_LENGTH);var e=s_oGame.findSegment(k);if(c!==e){var g=c.cars.indexOf(A);c.cars.splice(g,1);e.cars.push(A)}};var A=this;
this._init(a,c,b,g,e)}
function CLevelBuilder(a,c,b,g){var e;this._init=function(a,b,c,h){e=LEVEL_INFO[h].num_cars;this._initTerrainInfo();this._initFinishLane();this._initSprites();this._initCars()};this._attachSprites=function(){for(var a=0;a<s_oGame.getSegments().length;a++)for(var c=s_oGame.getSegments()[a].sprites,e=0;e<c.length;e++)b.addChildAt(c[e].source,0)};this._addSprite=function(a,b,c){if(void 0!==s_oGame.getSegments()[a]){var d=s_oSpriteLibrary.getSprite(b.name),e=createBitmap(d);e.visible=!1;-1!==b.name.indexOf("buoy")?
e.regY=-d.height/4:e.regY=-d.height/3;var g=d.width*SPRITES.SCALE,k=c+g/2*(0<c?1:-1);b.collision&&(b.collision.center&&(k=c+(0<c?b.collision.center:-(d.width-b.collision.center))*SPRITES.SCALE),b.collision.width&&(g=b.collision.width*SPRITES.SCALE));var m=!1;if(b.name===SPRITES.PALM_TREE.name||b.name===SPRITES.TREE1.name||b.name===SPRITES.TREE2.name)m=!0;s_oGame.getSegments()[a].sprites.push({grounded:m,source:e,offset:c,sprite:d,collision:{center:k,width:g}})}};this._addDensityElements=function(a,
b,c,e,f,g,l){g=g||100;l=l||1;if(a===AMBIENT.SIDE.BOTH)this._addDensityElements(AMBIENT.SIDE.RIGHT,b,c,e,f,g,l),this._addDensityElements(AMBIENT.SIDE.LEFT,b,c,e,f,g,l);else for(;c<=e;c+=l)if(100*Math.random()<=g){var d=c+Util.randomInt(0,5);this._addSprite(d,b,a+a*f+2*a*Math.random())}};this._addPreciseElements=function(a,b,c,e,f,g,l){g=g||100;l=l||1;if(a===AMBIENT.SIDE.BOTH)this._addPreciseElements(AMBIENT.SIDE.RIGHT,b,c,e,f,g,l),this._addPreciseElements(AMBIENT.SIDE.LEFT,b,c,e,f,g,l);else for(;c<=
e;c+=l)100*Math.random()<=g&&this._addSprite(c,b,a+a*f)};this._initSprites=function(){var a,b=AMBIENT_INFO[g];for(a=0;a<b.length;a++){var c=b[a];if(c.segments.constructor===Array){var e=c.segments[0];var f=c.segments[1]}else f=e=c.segments;switch(c.disposition){case AMBIENT.DISPOSITION.PRECISE:this._addPreciseElements(c.side,c.sprite,e,f,c.position,c.occurrence,c.repetitionevery);break;case AMBIENT.DISPOSITION.DENSITY:this._addDensityElements(c.side,c.sprite,e,f,c.position,c.occurrence,c.repetitionevery)}}this._attachSprites()};
this._initFinishLane=function(){var a=s_oSpriteLibrary.getSprite("finish"),b=createBitmap(a);b.visible=!1;b.regX=a.width/2;s_oGame.getSegments()[s_oGame.getSegments().length-1].sprites.push({source:b,offset:0,sprite:a,collision:{center:0,width:0}})};this._initCars=function(){var d;for(d=0;d<e;d++){var g=Math.random()*Util.randomChoice([-.8,.8]);var m=Math.floor(Math.random()*s_oGame.getSegments().length)*SEGMENT_LENGTH;var h=Util.randomChoice(SPRITES.ENEMIES);var f=a.getMaxSpeed()/4+Math.random()*
a.getMaxSpeed()/(h==SPRITES.SEMI?4:2);g=new CCar(h,g,m,f,b);m=s_oGame.findSegment(m);m.cars.push(g);c.push(g)}};this._initTerrainInfo=function(){TERRAIN_ADHERENCE=LEVEL_INFO[g].terrain.adherence;TERRAIN_MAX_INERTIA=LEVEL_INFO[g].terrain.max_inertia;NUM_LANES=LEVEL_INFO[g].terrain.num_lanes;ROAD_BOUNDS=LEVEL_INFO[g].terrain.roadbounds;TIDE_VARIABLE_FREQUENCY=LEVEL_INFO[g].tide.frequency;TIDE_VARIABLE_HEIGHT=LEVEL_INFO[g].tide.height};this._init(a,c,b,g)}
function CWorldMenu(){var a,c,b,g,e,d,k,m,h,f,t,l,r,q,z,A=null,x=null;this._init=function(){t=createBitmap(s_oSpriteLibrary.getSprite("bg_select"));s_oStage.addChild(t);var p=CANVAS_WIDTH/2,u=600;(new CTLText(s_oStage,p-u/2,210,u,80,40,"center","#000",PRIMARY_FONT,1,0,0,TEXT_SELECT_WORLD,!0,!0,!0,!1)).setOutline(5);new CTLText(s_oStage,p-u/2,210,u,80,40,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_SELECT_WORLD,!0,!0,!0,!1);h=[];for(p=0;p<NUM_WORLDS*NUM_TRACKS_PER_WORLD;p++)h[p]=s_aTimeScore[p];f=[];u=
500;for(p=0;p<NUM_WORLDS;p++){var L=s_oSpriteLibrary.getSprite("but_world"+p),w=CANVAS_WIDTH/2-u/2+u/(NUM_WORLDS-1)*p,B=s_oSpriteLibrary.getSprite("image_"+p),D=s_oSpriteLibrary.getSprite("cover_"+p);f[p]=new CLevelBut(w,CANVAS_HEIGHT/2,L,D,B,s_oStage);f[p].addEventListenerWithParams(ON_MOUSE_UP,this._onLevelBut,this,p);f[p].disable()}this._setLevelActive();u=s_oSpriteLibrary.getSprite("but_exit");k=CANVAS_WIDTH-u.width/2-12;m=u.height/2+16;l=new CGfxButton(k,m,u,s_oStage);l.addEventListener(ON_MOUSE_UP,
this._onExit,this);b=k-u.width-12;g=u.height/2+16;if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)u=s_oSpriteLibrary.getSprite("audio_icon"),q=new CToggle(b,g,u,s_bAudioActive),q.addEventListener(ON_MOUSE_UP,this._onAudioToggle,this);u=window.document;p=u.documentElement;A=p.requestFullscreen||p.mozRequestFullScreen||p.webkitRequestFullScreen||p.msRequestFullscreen;x=u.exitFullscreen||u.mozCancelFullScreen||u.webkitExitFullscreen||u.msExitFullscreen;!1===ENABLE_FULLSCREEN&&(A=!1);A&&screenfull.isEnabled&&
(u=s_oSpriteLibrary.getSprite("but_fullscreen"),a=u.width/4+12,c=u.height/2+16,z=new CToggle(a,c,u,s_bFullscreen,s_oStage),z.addEventListener(ON_MOUSE_UP,this._onFullscreenRelease,this));e=64;d=CANVAS_HEIGHT-40;r=new createjs.Container;r.x=e;r.y=d;s_oStage.addChild(r);u=new createjs.Text(" "+s_iTotalScore,"bold 30px "+PRIMARY_FONT,"#000000");u.textAlign="left";u.textBaseline="middle";u.lineWidth=500;u.outline=5;r.addChild(u);u=new createjs.Text(" "+s_iTotalScore,"bold 30px "+PRIMARY_FONT,"#ffffff");
u.textAlign="left";u.textBaseline="middle";u.lineWidth=500;r.addChild(u);u=s_oSpriteLibrary.getSprite("star");p=createBitmap(u);p.regX=u.width/2;p.regY=u.height/2;p.x=-u.width/2;r.addChild(p);this.refreshButtonPos(s_iOffsetX,s_iOffsetY)};this.refreshButtonPos=function(f,h){l.setPosition(k-f,h+m);!1!==DISABLE_SOUND_MOBILE&&!1!==s_bMobile||q.setPosition(b-f,h+g);A&&screenfull.isEnabled&&z.setPosition(a+f,c+h);r.x=e+f;r.y=d-h};this.unload=function(){for(var a=0;a<f.length;a++)f[a].unload();s_oWorldMenu=
null;s_oStage.removeAllChildren();if(!1===DISABLE_SOUND_MOBILE||!1===s_bMobile)q.unload(),q=null;A&&screenfull.isEnabled&&z.unload()};this._setLevelActive=function(){for(var a=0,b=0;b<h.length;b++)0<h[b]&&(a=b+1);if(a===NUM_TRACKS_PER_WORLD*f.length)for(b=0;b<f.length;b++)f[b].enable();else{a=Math.floor(a/NUM_TRACKS_PER_WORLD);for(b=0;b<a+1;b++)f[b].enable();f[a].pulseAnimation()}};this._onLevelBut=function(a){var b=a*NUM_TRACKS_PER_WORLD;new CTrackMenu(a,[h[b],h[b+1],h[b+2]])};this.resetFullscreenBut=
function(){A&&screenfull.isEnabled&&z.setActive(s_bFullscreen)};this._onFullscreenRelease=function(){s_bFullscreen?x.call(window.document):A.call(window.document.documentElement);sizeHandler()};this._onAudioToggle=function(){Howler.mute(s_bAudioActive);s_bAudioActive=!s_bAudioActive};this._onExit=function(){$(s_oMain).trigger("end_session");this.unload();s_oMain.gotoMenu()};s_oWorldMenu=this;this._init()}var s_oWorldMenu=null;
function CTrackMenu(a,c){var b,g,e,d,k;this._init=function(a,c){e=new createjs.Shape;e.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);e.alpha=0;e.on("mousedown",function(){});s_oStage.addChild(e);(new createjs.Tween.get(e)).to({alpha:.7},500);k=new createjs.Container;s_oStage.addChild(k);var f=s_oSpriteLibrary.getSprite("msg_box"),h=createBitmap(f);h.regX=f.width/2;h.regY=f.height/2;k.addChild(h);h=-f.height/2+90;(new CTLText(k,-250,h-20,500,40,40,"center","#000",PRIMARY_FONT,
1,0,0,TEXT_SELECT_TRACK,!0,!0,!1,!1)).setOutline(5);new CTLText(k,-250,h-20,500,40,40,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_SELECT_TRACK,!0,!0,!1,!1);k.x=CANVAS_WIDTH/2;k.y=CANVAS_HEIGHT+f.height/2+70;b=k.y;(new createjs.Tween.get(k)).to({y:CANVAS_HEIGHT/2},500,createjs.Ease.quartIn);f=s_oSpriteLibrary.getSprite("but_level");h=s_oSpriteLibrary.getSprite("image_"+a);var l=s_oSpriteLibrary.getSprite("cover_"+a);g=[];for(var m=0;m<NUM_TRACKS_PER_WORLD;m++){var q=m+1;g[m]=new CLevelBut(-180+180*m,0,
f,l,h,k);g[m].addEventListenerWithParams(ON_MOUSE_UP,this._onStageBut,this,m);g[m].addLevelText(q);g[m].disable()}this._setStageInfo();f=s_oSpriteLibrary.getSprite("but_exit");d=new CGfxButton(326,-200,f,k);d.addEventListener(ON_MOUSE_UP,this._onBack,this)};this.unload=function(){for(var a=0;a<NUM_TRACKS_PER_WORLD;a++)g[a].unload();e.off("mousedown",function(){});s_oStage.removeChild(e);s_oStage.removeChild(k)};this._setStageInfo=function(){for(var b=0,d=0;d<c.length;d++)0<c[d]&&(b=d+1);b<NUM_TRACKS_PER_WORLD&&
(g[b].enable(),g[b].addScore(LEVEL_INFO[a*NUM_TRACKS_PER_WORLD+b].time),g[b].pulseAnimation());for(d=0;d<b;d++)g[d].enable(),g[d].addScore(c[d])};this._onStageBut=function(b){this.unload();s_oWorldMenu.unload();s_oMain.gotoGame(a*NUM_TRACKS_PER_WORLD+b)};this._onBack=function(){for(var a=0;3>a;a++)g[a].setClickable();d.setClickable();var c=this;(new createjs.Tween.get(e)).to({alpha:0},500);(new createjs.Tween.get(k)).to({y:b},400,createjs.Ease.backIn).call(function(){c.unload()})};this._init(a,c)}
function CLevelBut(a,c,b,g,e,d){var k,m,h,f,t=[],l,r,q,z,A=null,x=null,p,u;this._init=function(a,b,c,d){k=!1;m=1;h=[];f=[];l=new createjs.Container;l.x=a;l.y=b;l.scaleX=l.scaleY=m;d.addChild(l);r=new createjs.Container;r.x=a;r.y=b;r.scaleX=l.scaleY=m;d.addChild(r);a=c.width/2;b=c.height;c=new createjs.SpriteSheet({images:[c],frames:{width:a,height:b,regX:a/2,regY:b/2},animations:{on:[0],off:[1]}});p=createSprite(c,"on",a/2,b/2,a,b);l.addChild(p);g?p.gotoAndStop("on"):p.gotoAndStop("off");this._initListener()};
this.unload=function(){s_bMobile?l.off("mousedown",this.buttonDown):(l.off("mousedown",this.buttonDown),l.off("mouseover",this.buttonOver));l.off("pressup",this.buttonRelease);d.removeChild(l)};this.setVisible=function(a){l.visible=a};this.enable=function(){p.gotoAndStop("on");k=!1;null!==x&&(A.color="#000000",x.color="#ffffff")};this.disable=function(){k=!0;p.gotoAndStop("off");null!==x&&(A.color="#000000",x.color="#a8a8a8")};this.setClickable=function(a){k=!a};this.addInfo=function(a){q=new createjs.Text(a,
" 24px "+PRIMARY_FONT,"#000000");q.x=b.height/2-24;q.y=-b.height/2+10;q.textAlign="center";q.textBaseline="middle";q.lineWidth=200;q.outline=4;q.rotation=30;l.addChild(q);z=new createjs.Text(a," 24px "+PRIMARY_FONT,"#ffffff");z.x=q.x;z.y=q.y;z.textAlign="center";z.textBaseline="middle";z.lineWidth=200;z.rotation=q.rotation;l.addChild(z)};this.addScore=function(a){var c=new createjs.Text(formatTime(a)," 30px "+PRIMARY_FONT,"#000000");c.y=b.height/2+12;c.textAlign="center";c.textBaseline="middle";c.lineWidth=
200;c.outline=4;r.addChild(c);a=new createjs.Text(formatTime(a)," 30px "+PRIMARY_FONT,"#ffffff");a.y=c.y;a.textAlign="center";a.textBaseline="middle";a.lineWidth=200;r.addChild(a)};this.addLevelText=function(a){A=new createjs.Text(a," 80px "+PRIMARY_FONT,"#000000");A.y=2;A.textAlign="center";A.textBaseline="middle";A.lineWidth=200;A.outline=8;l.addChild(A);x=new createjs.Text(a," 80px "+PRIMARY_FONT,"#f14e00");x.y=2;x.textAlign="center";x.textBaseline="middle";x.lineWidth=200;l.addChild(x)};this._initListener=
function(){if(s_bMobile)l.on("mousedown",this.buttonDown);else l.on("mousedown",this.buttonDown),l.on("mouseover",this.buttonOver);l.on("pressup",this.buttonRelease)};this.addEventListener=function(a,b,c){h[a]=b;f[a]=c};this.addEventListenerWithParams=function(a,b,c,d){h[a]=b;f[a]=c;t=d};this.buttonRelease=function(){k||(u||(l.scaleX=m,l.scaleY=m),h[ON_MOUSE_UP]&&h[ON_MOUSE_UP].call(f[ON_MOUSE_UP],t))};this.buttonDown=function(){k||(playSound("click",1,0),u||(l.scaleX=.9*m,l.scaleY=.9*m),h[ON_MOUSE_DOWN]&&
h[ON_MOUSE_DOWN].call(f[ON_MOUSE_DOWN],t))};this.buttonOver=function(a){s_bMobile||k||(a.target.cursor="pointer")};this.pulseAnimation=function(){u=createjs.Tween.get(l).to({scaleX:1.1*m,scaleY:1.1*m},850,createjs.Ease.quadOut).to({scaleX:m,scaleY:m},650,createjs.Ease.quadIn).call(function(){L.pulseAnimation()})};this.trembleAnimation=function(){u=createjs.Tween.get(l).to({rotation:5},75,createjs.Ease.quadOut).to({rotation:-5},140,createjs.Ease.quadIn).to({rotation:0},75,createjs.Ease.quadIn).wait(750).call(function(){L.trebleAnimation()})};
this.setImage=function(a){};this.setPosition=function(a,b){l.x=a;l.y=b};this.setScale=function(a){m=a;l.scaleX=l.scaleY=a};this.setX=function(a){l.x=a};this.setY=function(a){l.y=a};this.getButtonImage=function(){return l};this.getX=function(){return l.x};this.getY=function(){return l.y};var L=this;this._init(a,c,b,d);return this}var ROAD_INFO=[],AMBIENT_INFO=[],LEVEL_INFO=[];
ROAD_INFO[0]=[{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,
curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.FINAL,length:ROAD.LENGTH.MEDIUM}];
LEVEL_INFO[0]={time:85E3,num_cars:10,terrain:{roadbounds:2,num_lanes:3,adherence:1,max_inertia:.04},tide:{frequency:[4E3,8E3],height:[500,1E3]}};
AMBIENT_INFO[0]=[{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BUOY3,segments:[10,3200],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BOAT0,segments:[0,3200],position:2,occurrence:30,repetitionevery:50,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BOAT1,segments:[25,3200],position:2,occurrence:20,repetitionevery:150,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD03,
segments:400,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD01,segments:1200,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD01,segments:[3E3,3200],position:.5,repetitionevery:30,disposition:AMBIENT.DISPOSITION.PRECISE}];
ROAD_INFO[1]=[{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:-ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.CURVE_S,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,
curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.CURVE_S,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.FINAL,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.MEDIUM}];LEVEL_INFO[1]={time:95E3,num_cars:15,terrain:{roadbounds:2,num_lanes:3,adherence:1,max_inertia:.04},tide:{frequency:[6E3,9E3],height:[1E3,1E3]}};
AMBIENT_INFO[1]=[{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BUOY0,segments:[10,3850],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD02,segments:[350,450],position:.5,repetitionevery:30,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD04,segments:[900,1200],position:.5,repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD04,segments:[925,
1225],position:.5,repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD03,segments:1700,position:5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD01,segments:2E3,position:4,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD04,segments:2300,position:5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD02,segments:2600,position:6,
disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD03,segments:2900,position:3,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD03,segments:3650,position:0,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BOAT1,segments:[0,3800],position:2,occurrence:30,repetitionevery:50,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BOAT2,segments:[25,3800],position:2,occurrence:20,
repetitionevery:150,disposition:AMBIENT.DISPOSITION.DENSITY}];
ROAD_INFO[2]=[{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:-ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:-ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.HARD},
{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:-ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,
curve:-ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.FINAL,length:ROAD.LENGTH.MEDIUM}];LEVEL_INFO[2]={time:9E4,num_cars:15,terrain:{roadbounds:2,num_lanes:3,adherence:1,max_inertia:.04},tide:{frequency:[5E3,7E3],height:[600,800]}};
AMBIENT_INFO[2]=[{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BUOY1,segments:[10,3850],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD01,segments:[1700,2E3],position:.5,repetitionevery:60,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD01,segments:[1725,2025],position:.5,repetitionevery:60,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD03,segments:1300,
position:.5,repetitionevery:60,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD05,segments:[2400,2800],position:.5,repetitionevery:60,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD01,segments:[3100,3400],position:.5,repetitionevery:50,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD05,segments:2300,position:.5,repetitionevery:60,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,
sprite:SPRITES.BOAT2,segments:[0,3800],position:2,occurrence:30,repetitionevery:50,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BOAT0,segments:[25,3800],position:2,occurrence:20,repetitionevery:150,disposition:AMBIENT.DISPOSITION.DENSITY}];
ROAD_INFO[3]=[{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:-ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:-ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.FINAL,
length:ROAD.LENGTH.LONG}];LEVEL_INFO[3]={time:9E4,num_cars:20,terrain:{roadbounds:2,num_lanes:2,adherence:1,max_inertia:.04},tide:{frequency:[0,1E3],height:[200,500]}};
AMBIENT_INFO[3]=[{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BUOY2,segments:[10,3600],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD01,segments:[2200,2500],position:.5,repetitionevery:60,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD02,segments:[2800,3200],position:.5,repetitionevery:60,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.PALM_TREE,segments:[0,
800],position:5,repetitionevery:16,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.PALM_TREE,segments:[0,800],position:5,repetitionevery:13,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.PALM_TREE,segments:[0,3600],position:10,occurrence:50,repetitionevery:13,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BUSH1,segments:[0,3600],position:5,occurrence:40,repetitionevery:16,disposition:AMBIENT.DISPOSITION.DENSITY}];
ROAD_INFO[4]=[{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.CURVE_S,length:ROAD.LENGTH.SHORT/2,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT/2,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.CURVE_S,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.CURVE_S,length:ROAD.LENGTH.LONG,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.FINAL,length:ROAD.LENGTH.LONG}];
LEVEL_INFO[4]={time:9E4,num_cars:20,terrain:{roadbounds:2,num_lanes:2,adherence:1,max_inertia:.04},tide:{frequency:[0,1E3],height:[400,700]}};
AMBIENT_INFO[4]=[{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BUOY2,segments:[10,3600],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD04,segments:770,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD04,segments:1650,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD02,segments:2E3,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},
{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BOAT0,segments:[0,3E3],position:7,occurrence:20,repetitionevery:50,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.PALM_TREE,segments:[0,1800],position:4,occurrence:60,repetitionevery:13,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.TREE1,segments:[1800,3200],position:5,occurrence:50,repetitionevery:13,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.TREE2,segments:[1200,
3200],position:3,occurrence:40,repetitionevery:17,disposition:AMBIENT.DISPOSITION.DENSITY}];
ROAD_INFO[5]=[{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT/2,curve:-ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT/2,curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT/2,curve:-ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,
length:ROAD.LENGTH.SHORT/2,curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT/2,curve:-ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT/2,curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:-ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT/2},{roadtype:ROAD.TYPE.CURVE_S,length:ROAD.LENGTH.SHORT,curve:-ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,
length:ROAD.LENGTH.LONG,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:-ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.FINAL,length:ROAD.LENGTH.LONG}];LEVEL_INFO[5]={time:7E4,num_cars:25,terrain:{roadbounds:2,num_lanes:2,adherence:1,max_inertia:.04},tide:{frequency:[0,1E3],height:[700,1E3]}};
AMBIENT_INFO[5]=[{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BUOY2,segments:[10,3E3],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD05,segments:20,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD02,segments:[1500,1700],position:.5,repetitionevery:40,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD01,segments:[1525,1725],position:.5,repetitionevery:40,
disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.TREE2,segments:[0,3E3],position:3,occurrence:70,repetitionevery:3,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.PALM_TREE,segments:[1,3E3],position:3,occurrence:70,repetitionevery:3,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BUSH1,segments:[1,3E3],position:9,occurrence:30,repetitionevery:3,disposition:AMBIENT.DISPOSITION.DENSITY}];
ROAD_INFO[6]=[{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,
curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:-ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.FINAL,length:ROAD.LENGTH.LONG}];
LEVEL_INFO[6]={time:125E3,num_cars:60,terrain:{roadbounds:2,num_lanes:4,adherence:1,max_inertia:.04},tide:{frequency:[2500,4E3],height:[800,900]}};
AMBIENT_INFO[6]=[{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BUOY0,segments:[10,4500],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BUOY1,segments:[3850,3900],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BUOY1,segments:[2100,2550],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BUOY1,segments:[2700,3150],position:0,
repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD05,segments:[1500,2E3],position:.5,repetitionevery:40,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD04,segments:[1525,2025],position:.5,repetitionevery:40,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BOAT2,segments:[0,5E3],position:15,occurrence:60,repetitionevery:100,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.BOTH,
sprite:SPRITES.BOAT1,segments:[0,5E3],position:10,occurrence:60,repetitionevery:30,disposition:AMBIENT.DISPOSITION.DENSITY}];
ROAD_INFO[7]=[{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.MEDIUM},
{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,
length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:-ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,
curve:-ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.FINAL,length:ROAD.LENGTH.LONG}];LEVEL_INFO[7]={time:145E3,num_cars:70,terrain:{roadbounds:2,num_lanes:4,adherence:1,max_inertia:.04},tide:{frequency:[2500,4E3],height:[1E3,1E3]}};
AMBIENT_INFO[7]=[{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BUOY3,segments:[10,5200],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD01,segments:[10,650],position:.5,repetitionevery:60,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD03,segments:[1E3,1650],position:.5,repetitionevery:60,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD03,segments:[1030,
1680],position:.5,repetitionevery:60,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BUOY1,segments:[3070,3270],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BUOY1,segments:[3400,3570],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BUOY1,segments:[3700,4100],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,
sprite:SPRITES.BUOY1,segments:[4300,4700],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BOAT3,segments:[1E3,5E3],position:20,occurrence:80,repetitionevery:50,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BOAT3,segments:[2E3,5E3],position:10,occurrence:60,repetitionevery:30,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BOAT3,segments:[3E3,5E3],position:5,occurrence:40,
repetitionevery:10,disposition:AMBIENT.DISPOSITION.DENSITY}];
ROAD_INFO[8]=[{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,
length:ROAD.LENGTH.SHORT},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,
curve:-ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:-ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:-ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:-ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.MEDIUM},
{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:-ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,
curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,curve:-ROAD.CURVE.MEDIUM},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.LONG,curve:-ROAD.CURVE.HARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.EXTRALONG,curve:ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.SHORT,
curve:ROAD.CURVE.EASY},{roadtype:ROAD.TYPE.STANDARD,length:ROAD.LENGTH.MEDIUM,curve:ROAD.CURVE.VERYHARD},{roadtype:ROAD.TYPE.FINAL,length:ROAD.LENGTH.EXTRALONG}];LEVEL_INFO[8]={time:18E4,num_cars:70,terrain:{roadbounds:4,num_lanes:4,adherence:1,max_inertia:.04},tide:{frequency:[500,2E3],height:[1E3,1E3]}};
AMBIENT_INFO[8]=[{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BUOY0,segments:[10,7E3],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BUOY1,segments:[1500,1700],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BUOY1,segments:[2E3,2400],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BUOY1,segments:[4800,5E3],position:0,
repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BUOY1,segments:[5100,5200],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BUOY1,segments:[5300,5700],position:0,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD04,segments:2480,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BILLBOARD04,
segments:3610,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BOAT5,segments:[2500,3600],position:.5,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BOAT2,segments:[2505,3600],position:.5,repetitionevery:10,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD01,segments:6100,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD02,
segments:6200,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD03,segments:6300,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD04,segments:6400,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.LEFT,sprite:SPRITES.BILLBOARD05,segments:6500,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD01,segments:6150,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},
{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD02,segments:6250,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD03,segments:6350,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD04,segments:6450,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.RIGHT,sprite:SPRITES.BILLBOARD05,segments:6550,position:.5,disposition:AMBIENT.DISPOSITION.PRECISE},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BOAT5,
segments:[0,7E3],position:20,occurrence:30,repetitionevery:60,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BOAT4,segments:[0,7E3],position:10,occurrence:60,repetitionevery:30,disposition:AMBIENT.DISPOSITION.DENSITY},{side:AMBIENT.SIDE.BOTH,sprite:SPRITES.BOAT3,segments:[0,7E3],position:20,occurrence:60,repetitionevery:30,disposition:AMBIENT.DISPOSITION.DENSITY}];
function CHorizon(a,c){var b,g,e;this._init=function(a,c){b=0;e=new createjs.Container;c.addChild(e);g=[];var d=Math.floor(a/NUM_TRACKS_PER_WORLD),h="w"+d+"_bg1";d=s_oSpriteLibrary.getSprite("w"+d+"_bg0");this._addBG(d);d=s_oSpriteLibrary.getSprite(h);this._addBG(d)};this._addBG=function(a){a=new CBackground(a,e);g.push(a)};this.resetPos=function(){b=0};this.restart=function(){for(var a=0;a<g.length;a++)g[a].restart()};this.move=function(a){var c=b-a.x;g[0].moveX(c);g[1].moveX(c*PARALLAX_RATIO_X);
g[0].moveY(a.y*PARALLAX_RATIO_Y_0);g[1].moveY(a.y*PARALLAX_RATIO_Y_1);b=a.x};this._init(a,c)}
function CBackground(a,c){var b,g,e;this._init=function(){b=a.height/2-(CANVAS_HEIGHT-2*s_iOffsetY)/2;e=new createjs.Container;c.addChild(e);g=[];for(var d=0;2>d;d++)g[d]=createBitmap(a),g[d].regY=a.height/2,g[d].x=d*a.width,g[d].y=CANVAS_HEIGHT/2,e.addChild(g[d]),g[d].cache(0,0,a.width,a.height)};this.restart=function(){e.x=0;for(var b=e.y=0;2>b;b++)g[b].x=b*a.width,g[b].y=CANVAS_HEIGHT/2};this.moveX=function(b){e.x+=b;b=Math.floor(-e.x/a.width)*a.width;for(var c=0;2>c;c++)g[c].x=b+c*a.width};this.moveY=
function(a){a<-b&&(a=-b);a>b&&(a=b);e.y=a};this._init()}
function CNextLevelPanel(a,c,b){var g,e,d,k,m;this._init=function(a,b,c){playSound("arrive_win",1,!1);setVolume(s_aSounds.game_soundtrack,.5);d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);d.alpha=0;d.on("mousedown",function(){});s_oStage.addChild(d);(new createjs.Tween.get(d)).to({alpha:.7},500);e=new createjs.Container;s_oStage.addChild(e);var f=s_oSpriteLibrary.getSprite("msg_box"),h=createBitmap(f);h.regX=f.width/2;h.regY=f.height/2;e.addChild(h);f=
-f.height/2+70;h=100;(new CTLText(e,-250,f-h/2,500,h,40,"center","#000",PRIMARY_FONT,1,0,0,TEXT_TRACK_COMPLETED,!0,!0,!0,!1)).setOutline(5);new CTLText(e,-250,f-h/2,500,h,40,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_TRACK_COMPLETED,!0,!0,!0,!1);var l=new createjs.Container;l.x=-220;l.y=-30;e.addChild(l);f=s_oSpriteLibrary.getSprite("timer");h=createBitmap(f);h.regX=f.width/2;h.regY=f.height/2;l.addChild(h);f=LEVEL_INFO[c].time-a;h=100;new CTLText(l,34,-(h/2),200,h,50,"left","#fff",PRIMARY_FONT,1,0,
0,formatTime(f),!0,!0,!0,!1);a=new createjs.Container;a.x=100;a.y=l.y;e.addChild(a);f=s_oSpriteLibrary.getSprite("star");c=createBitmap(f);c.regX=f.width/2;c.regY=f.height/2;a.addChild(c);h=100;var t=new CTLText(a,34,-(h/2),200,h,50,"left","#fff",PRIMARY_FONT,1,0,0,"0",!0,!0,!0,!1);e.x=CANVAS_WIDTH/2;e.y=CANVAS_HEIGHT+f.height/2;g=e.y;(new createjs.Tween.get(e)).to({y:CANVAS_HEIGHT/2},500,createjs.Ease.quartIn).call(function(){new CRollingText(t.getText(),b,5E3,!1)});this._sendScore();f=s_oSpriteLibrary.getSprite("but_next");
k=new CGfxButton(120,100,f,e);k.addEventListener(ON_MOUSE_UP,this._onContinue,this);k.pulseAnimation();f=s_oSpriteLibrary.getSprite("but_restart");m=new CGfxButton(-120,100,f,e);m.addEventListener(ON_MOUSE_UP,this._onRestart,this)};this.unload=function(){d.off("mousedown",function(){});s_oStage.removeChild(d);e.removeAllChildren(d);k.unload();m.unload()};this._sendScore=function(){var d=LEVEL_INFO[b].time-a;s_iTotalScore+=c;if(d<s_aTimeScore[b]||0===s_aTimeScore[b])s_aTimeScore[b]=d;s_oLocalStorage.saveData();
$(s_oMain).trigger("save_score",s_iTotalScore)};this._onContinue=function(){m.setClickable(!1);k.setClickable(!1);(new createjs.Tween.get(d)).to({alpha:0},500);(new createjs.Tween.get(e)).to({y:g},400,createjs.Ease.backIn).call(function(){h.unload();s_oGame.nextLevel()})};this._onRestart=function(){m.setClickable(!1);k.setClickable(!1);(new createjs.Tween.get(d)).to({alpha:0},500);(new createjs.Tween.get(e)).to({y:g},400,createjs.Ease.backIn).call(function(){h.unload();s_oGame.restartGame()})};this._onFinishRolling=
function(){};this._onRollingRemoved=function(){};this._onRollingText=function(a){(void 0).playManualMode(a,STAR_EFFECT_SCALE)};var h=this;this._init(a,c,b)}
function CRollingText(a,c,b,g){var e=null,d;this._init=function(a,b,c){d={value:parseInt(a.text)};e=createjs.Tween.get(d,{override:!0}).to({value:b},c,createjs.Ease.cubicInOut).addEventListener("change",function(){a.text=g?formatTime(d.value):"+"+Math.floor(d.value)}).call(function(){createjs.Tween.removeTweens(e)})};this._init(a,c,b);return this}var LOCALSTORAGE_TIMES="times",LOCALSTORAGE_TOTALSCORE="totalscore",s_aTimeScore=[],s_iTotalScore=0;
function CLocalStorage(a){var c=!0;this._init=function(a){try{var b=window.localStorage.getItem(a);this.resetData();null!==b&&void 0!==b&&this.loadData()}catch(e){this.resetData()}};this.isDirty=function(){for(var a=0;a<s_aTimeScore.length;a++)if(0<s_aTimeScore[a])return!0;return!1};this.isUsed=function(){try{window.localStorage.setItem("ls_available","ok")}catch(b){c=!1}return c};this.resetData=function(){s_aTimeScore=[];for(var a=0;a<NUM_TRACKS_PER_WORLD*NUM_WORLDS;a++)s_aTimeScore[a]=0;s_iTotalScore=
0};this.deleteData=function(){window.localStorage.removeItem(a)};this.saveData=function(){var b={};b[LOCALSTORAGE_TIMES]=s_aTimeScore;b[LOCALSTORAGE_TOTALSCORE]=s_iTotalScore;window.localStorage.setItem(a,JSON.stringify(b))};this.loadData=function(){var b=JSON.parse(window.localStorage.getItem(a)),c=b[LOCALSTORAGE_TIMES];s_aTimeScore=[];for(var e=0;e<c.length;e++)s_aTimeScore[e]=parseInt(c[e]);s_iTotalScore=parseInt(b[LOCALSTORAGE_TOTALSCORE])};this._init(a)}
function CLosePanel(){var a,c,b,g,e;this._init=function(){setVolume(s_aSounds.game_soundtrack,.5);c=new createjs.Shape;c.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);c.alpha=0;c.on("mousedown",function(){});s_oStage.addChild(c);(new createjs.Tween.get(c)).to({alpha:.7},500);b=new createjs.Container;s_oStage.addChild(b);var d=s_oSpriteLibrary.getSprite("msg_box"),m=createBitmap(d);m.regX=d.width/2;m.regY=d.height/2;b.addChild(m);b.x=CANVAS_WIDTH/2;b.y=CANVAS_HEIGHT+d.height/
2;a=b.y;(new createjs.Tween.get(b)).to({y:CANVAS_HEIGHT/2},500,createjs.Ease.quartIn);d=s_oSpriteLibrary.getSprite("baloon_mc");m=createBitmap(d);m.regX=d.width/2;m.regY=d.height/2;m.y=-10;m.scaleX=m.scaleY=.6;b.addChild(m);d=-d.height/2+30;(new CTLText(b,-250,d-50,500,100,50,"center","#000",PRIMARY_FONT,1,0,0,TEXT_TIME_IS_UP,!0,!0,!0,!1)).setOutline(5);new CTLText(b,-250,d-50,500,100,50,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_TIME_IS_UP,!0,!0,!0,!1);d=s_oSpriteLibrary.getSprite("but_exit");g=new CGfxButton(120,
100,d,b);g.addEventListener(ON_MOUSE_UP,this._onExit,this);d=s_oSpriteLibrary.getSprite("but_restart");e=new CGfxButton(-120,100,d,b);e.addEventListener(ON_MOUSE_UP,this._onRestart,this);e.pulseAnimation()};this.unload=function(){s_oStage.removeChild(b);c.off("mousedown",function(){});g.unload();e.unload()};this.show=function(){playSound("arrive_lose",1,0)};this._onExit=function(){c.off("mousedown",function(){});s_oStage.removeChild(b);s_oGame.onExit()};this._onRestart=function(){e.setClickable(!1);
g.setClickable(!1);(new createjs.Tween.get(c)).to({alpha:0},500);(new createjs.Tween.get(b)).to({y:a},400,createjs.Ease.backIn).call(function(){d.unload();s_oGame.restartGame()})};var d=this;this._init();return this}
function CTimer(a,c,b,g,e,d,k){var m,h,f;this._init=function(a,b,c,d,e,g,k){m=new createjs.Container;m.x=a;m.y=b;c.addChild(m);a=0;g&&(g=s_oSpriteLibrary.getSprite(g),a=createBitmap(g),a.regY=g.height/2,m.addChild(a),a=g.width);h=new createjs.Text("00:00"," "+d+"px "+PRIMARY_FONT,k);h.x=a+10;h.textAlign="left";h.textBaseline="middle";h.lineWidth=500;h.outline=6;m.addChild(h);f=new createjs.Text(h.text," "+d+"px "+PRIMARY_FONT,e);f.x=h.x;f.y=h.y;f.textAlign=h.textAlign;f.textBaseline=h.textBaseline;
f.lineWidth=h.lineWidth;m.addChild(f);m.regX=m.getBounds().width/2};this.setDecimalTime=function(a){a=formatTime(a);h.text=a;f.text=a};this.setIntTime=function(a){a=Math.floor(a/1E3);h.text=a;f.text=a};this.setSpeedIndicator=function(a){a=Math.floor(a);h.text=a;f.text=a};this.setAlign=function(a,b){h.textAlign=a;h.textBaseline=b;f.textAlign=h.textAlign;f.textBaseline=h.textBaseline};this.resetTextRelativePos=function(){h.x=0;h.y=0;f.x=h.x;f.y=h.y;m.regX=0};this.setPos=function(a,b){m.x=a;m.y=b};this._init(a,
c,b,g,e,d,k)}
function CTachometer(a,c){var b,g,e,d;this._init=function(a,c){b=a;g=c;e=new createjs.Container;e.x=b;e.y=g;s_oStage.addChild(e);var h=s_oSpriteLibrary.getSprite("tachometer"),f=createBitmap(h);f.regX=h.width/2;f.regY=h.height;e.addChild(f);new CTLText(e,-70,-115,140,40,40,"center","#ffcc00",PRIMARY_FONT,1,0,0,TEXT_SPEED_INDICATOR,!0,!0,!1,!1);new CTLText(e,-45,-73,90,60,60,"right","#222222",SECONDARY_FONT,1,0,0,"888",!0,!0,!1,!1);d=new CTLText(e,-45,-73,90,60,60,"right","#fff",SECONDARY_FONT,1,0,
0,"0",!0,!0,!1,!1)};this.setSpeedIndicator=function(a){d.refreshText(Math.floor(a))};this.updateOffset=function(a,c){e.x=b+a;e.y=g-c};this._init(a,c)}
function CMsgBox(a,c){var b,g,e,d,k;this._init=function(a,c){d=new createjs.Shape;d.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);d.alpha=0;d.on("mousedown",function(){});s_oStage.addChild(d);(new createjs.Tween.get(d)).to({alpha:.7},500);k=new createjs.Container;s_oStage.addChild(k);var f=s_oSpriteLibrary.getSprite("msg_box"),h=createBitmap(f);h.regX=f.width/2;h.regY=f.height/2;k.addChild(h);k.x=CANVAS_WIDTH/2;k.y=CANVAS_HEIGHT+f.height/2;b=k.y;(new createjs.Tween.get(k)).to({y:CANVAS_HEIGHT/
2-40},500,createjs.Ease.quartIn);g=new CTLText(k,-300,-f.height/2+100-85,600,170,26,"center","#fff",PRIMARY_FONT,1,0,0,a,!0,!0,!0,!1);e=new CGfxButton(0,80,s_oSpriteLibrary.getSprite("but_yes"),k);e.addEventListener(ON_MOUSE_UP,this._onButYes,this);e.pulseAnimation()};this._onButYes=function(){e.setClickable(!1);(new createjs.Tween.get(d)).to({alpha:0},500);(new createjs.Tween.get(k)).to({y:b},400,createjs.Ease.backIn).call(function(){m.unload();c&&c()})};this.changeMessage=function(a){g.text=a};
this.unload=function(){e.unload();s_oStage.removeChild(d);s_oStage.removeChild(k);d.off("mousedown",function(){})};var m=this;this._init(a,c)}
function CTremble(a,c,b,g){var e,d,k,m,h,f,t;this._init=function(a,b,c,g){m=k=!1;f=0;this._calculateDuration();e=a.x;d=a.y;k||(k=!0,h=setInterval(function(){l._tremble()},c))};this._tremble=function(){if(m=!m){var r=.5>Math.random()?-g:g;var q=.5>Math.random()?-g:g;a.x+=r;a.y+=q}else a.x=e,a.y=d;f++;f>t&&(f=0,k=!1,s_oGame.endDamageTime(),a.x=e,a.y=d,0===c?h=setInterval(function(){l._tremble()},b):clearInterval(h))};this._calculateDuration=function(){t=c/b};this.stopTremble=function(){clearInterval(h)};
var l=this;this._init(a,c,b,g)}
function CAreYouSurePanel(a,c){var b,g,e,d,k,m,h;this._init=function(a,c){m=new createjs.Shape;m.graphics.beginFill("black").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);m.alpha=0;m.on("mousedown",function(){});s_oStage.addChild(m);(new createjs.Tween.get(m)).to({alpha:.7},500);h=new createjs.Container;s_oStage.addChild(h);var f=s_oSpriteLibrary.getSprite("msg_box"),l=createBitmap(f);l.regX=f.width/2;l.regY=f.height/2;h.addChild(l);h.x=CANVAS_WIDTH/2;h.y=CANVAS_HEIGHT+f.height/2;b=h.y;(new createjs.Tween.get(h)).to({y:CANVAS_HEIGHT/
2-40},500,createjs.Ease.cubicOut);f=-f.height/2+120;g=new CTLText(h,-300,f-70,600,140,60,"center","#000",PRIMARY_FONT,1,0,0,TEXT_ARE_SURE,!0,!0,!0,!1);g.setOutline(5);e=new CTLText(h,-300,f-70,600,140,60,"center","#fff",PRIMARY_FONT,1,0,0,TEXT_ARE_SURE,!0,!0,!0,!1);d=new CGfxButton(110,80,s_oSpriteLibrary.getSprite("but_yes"),h);d.addEventListener(ON_MOUSE_UP,this._onButYes,this);k=new CGfxButton(-110,80,s_oSpriteLibrary.getSprite("but_exit"),h);k.addEventListener(ON_MOUSE_UP,this._onButNo,this);
k.pulseAnimation()};this._onButYes=function(){k.setClickable(!1);d.setClickable(!1);(new createjs.Tween.get(m)).to({alpha:0},500);(new createjs.Tween.get(h)).to({y:b},400,createjs.Ease.backIn).call(function(){f.unload();a&&a()})};this._onButNo=function(){k.setClickable(!1);d.setClickable(!1);(new createjs.Tween.get(m)).to({alpha:0},500);(new createjs.Tween.get(h)).to({y:b},400,createjs.Ease.backIn).call(function(){f.unload();c&&c()})};this.changeMessage=function(a,b){g.text=a;e.text=a;b&&(g.font=
" "+b+"px "+PRIMARY_FONT,e.font=" "+b+"px "+PRIMARY_FONT)};this.unload=function(){k.unload();d.unload();s_oStage.removeChild(m);s_oStage.removeChild(h);m.off("mousedown",function(){})};var f=this;this._init(a,c)}
function CTideController(){var a,c;this._init=function(){a=0;c=[]};this.flattenTide=function(a){for(a=c.length-1;0<=a;a--)s_oRoad.setTide(c[a].pos,c[a].dim,0),c.splice(a,1)};this._generateTide=function(){var a=randomFloatBetween(TIDE_VARIABLE_HEIGHT[0],TIDE_VARIABLE_HEIGHT[1]);c.push({pos:s_oGame.getPlayer().getPosition().z+5E4,dim:16,maxheight:a,curheight:0,speed:TIDE_SPEED})};this.moveTide=function(a){c[a].pos-=c[a].speed;s_oRoad.setTide(c[a].pos,c[a].dim,c[a].curheight);c[a].curheight+=TIDE_RAISE_HEIGHT_SPEED;
c[a].curheight>c[a].maxheight&&(c[a].curheight=c[a].maxheight)};this.update=function(){a+=s_iTimeElaps;var b=TIDE_BASE_FREQUENCY-1E3*s_oGame.getPlayer().getSpeedRatio()+randomFloatBetween(TIDE_VARIABLE_FREQUENCY[0],TIDE_VARIABLE_FREQUENCY[1]);a>b&&(a=0,this._generateTide());for(b=0;b<c.length;b++)this.moveTide(b);for(b=c.length-1;0<=b;b--)c[b].pos<s_oGame.getPlayer().getPosition().z-c[b].dim*SEGMENT_LENGTH&&(s_oRoad.setTide(c[b].pos,c[b].dim,0),c.splice(b,1))};this._init()}
function CFoamParticle(){var a,c;this._init=function(){};this.addBottom=function(b,c,e){var d=s_oSpriteLibrary.getSprite("foam_bottom_0"),g=s_oSpriteLibrary.getSprite("foam_bottom_1"),m=g.width/4,h=g.height;d=new createjs.SpriteSheet({images:[d,g],frames:{width:m,height:h,regX:m/2,regY:h/2},animations:{idle:[0,27]}});a=createSprite(d,"idle",m/2,h/2,m,h);a.x=b;a.y=c;e.addChild(a)};this.addBack=function(a,g,e){for(var b=[],k=0;29>k;k++)b.push(s_oSpriteLibrary.getSprite("foam_back_"+k));k=b[0].width;
var m=b[0].height;b=new createjs.SpriteSheet({images:b,frames:{width:k,height:m,regX:k/2,regY:m-18},animations:{idle:[0,28]}});c=createSprite(b,"idle",k/2,m/2,k,m);c.x=a;c.y=g;e.addChild(c)};this.setSpeed=function(b){a.framerate=b;c.framerate=b};this.setVisible=function(b){a.visible=b;c.visible=b};this.setAlpha=function(b){a.alpha=b;c.alpha=b};this.setBottomAlpha=function(b){a.alpha=b};this.setBottomVisible=function(b){a.visible=b};this.setBackAlpha=function(a){c.alpha=a};this.setBackVisible=function(a){c.visible=
a};this.setBackScale=function(a){c.scaleX=c.scaleY=a};this.setBackRotation=function(a){c.rotation=a};this._init()};